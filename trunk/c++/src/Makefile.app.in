#################################
# $Id$
# Author:  Denis Vakatov (vakatov@ncbi.nlm.nih.gov)
#################################
# Must be used this way:
#
# srcdir = @srcdir@
# include @builddir@/Makefile.mk
#
# APP1  = app1
# OBJ1  = app1
# LIB1  = libp1
#
# APP2  = app2
# OBJ2  = app2 app2_1 app2_2
# LIB2  = libp1
#
# SUBPROJ = sub_proj1 sub_proj2
#
# .....
# CXXFLAGS = -g $(ORIG_CXXFLAGS) -D_DEBUG -DXYZ_APP1
# .....
# include @builddir@/Makefile.app
#
# ### Standard build rules for "app1"
# XAPP1 = $(APP1)@exe_ext@
# XOBJ1 = $(APPOBJ_APP1:=@obj_ext@)
# XLIB1 = @f_libpath@$(libdir) $(LIB1:lib=@lib_pre@)
# $(XAPP1): $(XOBJ1) $(libdir)/$(LIB_APP1)@lib_ext@
# 	$(LINK) $(LDFLAGS) $(XOBJ1) $(XLIB1) $(LIBS)
#
# ### Standard build rules for "app2"
# XAPP2 = $(APP2)@exe_ext@
# XOBJ2 = $(APPOBJ_APP2:=@obj_ext@)
# XLIB2 = @f_libpath@$(libdir) $(LIB2:lib=@lib_pre@)
# $(XAPP2): $(XOBJ2) $(libdir)/$(LIB_APP2)@lib_ext@
# 	$(LINK) $(LDFLAGS) $(XOBJ2) $(XLIB2) $(LIBS)
#
#################################


### C/C++ source file compilation rules

%.@obj_ext@: $(srcdir)/%.cpp
	$(CXX) @f_compile@ $(CXXFLAGS) $(CPPFLAGS) $< @f_outobj@ $@
%.@obj_ext@: $(srcdir)/%.c
	$(CC)  @f_compile@ $(CFLAGS)   $(CPPFLAGS) $< @f_outobj@ $@


### Standard targets(non-recursive)

all: $(APP)

install: all
	$(COPY) $(APP) $(bindir)/

clean:
	-$(RMDIR) SunWS_cache
	-$(RM) .make.state
	-$(RM) *@obj_ext@
	-$(RM) $(APP:=@exe_ext@)
	-$(RM) *~


### Standard targets
### Recursive build -- in the $(SUBPROJ) directories

all_r: all
	@if ! -z "$(SUBPROJ)" ; then \
		for i in $(SUBPROJ) ; do \
			( cd $$i ; $(MAKE) $(MFLAGS) $@ ) ; \
		done ; \
	fi

install_r: install
	@if ! -z "$(SUBPROJ)" ; then \
		for i in $(SUBPROJ) ; do \
			( cd $$i ; $(MAKE) $(MFLAGS) $@ ) ; \
		done ; \
	fi

clean_r: clean
	@if ! -z "$(SUBPROJ)" ; then \
		for i in $(SUBPROJ) ; do \
			( cd $$i ; $(MAKE) $(MFLAGS) $@ ) ; \
		done ; \
	fi

