<!--#set var="TITLE" value="NCBI C++ Object Manager library" -->
<!--#set var="DOCROOT" value="../.." -->
<!--#include virtual="../../ssi/header.shtml" -->



<div align="Center">
<h1>Object Manager.</h1>
</div>




<h2>Internal classes - attributes and operations.</h2>
<ul>
  <li><a href="#Indexing">Indexing.</a></li>
  <li><a href="#Seq_id_Handle">Seq_id_Handle and Seq_id_Mapper.</a></li>
</ul>
<hr>




<h3><a name="Indexing"></a>Indexing.</h3>
<p>
In order to facilitate the data search, Object Manager's objects
create and maintain a number of  internal indices.
</p>



<h4>Data source.</h4>
<p>
Data source
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CDataSource">CDataSource</a>)
manages a set of Seq_entries, possibly several of which may
be Top level  ones. It contains the following indices:
</p>


<ul>
  <li>a map of known to this Data source Seq_entries and corresponding Top-level
    seq.entry info - here several seq entries may be mapped to a single
    top-level seq entry info (
	<code>map&lt;CRef&lt;CSeq_entry&gt;,CRef&lt;CTSE_Info&gt;&gt; m_Entries</code>
	),</li>

  <li>a map of Seq_ids to the set of top level Seq_entries which contain bio
    sequence with this Seq_id (
	<code>map&lt;CSeq_id_Handle,set&lt;CRef&lt;CTSE_Info&gt;&gt; m_TSE_seq</code>
	),</li>

  <li>a map of Seq_ids to the set of top level Seq_entries which reference
    bio sequence with this Seq_id in annotations or sequence data (
	<code>map&lt;CSeq_id_Handle,set&lt;CRef&lt;CTSE_Info&gt;&gt; m_TSE_ref</code>
    ),</li>

  <li>a map of CBioseq's pointer to corresponding SeqMap (
    <code>map&lt;const CBioseq*,CRef&lt;CSeqMap&gt;&gt; m_SeqMaps</code>
	)</li>
</ul>




<h4>Top-level seq entry info (TSE info).</h4>
<p>
TSE_info
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CTSE_Info">CTSE_Info</a>)
object contains information about a specific Seq_entry within
a given Data source. It contains:
</p>

<ul>
  <li>a map of Seq_ids to corresponding Bioseq_info data objects (
    <code>map&lt;CSeq_id_Handle,CRef&lt;CBioseq_Info&gt;&gt; m_BioseqMap</code>
	),</li>

  <li>a map of Seq_ids to a data structure which describes position (in terms
    of ranges) of annotation  objects on  the sequence (
	<code>map&lt;CSeq_id_Handle,CRangeMultimap&lt;CRef&lt;CAnnotObject&gt;,CRange&lt;int&gt;::position_type&gt;&gt; m_AnnotMap</code>
	).</li>
</ul>




<h4>Bioseq info.</h4>
<p>
Bioseq_info
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CBioseq_Info"> CBioseq_Info</a>)
contains a set of Seq_ids (Seq_id_Handles) which identify a
given Seq_entry (
<code>set&lt;CSeq_id_Handle&gt; m_Synonyms</code>).
</p>



<h4>Handle range map.</h4>
<p>
This object
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CHandleRangeMap">CHandleRangeMap</a>)
contains a map of Bioseq handle to Handle range (
<code>map&lt;CBioseq_Handle,CHandleRange&gt; m_LocMap</code>
).
</p>



<h4>Handle range.</h4>
<p>
The object
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CHandleRange"> CHandleRange</a>)
contains a list of locations for a particular bio sequence (
<code>list&lt;pair&lt;CRange&lt;int&gt;,ENa_strand&gt;&gt; m_Ranges</code>
).
</p>







<h3><a name="Seq_id_Handle"></a>Seq_id_Handle and Seq_id_Mapper.</h3>
<p>
Seq_id_Handle
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CSeq_id_Handle">CSeq_id_Handle</a>)
is an internal object, which is used as an alias (or  substitute)
to  Seq_id. Seq_id_Mapper
(<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CSeq_id_Mapper">CSeq_id_Mapper</a>)
maps one to another, back and forth.  The map is created and
maintained by the Object Manager. Different Object  Managers have different
maps.   Such map is populated by Data sources when they load and index
data.
</p>
<p>
CSeq_id_Handle is designed for more efficient indexing and
searching.  Each  Seq_id is mapped to a unique handle. Such handles
are  not aware of bio sequences  or other ways of Seq_id usage.
</p>



<h4>CSeq_id_Handle  object methods:</h4>
<pre>
  // copy (assignment) operator
  CSeq_id_Handle&amp; operator= (const CSeq_id_Handle&amp; handle);
  // comparison
  bool operator== (const CSeq_id_Handle&amp; handle) const;
  bool operator&lt;  (const CSeq_id_Handle&amp; handle) const;
  // Check if the handle is a valid or an empty one
  operator bool(void) const;
  // Reset the handle (remove seq-id reference)
  void Reset(void);
</pre>

<p>
Handles have comparison operators, which makes it possible
to  use  them  with  STL maps, lists or sets. A newly created handle is
not  assigned to any Seq_id. Whether a handle has been initialized or
not can be checked   with operator  bool(): an assigned handle will return
true, while an unassigned  one will return false.
</p>



<h4>CSeq_id_Mapper  object methods:</h4>
<pre>
    // Get seq-id handle. Create new handle if not found and
    // do_not_create is false. Get only the exactly equal seq-id handle.
    CSeq_id_Handle GetHandle(const CSeq_id&amp; id, bool do_not_create=false);
    // Get the list of matching handles, do not create new handles
    void GetMatchingHandles(const CSeq_id&amp; id, TSeq_id_HandleSet&amp; h_set);
    // Get the list of string-matching handles, do not create new handles
    void GetMatchingHandlesStr(string sid, TSeq_id_HandleSet&amp; h_set);
    // Get seq-id for the given handle
    static const CSeq_id&amp; GetSeq_id(const CSeq_id_Handle&amp; handle);
    // References to each handle must be tracked to re-use their values
    void AddHandleReference(const CSeq_id_Handle&amp; handle);
    void ReleaseHandleReference(const CSeq_id_Handle&amp; handle);
</pre>

<p>
<code>GetMatchingHandles</code>
method populates the "h_set" container with handles for
all   seq-ids     matching to the "id". E.g. if "id" contains accession "A"
 without   version     information, the set may be populated with all of
"A",  "A.1",   "A.2" etc.    Special rules may be applied to some seq-id types
(e.g. GenBank,   EMBL and    DDBJ ids share the same accession space and
are searched together).   No new   handles are created for the "id".
</p>

<p>
<code>GetMatchingHandlesStr</code>
method populates the "h_set" with handles for all seq-ids,
containing "sid" string in their key fields (accession, name, integer
id corresponding  to the string value etc.).
</p>

<p>
Internally each handle maps to an integer value (key), mapped
to  a  Seq_id.    Keys may be re-used when there is no client using a particular
seq-id handle.    The keys are locked and released by groups, the total
number  of groups is   defined by kKeyUsageTableSize constant. When all
keys  in a  group are released,   the whole group of keys may be used to
map other   seq-ids.  This may result   in obtaining different handles (keys)
for the   same id or  getting the same   handle for different seq-ids. To
avoid such   misbehavior  AddHandleReference()    and ReleaseHandleReference()
methods   of CSeq_id_Mapper  are called by CSeq_id_Handle constructor and destructor.
</p>



<br>
<!--#include virtual="../../ssi/navlinks.shtml" -->

<!-- Begin footer content -->



<!--#include virtual="../../ssi/footer.shtml" -->
