(function(d){var k=d.browser.msie,p=k&&d.browser.version=="6.0"||false,q=d.browser.safari||false,m=null,r=function(a){if(typeof a!=="undefined")return Math.max.apply(Math,a)};d.widget("ui.ncbimenu",{styles:{hilited:"ui-ncbimenu-item-active",item:"ui-ncbimenu-item",itemFirst:"ui-ncbimenu-item-first",itemFirstHilited:"ui-ncbimenu-item-first-active",itemHasSubmenu:"ui-ncbimenu-item-has-submenu",itemLeaf:"ui-ncbimenu-item-leaf",itemNoHilite:"ui-ncbimenu-item-no-hlt",itemSkip:"ui-ncbimenu-item-skip",randClass:d.ui.jig._generateId("ncbimenu"),
submenu:"ui-ncbimenu-submenu",submenuOpen:"ui-ncbimenu-submenu-open"},_init:function(){d.ui.ncbimenu._rootNodes.push(this.element);this._menuIsActive=this.options.disabled=false;this._setAttrs();this._setEvents();this._register()},_areInstances:function(){return d.ui.ncbimenu._areInstances},_focus:function(a){a=d(a);if(k)a.attr("href")||a.attr("href","#");else{var b=q&&!a.attr("href")?true:false;b&&a.attr("href","#");a[0].focus();b&&a.removeAttr("href")}},_register:function(){d.ui.ncbimenu._areInstances=
true},_setAttrs:function(){var a=this.styles,b=this;this.firstItems=this.element.addClass("ui-widget ui-ncbimenu "+a.randClass).children("li");this.firstItems.each(function(e){var c=d(this),f=b.isSkip(c);if(!k&&!f)if(e!==0)c.children("a")[0].tabIndex=-1;else{c.children("a")[0].tabIndex=0;q&&c.children("ul").length>0&&c.children("a").attr("href","#")}c.children("ul").length===1?c.children("a").addClass("ui-ncbimenu-first-link-has-submenu").attr({"aria-haspopup":"true"}).next("ul").attr("aria-hidden",
"true"):c.addClass(a.itemLeaf);c.addClass(a.itemFirst+" ui-helper-reset ui-ncbimenu "+a.randClass).attr("role","presentation").children("a").attr("role","menuitem").addClass(a.randClass+" ui-ncbimenu-link-first");f||c.children("a").addClass("ui-ncbimenu");d.browser.safari&&d(window).load(function(){c.width(c.outerWidth())})});this.element.attr("role",this.firstItems.length>1?"menubar":"menu")},_setEvents:function(){var a=this,b=this.element[0];this.element.unbind("click.NCBIMenu").bind("click.NCBIMenu",
function(c){a._delegate(c,a)}).mouseover(function(c){a._delegate(c,a)}).mouseout(function(c){a._delegate(c,a)}).keyup(function(c){a._delegate(c,a)});if(document.addEventListener)b.addEventListener("focus",function(c){a._delegate(c,a)},true);else b.onfocusin=function(){a._delegate(null,a)};if(!this._areInstances()){d(document).click(function(c){a._closeAllMenus(c,a)});var e=function(c){c=c||window.event;var f=c.target||c.srcElement;f.tagName&&f!==d(b).parent()[0]&&!d(f).hasClass("ui-ncbimenu")&&a._closeAllMenus(c,
a)};if(document.addEventListener)document.addEventListener("focus",function(c){e(c)},true);else document.onfocusin=e}},_delegate:function(a,b){var e,c;if(a){e=a.type;c=a.target}else{e=window.event.type;c=window.event.srcElement}for(;c.tagName&&c.tagName.toLowerCase()!=="a";)c=d(c).parent()[0];tJ=d(c);var f=tJ.parent("li"),i=b.styles,h=f.hasClass(i.itemFirst);if(e==="click"){b._menuIsActive=true;if(h||k)b._activateItem(c,e);b.isSkip(f)||f.hasClass(i.itemLeaf)||a.preventDefault()}if(e==="mouseover"&&
c.tagName&&c.tagName.toLowerCase()==="a"){if(h)this._menuIsActive?this._activateItem(c,"mouseover",false):this._activateItem(c);f.hasClass(i.item)&&b._activateItem(c,e)}if(e==="keyup"){h=a.keyCode;var j=d.ui.keyCode;h===j.DOWN&&b._activateItem(c,"down");h===j.UP&&b._activateItem(c,"up");h===j.RIGHT&&b._activateItem(c,"right");h===j.LEFT&&b._activateItem(c,"left");h===j.ESCAPE&&b._closeAllMenus(a,b,true)}e==="mouseout"&&f.hasClass(i.itemFirst)&&!d(a.relatedTarget).hasClass("ui-ncbimenu")&&b._unHiliteItem(c);
if(e==="focus"||e==="focusin"){k&&tJ.attr("aria-haspopup","true")&&b._closeSiblingSubmenus(tJ);b._unHiliteSiblings(c)}},_getSubMenu:function(a){return a.siblings("ul")},isSkip:function(a){return skip=d(a).hasClass(this.styles.itemSkip)?true:false},_unHiliteItem:function(a){a=d(a);a.removeClass(this.styles.hilited+" ui-ncbimenu-first-link-has-submenu-active "+this.styles.itemFirstHilited)},_hiliteItem:function(a){var b=this.styles;a=d(a);parentLi=a.parent("li");if(!this.isSkip(parentLi)){if(!parentLi.hasClass(b.itemNoHilite))if(a.parent("li").hasClass(b.itemFirst)){a.addClass(b.itemFirstHilited);
a.hasClass("ui-ncbimenu-first-link-has-submenu")&&a.addClass("ui-ncbimenu-first-link-has-submenu-active")}else a.addClass(this.styles.hilited);if(!k)a[0].tabIndex=0;this._focus(a);if(!k&&d.ui.ncbimenu._activeLink)d.ui.ncbimenu._activeLink[0].tabIndex=-1;d.ui.ncbimenu._activeLink=a}},_unHiliteSiblings:function(a){var b=this;d(a).parent("li").siblings("li").children("a").each(function(){b._unHiliteItem(this)})},_openSubmenu:function(a){var b=this.styles,e=d(a.el)||null;this.element.addClass("ui-ncbimenu-has-active-submenu");
if(!this._firstTime){this.element.hide().show();this._firstTime=true}a=a.callback||null;var c=this;if(e.length!==0){if(!e)throw new Error("ncbigrid: _openSubmenu() method must be passed a DOM or jQuery collection representing the menu to be opened");var f=e.children("li").andSelf().children("a").andSelf().addClass(b.randclass);e.data("jig-ncbimenu-subnodes",f);var i=e.data("jig-ncbimenu-width");if(typeof i==="undefined"){e.data("widths",[]);var h=false,j=[];f.each(function(){var g=d(this),n=g[0].tagName.toLowerCase();
if(n==="li"){g.addClass(b.item+" ui-helper-reset").attr("role","presentation");if(g.children("ul").length>0){g.addClass(b.itemHasSubmenu);h||(h=true)}else g.addClass(b.itemLeaf)}n==="ul"&&g.addClass(b.submenu).attr("role","menu").css("z-index",c.options.submenuZindex);if(n==="a"){g.attr({role:"menuitem"});if(!k&&!c.isSkip(g.parent("li")))g[0].tabIndex=-1;g.next("ul").length>0&&g.attr({"aria-haspopup":"true"}).append('<span class="ui-ncbimenu ui-icon ui-icon-triangle-1-e"></span>');e.css({position:"absolute",
left:"-2000px"});e.css("display","block");g.css("display","inline");j.push(g.outerWidth());g.css("display","block");e.css("left","auto")}}).addClass(b.randClass+" ui-ncbimenu");i=r(j);var o=h?(i+=12):i;e.data("jig-ncbimenu-width",o);i=e.data("jig-ncbimenu-width");e.parent("li").hasClass(b.itemHasSubmenu)&&e.css("margin-left",e.parent("li").parent("ul").data("jig-ncbimenu-width"))}var l=e.data("jig-ncbimenu-width");f.each(function(){var g=d(this);g[0].tagName.toLowerCase()==="a"?g.css("width",l-(parseInt(g.css("padding-right"))+
parseInt(g.css("padding-left"))+1)):g.css("width",l)});e.css({position:"absolute",display:"block"}).attr("aria-hidden","false").addClass(this.styles.submenuOpen);typeof a==="function"&&a();if(p)if(e.data("iframe"))d("#"+e.data("iframe")).show();else{a=d.ui.jig._generateId(this.widgetName,"iframe-fix");d(e).createIE6LayerFix(true).attr("id",a);e.data("iframe",a)}}},_closeSubmenu:function(a){var b=d(a.el)||null,e=a.delay||null,c=a.callback||null,f=a.submenuFadeSpeed||0;if(!b)throw new Error("ncbigrid: _openSubmenu() method must be passed a DOM or jQuery collection representing the menu to be closed");
var i=this;b.data("jig-ncbimenu-subnodes")&&b.data("jig-ncbimenu-subnodes").each(function(){d(this).css("width","auto")});b.children("li").each(function(){i._unHiliteItem(d(this).find("a"))});if(e)window.setTimeout(function(){b.fadeOut(f,function(){d(this).css("position","static").removeClass(i.styles.submenuOpen);typeof c==="function"&&c()})},e);else{b.css({position:"static",display:"none"}).attr("aria-hidden","true").removeClass(this.styles.submenuOpen);typeof c==="function"&&c()}p&&d("#"+b.data("iframe")).hide()},
_closeSiblingSubmenus:function(a,b){var e=this;a.parent("li").siblings("li").find("ul.ui-ncbimenu-submenu-open").each(function(){b?e._closeSubmenu({el:d(this),delay:e.options.submenuDelay,submenuFadeSpeed:e.options.submenuFadeSpeed}):e._closeSubmenu({el:d(this)})})},_closeGrandChildSubmenu:function(a,b){a=a.parent("li").children("ul").children("li").children("ul");b?this._closeSubmenu({el:a,delay:this.options.submenuDelay,submenuFadeSpeed:this.options.submenuFadeSpeed}):this._closeSubmenu({el:a})},
_closeChildSubmenu:function(a,b){a=a.siblings("ul");b?this._closeSubmenu({el:a,delay:this.options.submenuDelay,submenuFadeSpeed:this.options.submenuFadeSpeed}):this._closeSubmenu({el:a})},_closeAllMenus:function(a,b,e){if(!d(a.target).hasClass("ui-ncbimenu")||e){a=d.ui.ncbimenu._rootNodes;for(var c=0;c<a.length;c++)d(a[c]).children("li").children("a").each(function(f){if(!b.isSkip(d(this).parent("li"))){if(!k)f==0?(this.tabIndex=0):(this.tabIndex=-1);b._unHiliteItem(this)}}).end().find("ul").each(function(){b._closeSubmenu({el:d(this)})});
this._menuIsActive=false}if(c>0){this.element.removeClass("ui-ncbimenu-has-active-submenu");this._firstTime=false}},_getNextItem:function(a){var b=a.parent("li").next("li");if(b.length===0){b=a.parent("li").siblings("li:first");if(b.length===0)return a}for(;this.isSkip(b);){b=b.next("li");if(b.length===0){b=a.parent("li").siblings("li:first");if(b.length===0)return a}}return b.children("a")},_getPreviousItem:function(a){var b=a.parent("li").prev("li");if(b.length===0){b=a.parent("li").siblings("li:last");
if(b.length===0)return}for(;this.isSkip(b);){b=b.prev("li");if(b.length===0){b=a.parent("li").siblings("li:last");if(b.length===0)return}}return b.children("a")},_activateItem:function(a,b,e){var c=this.styles,f=c.itemFirst,i=this;a=d(a);var h=a.parent("li"),j=this.options.submenuFadeSpeed,o=this.options.submenuDelay,l=a.next("ul");b=b||null;switch(b){case "click":l.hasClass(c.submenuOpen)?this._closeSubmenu({el:l}):this._openSubmenu({el:l});break;case "mouseover":this._closeSiblingSubmenus(a,true);
this._closeGrandChildSubmenu(a,true);this._unHiliteSiblings(a);this._hiliteItem(a);if(e!==false){m&&window.clearTimeout(m);m=window.setTimeout(function(){i._openSubmenu({el:a.siblings("ul"),delay:o,submenuFadeSpeed:j})},i.options.openSubmenuDelay)}else this._openSubmenu({el:a.siblings("ul")});break;case "up":this._closeChildSubmenu(a);a=this._getPreviousItem(a);this._unHiliteSiblings(a);this._hiliteItem(a);break;case "down":if(h.hasClass(f)){this._openSubmenu({el:a.siblings("ul")});a=a.siblings("ul").find("li:first > a");
a.length>0&&this._hiliteItem(a)}else{this._closeChildSubmenu(a);a=this._getNextItem(a);this._unHiliteSiblings(a);this._hiliteItem(a)}break;case "right":if(h.hasClass(c.itemHasSubmenu))this._openSubmenu({el:l,callback:function(){a=l.children("li:first").children("a");i._hiliteItem(a)}});else if(h.hasClass(f)){a=this._getNextItem(a);this._activateItem(a,"mouseover",false)}else if(h.hasClass(c.itemLeaf)&&h.parent("ul").parent("li").hasClass(f)){a=this._getNextItem(h.parent("ul").parent("li").children("a"));
this._activateItem(a,"mouseover")}else a.parents().each(function(){var g=d(this);if(g.hasClass(f)){a=i._getNextItem(g.children("a"));i._activateItem(a,"mouseover")}});break;case "left":if(!h.hasClass(f)){this._closeSubmenu({el:a.parent("li").parent("ul")});a=a.parent("li").parent("ul").prev("a");this._hiliteItem(a)}if(h.hasClass(f)||h.parent("ul").parent("li").hasClass(f)){this._unHiliteItem(a);a=this._getPreviousItem(a);this._activateItem(a,"mouseover",false)}break;default:this._hiliteItem(a)}}});
d.ui.ncbimenu.prototype.options={openSubmenuDelay:300,submenuZindex:"1002"};d.ui.ncbimenu._areInstances=null;d.ui.ncbimenu.getter="areInstances";d.ui.ncbimenu._activeLink=null;d.ui.ncbimenu._rootNodes=[]})(jQuery);
