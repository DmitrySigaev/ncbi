<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Installation and configuration</title>
</head>

<body>
<h1>Installation and configuration</h1>



<ul>
  <li> <a href="#ref_Source">
       NCBI C++ source code repository</a> 
  <li> <a href="#ref_Configure">
       Configuration and installation script <b><i>configure</i></b></a>
  <li> <a href="#ref_Build">
       Structure of the build directory tree(s) produced by <b><i>configure</i></b></a>
  <li> <a href="#ref_Running">
       Running the <b><i>configure</i></b> script</a>
  <li> <a href="#ref_Reconf">
       Quick reconfiguration</a>
  <li> <a href="#ref_Wrappers">
       Compiler-specific "wrappers" for the <b><i>configure</i></b> script</a>
  <li> <a href="#ref_Example">
       An example of configuration, installation and build</a>
  <li> <a href="#ref_Compilers">
       List of supported compilers</a>
</ul>

<p>
This page describes how to get the NCBI C++ sources and how to deploy
a build directory(es) that has the <i>"ncbiconf.h"</i> header and makefiles
configured to work with the platform and compiler(and its flags) you are using.

<br></br>
<a name="ref_Source">
<h2>NCBI C++ source code repository</h2>
</a>

<p>
The NCBI C++ sources can be obtained from internal NCBI
CVS tree (<i><b>"$CVSROOT/internal/c++/"</b></i>) or
from a distribution archive. In either case, the root directory will
contain the <a href="src_tree.gif"><i>NCBI C++  source tree</i></a>:
<ul>
  <li> Set of files needed for the platform-specific
		 <a href="#ref_Running">configuration and installation</a>
		 with the
       <a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
       autoconf</a> utility.
       It includes pre-built multiplatform <i>"configure"</i> script and its
       <a href="#ref_Wrappers">platform-specific "wrappers"</a>
       in the <i><b>"compilers/"</b></i> directory.
       Here is also a template for the configuration header file
       <i>"config.h.in"</i> and
       <a href="#ref_PreBuiltHeaders">pre-built configuration headers</a>
       (<i>"ncbiconf.*"</i>) for some platforms.

  <li> <i><b>"doc/"</b></i> directory. -- 
       Here go the generic NCBI C++ documentation, manuals(e.g. including
       this one <i>"doc/config.html"</i>) and guidelines for
       <b>everybody</b> writing on C++ in NCBI SWG.

  <li> <i><b>"src/"</b> and <b>"include/"</b></i> directories. --
       These two contain a hierarchical directory tree of
       <a href="new_proj.html">NCBI C++ projects</a>
       , so that each project has its source and header directories
       mirrored (e.g. <i>"src/corelib/" correstonds to "include/corelib/"</i>).
       The <i><b>"src/"</b></i> directory also contains generic makefile
       templates (<i>"src/Makefile.*.in</i>") and configurable makefiles for
       each project or sub-project
       (like e.g. <i>"src/corelib/Makefile.*.in"</i>
       and <i>"src/corelib/test/Makefile.*.in"</i>).
</ul>


<a name="ref_Configure">
<h2>Configuration and installation script <b><i>configure</i></b></h2>
</a>

<p>
Practically every compiler compiles C++ (and even C!) code differently --
different compilers may vary in the OS standard libraries and header files,
completeness of the C++ implementation, and... in compiler bugs.
There are also different <b><i>make</i></b> tools and file naming conventions
on different platforms.

<p>
Thus, a configuration is needed to encounter the said platform-
and compiler-specific features.
For this purporse, we are using GNU
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">autoconf</a> 
tool to automatically generate compiler-specific header file
<i>"ncbiconf.h"</i> and makefiles that would work for the given platform.

<p>
User performs both configuration and installation by merely running
platform-independent shell(<i>sh, bash</i>) script
<b><i>configure</i></b> (generated by
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
autoconf</a>
from template <i>"configure.in"</i>) from the NCBI C++ top source directory.

<p>
During the configuration process, many compiler "features" are tested,
and the results of this testing are recorded in the configuration header
<i>"ncbiconf.h"</i> by the means of C preprocessor variables. E.g., the
preprocessor variable <i>"NO_INCLASS_TMPL"</i> indicates whether the tested
compiler supports template class methods; another example of the information 
contained in <i>"ncbiconf.h"</i> are preprocessor variables used to
define NCBI C++ <a href="types.html#ref_IntFixed">sized integer</a> and
<a href="types.html#ref_BigScalar"><i>BigScalar</i></a> types.

<p>
The <b><i>configure</i></b> script will create so-called
<a href="bld_tree.gif"><i>build tree</i></a>
-- a hierarchy of directories where
object modules, libraries and executables are to be built.
User can create as many such trees as he needs.  All these
trees would refer to just the same (origin) NCBI C++ 
<a href="src_tree.gif"><i>source tree</i></a>,
while each <i>build tree</i> can contain its own (compilator-specific)
<i>"ncbiconf.h"</i> header, and/or different set of compilation/linking/etc.
flags and tools ("frozen" in the makefiles). This is to allow one to build
libraries and executables -- with different compilers and/or flags, yet from
the same sources, and in a uniform way.


<br></br>
<a name="ref_Build">
<h2>Structure of the build directory tree(s) produced by <b><i>configure</i></b></h2>
</a>

<p>
Each configuration process results in a new tree of build directories.
The structure of the tree is as follows(see also in
<a href="bld_tree.gif">chart</a>):
<ul>
  <li> <i><b>"inc/"</b></i> -- contains
       <i>"ncbiconf.h"</i> configuration header generated by the
       <b><i>configure</i></b> script.
  <li> <i><b>"build/"</b></i> -- contains a hierarchy of directories that
       correspond to those in the <i><b>"src/"</b></i> (in NCBI C++ original
       sources). These directories will contain makefiles (<i>"Makefile.*"</i>)
       generated by the <b><i>configure</i></b> script from the makefile
       templates (<i>"Makefile.*.in"</i>) of corresponding project.
       The makefiles will have all tools and flags set as they were
       specified for the configuration process, and they will keep referencies
       to the original NCBI C++ source directories.
       All build results (object modules, libraries and executables
       as well as any auxiliary files and directories created during the build)
       will go exclusively into this <i><b>"build/"</b></i> tree, and not
       to the original NCBI C++ source directories. This allows one to
       have several build directories that use just the same sources, but
       compile and link them with different flags and/or compilers.
  <li> <i><b>"lib/"</b></i> -- here go all public libraries built by the
       <i><b>"build/"</b></i>-located projects.
  <li> <i><b>"bin/"</b></i> -- here go all public executables built by the
       <i><b>"build/"</b></i>-located projects.
  <li> <i><b>"status/"</b></i> -- contains cache (<i>"config.cache"</i>),
       log file (<i>"config.log"</i>), and secondary confifuration script
       (<i>"config.status"</i>) produced by <b><i>configure</i></b> during
       the configuration process.
</ul>


<a name="ref_Running">
<h2>Running the <b><i>configure</i></b> script</h2>
</a>

<p>
By default, the configuration process will produce a <i>build tree</i>
in the <i><b>"exec/"</b></i> subdirectory of the source root directory.
However, one can alternate its location by specifying optional
parameter <i>"--exec_prefix"</i> to the <b><i>configure</i></b>
script. For example, <i>"configure --exec_prefix=my_foo_dir"</i> would deploy
the build tree into directory <i>"my_foo_dir"</i>.
There is a "special case"(<i>"configure --exec_prefix=."</i>) -- for the people
who usually do not need different builds, and who prefer to have object
files, libraries and executables where the sources are located.

<p>
User can specify C and C++ compilers to use by setting environment variables
<b>CC</b> and <b>CXX</b> for the <b><i>configure</i></b> script.
By default, they will be (in the order of priority):
<b><i>c++,g++,gcc,CC,cxx,cc++</i></b> and <b><i>gcc,cc</i></b>, respectively.

<p>
Other tools and flags can be specified via the following shell
environment variables:
<ul>
  <li> <b>CPP</b> -- C preprocessor;  "$CXX -E" or "$CC -E" by default
  <li> <b>AR</b> -- "ar" by default
  <li> <b>RANLIB</b> -- "ranlib"(":" if "ranlib" not found) by default
  <li> <b>CFLAGS</b> -- C compiler flags
  <li> <b>CXXFLAGS</b> -- C++ compiler flags
  <li> <b>CPPFLAGS</b> -- C preprocessor flags
  <li> <b>LDFLAGS</b> -- linker flags
  <li> <b>LIBS</b> -- standard libraries to be linked to every executable
</ul>

They will be used to:
<ul>
  <li> Compile C sources:  <b><i>$CC -c $CFLAGS $CPPFLAGS ...</i></b>
  <li> Compile C++ sources:  <b><i>$CXX -c $CXXFLAGS $CPPFLAGS ...</i></b>
  <li> Link:  <b><i>$CXX $LDFLAGS ... $LIBS</i></b>
</ul>

For more info on these variables see in the
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Preset_Output_Variables.html">autoconf documentation</a>.
The specified tools and flags will then be "frozen" inside the makefiles of
produced <i>build tree</i>.

<a name="ref_Reconf">
<h2>Quick reconfiguration</h2>
</a>

<p>
Sometimes, you do changes in your existing <i>"*.in"</i> files (e.g. makefiles)
in the <i>source tree</i>, and you want to reflect these changes in your
<i>build tree</i>. To do this, just go to the <i><b>"status/"</i></b> subdirectory
of the relevant <i>build tree</i> and run <i><b>config.status</i></b> script
in it.

<p>
This technique also helps if some <i>"*.in"</i> files have been modified
in the result of CVS update in your <i>source tree</i>.

<p>
If you <b>added</b> or <b>removed</b> any of <i>"*.in"</i> files then you must
reconfigure your <i>build tree</i> anew by calling the configuration script
again, just like you did it for the original configuration.
(NOTE: In this case, you must also manualy remove the appropriate
<i>"inc/ncbiconf.h"</i> file before running the configure script.)


<br></br>
<a name="ref_Wrappers">
<h2>Compiler-specific "wrappers" for the <b><i>configure</i></b> script</h2>
</a>

<p>
For the developer's convenience, there are several <i>wrapper scripts</i>
located in the <i><b>"compilers/"</b></i> sub-directory of the NCBI C++
source directory. The <i>wrapper scripts</i> provide a "right environment"
(compiler, tools and flags) specific for the given compiler, and
then run <b><i>configure</i></b> in this environment. Yet, user may need to
perform an additional customization of the <i>wrapper scripts</i>
to adopt for his local environment.

<p>
It is even possible to use <b><i>configure</i></b> under Windows NT,
e.g. for the MSVC++ compiler -- if there is a "<i>sh</i>" or
<a href="http://www.lns.cornell.edu/public/COMP/info/bash/bashref_toc.html">
"<i>bash</i>"</a>
<a href="http://www.gci-net.com/~users/c/cteeple/windowsnttrueshells.htp">
emulators for MS Windows</a>.
<i>Wrapper script</i> <b><i>compilers/msvc_nt.bash</i></b> sets
MSVC++-specific environment variables, paths and flags, and then
executes <b><i>configure</i></b>.
The produced makefiles can be processed by the GNU <b><i>make</i></b>
utility for NT.

<p>
And, if you have installed
<a href="http://sourceware.cygnus.com/cygwin/">CYGWIN</a>
enviroment and "egc" GNU C/C++ compiler on your NT, then you can use
<b><i>compilers/egc_nt.bash</i></b> to configure your <i>build tree</i>.


<p>
<a name="ref_PreBuiltHeaders"></a>
However, most of NT users have neither <b><i>sh</b></i>-like interpreter nor
GNU <b><i>make</i></b> installed on their PCs. They can use pre-built
<b><i>ncbiconf.ms6</i></b> configuration header, and compose a hierarchy of
projects with the MS Visual C++ Studio.

<p>
The same is for Mac users -- we have a (manually maintained) 
<b><i>compilers/ncbiconf.mac</i></b> configuration header.

<br></br>
<a name="ref_Example">
<h2>An example of configuration, installation and build</h2>
</a>

To configure, install and build all NCBI C++ projects on Sun with
SunPro 5.0 compilers using CVS repository and relevant <i>wrapper script</i>
<b><i>compilers/sunpro50.sh</i></b>:

<pre>
# Retrieve NCBI C++ sources from the NCBI CVS tree(to "cpp_foo" directory)
cvs checkout -d cpp_foo internal/c++

# Configure (see in "sunpro50.sh" for the compiler and linker flags and tools)
# Note:  the build tree will be deployed into the source tree -- as
#        "sunpro50.sh" calls "configure" with "--exec_prefix=."
cd cpp_foo
sh compilers/sunpro50.sh

# Perform a recursive build
cd cpp_foo/src
make all_r
</pre>


<br></br>
<a name="ref_Compilers"><h2>List of supported compilers</h2>
</a>

<p>
As for now, at least the following compilers give enough support
(as concerns to the C++ and STL implementation) to build NCBI C++
libraries and tools:
<ul>
  <li> MSVC++ 6.XX for MS Windows on PC
  <li> WorkShop Compilers 5.0 for Solaris 2.6 on Sun
  <li> egcs-2.91.57 for CYGWIN_NT-4.0 on PC
  <li> egcs-2.91.66 for RedHat Linux 5.2 on PC
  <li> Metrowerks CodeWarrior for MacOS
</ul>
NOTE: Some projects(e.g. "query") are very platform-specific, and they cannot
be adopted(or even compiled) for all supported platforms.


<br></br>
<hr>
<table border=0 width="100%" cellspacing=0>
<tr>
<td><address><a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address></td>
<td align=right>($Revision$)</td></tr>
</table>
</body>
</html>
