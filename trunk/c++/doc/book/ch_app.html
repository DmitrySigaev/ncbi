<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Applications - The NCBI C++ Toolkit Book [Internet] - NCBI</title><meta name="description" content="A comprehensive manual on the NCBI C++ toolkit, including its design and development framework, a C++ library reference, software examples and demos, FAQs and release notes." /><meta name="robots" content="index,nofollow,noarchive" /><meta name="page_id" content="ch_app" /><meta name="page_type" content="chapter" /><meta name="ncbipopper" content="triggerPosition:'bottom left',destPosition:'top left',openEvent:'click',closeEvent:'click'" /><script type="text/javascript" src="js/jig/1.7/js/jig.min.js"></script><script type="text/javascript" src="js/toolkitSymbolSearch.js"></script><link type="text/css" rel="stylesheet" href="css/ptbooks.css" /><link type="text/css" rel="stylesheet" href="css/toolkit.css" /></head><body><div class="grid no_max_width"><div class="col twelve_col nomargin shadow"><div class="content"><div class="col eight_col"><div class="nvgtn"><a href="#__nav_cntnt" class="jig-ncbipopper">Contents ▾</a><div style="display:none;width:700px;height:500px;overflow:auto;" id="__nav_cntnt"><a class="right" href="toc.html">Table of Contents Page</a><ul class="simple-list"><li class="half_rhythm"><a href="toolkit.fm.html">Book Information</a></li><li class="half_rhythm"><a href="part1.html">Part 1. Overview</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_intro.html">1. Introduction to the C++ Toolkit</a></li><li class="half_rhythm"><a href="ch_start.html">2. Getting Started</a></li></ul></li><li class="half_rhythm"><a href="part2.html">Part 2. Development Framework</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_getcode_svn.html">3. Retrieve the Source Code (FTP and Subversion)</a></li><li class="half_rhythm"><a href="ch_config.html">4. Configure, Build, and Use the Toolkit</a></li><li class="half_rhythm"><a href="ch_build.html">5. Working with Makefiles</a></li><li class="half_rhythm"><a href="ch_proj.html">6. Project Creation and Management</a></li><li class="half_rhythm"><a href="ch_style.html">7. Programming Policies and Guidelines</a></li></ul></li><li class="half_rhythm"><a href="part3.html">Part 3. C++ Toolkit Library Reference</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_core.html">8. Portability, Core Functionality and Application Framework</a></li><li class="half_rhythm"><a href="ch_conn.html">9. Networking and IPC</a></li><li class="half_rhythm"><a href="ch_dbapi.html">10. Database Access - SQL, Berkley DB</a></li><li class="half_rhythm"><a href="ch_cgi.html">11. CGI and Fast-CGI </a></li><li class="half_rhythm"><a href="ch_html.html">12. HTML</a></li><li class="half_rhythm"><a href="ch_ser.html">13. Data Serialization (ASN.1, XML)</a></li><li class="half_rhythm"><a href="ch_datamod.html">14. Biological Sequence Data Model</a></li><li class="half_rhythm"><a href="ch_objmgr.html">15. Biological Object Manager</a></li><li class="half_rhythm"><a href="ch_blast.html">16. BLAST API</a></li><li class="half_rhythm"><a href="ch_dataaccess.html">17. Access to NCBI data</a></li><li class="half_rhythm"><a href="ch_algoalign.html">18. Biological Sequence Alignment</a></li><li class="half_rhythm"><a href="ch_gui.html">19. GUI and Graphics</a></li><li class="half_rhythm"><a href="ch_boost.html">20. Using the Boost Unit Test Framework</a></li></ul></li><li class="half_rhythm"><a href="part4.html">Part 4. Wrappers for 3rd-Party Packages</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_xmlwrapp.html">21. XmlWrapp (XML parsing and handling, XSLT, XPath)</a></li></ul></li><li class="half_rhythm"><a href="part5.html">Part 5. Software</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_debug.html">22. Debugging, Exceptions, and Error Handling</a></li><li class="half_rhythm"><a href="ch_grid.html">23. Distributed Computing</a></li><li class="half_rhythm"><a href="ch_app.html">24. Applications</a></li><li class="half_rhythm"><a href="ch_demo.html">25. Examples and Demos</a></li><li class="half_rhythm"><a href="ch_res.html">26. C Toolkit Resources for C++ Toolkit Users</a></li></ul></li><li class="half_rhythm"><a href="part6.html">Part 6. Help and Support</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_browse.html">27. NCBI C++ Toolkit Source Browser</a></li><li class="half_rhythm"><a href="ch_devtools.html">28. Software Development Tools</a></li><li class="half_rhythm"><a href="ch_xmlauthor.html">29. XML Authoring using Word</a></li><li class="half_rhythm"><a href="ch_faq.html">30. FAQs, Useful Documentation Links, and Mailing Lists</a></li></ul></li><li class="half_rhythm"><a href="part7.html">Part 7. Library and Applications Configuration</a><ul class="simple-list"><li class="half_rhythm"><a href="ch_libconfig.html">31. Library Configuration</a></li></ul></li><li class="half_rhythm"><a href="part8.html">Release Notes</a><ul class="simple-list"><li class="half_rhythm"><a href="release_notes.html">Release Notes (Version 9, May 2012)</a></li><li class="half_rhythm"><a href="release_notes_7-05_2011.html">Release Notes (Version 7, May 2011)</a></li><li class="half_rhythm"><a href="release_notes_06_29_2010.html">Release Notes (June, 2010)</a></li><li class="half_rhythm"><a href="release_notes_05_15_2009.html">Release Notes (May, 2009)</a></li><li class="half_rhythm"><a href="release_notes_12_24_2008.html">Release Notes (December, 2008)</a></li><li class="half_rhythm"><a href="release_notes_12_31_2008.html">Release Notes (March, 2008)</a></li><li class="half_rhythm"><a href="release_notes_08_27_2007.html">Release Notes (August, 2007)</a></li><li class="half_rhythm"><a href="release_notes_03_12_2007.html">Release Notes (March, 2007)</a></li><li class="half_rhythm"><a href="release_notes_08_14_2006.html">Release Notes (August, 2006)</a></li><li class="half_rhythm"><a href="release_notes_04_30_2006.html">Release Notes (April 30, 2006)</a></li><li class="half_rhythm"><a href="release_notes_12_31_2005.html">Release Notes (December 31, 2005)</a></li><li class="half_rhythm"><a href="release_notes_10_03_2005.html">Release Notes (August, 2005)</a></li><li class="half_rhythm"><a href="release_notes_05_05_2005.html">Release Notes (April, 2005)</a></li><li class="half_rhythm"><a href="release_notes_03_09_2005.html">Release Notes (February, 2005)</a></li><li class="half_rhythm"><a href="release_notes_11_22_2004.html">Release Notes (November 22, 2004)</a></li><li class="half_rhythm"><a href="release_notes_10_2_2004.html">Release Notes (October 2, 2004)</a></li><li class="half_rhythm"><a href="release_notes_7_8_2004.html">Release Notes (July 8, 2004)</a></li><li class="half_rhythm"><a href="release_notes_april_16_2004.html">Release Notes (April 16, 2004)</a></li><li class="half_rhythm"><a href="release_notes_12_08_2003.html">Release Notes (December 8, 2003)</a></li><li class="half_rhythm"><a href="release_notes_08_01_2003.html">Release Notes (August 1, 2003)</a></li></ul></li><li class="half_rhythm"><a href="app1.appendix1.html">Appendix - Books and Styles</a></li></ul></div><div class="pagination"><a class="pagelink active prev" title="Previous page" href="ch_grid.html">&lt; Prev</a><a class="pagelink active next" title="Next page" href="ch_demo.html">Next &gt;</a></div></div><div class="meta_content"><h1><span class="label">24</span><span class="title">Applications</span></h1><p class="small">Created: April 1, 2003; Last Update: May 21, 2012.</p></div><div class="body_content"><div class="sec"><h2><span class="title">Overview</span></h2><ul><li><p><a href="#ch_app.Intro">Introduction</a></p></li><li><p><a href="#ch_app.Outline">Chapter Outline</a></p></li></ul><div class="sec"><h3><span class="title">Introduction</span></h3><p>Most of the applications discussed in this chapter are built on a regular basis, at least once a day from the latest sources, and if you are in NCBI, then you can find the latest version in the directory:  <span class="nctnt ncbi-path">$NCBI/c++/Release/bin/</span> (or <span class="nctnt ncbi-path">$NCBI/c++/Debug/bin/</span>).</p></div><div class="sec"><h3><span class="title">Chapter Outline</span></h3><p>The following is an outline of the topics presented in this chapter:</p><ul><li><p><a href="ch_app.html#ch_app.datatool">DATATOOL: code generation and data serialization utility</a></p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refArgs">Invocation</a></p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refMainArgs">Main arguments</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCodeGenerationAr">Code generation arguments</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Data_Specification_C">Data specification conversion</a></p><ul><li><p><a href="ch_app.html#ch_app.Scope_Prefixes">Scope prefixes</a></p></li><li><p><a href="ch_app.html#ch_app.Modular_DTD_and_Sche">Modular DTD and Schemata</a></p></li><li><p><a href="ch_app.html#ch_app.Converting_XML_Schem">Converting XML Schema into ASN.1</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a></p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refDefCommon">Common definitions</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefSpecific">Definitions that affect specific types</a></p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refDefINT">INTEGER, REAL, BOOLEAN, NULL</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefENUM">ENUMERATED</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefOCTETS">OCTET STRING</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefArray">SEQUENCE OF, SET OF</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefClass">SEQUENCE, SET</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefChoice">CHOICE</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.The_Special__Section">The Special [-] Section</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefExample">Examples</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.ch_app_datatool_html_refModFile">Module file</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCode">Generated code</a></p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refNormalizedName">Normalized name</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCodeEnum">ENUMERATED types</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.dt_inside.html">Class diagrams</a></p><ul><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs">Specification analysis</a></p><ul><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs_asn">ASN.1 specification analysis</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs_dtd">DTD specification analysis</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_data_types">Data types</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_data_values">Data values</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_code_gen">Code generation</a></p></li></ul></li></ul></li><li><p><a href="ch_app.html#ch_app.Load_Balancing">Load Balancing</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview">Overview</a></p></li><li><p><a href="ch_app.html#ch_app.Load_Balancing_Servi">Load Balancing Service Mapping Daemon (LBSMD)</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview_1">Overview</a></p></li><li><p><a href="ch_app.html#ch_app._Configuration">Configuration</a></p><ul><li><p><a href="ch_app.html#ch_app.Check_Script_Specification">Check Script Specification</a></p></li><li><p><a href="ch_app.html#ch_app.Server_Descriptor_Specification">Server Descriptor Specification</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Signals">Signals</a></p></li><li><p><a href="ch_app.html#ch_app.Automatic_Configurat">Automatic Configuration Distribution</a></p></li><li><p><a href="ch_app.html#ch_app.Monitoring_and_Contr">Monitoring and Control</a></p><ul><li><p><a href="ch_app.html#ch_app.Service_Search">Service Search</a></p></li><li><p><a href="ch_app.html#ch_app.lbsmc_Utility">lbsmc Utility</a></p></li><li><p><a href="ch_app.html#ch_app.NCBI_Intranet_Web_Ut">NCBI Intranet Web Utilities</a></p></li><li><p><a href="ch_app.html#ch_app.Server_Penalizer_API">Server Penalizer API and Utility</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.SVN_Repository">SVN Repository</a></p></li><li><p><a href="ch_app.html#ch_app._Log_Files">Log Files</a></p></li><li><p><a href="ch_app.html#ch_app._Configuration_Exampl">Configuration Examples</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Database_Load_Balancing">Database Load Balancing</a></p></li><li><p><a href="ch_app.html#ch_app.Cookie___Argument_Af">Cookie / Argument Affinity Module (MOD_CAF)</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview_2">Overview</a></p></li><li><p><a href="ch_app.html#ch_app._Configuration_1">Configuration</a></p></li><li><p><a href="ch_app.html#ch_app._Configuration_Exampl">Configuration Examples</a></p></li><li><p><a href="ch_app.html#ch_app.Arguments_Matching">Arguments Matching</a></p><ul><li><p><a href="ch_app.html#ch_app.Argument_Matching_Ex">Argument Matching Examples</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Log_File">Log File</a></p></li><li><p><a href="ch_app.html#ch_app._Monitoring">Monitoring</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.DISPD_Network_Dispat">DISPD Network Dispatcher</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview_3">Overview</a></p></li><li><p><a href="ch_app.html#ch_app.Protocol_Description">Protocol Description</a></p><ul><li><p><a href="ch_app.html#ch_app.Client_Request_to_DI">Client Request to DISPD</a></p></li><li><p><a href="ch_app.html#ch_app.DISPD_Client_Respons">DISPD Client Response</a></p></li><li><p><a href="ch_app.html#ch_app.Communication_Scheme">Communication Schemes</a></p></li></ul></li></ul></li><li><p><a href="ch_app.html#ch_app.NCBID_Server_Launche">NCBID Server Launcher</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview_4">Overview</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Firewall_Daemon_FWDa">Firewall Daemon (FWDaemon)</a></p><ul><li><p><a href="ch_app.html#ch_app._Overview_5">Overview</a></p><ul><li><p><a href="ch_app.html#ch_app.FWDaemon_Behind_a__R">FWDaemon Behind a "Regular" Firewall</a></p></li><li><p><a href="ch_app.html#ch_app.FWDaemon_Behind_a__N">FWDaemon Behind a "Non-Transparent" Firewall</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app._Monitoring_1">Monitoring</a></p></li><li><p><a href="ch_app.html#ch_app._Log_Files_1">Log Files</a></p></li><li><p><a href="ch_app.html#ch_app.FWDaemon_and_NCBID_D">FWDaemon and NCBID Dispatcher Data Exchange</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.Launcherd_Utility">Launcherd Utility</a></p></li><li><p><a href="ch_app.html#ch_app.Monitoring_Tools">Monitoring Tools</a></p></li><li><p><a href="ch_app.html#ch_app.Quality_Assurance_Do">Quality Assurance Domain</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.applications1">NCBI Genome Workbench</a></p><ul><li><p><a href="ch_app.html#ch_app.gbench_dg">Design goals</a></p></li><li><p><a href="ch_app.html#ch_app.gbench_design">Design</a></p></li></ul></li><li><p><a href="ch_app.html#ch_app.ncbi_netcache_service">NCBI NetCache Service</a></p><ul><li><p><a href="ch_app.html#ch_app.what_is_netcache">What is NetCache?</a></p></li><li><p><a href="ch_app.html#ch_app.what_it_can_be_used">What it can be used for?</a></p></li><li><p><a href="ch_app.html#ch_app.getting_started">Getting started</a></p></li><li><p><a href="ch_app.html#ch_app.Available_samples">Available samples</a></p></li><li><p><a href="ch_app.html#ch_app.sample_configuration_file_netcac">Sample configuration file (netcached.ini)</a></p></li></ul></li></ul></div></div><div class="sec" id="ch_app.datatool"><h2><span class="title">DATATOOL: Code Generation and Data Serialization Utility</span></h2><p><span class="nctnt ncbi-app">DATATOOL</span> source code is located at <span class="nctnt ncbi-path">c++/src/serial/datatool;</span> this application can perform the following:</p><ul><li><p>Generate C++ data storage classes based on <a href="http://www.itu.int/ITU-T/studygroups/com17/languages">ASN.1</a>, <a href="http://www.w3.org/TR/REC-xml">DTD</a> or <a href="http://www.w3.org/XML/Schema">XML Schema</a> specification to be used with <a href="ch_ser.html">NCBI data serialization streams</a>.</p></li><li><p>Convert ASN.1 specification into a DTD or XML Schema specification and vice versa.</p></li><li><p>Convert data between ASN.1, XML and JSON formats.</p></li></ul><p><span class="nctnt highlight">Note:</span> Because ASN.1, XML and JSON are, in general, incompatible, the last two functions are supported only partially. </p><p> The following additional topics are discussed in subsections: </p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refArgs">Invocation</a></p></li><li><p><a href="ch_app.html#ch_app.Data_Specification_C">Data specification conversion</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a></p></li><li><p><a href="ch_app.html#ch_app.ch_app_datatool_html_refModFile">Module file</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCode">Generated code</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html">Class diagrams</a></p></li></ul><div class="sec" id="ch_app.datatool.html_refArgs"><h3><span class="title">Invocation</span></h3><p>The following topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refMainArgs">Main arguments</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCodeGenerationAr">Code generation arguments</a></p></li></ul><div class="sec" id="ch_app.datatool.html_refMainArgs"><h4><span class="title">Main Arguments</span></h4><p>See <a href="ch_app.html#ch_app.tools_table1">Table 1</a>.</p><div class="table" id="ch_app.tools_table1"><div class="caption"><p>1. Main arguments</p></div><table><tbody><tr><th align="left" valign="top" rowspan="1" colspan="1">Argument</th><th align="left" valign="top" rowspan="1" colspan="1">Effect</th><th align="left" valign="top" rowspan="1" colspan="1">Comments</th></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-h</td><td align="left" valign="top" rowspan="1" colspan="1">Display the <span class="nctnt ncbi-app">DATATOOL</span> arguments</td><td align="left" valign="top" rowspan="1" colspan="1">Ignores other arguments</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-m &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">ASN.1 or DTD module file(s)</td><td align="left" valign="top" rowspan="1" colspan="1">Required argument</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-M &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">External module file(s)</td><td align="left" valign="top" rowspan="1" colspan="1">Is used for IMPORT type resolution</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-i</td><td align="left" valign="top" rowspan="1" colspan="1">Ignore unresolved types</td><td align="left" valign="top" rowspan="1" colspan="1">Is used for IMPORT type resolution</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-f &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write ASN.1 module file</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-fx &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write DTD module file</td><td align="left" valign="top" rowspan="1" colspan="1">"-fx m" writes modular DTD file</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-fxs &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write XML Schema file</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-fd &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write specification dump file in datatool internal format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ms &lt;string&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Suffix of modular DTD or XML Schema file name</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-dn &lt;string&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">DTD module name in XML header</td><td align="left" valign="top" rowspan="1" colspan="1">No extension. If empty, omit DOCTYPE declaration.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-v &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Read value in ASN.1 text format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-vx &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Read value in XML format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-F</td><td align="left" valign="top" rowspan="1" colspan="1">Read value completely into memory</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-p &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write value in ASN.1 text format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-px &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write value in XML format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-pj &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write value in JSON format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-d &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Read value in ASN.1 binary format</td><td align="left" valign="top" rowspan="1" colspan="1">-t argument required</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-t &lt;type&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Binary value type name</td><td align="left" valign="top" rowspan="1" colspan="1">See -d argument</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-e &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write value in ASN.1 binary format</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-xmlns</td><td align="left" valign="top" rowspan="1" colspan="1">XML namespace name</td><td align="left" valign="top" rowspan="1" colspan="1">When specified, also makes XML output file reference Schema instead of DTD</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-sxo</td><td align="left" valign="top" rowspan="1" colspan="1">No scope prefixes in XML output</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-sxi</td><td align="left" valign="top" rowspan="1" colspan="1">No scope prefixes in XML input</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-logfile &lt;File_Out&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">File to which the program log should be redirected</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">conffile &lt;File_In&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Program's configuration (registry) data file</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"> -version</td><td align="left" valign="top" rowspan="1" colspan="1">Print version number</td><td align="left" valign="top" rowspan="1" colspan="1">Ignores other arguments</td></tr></tbody></table></div></div><div class="sec" id="ch_app.datatool.html_refCodeGenerationAr"><h4><span class="title">Code Generation Arguments</span></h4><p>See <a href="ch_app.html#ch_app.tools_table2">Table 2</a>.</p><div class="table" id="ch_app.tools_table2"><div class="caption"><p>2. Code generation arguments</p></div><table><tbody><tr><th align="left" valign="top" rowspan="1" colspan="1">Argument</th><th align="left" valign="top" rowspan="1" colspan="1">Effect</th><th align="left" valign="top" rowspan="1" colspan="1">Comments</th></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-od &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">C++ code <a href="ch_app.html#ch_app.datatool.html_refDefFile">definition file</a></td><td align="left" valign="top" rowspan="1" colspan="1">See <a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ods</td><td align="left" valign="top" rowspan="1" colspan="1">Generate an example definition file (e.g. <span class="nctnt ncbi-path">MyModuleName._sample_def</span>)</td><td align="left" valign="top" rowspan="1" colspan="1">Must be used with another option that generates code such as -oA.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-odi</td><td align="left" valign="top" rowspan="1" colspan="1">Ignore absent code definition file</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-odw</td><td align="left" valign="top" rowspan="1" colspan="1">Issue a warning about absent code definition file</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oA</td><td align="left" valign="top" rowspan="1" colspan="1">Generate C++ files for all types</td><td align="left" valign="top" rowspan="1" colspan="1">Only types from the main module are used (see <a href="ch_app.html#ch_app.tools_table1">-m</a> and -mx arguments).</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ot &lt;types&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Generate C++ files for listed types</td><td align="left" valign="top" rowspan="1" colspan="1">Only types from the main module are used (see <a href="ch_app.html#ch_app.tools_table1">-m</a> and -mx arguments).</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ox &lt;types&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Exclude types from generation</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oX</td><td align="left" valign="top" rowspan="1" colspan="1">Turn off recursive type generation</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-of &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write the list of generated C++ files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oc &lt;file&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Write combining C++ files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-on &lt;string&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Default namespace</td><td align="left" valign="top" rowspan="1" colspan="1">The value "-" in the <a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a> means don't use a namespace at all and overrides the -on option specified elsewhere.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-opm &lt;dir&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Directory for searching source modules</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oph &lt;dir&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Directory for generated *.hpp files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-opc &lt;dir&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Directory for generated *.cpp files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-or &lt;prefix&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Add prefix to generated file names</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-orq</td><td align="left" valign="top" rowspan="1" colspan="1">Use quoted syntax form for generated include files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ors</td><td align="left" valign="top" rowspan="1" colspan="1">Add source file dir to generated file names</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-orm</td><td align="left" valign="top" rowspan="1" colspan="1">Add module name to generated file names</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-orA</td><td align="left" valign="top" rowspan="1" colspan="1">Combine all -or* prefixes</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-ocvs</td><td align="left" valign="top" rowspan="1" colspan="1">create ".cvsignore" files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oR &lt;dir&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Set -op* and -or* arguments for NCBI directory tree </td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oDc</td><td align="left" valign="top" rowspan="1" colspan="1">Turn ON generation of Doxygen-style comments</td><td align="left" valign="top" rowspan="1" colspan="1">The value "-" in the <a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a> means don't generate Doxygen comments and overrides the -oDc option specified elsewhere.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-odx &lt;string&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">URL of documentation root folder</td><td align="left" valign="top" rowspan="1" colspan="1">For Doxygen</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-lax_syntax</td><td align="left" valign="top" rowspan="1" colspan="1">Allow non-standard ASN.1 syntax accepted by asntool</td><td align="left" valign="top" rowspan="1" colspan="1">The value "-" in the <a href="ch_app.html#ch_app.datatool.html_refDefFile">Definition file</a> means don't allow non-standard syntax and overrides the -lax_syntax option specified elsewhere.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-pch &lt;string&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Name of the precompiled header file to include in all *.cpp files</td><td align="left" valign="top" rowspan="1" colspan="1"></td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">-oex &lt;export&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">Add storage-class modifier to generated classes</td><td align="left" valign="top" rowspan="1" colspan="1">Can be overriden by <a href="ch_app.html#ch_app.datatool.html_refDefCommon">[-]._export</a> in the definition file.</td></tr></tbody></table></div></div></div><div class="sec" id="ch_app.Data_Specification_C"><h3><span class="title">Data Specification Conversion</span></h3><p>When parsing data specification, <span class="nctnt ncbi-app">DATATOOL</span> identifies specification format by source file extension - ASN, DTD or XSD.</p><div class="sec" id="ch_app.Scope_Prefixes"><h4><span class="title">Scope Prefixes</span></h4><p>Initially, <span class="nctnt ncbi-app">DATATOOL</span> and serial library supported serialization in ASN.1 and XML format, and conversion of ASN.1 specification into DTD. Comparing with ASN, DTD is a very sketchy specification in a sense that there is only one primitive type - string, and all elements are defined globally. The latter feature of DTD led to a decision to use ‘scope prefixes’ in XML output to avoid potential name conflicts. For example, consider the following ASN.1 specification:</p><pre>Date ::= CHOICE {<br />    str VisibleString, <br />    std Date-std<br />}<br />Time ::= CHOICE {<br />    str VisibleString, <br />    std Time-std<br />}</pre><p>Here, accidentally, element <span class="nctnt ncbi-type">str</span> is defined identically both in <span class="nctnt ncbi-type">Date</span> and <span class="nctnt ncbi-type">Time</span> productions; while the meaning of element <span class="nctnt ncbi-type">std</span> depends on the context. To avoid ambiguity, this specification translates into the following DTD:</p><pre>&lt;!ELEMENT Date (Date_str | Date_std)&gt;<br />&lt;!ELEMENT Date_str (#PCDATA)&gt;<br />&lt;!ELEMENT Date_std (Date-std)&gt;<br />&lt;!ELEMENT Time (Time_str | Time_std)&gt;<br />&lt;!ELEMENT Time_str (#PCDATA)&gt;<br />&lt;!ELEMENT Time_std (Time-std)&gt;</pre><p>Accordingly, these scope prefixes made their way into XML output. </p><p>Later, DTD parsing was added into <span class="nctnt ncbi-app">DATATOOL</span>. Here, scope prefixes were not needed. Also, since these prefixes considerably increase the size of the XML output, they could be omitted when it is known in advance that there can be no ambiguity. So, <span class="nctnt ncbi-app">DATATOOL</span> has got command line flags, which would enable that.</p><p>With the addition of XML Schema parser and generator, when converting ASN.1 specification, elements can be declared in Schema locally if needed, and scope prefixes make almost no sense. Still, they are preserved for compatibility.</p></div><div class="sec" id="ch_app.Modular_DTD_and_Sche"><h4><span class="title">Modular DTD and Schemata</span></h4><p>Here, ‘module’ means ASN.1 module. Single ASN.1 specification file may contain several modules. When converting it into DTD or XML schema, it might be convenient to put each module definitions into a separate file. To do so, one should specify a special file name in <span class="nctnt ncbi-cmd">-fx</span> or <span class="nctnt ncbi-cmd">-fxs</span> command line parameter. The names of output DTD or Schema files will then be chosen automatically - they will be named after ASN modules defined in the source. ‘Modular’ output does not make much sense when the source specification is DTD or Schema. </p><p>You can find a number of DTDs and Schema converted by <span class="nctnt ncbi-app">DATATOOL</span> from NCBI public ASN.1 specifications <a href="http://www.ncbi.nlm.nih.gov/data_specs">here</a>.</p></div><div class="sec" id="ch_app.Converting_XML_Schem"><h4><span class="title">Converting XML Schema into ASN.1</span></h4><p>There are two major problems in converting XML schema into ASN.1 specification: how to define XML attributes and how to convert complex content models. The solution was greatly affected by the underlying implementation of data storage classes (classes which <span class="nctnt ncbi-app">DATATOOL</span> generates based on a specification).  So, for example the following Schema</p><pre>&lt;xs:element name="Author"&gt;<br />  &lt;xs:complexType&gt;<br />    &lt;xs:sequence&gt;<br />      &lt;xs:element name="LastName" type="xs:string"/&gt;<br />      &lt;xs:choice minOccurs="0"&gt;<br />        &lt;xs:element name="ForeName" type="xs:string"/&gt;<br />        &lt;xs:sequence&gt;<br />          &lt;xs:element name="FirstName" type="xs:string"/&gt;<br />          &lt;xs:element name="MiddleName" type="xs:string" minOccurs="0"/&gt;<br />        &lt;/xs:sequence&gt;<br />      &lt;/xs:choice&gt;<br />      &lt;xs:element name="Initials" type="xs:string" minOccurs="0"/&gt;<br />      &lt;xs:element name="Suffix" type="xs:string" minOccurs="0"/&gt;<br />    &lt;/xs:sequence&gt;<br />    &lt;xs:attribute name="gender" use="optional"&gt;<br />      &lt;xs:simpleType&gt;<br />        &lt;xs:restriction base="xs:string"&gt;<br />          &lt;xs:enumeration value="male"/&gt;<br />          &lt;xs:enumeration value="female"/&gt;<br />        &lt;/xs:restriction&gt;<br />      &lt;/xs:simpleType&gt;<br />    &lt;/xs:attribute&gt;<br />  &lt;/xs:complexType&gt;<br />&lt;/xs:element&gt;</pre><p>translates into this ASN.1:</p><pre>Author ::= SEQUENCE {<br />  attlist SET {<br />    gender ENUMERATED {<br />      male (1),<br />      female (2)<br />    } OPTIONAL<br />  },<br />  lastName VisibleString,<br />  fF CHOICE {<br />    foreName VisibleString,<br />    fM SEQUENCE {<br />      firstName VisibleString,<br />      middleName VisibleString OPTIONAL<br />    }<br />  } OPTIONAL,<br />  initials VisibleString OPTIONAL,<br />  suffix VisibleString OPTIONAL<br />}</pre><p>Each unnamed local element gets a name. When generating C++ data storage classes from Schema, <span class="nctnt ncbi-app">DATATOOL</span> marks such data types as anonymous.</p><p>It is possible to convert source Schema into ASN.1, and then use <span class="nctnt ncbi-app">DATATOOL</span> to generate C++ classes from the latter. In this case <span class="nctnt ncbi-app">DATATOOL</span> and serial library provide compatibility of ASN.1 output. If you generate data storage classes from Schema, and use them to write data in ASN.1 format (binary or text), if you then convert that Schema into ASN.1, generate classes from it, and again write same data in ASN.1 format using this new set of classes, then these two files will be identical.</p></div></div><div class="sec" id="ch_app.datatool.html_refDefFile"><h3><span class="title">Definition File</span></h3><p>It is possible to tune up the C++ code generation by using a definition file, which could be specified in the <a href="ch_app.html#ch_app.tools_table2">-od</a> argument. The definition file uses the generic <a href="ch_core.html#ch_core.registry_syntax">NCBI configuration</a> format also used in the configuration (<span class="nctnt ncbi-path">*.ini</span>) files found in NCBI's applications. </p><p><span class="nctnt ncbi-app">DATATOOL</span> looks for code generation parameters in several sections of the file in the following order:</p><ul><li><p><span class="nctnt ncbi-monospace">[ModuleName.TypeName]</span></p></li><li><p><span class="nctnt ncbi-monospace">[TypeName]</span></p></li><li><p><span class="nctnt ncbi-monospace">[ModuleName]</span></p></li><li><p><span class="nctnt ncbi-monospace">[-]</span></p></li></ul><p>Parameter definitions follow a "name = value" format. The "name" part of the definition serves two functions: (1) selecting the specific element to which the definition applies, and (2) selecting the code generation parameter (such as <span class="nctnt ncbi-monospace"><b>_class</b></span>) that will be fine-tuned for that element.</p><p>To modify a top-level element, use a definition line where the name part is simply the desired code generation parameter (such as <span class="nctnt ncbi-monospace"><b>_class</b></span>). To modify a nested element, use a definition where the code generation parameter is prefixed by a dot-separated "path" of the successive container element names from the data format specification. For path elements of type <span class="nctnt ncbi-monospace">SET OF</span> or <span class="nctnt ncbi-monospace">SEQUENCE OF</span>, use an "<span class="nctnt ncbi-monospace">E</span>" as the element name (which would otherwise be anonymous). <span class="nctnt highlight">Note:</span> Element names will depend on whether you are using ASN.1, DTD, or Schema.</p><p>For example, consider the following ASN.1 specification:</p><pre>MyType ::= SEQUENCE {<br />    label VisibleString ,<br />    points SEQUENCE OF<br />        SEQUENCE {<br />            x INTEGER ,<br />            y INTEGER<br />        }<br />}</pre><p>Code generation for the various elements can be fine-tuned as illustrated by the following sample definition file:</p><pre>[MyModule.MyType]<br />; modify the top-level element (MyType)<br />_class = MyTypeX<br /><br />; modify a contained element<br />label._class = Title<br /><br />; modify a "SEQUENCE OF" container type<br />points._type = vector<br /><br />; modify members of an anonymous SEQUENCE contained in a "SEQUENCE OF"<br />points.E.x._type = double<br />points.E.y._type = double</pre><p>The following additional topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refDefCommon">Common definitions</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefSpecific">Definitions that affect specific types</a></p></li><li><p><a href="ch_app.html#ch_app.The_Special__Section">The Special [-] Section</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefExample">Examples</a></p></li></ul><div class="sec" id="ch_app.datatool.html_refDefCommon"><h4><span class="title">Common Definitions</span></h4><p>Some definitions refer to the generated class as a whole.</p><p><span class="nctnt ncbi-monospace"><b>_file</b></span>      Defines the base filename for the generated or referenced C++ class.</p><p>For example, the following definitions: </p><pre>[ModuleName.TypeName]_file=AnotherName</pre><p>Or</p><pre>[TypeName]<br />_file=AnotherName</pre><p>would put the class <span class="nctnt ncbi-class">CTypeName</span> in files with the base name <span class="nctnt ncbi-path">AnotherName</span>, whereas these two:</p><pre>[ModuleName]<br />_file=AnotherName</pre><p>Or</p><pre>[-]<br />_file=AnotherName</pre><p>put <b>all</b> the generated classes into a single file with the base name <span class="nctnt ncbi-path">AnotherName</span>.</p><p><span class="nctnt ncbi-monospace"><b>_extra_headers</b></span>      Specify additional header files to include.</p><p>For example, the following definition:</p><pre>[-]<br />_extra_headers=name1 name2 \"name3\"</pre><p>would put the following lines into all generated headers:</p><pre>#include &lt;name1&gt;<br />#include &lt;name2&gt;<br />#include "name3"</pre><p>Note the name3 clause. Putting name3 in quotes instructs <span class="nctnt ncbi-app">DATATOOL</span> to use the quoted syntax in generated files. Also, the quotes must be escaped with backslashes.</p><p><span class="nctnt ncbi-monospace"><b>_dir</b></span>      Subdirectory in which the generated C++ files will be stored (in case _file not specified) or a subdirectory in which the referenced class from an external module could be found. The subdirectory is added to include directives. </p><p><span class="nctnt ncbi-monospace"><b>_class</b></span>      The name of the generated class (if <span class="nctnt ncbi-monospace">_class=-</span> is specified, then no code is generated for this type).</p><p>For example, the following definitions:</p><pre>[ModuleName.TypeName]<br />_class=AnotherName</pre><p>Or</p><pre>[TypeName]<br />_class=AnotherName</pre><p>would cause the class generated for the type <span class="nctnt ncbi-path">TypeName</span> to be named <span class="nctnt ncbi-class">CAnotherName</span>, whereas these two:</p><pre>[ModuleName]<br />_class=AnotherName</pre><p>Or</p><pre>[-]<br />_class=AnotherName</pre><p>would result in <b>all</b> the generated classes having the same name <span class="nctnt ncbi-class">CAnotherName</span> (which is probably not what you want).</p><p><span class="nctnt ncbi-monospace"><b>_namespace</b></span>      The namespace in which the generated class (or classes) will be placed.</p><p><span class="nctnt ncbi-monospace"><b>_parent_class</b></span>      The name of the base class from which the generated C++ class is derived.</p><p><span class="nctnt ncbi-monospace"><b>_parent_type</b></span>      Derive the generated C++ class from the class, which corresponds to the specified type (in case _parent_class is not specified).</p><p>It is also possible to specify a storage-class modifier, which is required on Microsoft Windows to export/import generated classes from/to a DLL. This setting affects all generated classes in a module. An appropriate section of the definition file should look like this:</p><pre>[-]<br />_export = EXPORT_SPECIFIER</pre><p>Because this modifier could also be specified in the <a href="ch_app.html#ch_app.tools_table2">command line</a>, the <span class="nctnt ncbi-app">DATATOOL</span> code generator uses the following rules to choose the proper one:</p><ul><li><p>If no <span class="nctnt ncbi-monospace">-oex</span> flag is given in the command line, no modifier is added at all.</p></li><li><p>If <span class="nctnt ncbi-monospace">-oex ""</span> (that is, an empty modifier) is specified in the command line, then the modifier from the definition file will be used.</p></li><li><p>The command-line parameter in the form <span class="nctnt ncbi-monospace">-oex FOOBAR</span> will cause the generated classes to have a <span class="nctnt ncbi-monospace">FOOBAR</span> storage-class modifier, unless another one is specified in the definition file. The modifier from the definition file always takes precedence.</p></li></ul></div><div class="sec" id="ch_app.datatool.html_refDefSpecific"><h4><span class="title">Definitions That Affect Specific Types</span></h4><p>The following additional topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refDefINT">INTEGER, REAL, BOOLEAN, NULL</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefENUM">ENUMERATED</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefOCTETS">OCTET STRING</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefArray">SEQUENCE OF, SET OF</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefClass">SEQUENCE, SET</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refDefChoice">CHOICE</a></p></li></ul><div class="sec" id="ch_app.datatool.html_refDefINT"><h5><span class="title">INTEGER, REAL, BOOLEAN, NULL</span></h5><p><span class="nctnt ncbi-monospace"><b>_type</b></span>      C++ type: int, short, unsigned, long, etc.</p></div><div class="sec" id="ch_app.datatool.html_refDefENUM"><h5><span class="title">ENUMERATED</span></h5><p><span class="nctnt ncbi-monospace"><b>_type</b></span>      C++ type: int, short, unsigned, long, etc.</p><p><span class="nctnt ncbi-monospace"><b>_prefix</b></span>      Prefix for names of enum values. The default is "e".</p></div><div class="sec" id="ch_app.datatool.html_refDefOCTETS"><h5><span class="title">OCTET STRING</span></h5><p><span class="nctnt ncbi-monospace"><b>_char</b></span>      Vector element type: char, unsigned char, or signed char.</p></div><div class="sec" id="ch_app.datatool.html_refDefArray"><h5><span class="title">SEQUENCE OF, SET OF</span></h5><p><span class="nctnt ncbi-monospace"><b>_type</b></span>      STL container type: list, vector, set, or multiset.</p></div><div class="sec" id="ch_app.datatool.html_refDefClass"><h5><span class="title">SEQUENCE, SET</span></h5><p><span class="nctnt ncbi-monospace"><b>memberName._delay</b></span>      Mark the specified member for delayed reading.</p></div><div class="sec" id="ch_app.datatool.html_refDefChoice"><h5><span class="title">CHOICE</span></h5><p><span class="nctnt ncbi-monospace"><b>_virtual_choice</b></span>      If not empty, do not generate a special class for choice. Rather make the choice class as the parent one of all its variants.</p><p><span class="nctnt ncbi-monospace"><b>variantName._delay</b></span>      Mark the specified variant for delayed reading.</p></div></div><div class="sec" id="ch_app.The_Special__Section"><h4><span class="title">The Special [-] Section</span></h4><p>There is a special section <span class="nctnt ncbi-monospace">[-]</span> allowed in the definition file which can contain definitions related to code generation. This is a good place to define a namespace or identify additional headers. It is a "top level" section, so entries placed here will override entries with the same name in other sections or on the command-line. For example, the following entries set the proper parameters for placing header files alongside source files:</p><pre>[-]<br />; Do not use a namespace at all:<br />-on  = -<br /><br />; Use the current directory for generated .cpp files:<br />-opc = .<br /><br />; Use the current directory for generated .hpp files:<br />-oph = .<br /><br />; Do not add a prefix to generated file names:<br />-or  = -<br /><br />; Generate #include directives with quotes rather than angle brackets:<br />-orq = 1</pre><p>Any of the code generation arguments in <a href="ch_app.html#ch_app.tools_table2">Table 2</a> (except <span class="nctnt ncbi-monospace">-od</span>, <span class="nctnt ncbi-monospace">-odi</span>, and <span class="nctnt ncbi-monospace">-odw</span> which are related to specifying the definition file) can be placed in the <span class="nctnt ncbi-monospace">[-]</span> section.</p><p>In some cases, the special value <span class="nctnt ncbi-monospace">"-"</span> causes special processing as noted in <a href="ch_app.html#ch_app.tools_table2">Table 2</a>.</p></div><div class="sec" id="ch_app.datatool.html_refDefExample"><h4><span class="title">Examples</span></h4><p>If we have the following ASN.1 specification (this not a "real" specification - it is only for illustration):</p><pre>Date ::= CHOICE {<br />    str VisibleString,<br />    std Date-std<br />}<br />Date-std ::= SEQUENCE {<br />    year INTEGER,<br />    month INTEGER OPTIONAL<br />}<br />Dates ::= SEQUENCE OF Date<br />Int-fuzz ::= CHOICE {<br />    p-m INTEGER,<br />    range SEQUENCE {<br />        max INTEGER,<br />        min INTEGER<br />    },<br />    pct INTEGER,<br />    lim ENUMERATED {<br />        unk (0),<br />        gt (1),<br />        lt (2),<br />        tr (3),<br />        tl (4),<br />        circle (5),<br />        other (255)<br />    },<br />    alt SET OF INTEGER<br />}</pre><p>Then the following definitions will effect the generation of objects:</p><div class="table" id="ch_app.T.nc_definitioneffected_objectsda"><table><tbody><tr><th align="left" valign="top" rowspan="1" colspan="1">Definition</th><th align="left" valign="top" rowspan="1" colspan="1">Effected Objects</th></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-monospace">[Date]str._type = string</span></td><td align="left" valign="top" rowspan="1" colspan="1">the <span class="nctnt ncbi-monospace">str</span> member of the <span class="nctnt ncbi-monospace">Date</span> structure</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-monospace">[Dates]E._pointer = true</span></td><td align="left" valign="top" rowspan="1" colspan="1">elements of the <span class="nctnt ncbi-monospace">Dates</span> container</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-monospace">[Int-fuzz]range.min._type = long</span></td><td align="left" valign="top" rowspan="1" colspan="1">the <span class="nctnt ncbi-monospace">min</span> member of the <span class="nctnt ncbi-monospace">range</span> member of the <span class="nctnt ncbi-monospace">Int-fuzz</span> structure</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-monospace">[Int-fuzz]alt.E._type = long</span></td><td align="left" valign="top" rowspan="1" colspan="1">elements of the <span class="nctnt ncbi-monospace">alt</span> member of the <span class="nctnt ncbi-monospace">Int-fuzz</span> structure</td></tr></tbody></table></div></div></div><div class="sec" id="ch_app.ch_app_datatool_html_refModFile"><h3><span class="title">Module File</span></h3><p>Module files are not used directly by <span class="nctnt ncbi-app">DATATOOL</span>, but they are input for <span class="nctnt ncbi-path">new_module.sh</span> and <a href="ch_config.html#ch_config._Build_the_Toolkit">project_tree_builder</a> and therefore determine what <span class="nctnt ncbi-app">DATATOOL</span>'s command line will be during the build process.</p><p>Module files simply consist of lines of the form "<span class="nctnt ncbi-monospace">KEY = VALUE</span>". Only the key <span class="nctnt ncbi-monospace">MODULE_IMPORT</span> is currently used (and is the only key ever recognized by <span class="nctnt ncbi-path">project_tree_builder</span>). Other keys used to be recognized by <span class="nctnt ncbi-path">module.sh</span> and still harmlessly remain in some files. The possible keys are:</p><p><span class="nctnt ncbi-monospace">MODULE_IMPORT</span>      These definitions contain a space-delimited list of other modules to import. The paths should be relative to <span class="nctnt ncbi-path">.../src</span> and should not include extensions.</p><p>For example, a valid entry could be:</p><pre>MODULE_IMPORT = objects/general/general objects/seq/seq</pre><p><span class="nctnt ncbi-monospace">MODULE_ASN</span>, <span class="nctnt ncbi-monospace">MODULE_DTD</span>, <span class="nctnt ncbi-monospace">MODULE_XSD</span>      These definitions explicitly set the specification filename (normally <span class="nctnt ncbi-path">foo.asn</span>, <span class="nctnt ncbi-path">foo.dtd</span>, or <span class="nctnt ncbi-path">foo.xsd</span> for <span class="nctnt ncbi-monospace">foo.module</span>). Almost no module files contain this definition. It is no longer used by the <span class="nctnt ncbi-path">project_tree_builder</span> and is therefore not necessary</p><p><span class="nctnt ncbi-monospace">MODULE_PATH</span>      Specifies the directory containing the current module, again relative to <span class="nctnt ncbi-path">.../src</span>. Almost all module files contain this definition, however it is no longer used by either <span class="nctnt ncbi-path">new_module.sh</span> or the <span class="nctnt ncbi-path">project_tree_builder</span> and is therefore not necessary.</p></div><div class="sec" id="ch_app.datatool.html_refCode"><h3><span class="title">Generated Code</span></h3><p>The following additional topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.datatool.html_refNormalizedName">Normalized name</a></p></li><li><p><a href="ch_app.html#ch_app.datatool.html_refCodeEnum">ENUMERATED types</a></p></li></ul><div class="sec" id="ch_app.datatool.html_refNormalizedName"><h4><span class="title">Normalized Name</span></h4><p>By default, DATATOOL generates "normalized" C++ class names from ASN.1 type names using two rules:</p><dl class="labeled-list"><dt>1</dt><dd><p class="no_top_margin">Convert any hyphens ("<span class="nctnt ncbi-type">-</span>") into underscores ("<span class="nctnt ncbi-class">_</span>"), because hyphens are not legal characters in C++ class names.</p></dd><dt>2</dt><dd><p class="no_top_margin">Prepend a 'C' character.</p></dd></dl><p>For example, the default normalized C++ class name for the ASN.1 type name "<span class="nctnt ncbi-type">Seq-data</span>" is "<span class="nctnt ncbi-class">CSeq_data</span>".</p><p>The default C++ class name can be overridden by explicitly specifying in the definition file a name for a given ASN.1 type name. For example:</p><pre>[MyModule.Seq-data]<br />_class=CMySeqData</pre></div><div class="sec" id="ch_app.datatool.html_refCodeEnum"><h4><span class="title">ENUMERATED Types</span></h4><p>By default, for every <span class="nctnt ncbi-monospace">ENUMERATED</span> ASN.1 type, <span class="nctnt ncbi-app">DATATOOL</span> will produce a C++ enum type with the name <span class="nctnt ncbi-type">ENormalizedName</span>.</p></div></div><div class="sec" id="ch_app.dt_inside.html"><h3><span class="title">Class Diagrams</span></h3><p>The following topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs">Specification analysis</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_data_types">Data types</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_data_values">Data values</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_code_gen">Code generation</a></p></li></ul><div class="sec" id="ch_app.dt_inside.html_specs"><h4><span class="title">Specification Analysis</span></h4><p>The following topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs_asn">ASN.1 specification analysis</a></p></li><li><p><a href="ch_app.html#ch_app.dt_inside.html_specs_dtd">DTD specification analysis</a></p></li></ul><div class="sec" id="ch_app.dt_inside.html_specs_asn"><h5><span class="title">ASN.1 Specification Analysis</span></h5><p>See <a href="ch_app.html#ch_app.specs_asn">Figure 1</a>.</p><div class="figure" id="ch_app.specs_asn"><div class="graphic"><img src="img/specs_asn.gif" alt="1. ASN.1 specification analysis." /></div><div class="caption"><p>1. ASN.1 specification analysis.</p></div></div></div><div class="sec" id="ch_app.dt_inside.html_specs_dtd"><h5><span class="title">DTD Specification Analysis</span></h5><p>See <a href="ch_app.html#ch_app.specs_dtd">Figure 2</a>.</p><div class="figure" id="ch_app.specs_dtd"><div class="graphic"><img src="img/specs_dtd.gif" alt="2. DTD specification analysis." /></div><div class="caption"><p>2. DTD specification analysis.</p></div></div></div></div><div class="sec" id="ch_app.dt_inside.html_data_types"><h4><span class="title">Data Types</span></h4><p>See <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/doxyhtml/classCDataType.html">CDataType</a>.</p></div><div class="sec" id="ch_app.dt_inside.html_data_values"><h4><span class="title">Data Values</span></h4><p>See <a href="ch_app.html#ch_app.data_values">Figure 3</a>.</p><div class="figure" id="ch_app.data_values"><div class="graphic"><img src="img/data_types.gif" alt="3. Data values." /></div><div class="caption"><p>3. Data values.</p></div></div></div><div class="sec" id="ch_app.dt_inside.html_code_gen"><h4><span class="title">Code Generation</span></h4><p>See <a href="ch_app.html#ch_app.code_gen">Figure 4</a>.</p><div class="figure" id="ch_app.code_gen"><div class="graphic"><img src="img/type_strings.gif" alt="4. Code generation." /></div><div class="caption"><p>4. Code generation.</p></div></div></div></div></div><div class="sec" id="ch_app.Load_Balancing"><h2><span class="title">Load Balancing</span></h2><ul><li><p><a href="ch_app.html#ch_app._Overview">Overview</a></p></li><li><p><a href="ch_app.html#ch_app.Load_Balancing_Servi">Load Balancing Service Mapping Daemon (LBSMD)</a></p></li><li><p><a href="ch_app.html#ch_app.Database_Load_Balancing">Database Load Balancing</a></p></li><li><p><a href="ch_app.html#ch_app.Cookie___Argument_Af">Cookie / Argument Affinity Module (MOD_CAF)</a></p></li><li><p><a href="ch_app.html#ch_app.DISPD_Network_Dispat">DISPD Network Dispatcher</a></p></li><li><p><a href="ch_app.html#ch_app.NCBID_Server_Launche">NCBID Server Launcher</a></p></li><li><p><a href="ch_app.html#ch_app.Firewall_Daemon_FWDa">Firewall Daemon (FWDaemon)</a></p></li><li><p><a href="ch_app.html#ch_app.Launcherd_Utility">Launcherd Utility</a></p></li><li><p><a href="ch_app.html#ch_app.Monitoring_Tools">Monitoring Tools</a></p></li><li><p><a href="ch_app.html#ch_app.Quality_Assurance_Do">Quality Assurance Domain</a></p></li></ul><p><span class="nctnt highlight">Note:</span> For security reasons not all links in the public version of this document are accessible by the outside NCBI users.</p><p>The section covers the following topics:</p><ul><li><p>The purpose of load balancing</p></li><li><p>All the separate components’ purpose, internal details, configuration</p></li><li><p>Communications between the components</p></li><li><p>Monitoring facilities</p></li></ul><div class="sec" id="ch_app._Overview"><h3><span class="title">Overview</span></h3><p>The purpose of load balancing is distributing the load among the service providers available on the NCBI network basing on certain rules. The load is generated by both locally-connected and Internet-connected users. The figures below show the most typical usage scenarios.</p><p><span><img src="img/LoadBalancingLocal.gif" alt="Image LoadBalancingLocal.gif" /></span></p><p>Figure 5.  Local Clients</p><p>Please note that the figure is simplified slightly to remove unnecessary details for the time being.</p><p>In case of local access to the NCBI resources there are two NCBI developed components which are involved into the interactions. These are LBSMD daemon (Load Balancing Service Mapping Daemon) and mod_caf (Cookie/Argument Affinity module) - an Apache web server module. </p><p>The LBSMD daemon is running on each host in the NCBI network. The daemon reads its configuration file with all the services available on the host described. Then the LBSMD daemon broadcasts the available services and the current host load to the adjacent LBSMD daemons on a regular basis. The data received from the other LBSMD daemons are stored in a special table. So at some stage the LBSMD daemon on each host has a full description of the services available on the network as well as the current hosts’ load.</p><p>The mod_caf Apache’s module analyses special cookies, query line arguments and reads data from the table populated by the LBSMD daemon. Basing on the best match it makes a decision of where to pass a request further.</p><p>Suppose for a moment that a local NCBI client runs a web browser, points to an NCBI web page and initiates a DB request via the web interface. At this stage the mod_caf analyses the request line and makes a decision where to pass the request. The request is passed to the ServiceProviderN host which performs the corresponding database query. Then the query results are delivered to the client. The data exchange path is shown on the figure above using solid lines.</p><p>Another typical scenario for the local NCBI clients is when client code is run on a user workstation. That client code might require a long term connection to a certain service, to a database for example. The browser is not able to provide this kind of connection so a direct connection is used in this case. The data exchange path is shown on the figure above using dashed lines.</p><p>The communication scenarios become more complicated in case when clients are located outside of the NCBI network. The figure below describes the interactions between modules when the user requested a service which does not suppose a long term connection.</p><p><span><img src="img/LoadBalancingInternetShort.gif" alt="Image LoadBalancingInternetShort.gif" /></span></p><p>Figure 6. Internet Clients. Short Term Connection</p><p>The clients have no abilities to connect to front end Apache web servers directly. The connection is done via a router which is located in DMZ (Demilitarized Zone). The router selects one of the available front end servers and passes the request to that web server. Then the web server processes the request very similar to how it processes requests from a local client.</p><p>The next figure explains the interactions for the case when an Internet client requests a service which supposes a long term connection.</p><p><span><img src="img/LoadBalancingInternetLong.gif" alt="Image LoadBalancingInternetLong.gif" /></span></p><p>Figure 7. Internet Clients. Long Term Connection</p><p>In opposite to the local clients the internet clients are unable to connect to the required service directly because of the DMZ zone. This is where DISPD, FWDaemon and a proxy come to help resolving the problem. </p><p>The data flow in the scenario is as follows. A request from the client reaches a front end Apache server as it was discussed above. Then the front end server passes the request to the DISPD dispatcher. The DISPD dispatcher communicates to FWDaemon (Firewall Daemon) to provide the required service facilities. The FWDaemon answers with a special ticket for the requested service. The ticket is sent to the client via the front end web server and the router. Then the client connects to the NAT service in the DMZ zone providing the received ticket. The NAT service establishes a connection to the FWDaemon and passes the received earlier ticket. The FWDaemon, in turn, provides the connection to the required service. It is worth to mention that the FWDaemon is running on the same host as the DISPD dispatcher and neither DISPD nor FWDaemon can work without each other.</p><p>The most complicated scenario comes to the picture when an arbitrary UNIX filter program is used as a service provided for the outside NCBI users. The figure below shows all the components involved into the scenario.</p><p><span><img src="img/LoadBalancingDispD.gif" alt="Image LoadBalancingDispD.gif" /></span></p><p>Figure 8.   NCBID at Work</p><p>The data flow in the scenario is as follows. A request from the client reaches a front end Apache server as it was discussed above. Then the front end server passes the request to the DISPD dispatcher. The DISPD communicates to both the FWDaemon and the NCBID utility on (possibly) the other host and requests to demonize a requested UNIX filter program (Service X on the figure). The demonized service starts listening on the certain port for a network connection. The connection attributes are delivered to the FWDaemon and to the client via the web front end and the router. The client connects to the NAT service and the NAT service passes the request further to the FWDaemon. The FWDaemon passes the request to the demonized Service X on the Service Provider K host. Since that moment the client is able to start data exchange with the service. The described scenario is purposed for long term connections oriented tasks.</p><p>Further sections describe all the components in more detail.</p></div><div class="sec" id="ch_app.Load_Balancing_Servi"><h3><span class="title">Load Balancing Service Mapping Daemon (LBSMD)</span></h3><div class="sec" id="ch_app._Overview_1"><h4><span class="title">Overview</span></h4><p>As it was mentioned earlier the purpose of LBSMD daemon is running on each host which carries either public or private servers which, in turn, implement NCBI services. The services include CGI programs or standalone servers to access NCBI data.</p><p>Each service has a unique name assigned to it. The “TaxServer” would be an example of such name. The name not only identifies a service. It also implies a protocol which is used for data exchange with the certain service. For example, any client which connects to the “TaxServer” service knows how to communicate with that service regardless the way the service is implemented. In other words the service could be implemented as a standalone server on host X and as a CGI program on the same host or on another host Y (please note, however, that there are exceptions and for some service types it is forbidden to have more than one service type on the same host).</p><p>A host can advertize many services. For example, one service (such as “Entrez2”) can operate with binary data only while another one (such as “Entrez2Text”) can operate with text data only. The distinction between those two services could be made by using a content type specifier in the LBSMD daemon configuration file. </p><p>The main purpose of the LBSMD daemon is to maintain a table of all services available at NCBI at the moment. In addition the LBSMD daemon keeps track of servers that are found to be nonfunctional (dead servers). The daemon is also responsible for propagating trouble reports, obtained from applications. The application trouble reports are based on their experience with advertised servers (e.g., an advertised server is not technically dead but generates some sort of garbage). Further in this document, the latter kind of feedback is called a penalty.</p><p>The principle of load balancing is simple: each server which implements a service is assigned a (calculated) rate. The higher the rate, the better the chance for that server to be chosen when a request for a service comes up. Note that load balancing is thus almost never deterministic.</p><p>The LBSMD daemon calculates two parameters for the host on which it is running. The parameters are a normal host status and a BLAST host status (based on the instant load of the system). These parameters are then used to calculate the rate of all (non static) servers on the host. The rates of all other hosts are not calculated but received and stored in the LBSDM table.</p><p>The LBSMD daemon is started from crontab every few minutes on all the production hosts to ensure that the daemon is always running. This technique is safe because no more than one instance of the daemon is permitted on a certain host and any attempt to start more than one is rejected.</p><p>The main loop of the LBSMD daemon comprises periodic checking of the configuration file and reloading the configuration if necessary, checking and processing the incoming messages from neighbor LBSMD daemons running on other hosts, and generation and broadcasting the messages to the other hosts about the load of the system and configured services. The LBSMD daemon also checks periodically whether the configured servers are alive by trying to connect to them and then disconnect immediately, without sending/receiving any data. This is the only way how the daemon is able to check whether the network port is working.</p><p>Clients can <a href="ch_conn.html#ch_conn.Service_Redirection">redirect services</a>. The LBSMD does not distinguish between direct and redirected services.</p></div><div class="sec" id="ch_app._Configuration"><h4><span class="title">Configuration</span></h4><p>The LBSMD daemon is configured via command line options and via a configuration file. The full list of command line options can be retrieved by issuing the following command:</p><p><span class="nctnt ncbi-cmd">/opt/machine/lbsm/sbin/lbsmd --help</span></p><p>The local NCBI users can also visit the following link:</p><p><a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi</a></p><p>The default name of the LBSMD daemon configuration file is <span class="nctnt ncbi-path">/etc/lbsmd/servrc.cfg</span>. Each line can be one of the following:</p><ul><li><p>a part of the host environment</p></li><li><p>an include directive</p></li><li><p>a service definition</p></li><li><p>an empty line (entirely blank or containing a comment only)</p></li></ul><p>Empty lines are ignored in the file. Any single configuration line can be split into several physical lines by inserting backslash symbols (\) before the line breaks. A comment is introduced by the pound symbol (#). </p><p>A configuration line of the form </p><pre> <span class="nctnt-pre ncbi-code">name=value</span> <br /></pre><p>goes into the host environment. The host environment can be accessed by clients when they perform the service name resolution. The host environment is designed to help the client to know about limitations/options that the host has, and based on this additional information the client can make a decision whether the server (despite the fact that it implements the service) is suitable for carrying out the client's request. For example, the host environment can give the client an idea about what databases are available on the host. The host environment is not interpreted or used in any way by either the daemon or by the load balancing algorithm, except that the name must be a valid identifier. The value may be practically anything, even empty. It is left solely to the client to parse the environment and to look for the information of interest. The host environment can be obtained from the service iterator by a call to <span class="nctnt ncbi-code">SERV_GetNextInfoEx()</span> (<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=SERV_GetNextInfoEx">http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=SERV_GetNextInfoEx</a>), which is documented in the <a href="ch_conn.html#ch_conn.service_mapping_api">service mapping API</a></p><p><span class="nctnt highlight">Note</span>: White space characters which surround the name are not preserved but they are preserved in the value i.e. when they appear after the “=” sign.</p><p>A configuration line of the form </p><pre> <span class="nctnt-pre ncbi-code">%include filename</span> <br /></pre><p>causes the <span class="nctnt ncbi-var">filename</span> file content be inserted here. The daemon always assumes that relative file names (those with names that do not start with the slash character (/)) are given with the daemon startup directory as a base. This is true for any level of nesting.</p><p>Once started, the daemon first assigns the configuration file name as <span class="nctnt ncbi-path">/etc/lbsmd/servrc.cfg</span> and then tries to read it. If the file is not found (or is not readable) the daemon looks for the configuration file <span class="nctnt ncbi-path">servrc.cfg</span> in the directory from which the server has been started. If the file is found then the file is used as a configuration file. This fallback mechanism is not used when the configuration file name is explicitly stated in the command line. The daemon periodically checks the configuration file and all of its descendants and reloads (discards) their contents if some of the files have been either updated, (re-)moved, or added.</p><p>A configuration line of the form </p><pre> <br /><span class="nctnt-pre ncbi-code">service_name [check_specifier] server_descriptor [| launcher_info ]</span> <br /></pre><p>introduces a service. The detailed description of the individual fields is given below.</p><ul><li><p><span class="nctnt ncbi-var">service_name</span> introduces the service name, for example TaxServer.</p></li><li><p><span class="nctnt ncbi-var">[check_specifier]</span> is an optional parameter (if omitted, the surrounding square brackets must not be used). The parameter is a comma separated list and each element in the list can be one of the following.</p><ul><li><p><span class="nctnt ncbi-var">[-]N[/[-]M]</span> where N and M are integers. This will lead to checking every N seconds with backoff time of M seconds if failed. The “-“ character is used when it is required to check dependencies only but not the primary connection point. "0", which stands for "no check interval", disables checks for the service.</p></li><li><p><span class="nctnt ncbi-var">[!][host[:port]][+[service]]</span> which describes a dependency. The “!” character means negation. The <span class="nctnt ncbi-var">service</span> is a service name the describing service depends on and runs on <span class="nctnt ncbi-var">host:port</span>. The pair <span class="nctnt ncbi-var">host:port</span> is required if no service is specified. The <span class="nctnt ncbi-var">host</span>, :<span class="nctnt ncbi-var">port</span>, or both can be missing if <span class="nctnt ncbi-var">service</span> is specified (in that case the missing parts are read as “any”). The “+” character alone means “this service” (the one currently being defined). There could be multiple dependency specifications for a service.</p></li><li><p><span class="nctnt ncbi-var">[~][DOW[-DOW]][@H[-H]]</span> which defines a schedule. The “~” character means negation. The service runs from <span class="nctnt ncbi-var">DOW</span> to <span class="nctnt ncbi-var">DOW</span> (<span class="nctnt ncbi-var">DOW</span> is one of Su, Mo, Tu, We, Th, Fr, Sa) or any if not specified and between hours <span class="nctnt ncbi-var">H</span> to <span class="nctnt ncbi-var">H</span> (9-5 means 9:00am thru 5:59pm, 9-22 means 9:00am thru 10:59pm). Single <span class="nctnt ncbi-var">DOW</span> and / or <span class="nctnt ncbi-var">H</span> are allowed and mean the exact day of week and / or the exact hour. There could be multiple schedule specifications.</p></li><li><p><span class="nctnt ncbi-var">email@ncbi.nlm.nih.gov</span> which makes the LBSMD daemon to send an e-mail to the specified address whenever this server changes its status (e.g. from up to down). There could be many e-mail specifications. The <span class="nctnt ncbi-var">ncbi.nlm.nih.gov</span> part is fixed and is not allowed to be changed.</p></li><li><p><span class="nctnt ncbi-var">user</span> which makes the LBSMD daemon add the specified <span class="nctnt ncbi-var">user</span> to the list of users who are authorized to change the server rate on the fly (e.g. post a penalty, issue re-rate command etc.). By default these actions are allowed to the <span class="nctnt ncbi-var">root</span> and <span class="nctnt ncbi-var">lbsmd</span> users. There could be many user specifications.</p></li><li><p><span class="nctnt ncbi-var">script</span> which specifies a path to a local executable which checks whether the server is operational. The LBSMD daemon starts this script periodically as specified by the check time parameter(s) above. A single script specification is allowed. See <a href="ch_app.html#ch_app.Check_Script_Specification">Check Script Specification</a> for more details.</p></li></ul></li><li><p><span class="nctnt ncbi-var">server_descriptor</span> specifies the address of the server and supplies additional information. An example of the <span class="nctnt ncbi-var">server_descriptor</span>:<br /><span class="nctnt ncbi-code">STANDALONE somehost:1234 R=3000 L=yes S=yes B=-20</span><br />See <a href="ch_app.html#ch_app.Server_Descriptor_Specification">Server Descriptor Specification</a> for more details.</p></li><li><p><span class="nctnt ncbi-var">launcher_info</span> is basically a command line preceded by a pipe symbol ( | ) which plays a role of a delimiter from the <span class="nctnt ncbi-var">server_descriptor</span>. It is only required for the <span class="nctnt ncbi-app">NCBID</span> type of service which are configured on the local host.</p></li></ul><div class="sec" id="ch_app.Check_Script_Specification"><h5><span class="title">Check Script Specification</span></h5><p>The check script file is configured between square brackets '[' and ']' in the service definition line. For example, in this service definition line:</p><p><span class="nctnt ncbi-code">MYSERVICE [5, /bin/user/directory/script.sh] STANDALONE :2222 ...</span></p><p>the period in seconds between script checks is "<span class="nctnt ncbi-code">5</span>" and the check script file is "<span class="nctnt ncbi-code">/bin/user/directory/script.sh</span>". The default period is 15 seconds. You can prepend "-" to the period to indicate that LBSMD should not check the connection point (:2222 in this example) on its own, but should only run the script. The script must finish before the next check run is due. Otherwise, LBSMD will remove the script from the check schedule (and won't use it again).</p><p>The following command-line parameters are always passed to the script upon execution:</p><ul><li><p><span class="nctnt ncbi-var">argv[0]</span> = name of the executable with preceding '|' character if <span class="nctnt ncbi-var">stdin</span> / <span class="nctnt ncbi-var">stdout</span> are open to the server connection (/dev/null otherwise), <span class="nctnt highlight">NB</span>: '|' is not always readily accessible from within shell scripts, so it's duplicated in <span class="nctnt ncbi-var">argv[2]</span> for convenience;</p></li><li><p><span class="nctnt ncbi-var">argv[1]</span> = name of the service being checked;</p></li><li><p><span class="nctnt ncbi-var">argv[2]</span> = if piped, "|host:port" of the connection point being checked, otherwise "host:port" of the server as per configuration;</p></li></ul><p>The following additional command-line parameters will be passed to the script if it has been run before:</p><ul><li><p><span class="nctnt ncbi-var">argv[3]</span> = exit code obtained in the last check script run;</p></li><li><p><span class="nctnt ncbi-var">argv[4]</span> = repetition count for <span class="nctnt ncbi-var">argv[3]</span> (<span class="nctnt highlight">NB</span>: 0 means this is the first occurrence of the exit code given in <span class="nctnt ncbi-var">argv[3]</span>);</p></li><li><p><span class="nctnt ncbi-var">argv[5]</span> = seconds elapsed since the last check script run.</p></li></ul><p>Output to <span class="nctnt ncbi-var">stderr</span> is attached to the LBSMD log file; the CPU limit is set to maximal allowed execution time.</p><p>The check script is expected to finish with the following exit codes:</p><ul><li><p>within the range [0..100], where 0 means the server is running at full throttle (fully available), and 100 means that the server has to be considered down; or</p></li><li><p>123 to request to keep the last exit code if that has been supplied in <span class="nctnt ncbi-var">argv[3]</span> (which is guaranteed to be within [0..100]); or</p></li><li><p>127 to request to turn the server off from LBSMD configuration.</p></li></ul><p>Note that a code from the range [0..100] resets the repetition count even though the resulting exit code may be equal to the previous one. Any other exit code (or code 123 when no previous code is available) will cause the server to be considered fully up (as if 0 has been returned), and will be logged with a warning. Note that upon code 127 no further script runs will occur.</p><p>If the check script crashes ungracefully (with or without the coredump), it will be eliminated from further checks, and the server will be considered fully available (i.e. as if 0 had been returned).</p><p><span class="nctnt highlight">Note:</span> The check script operation is complementary to setting a penalty prior to doing any disruptive changes in production. In other words, the script is only reliable as long as the service is expected to work. If there is any scheduled maintenance, it should be communicated to LBSMD via a penalty rather than by an assumption that the failing script will do the job of bringing the service to the down state and excluding it from LB.</p></div><div class="sec" id="ch_app.Server_Descriptor_Specification"><h5><span class="title">Server Descriptor Specification</span></h5><p>The <span class="nctnt ncbi-var">server_descriptor</span>, also detailed in <span class="nctnt ncbi-path">connect/ncbi_server_info.h</span> (<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/include/connect/ncbi_server_info.h">http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/include/connect/ncbi_server_info.h</a>), consists of the following fields:</p><p><span class="nctnt ncbi-code">server_type [host][:port] [arguments] [flags]</span></p><p>where:</p><ul><li><p><span class="nctnt ncbi-var">server_type</span> is one of the following keywords (<a href="ch_conn.html#ch_conn.service_connector">more info</a>):</p><ul><li><p><span class="nctnt ncbi-type">NCBID</span> for servers launched by ncbid.cgi</p></li><li><p><span class="nctnt ncbi-type">STANDALONE</span> for standalone servers listening to incoming connections on dedicated ports</p></li><li><p><span class="nctnt ncbi-type">HTTP_GET</span> for servers, which are the CGI programs accepting only the GET request method</p></li><li><p><span class="nctnt ncbi-type">HTTP_POST</span> for servers, which are the CGI programs accepting only the POST request method</p></li><li><p><span class="nctnt ncbi-type">HTTP</span> for servers, which are the CGI programs accepting either GET or POST request methods</p></li><li><p><span class="nctnt ncbi-type">DNS</span> for introduction of a name (fake service), which can be used later in load-balancing for domain name resolution</p></li><li><p><span class="nctnt ncbi-type">NAMEHOLD</span> for declaration of service names that cannot be defined in any other configuration files except for the current configuration file. <span class="nctnt highlight">Note:</span> The FIREWALL server specification may not be used in a configuration file (i.e., may neither be declared as services nor as service name holders). </p></li></ul></li><li><p>both <span class="nctnt ncbi-var">host</span> and <span class="nctnt ncbi-var">port</span> parameters are optional. Defaults are local host and port 80, except for <span class="nctnt ncbi-type">STANDALONE</span> and <span class="nctnt ncbi-type">DNS</span> servers, which do not have a default port value. If host is specified (by either of the following: keyword localhost, localhost IP address 127.0.0.1, real host name, or IP address) then the described server is not a subject for variable load balancing but is a static server. Such server always has a constant rate, independent of any host load.</p></li><li><p><span class="nctnt ncbi-var">arguments</span> are required for HTTP* servers and must specify the local part of the URL of the CGI program and, optionally, parameters such as <span class="nctnt ncbi-path">/somepath/somecgi.cgi?param1&amp;param2=value2&amp;param3=value3</span>. If no parameters are to be supplied, then the question mark (?) must be omitted, too. For <span class="nctnt ncbi-app">NCBID</span> servers, arguments are parameters to pass to the server and are formed as arguments for CGI programs, i.e., param1&amp;param2&amp;param3=value. As a special rule, '' (two single quotes) may be used to denote an empty argument for the <span class="nctnt ncbi-app">NCBID</span> server. <span class="nctnt ncbi-type">STANDALONE</span> and <span class="nctnt ncbi-type">DNS</span> servers do not take any <span class="nctnt ncbi-var">arguments</span>.</p></li><li><p><span class="nctnt ncbi-var">flags</span> can come in any order (but no more than one instance of a flag is allowed) and essentially are the optional modifiers of values used by default. The following flags are recognized (see <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/include/connect/ncbi_server_info.h">ncbi_server_info.h</a>):</p><ul><li><p>load calculation keyword:</p><ul><li><p><span class="nctnt ncbi-type">Blast</span> to use special algorithm for rate calculation acceptable for BLAST (<a href="http://www.ncbi.nlm.nih.gov/blast/Blast.cgi">http://www.ncbi.nlm.nih.gov/blast/Blast.cgi</a>) applications. The algorithm uses instant values of the host load and thus is less conservative and more reactive than the ordinary one.</p></li><li><p><span class="nctnt ncbi-type">Regular</span> to use an ordinary rate calculation (default, and the only load calculation option allowed for static servers).</p></li></ul></li><li><p>base rate:</p><ul><li><p>R=value sets the base server reachability rate (as a floating point number); the default is 1000. Any negative value makes the server unreachable, and a value 0 is used. The range of the base rate is between 0.001 and 100000.</p></li></ul></li><li><p>locality markers (Note: If necessary, both L and P markers can be combined in a particular service definition):</p><ul><li><p>L={yes|no} sets (if yes) the server to be local only. The default is no. The <a href="ch_conn.html#ch_conn.service_mapping_api">service mapping API</a> returns local only servers in the case of mapping with the use of LBSMD running on the same - local - host (direct mapping), or if the dispatching (indirect mapping) occurs within the NCBI Intranet. Otherwise, if the service mapping occurs using a non-local network (certainly indirectly, by exchange with dispd.cgi) then servers that are local only are not seen.</p></li><li><p>P={yes|no} sets (if yes) the server to be private. The default is no. Private servers are not seen by the outside NCBI users (exactly like local servers), but in addition these servers are not seen from the NCBI Intranet if requested from a host, which is different from one where the private server runs. This flag cannot be used for DNS servers. </p></li></ul></li><li><p>Stateful server:</p><ul><li><p>S={yes|no}. The default is no.<br />Indication of stateful server, which allows only dedicated socket (stateful) connections. This tag is not allowed for HTTP* and DNS servers.</p></li></ul></li><li><p><span class="nctnt highlight">Note:</span> If several configuration lines for a particular service have Q=value flag, then the quorum is the minimal value among those specified. Q=no or Q=0 defines an active service entry (as if the Q flag were not specified at all).</p></li><li><p>Content type indication:</p><ul><li><p>C=type/subtype [no default]<br />specification of Content-Type (including encoding), which server accepts. The value of this flag gets added automatically to any HTTP packet sent to the server by SERVICE connector. However, in order to communicate, a client still has to know and generate the data type accepted by the server, i.e. a protocol, which server understands. This flag just helps insure that HTTP packets all get proper content type, defined at service configuration. This tag is not allowed in DNS server specifications.</p></li></ul></li><li><p>Bonus coefficient:</p><ul><li><p>B=double [0.0 = default]<br />specifies a multiplicative bonus given to a server run locally, when calculating reachability rate. Special rules apply to negative/zero values: 0.0 means not to use the described rate increase at all (default rate calculation is used, which only slightly increases rates of locally run servers). Negative value denotes that locally run server should be taken in first place, regardless of its rate, if that rate is larger than percent of expressed by the absolute value of this coefficient of the average rate coefficient of other servers for the same service. That is -5 instructs to ignore locally run server if its status is less than 5% of average status of remaining servers for the same service.</p></li></ul></li><li><p>Validity period:</p><ul><li><p>T=integer [0 = default]<br />specifies the time in seconds this server entry is valid without update. (If equal to 0 then defaulted by the LBSM Daemon to some reasonable value.)</p></li></ul></li></ul></li></ul><p>Server descriptors of type <span class="nctnt ncbi-type">NAMEHOLD</span> are special. As <span class="nctnt ncbi-var">arguments</span>, they have only a server type keyword. The namehold specification informs the daemon that the service of this name and type is not to be defined later in any configuration file except for the current one. Also, if the host is specified, then this protection works only for the service name on the particular host. The port number is ignored (if specified).</p><p><span class="nctnt highlight">Note:</span> it is recommended that a dummy port number (such as :0) is always put in the namehold specifications to avoid ambiguities with treating the server type as a host name. The following example disables <span class="nctnt ncbi-var">TestService</span> of type <span class="nctnt ncbi-type">DNS</span> from being defined in all other configuration files included later, and <span class="nctnt ncbi-var">TestService2</span> to be defined as a <span class="nctnt ncbi-app">NCBID</span> service on host foo: </p><pre> <br /><span class="nctnt-pre ncbi-code">TestService  NAMEHOLD    :0 DNS <br />TestService2 NAMEHOLD foo:0 NCBID</span> <br /></pre></div></div><div class="sec" id="ch_app.Signals"><h4><span class="title">Signals</span></h4><p>The table below describes the LBSMD daemon signal processing.</p><div class="table" id="ch_app.T.nc_SignalReactionSIGHUPreload_t"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Signal</td><td align="center" valign="top" rowspan="1" colspan="1">Reaction</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">SIGHUP</td><td align="left" valign="top" rowspan="1" colspan="1">reload the configuration</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">SIGINT</td><td align="left" valign="top" rowspan="1" colspan="1">quit</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">SIGTERM</td><td align="left" valign="top" rowspan="1" colspan="1">quit</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">SIGUSR1</td><td align="left" valign="top" rowspan="1" colspan="1">toggle the verbosity level between less verbose (default) and more verbose (when every warning generated is stored) modes</td></tr></tbody></table></div></div><div class="sec" id="ch_app.Automatic_Configurat"><h4><span class="title">Automatic Configuration Distribution</span></h4><p>The configuration files structure is unified for all the hosts in the NCBI network. It is shown on the figure below.</p><p><span><img src="img/LBSMDConfig.gif" alt="Image LBSMDConfig.gif" /></span></p><p>Figure 9. LBSMD Configuration Files Structure</p><p>The common for all the configuration file prefix <span class="nctnt ncbi-path">/etc/lbsmd</span> is omitted on the figure. The arrows on the diagram show how the files are included.</p><p>The files <span class="nctnt ncbi-path">servrc.cfg</span> and <span class="nctnt ncbi-path">servrc.cfg.systems</span> have fixed structure and should not be changed at all. The purpose of the file <span class="nctnt ncbi-path">local/servrc.cfg.systems</span> is to be modified by the systems group while the purpose of the file <span class="nctnt ncbi-path">local/servrc.cfg.ieb</span> isto be modified by the delegated members of the respected groups. To make it easier for changes all the <span class="nctnt ncbi-path">local/servrc.cfg.ieb</span> files from all the hosts in the NCBI network are stored in a centralized SVN repository. The repository can be received by issuing the following command:</p><p><span class="nctnt ncbi-cmd">svn co svn+ssh://subvert.be-md.ncbi.nlm.nih.gov/export/home/LBSMD_REPO</span></p><p>The file names in that repository match the following pattern:</p><p><span class="nctnt ncbi-monospace">hostname.{be-md|st-va}[.qa]</span></p><p>where <span class="nctnt ncbi-monospace">be-md</span> is used for Bethesda, MD site and <span class="nctnt ncbi-monospace">st-va</span> is used for Sterling, VA site. The optional <span class="nctnt ncbi-monospace">.qa</span> suffix is used for quality assurance department hosts.</p><p>So, if it is required to change the <span class="nctnt ncbi-path">/etc/lbsmd/local/servrc.cfg.ieb</span> file on the sutils1 host in Bethesda the <span class="nctnt ncbi-path">sutils1.be-md</span> file is to be changed in the repository.</p><p>As soon as the modified file is checked in the file will be delivered to the corresponding host with the proper name automatically. The changes will take effect in a few minutes. The process of the configuration distribution is illustrated on the figure below.</p><p><span><img src="img/CFEngine.gif" alt="Image CFEngine.gif" /></span></p><p>Figure 10. Automatic Configuration Distribution</p></div><div class="sec" id="ch_app.Monitoring_and_Contr"><h4><span class="title">Monitoring and Control</span></h4><div class="sec" id="ch_app.Service_Search"><h5><span class="title">Service Search</span></h5><p>The following web page can be used to search for a service:</p><p><a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi</a></p><p>The following screen will appear</p><p><span><img src="img/LBSMDSearchMain.gif" alt="Image LBSMDSearchMain.gif" /></span></p><p>Figure 11. NCBI Service Search Page</p><p>As an example of usage a user might enter the partial name of the service like "TaxService" and click on the “Go” button. The search results will display "TaxService", "TaxService3" and "TaxService3Test" if those services are available (see <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi?key=rb_svc&amp;service=TaxService&amp;host=&amp;button=Go&amp;db=">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi?key=rb_svc&amp;service=TaxService&amp;host=&amp;button=Go&amp;db=</a>).</p></div><div class="sec" id="ch_app.lbsmc_Utility"><h5><span class="title">lbsmc Utility</span></h5><p>Another way of monitoring the LBSMD daemon is using the lbsmc (<a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/lxr/source/src/connect/daemons/lbsmc.c">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/lxr/source/src/connect/daemons/lbsmc.c</a>) utility. The utility periodically dumps onto the screen a table which represents the current content of the LBSMD daemon table. The utility output can be controlled by a number of command line options. The full list of available options and their description can be obtained by issuing the following command:</p><p><span class="nctnt ncbi-cmd">lbsmc -h</span></p><p>The NCBI intranet users can also get the list of options by clicking on this link: <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc.cgi?-h">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc.cgi?-h</a>.</p><p>For example, to print a list of hosts which names match the pattern “sutil*” the user can issue the following command:</p><pre> &gt;./lbsmc -h sutil* 0<br />LBSMC - Load Balancing Service Mapping Client R100432<br />03/13/08 16:20:23 ====== widget3.be-md.ncbi.nlm.nih.gov (00:00) ======= [2] V1.2<br />Hostname/IPaddr Task/CPU LoadAv LoadBl    Joined      Status   StatBl<br />sutils1          151/4     0.06   0.03  03/12 13:04   397.62  3973.51<br />sutils2          145/4     0.17   0.03  03/12 13:04   155.95  3972.41<br />sutils3          150/4     0.20   0.03  03/12 13:04   129.03  3973.33<br />--------------------------------------------------------------------------------<br />Service             T    Type    Hostname/IPaddr:Port LFS   B.Rate Coef   Rating<br />bounce            +25    NCBID   sutils1:80           L    1000.00        397.62<br />bounce            +25    HTTP    sutils1:80                1000.00        397.62<br />bounce            +25    NCBID   sutils2:80           L    1000.00        155.95<br />bounce            +25    HTTP    sutils2:80                1000.00        155.95<br />bounce            +27    NCBID   sutils3:80           L    1000.00        129.03<br />bounce            +27    HTTP    sutils3:80                1000.00        129.03<br />dispatcher_lb      25     DNS    sutils1:80                1000.00        397.62<br />dispatcher_lb      25     DNS    sutils2:80                1000.00        155.95<br />dispatcher_lb      27     DNS    sutils3:80                1000.00        129.03<br />MapViewEntrez      25 STANDALONE sutils1:44616        L S  1000.00        397.62<br />MapViewEntrez      25 STANDALONE sutils2:44616        L S  1000.00        155.95<br />MapViewEntrez      27 STANDALONE sutils3:44616        L S  1000.00        129.03<br />MapViewMeta        25 STANDALONE sutils2:44414        L S     0.00          0.00<br />MapViewMeta        27 STANDALONE sutils3:44414        L S     0.00          0.00<br />MapViewMeta        25 STANDALONE sutils1:44414        L S     0.00          0.00<br />sutils_lb          25     DNS    sutils1:80                1000.00        397.62<br />sutils_lb          25     DNS    sutils2:80                1000.00        155.95<br />sutils_lb          27     DNS    sutils3:80                1000.00        129.03<br />TaxService         25    NCBID   sutils1:80                1000.00        397.62<br />TaxService         25    NCBID   sutils2:80                1000.00        155.95<br />TaxService         27    NCBID   sutils3:80                1000.00        129.03<br />TaxService3       +25  HTTP_POST sutils1:80                1000.00        397.62<br />TaxService3       +25  HTTP_POST sutils2:80                1000.00        155.95<br />TaxService3       +27  HTTP_POST sutils3:80                1000.00        129.03<br />test              +25    HTTP    sutils1:80                1000.00        397.62<br />test              +25    HTTP    sutils2:80                1000.00        155.95<br />test              +27    HTTP    sutils3:80                1000.00        129.03<br />testgenomes_lb     25     DNS    sutils1:2441              1000.00        397.62<br />testgenomes_lb     25     DNS    sutils2:2441              1000.00        155.95<br />testgenomes_lb     27     DNS    sutils3:2441              1000.00        129.03<br />testsutils_lb      25     DNS    sutils1:2441              1000.00        397.62<br />testsutils_lb      25     DNS    sutils2:2441              1000.00        155.95<br />testsutils_lb      27     DNS    sutils3:2441              1000.00        129.03<br />--------------------------------------------------------------------------------<br />* Hosts:4\747, Srvrs:44/1223/23  |   Heap:249856, used:237291/249616, free:240 *<br />LBSMD PID: 17530, config: /etc/lbsmd/servrc.cfg<br /></pre></div><div class="sec" id="ch_app.NCBI_Intranet_Web_Ut"><h5><span class="title">NCBI Intranet Web Utilities</span></h5><p>The NCBI intranet users can also visit the following quick reference links:</p><ul><li><p>Dead servers list: <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc.cgi?-h+none+-w+-d">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc.cgi?-h+none+-w+-d</a></p></li><li><p>Search engine for all available hosts, all services and database affiliation: <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi?key=rb_svc&amp;service=&amp;host=&amp;button=Go&amp;db=">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmc/search.cgi?key=rb_svc&amp;service=&amp;host=&amp;button=Go&amp;db=</a></p></li></ul><p>If the lbsmc utility is run with the -f option then the output contains two parts:</p><ul><li><p>The host table. The table is accompanied by raw data which are printed in the order they appear in the LBSMD daemon table.</p></li><li><p>The service table</p></li></ul><p>The output is provided in either long or short format. The format depends on whether the -w option was specified in the command line (the option requests the long (wide) output). The wide output occupies about 130 columns, while the short (normal) output occupies 80 which is the standard terminal width.</p><p>In case if the service name is more than the allowed number of characters to display the trailing characters will be replaced with “&gt;”. When there is more information about the host / service to be displayed the “+” character is put beside the host / service name (this additional information can be retrieved by adding the -i option). When both “+” and “&gt;” are to be shown they are replaced with the single character “*”. In the case of wide-output format the “#” character shown in the service line means that there is no host information available for the service (similar to the static servers). The “!” character in the service line denotes that the service was configured / stored with an error (this character actually should never appear in the listings and should be reported whenever encountered). Wide output for hosts contains the time of bootup and startup. If the startup time is preceded by the “~” character then the host was gone for a while and then came back while the lbsmc utility was running. The “+” character in the times is to show that the date belongs to the past year(s).</p></div><div class="sec" id="ch_app.Server_Penalizer_API"><h5><span class="title">Server Penalizer API and Utility</span></h5><p>The utility allows to report problems of accessing a certain server to the LBSMD daemon, in the form of a penalty which is a value in the range [0..100] that shows, in percentages, how bad the server is. The value 0 means that the server is completely okay, whereas 100 means that the server (is misbehaving and) should <b>not</b> be used at all. The penalty is not a constant value: once set, it starts to decrease in time, at first slowly, then faster and faster until it reaches zero. This way, if a server was penalized for some reason and later the problem has been resolved, then the server becomes available gradually as its penalty (not being reset by applications again in the absence of the offending reason) becomes zero. The figure below illustrates how the value of penalty behaves.</p><p><span><img src="img/Penalty.gif" alt="Image Penalty.gif" /></span></p><p>Figure 12. Penalty Value Characteristics</p><p>Technically, the penalty is maintained by a daemon, which has the server configured, i.e., received by a certain host, which may be different from the one where the server was put into the configuration file. The penalty first migrates to that host, and then the daemon on that host announces that the server was penalized.</p><p><span class="nctnt highlight">Note:</span> Once a daemon is restarted, the penalty information is lost.</p><p><a href="ch_conn.html#ch_conn.service_mapping_api">Service mapping API</a> has a call <span class="nctnt ncbi-code">SERV_Penalize()</span> (<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=SERV_Penalize">http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=SERV_Penalize</a>) declared in <span class="nctnt ncbi-path">connect/ncbi_service.h</span> (<a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/include/connect/ncbi_service.h">http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/include/connect/ncbi_service.h</a>), which can be used to set the penalty for the last server obtained from the mapping iterator.</p><p>For script files (similar to the ones used to start/stop servers), there is a dedicated utility program called <span class="nctnt ncbi-monospace">lbsm_feedback</span> (<a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/lxr/source/src/connect/daemons/lbsm_feedback.c">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/lxr/source/src/connect/daemons/lbsm_feedback.c</a>), which sets the penalty from the command line. This command should be used with extreme care because it affects the load-balancing mechanism substantially,.</p><p><span class="nctnt ncbi-app">lbsm_feedback</span> is a part of the LBSM set of tools installed on all hosts which run <span class="nctnt ncbi-app">LBSMD</span>. As it was explained above, penalizing means to make a server less favorable as a choice of the load balancing mechanism. Because of the fact that the full penalty of 100% makes a server unavailable for clients completely, at the time when the server is about to shut down (restart), it is wise to increase the server penalty to the maximal value, i.e. to exclude the server from the service mapping. (Otherwise, the LBSMD daemon might not immediately notice that the server is down and may continue dispatching to that server.) Usually, the penalty takes at most 5 seconds to propagate to all participating network hosts. Before an actual server shutdown, the following sequence of commands can be used:</p><pre>&gt; /opt/machine/lbsm/sbin/lbsm_feedback 'Servicename STANDALONE host 100 120'<br />&gt; sleep 5<br />now you can shutdown the server<br /></pre><p>The effect of the above is to set the maximal penalty 100 for the service Servicename (of type <span class="nctnt ncbi-type">STANDALONE</span>) running on host <span class="nctnt ncbi-var">host</span> for at least 120 seconds. After 120 seconds the penalty value will start going down steadily and at some stage the penalty becomes 0. The default hold time equals 0. It takes some time to deliver the penalty value to the other hosts on the network so ‘sleep 5’ is used. Please note the single quotes surrounding the penalty specification: they are required in a command shell because <span class="nctnt ncbi-app">lbsm_feedback</span> takes only one argument which is the entire penalty specification.</p><p>As soon as the server is down, the <span class="nctnt ncbi-app">LBSMD</span> daemon detects it in a matter of several seconds (if not instructed otherwise by the configuration file) and then does not dispatch to the server until it is back up. In some circumstances, the following command may come in handy:</p><pre> &gt; /opt/machine/lbsm/sbin/lbsm_feedback 'Servicename STANDALONE host 0' <br /><br /></pre><p>The command resets the penalty to 0 (no penalty) and is useful when, as for the previous example, the server is restarted and ready in less than 120 seconds, but the penalty is still held high by the <span class="nctnt ncbi-app">LBSMD</span> daemon on the other hosts.</p><p>The formal description of the lbsm_feedback utility parameters is given below.</p><p><span><img src="img/lbsm_feedback.gif" alt="Image lbsm_feedback.gif" /></span></p><p>Figure 13. lbsm_feedback Arguments</p><p>The <span class="nctnt ncbi-monospace">servicename</span> can be an identifier with ‘*’ for any symbols and / or ‘?’ for a single character. The <span class="nctnt ncbi-monospace">penalty value</span> is an integer value in the range 0 ... 100. The <span class="nctnt ncbi-monospace">port number</span> and <span class="nctnt ncbi-monospace">time</span> are integers. The <span class="nctnt ncbi-monospace">host name</span> is an identifier and the <span class="nctnt ncbi-monospace">rate value</span> is a floating point value.</p></div></div><div class="sec" id="ch_app.SVN_Repository"><h4><span class="title">SVN Repository</span></h4><p>The SVN repository where the LBSMD daemon source code is located can be retrieved by issuing the following command:</p><p><span class="nctnt ncbi-cmd">svn co https://svn.ncbi.nlm.nih.gov/repos/toolkit/trunk/c++</span></p><p>The daemon code is in this file:</p><p><span class="nctnt ncbi-path">c++/src/connect/daemons/lbsmd.c</span></p></div><div class="sec" id="ch_app._Log_Files"><h4><span class="title">Log Files</span></h4><p>The LBSMD daemon stores its log files at the following location:</p><p><span class="nctnt ncbi-path">/var/log/lbsmd</span></p><p>The file is formed locally on a host where LBSMD daemon is running. The log file size is limited to prevent the disk being flooded with messages. A standard log rotation is applied to the log file so you may see the files:</p><p><span class="nctnt ncbi-path">/var/log/lbsmd.X.gz</span></p><p>where X is a number of the previous log file.</p><p>The log file size can be controlled by the -s command line option. By default, -s 0 is the active flag, which provides a way to create (if necessary) and to append messages to the log file with no limitation on the file size whatsoever. The -s -1 switch instructs indefinite appending to the log file, which must exist. Otherwise, log messages are not stored. -s positive_number restricts the ability to create (if necessary) and to append to the log file until the file reaches the specified size in kilobytes. After that, message logging is suspended, and subsequent messages are discarded. Note that the limiting file size is only approximate, and sometimes the log file can grow slightly bigger. The daemon keeps track of log files and leaves a final logging message, either when switching from one file to another, in case the file has been moved or removed, or when the file size has reached its limit.</p><p>NCBI intranet users can get few (no more than 100) recent lines of the log file on an NCBI internal host. It is also possible to visit the following link:</p><p><a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi?log">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi?log</a></p></div><div class="sec" id="ch_app._Configuration_Exampl"><h4><span class="title">Configuration Examples</span></h4><p>Here is an example of a LBSMD configuration file:</p><pre><span class="nctnt-pre ncbi-code"># $Id$<br />#<br /># This is a configuration file of new NCBI service dispatcher<br />#<br />#<br /># DBLB interface definitions<br />%include /etc/lbsmd/servrc.cfg.db<br /># IEB's services<br />testHTTP      /Service/test.cgi?Welcome L=no<br />Entrez2[0] HTTP_POST www.ncbi.nlm.nih.gov /entrez/eutils/entrez2server.fcgi \<br />    C=x-ncbi-data/x-asn-binary L=no<br />Entrez2BLAST[0] HTTP_POST www.ncbi.nlm.nih.gov /entrez/eutils/entrez2server.cgi  \<br />    C=x-ncbi-data/x-asn-binary L=yes<br />CddSearch       [0] HTTP_POST www.ncbi.nlm.nih.gov /Structure/cdd/c_wrpsb.cgi \<br />    C=application/x-www-form-urlencoded L=no<br />CddSearch2      [0] HTTP_POST www.ncbi.nlm.nih.gov /Structure/cdd/wrpsb.cgi \<br />    C=application/x-www-form-urlencoded L=no<br />StrucFetch      [0] HTTP_POST www.ncbi.nlm.nih.gov /Structure/mmdb/mmdbsrv.cgi \<br />    C=application/x-www-form-urlencoded L=no<br />bounce[60]HTTP /Service/bounce.cgi L=no C=x-ncbi-data/x-unknown<br /># Services of old dispatcher<br />bounce[60]NCBID '' L=yes C=x-ncbi-data/x-unknown | \<br />..../web/public/htdocs/Service/bounce</span></pre><p>NCBI intranet users can also visit the following link to get a sample configuration file:</p><p><a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi?cfg">http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/NETWORK/lbsmd.cgi?cfg</a></p></div></div><div class="sec" id="ch_app.Database_Load_Balancing"><h3><span class="title">Database Load Balancing</span></h3><p>Database load balancing is an important part of the overall load balancing function. Please see the <a href="ch_dbapi.html#ch_dbapi.Database_loadbalanci">Database Load Balancer</a> section in the <a href="ch_dbapi.html">Database Access</a> chapter for more details.</p></div><div class="sec" id="ch_app.Cookie___Argument_Af"><h3><span class="title">Cookie / Argument Affinity Module (MOD_CAF)</span></h3><div class="sec" id="ch_app._Overview_2"><h4><span class="title">Overview</span></h4><p>The cookie / argument affinity module (CAF module in the further discussion) helps to virtualize and to dispatch a web site by modifying the way how Apache resolves host names. It is done by superseding conventional <span class="nctnt ncbi-code">gethostbyname*()</span> API. The CAF module is implemented as an Apache web server module and uses the LBSMD daemon collected data to make a decision how to dispatch a request. The data exchange between the CAF module and the LBSMD daemon is done via a shared memory segment as shown on the figure below.</p><p><span><img src="img/CAF-LBSMD.gif" alt="Image CAF-LBSMD.gif" /></span></p><p>Figure 14.   CAF Module and LBSMD daemon data exchange</p><p>The LBSMD daemon stores all the collected data in a shared memory segment and the CAF module is able to read data from that segment.</p><p>The CAF module looks for special cookies and query line arguments, and analyses the LBSMD daemon data to resolve special names which can be configured in ProxyPass directives of mod_proxy.</p><p>The CAF module maintains a list of proxy names, cookies, and arguments (either 4 predefined, see below, or set forth via Apache configuration file by CAF directives) associated with cookies. Once a URL is translated to the use of one of the proxies (generally, by ProxyPass of mod_proxy) then the information from related cookie (if any) and argument (if any) is used to find the best matching real host that corresponds to the proxy. Damaged cookies and arguments, if found in the incoming HTTP request, are ignored.</p><p>A special host name is meant under proxy and the name contains a label followed by string ".lb" followed by an optional domain part. Such names trigger gethostbyname() substitute, supplied by the module, to consult load-balancing daemon's table, and to use both the constraints on the arguments and the preferred host information, found in the query string and the cookie, respectively.</p><p>For example, the name "pubmed.lb.nlm.nih.gov" is an LB proxy name, which would be resolved by looking for special DNS services ("pubmed_lb" in this example) provided by the LBSMD daemon. Argument matching (see also a separate section below) is done by searching the host environment of target hosts (corresponding to the LB proxy name) as supplied by the LBSMD daemon. That is, "db=PubMed" (to achieve PubMed database affinity) in the query that transforms into a call to an LB proxy, which in turn is configured to use the argument "DB", instructs to search only those target hosts that declare the proxy and have "db=... PubMed ..." configured in their LBSMD environments (and yet to remember to accommodate, if it is possible, a host preference from the cookie, if any found in the request).</p><p>The CAF module also detects internal requests and allows them to use the entire set of hosts that the LB names are resolved to. For external requests, only hosts whose DNS services are not marked local (L=yes, or implicitly, by lacking "-i" flag in the LBSMD daemon launch command) will be allowed to serve requests. "HTTP_CAF_PROXIED_HOST" environment is supplied (by means of an HTTP header tag named "<span class="nctnt ncbi-monospace">CAF-Proxied-Host</span>") to contain an address of the actual host posted the request. Impostor's header tags (if any) of this name are always stripped, so that backends always have correct information about the requesters. Note that all internal requests are trusted, so that an internal resource can make a request to execute on behalf of an outside client by providing its IP in the "<span class="nctnt ncbi-monospace">Client-Host</span>" HTTP header. The "<span class="nctnt ncbi-monospace">Client-Host</span>" tag gets through for internal requests only; to maintain security the tag is dropped for all external requests.</p><p>The CAF module has its own status page that can be made available in the look somewhat resembling Apache status page. The status can be in either raw or HTML formatted, and the latter can also be sorted using columns in interest. Stats are designed to be fast, but sometimes inaccurate (to avoid interlocking, and thus latencies in request processing, there are no mutexes being used except for the table expansion). Stats are accumulated between server restarts (and for Apache 2.0 can survive graceful restarts, too). When the stat table is full (since it has a fixed size), it is cleaned in a way to get room for 1% of its capacity, yet trying to preserve the most of recent activity as well as the most of heavily used stats from the past. There are two cleaning algorithms currently implemented, and can be somehow tuned by means of <span class="nctnt ncbi-monospace">CAFexDecile</span>, <span class="nctnt ncbi-monospace">CAFexPoints</span>, and <span class="nctnt ncbi-monospace">CAFexSlope</span> directives which are described below.</p><p>The CAF module can also report the number of slots that the Apache server has configured and used up each time a new request comes in and is being processed. The information resides in a shared memory segment that several Apache servers can use cooperatively on the same machine. Formerly, this functionality has been implemented in a separate SPY module, which is now fully integrated into this module. Using a special compile-time macro it is possible to obtain the former SPY-only functionality (now called LBSMD reporter feature) without any other CAF features. Note that no CAF* directives will be recognized in Apache configuration, should the reduced functionality build be chosen.</p></div><div class="sec" id="ch_app._Configuration_1"><h4><span class="title">Configuration</span></h4><p>The table below describes Apache configuration directives which are taken into account by the CAF module.</p><div class="table" id="ch_app.T.nc_DirectiveDescriptionLBSMD__O"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Directive</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">LBSMD { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It can appear outside any paired section of the configuration file, and enables ["On", default in mod_spy mode] or disables ["Off", default in full-fledged mod_caf mode] the LBSMD reporter feature. When the module is built exclusively with the LBSMD reporter feature, this is the only directive, which is available for the use by the module. Please note that the directive is extremely global, and works across configuration files. Once "Off" is found throughout the configuration, it takes the effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAF { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It can appear outside any paired section of the configuration file, and enables ["On", default] or disables ["Off"] the entire module. Please note that this directive is extremely global, and works across Apache configuration files, that is the setting "Off" anywhere in the configuration causes the module to go out of business completely.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFQAMap name path</td><td align="left" valign="top" rowspan="1" colspan="1">It can appear outside any paired section of the configuration file but only once in the entire set of the configuration files per "name", and if used, defines a path to the map file, which is to be loaded at the module initialization phase (if the path is relative, it specifies the location with respect to the daemon root prefix as defined at the time of the build, much like other native configuration locations do). The file is a text, line-oriented list (w/o line continuations). The pound symbol (#) at any position introduces a comment (which is ignored by the parser). Any empty line (whether resulted from cutting off a comment, or just blank by itself) is skipped. Non-empty lines must contain a pair of words, delimited by white space(s) (that is, tab or space character(s)). The first word defines an LB group that is to be replaced with the second word, in the cases when the first word matches the LB group used in proxy passing of an internally-originating request. The matching is done by previewing a cookie named "name" that should contain a space-separated list of tokens, which must comprise a subset of names loaded from the left-hand side column of the QA file. Any unmatched token in the cookie will result the request to fail, so will do any duplicate name. That is, if the QA map file contains a paired rule "tpubmed tpubmedqa", and an internal (i.e. originating from within NCBI) request has the NCBIQA cookie listing "tpubmed", then the request that calls for use of the proxy-pass "tpubmed.lb" will actually use the name "tpubmedqa.lb" as if it appeared in the ProxyPass rule of mod_proxy. Default is not to load any QA maps, and not to proceed with any substitutions. Note that if the module is disabled (CAF Off), then the map file, even if specified, need not to exist, and won't be loaded.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFFailoverIP address</td><td align="left" valign="top" rowspan="1" colspan="1">It defines hostname / IP to return on LB proxy names that cannot be resolved. Any external requests and local ones, in which argument affinity has to be taken into account, will fall straight back to use this address whenever the LB name is not known or LBSMD is not operational. All other requests will be given a chance to use regular DNS first, and if that fails, then fall back to use this IP. When the failover IP address is unset, a failed LB proxy name generally causes the Apache server to throw either "Bad gateway" (502) or "Generic server error" (500) to the client. This directive is global across the entire configuration, and the last setting takes the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFForbiddenIP address</td><td align="left" valign="top" rowspan="1" colspan="1">It is similar to CAFFailoverIP described above yet applies only to the cases when the requested LB DNS name exists but cannot be returned as it would cause the name access violation (for example, an external access requires an internal name to be used to proxy the request). Default is to use the failover IP (as set by CAFFailoverIP), if available.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFThrottleIP address</td><td align="left" valign="top" rowspan="1" colspan="1">It is similar to CAFFailoverIP described above but applies only to abusive requests that should be throttled out. Despite this directive exists, the actual throttling mechanism is not yet in production. Default is to use the failover IP (as set by CAFFailoverIP), if available.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFBusyIP address</td><td align="left" valign="top" rowspan="1" colspan="1">It is similar to CAFFailoverIP described above but gets returned to clients when it is known that the proxy otherwise serving the request is overloaded. Default is to use the failover IP, if available.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFDebug { Off | On | 2 | 3 }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether to print none ("Off"), some ("On"), more ("2"), or all ("3") debugging information into Apache log file. Per-request logging is automatically on when debugging is enabled by the native LogLevel directive of Apache (LogLevel debug), or with a command line option -e (Apache 2). This directive controls whether mod_caf produces additional logging when doing maintenance cleaning of its status information (see CAFMaxNStats below).<br />Debug level 1 (On) produces cleanup synopsis and histogram, level 2 produces per-stat eviction messages and the synopsis, and debug level 3 is a combination of the above. Default is "Off". The setting is global, and the last encounter has the actual effect. NOTE: per-stat eviction messages may cause latencies in request processing; so debug levels "2" and "3" should be used carefully, and only when actually needed.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFTiming { Off | On | TOD }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether the module timing profile is done while processing requests. For this to work, though, CAFMaxNStats must first enable collection of statistics. Module's status page then will show how much time is being spent at certain stages of a request processing. Since proxy requests and non-proxy requests are processed differently they are accounted separately. "On" enables to make the time marks using the gettimeofday(2) syscall (accurate up to 1us) without reset upon each stat cleanup (note that tick count will wrap around rather frequently). Setting "TOD" is same as "On" but extends it so that counts do get reset upon every cleanup. Default is "Off". The setting is global, and the last encounter in the configuration file has the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFMaxNStats number</td><td align="left" valign="top" rowspan="1" colspan="1">The number defines how many statistics slots are allocated for CAF status (aka CAF odometer). Value "0" disables the status page at all. Value "-1" sets default number of slots (which currently corresponds to the value of 319). Note that the number only sets a lower bound, and the actual number of allocated slots may be automatically extended to occupy whole number of pages (so that no "memory waste" occurs). The actual number of stats (and memory pages) is printed to the log file. To access the status page, a special handler must be installed for a designated location, as in the following example:<br /><span class="nctnt ncbi-monospace">&lt;Location /caf-status&gt;</span><br /><span class="nctnt ncbi-monospace">    SetHandler CAF-status</span><br /><span class="nctnt ncbi-monospace">    Order deny,allow</span><br /><span class="nctnt ncbi-monospace">    Deny from all</span><br /><span class="nctnt ncbi-monospace">    Allow from 130.14/16</span><br /><span class="nctnt ncbi-monospace">&lt;/Location&gt;</span><br />404 (Document not found) gets returned from the configured location if the status page has been disabled (number=0), or if it malfunctions. This directive is global across the entire configuration, and the last found setting takes the actual effect.<br />CAF stats can survive server restarts [graceful and plain "restart"], but not stop / start triggering sequence.<br />Note: "CAF Off" does not disable the status page if it has been configured before -- it just becomes frozen. So [graceful] restart with "CAF Off" won't prevent from gaining access to the status page, although the rest of the module will be rendered inactive.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFUrlList url1 url2 ...</td><td align="left" valign="top" rowspan="1" colspan="1">By default, CAF status does not distinguish individual CGIs as they are being accessed by clients. This option allows separating statistics on a per-URL basis. Care must be taken to remember of "combinatorial explosion", and thus the appropriate quantity of stats is to be pre-allocated with CAFMaxNStats if this directive is used, or else the statistics may renew too often to be useful. Special value "*" allows to track every (F)CGI request by creating individual stat entries for unique (F)CGI names (with or without the path part, depending on a setting of CAFStatPath directive, below). Otherwise, only those listed are to be accounted for, leaving all others to accumulate into a nameless stat slot. URL names can have .cgi or .fcgi file name extensions.  Alternatively, a URL name can have no extension to denote a CGI, or a trailing period (.) to denote an FCGI. A single dot alone (.) creates a specially named stat for all non-matching CGIs (both .cgi or .fcgi), and collects all other non-CGI requests in a nameless stat entry. (F)CGI names are case sensitive. When path stats are enabled (see CAFStatPath below), a relative path entry in the list matches any (F)CGI that has the trailing part matching the request (that is, "query.fcgi" matches        any URL that ends in "query.fcgi", but "/query.fcgi" matches only the top-level ones). There is an internal limit of 1024 URLs that can be explicitly listed.  Successive directives add to the list. A URL specified as a minus sign alone ("-") clears the list, so that no urls will be registered in stats. This is the default.        This directive is only allowed at the top level, and applies to all virtual hosts.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFUrlKeep url1 url2 ...</td><td align="left" valign="top" rowspan="1" colspan="1">CAF status uses a fixed-size array of records to store access statistics, so whenever the table gets full, it has to be cleaned up by dropping some entries, which have not been updated too long, have fewer count values, etc. The eviction algorithm can be controlled by CAFexDecile, CAFexPoints, and CAFexSlope directives, described below, but even when finely tuned, can result in some important entries being pre-emptied, especially when per-URL stats are enabled. This directive helps avoid losing the important information, regardless of other empirical characteristics of a candidate-for-removal. The directive, like CAFUrlList above, lists individual URLs which, once recorded, have to be persistently kept in the table. Note that as a side effect, each value (except for "-") specified in this directive implicitly adds an entry as if it were specified with CAFUrlList. Special value "-" clears the keep list, but does not affect the URL list, so specifying "CAFUrlKeep a b -" is same as specifying "CAFUrlList a b" alone, that is, without obligation for CAF status to keep either "a" or "b" permanently.  There is an internal limit of 1024 URLs that can be supplied by this directive. Successive uses add to the list. The directive is only allowed at the top level, and applies to all virtual hosts.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFexDecile digit</td><td align="left" valign="top" rowspan="1" colspan="1">It specifies the top decile(s) of the total number of stat slots, sorted by the hit count and subject for expulsion, which may not be made available for stat's cleanup algorithms should it be necessary to arrange a new slot by removing old/stale entries. Decile is a single digit 0 through 9, or a special value "default" (which currently translates to 1). Note that each decile equals 10%.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFexPoints { value | percentage% }</td><td align="left" valign="top" rowspan="1" colspan="1">The directive specifies how many records, as an absolute value, or as a percentage of total stat slots, are to be freed each time the stat table gets full.  Keyword "default" also can be used, which results in eviction of 1% of all records (or just 1 record, whatever is greater). Note that if CAFUrlKeep is in use, the cleanup may not be always possible. The setting is global and the value found last takes the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFexSlope { value | "quad" }</td><td align="left" valign="top" rowspan="1" colspan="1">The directive can be used to modify cleanup strategy used to vacate stat records when the stat table gets full. The number of evicted slots can be controlled by CAFexPoints directive. The value, which is given by this directive, is used to plot either circular ("quad") or linear (value &gt;= 0) plan of removal. The linear plan can be further fine-tuned by specifying a co-tangent value of the cut-off line over a time-count histogram of statistics, as a binary logarithm value, so that 0 corresponds to the co-tangent of 1 (=2^0), 1 (default) corresponds to the co-tangent of 2 (=2^1), 2 - to the co-tangent of 4 (=2^2), 3 - to 8 (=2^3), and so forth, up to a maximal feasible value 31 (since 2^32 overflows an integer, this results in the infinite co-tangent, causing a horizontal cut-off line, which does not take into account times of last updates, but counts only). The default co-tangent (2) prices the count of a stats twice higher than its longevity. The cleanup histogram can be viewed in the log if CAFDebug is set as 2 (or 3). The setting is global and the value found last takes the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFStatVHost { Off | On }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether VHosts of the requests are to be tracked on the CAF status page. By default, VHost separation is not done. Note that preserving graceful restart of the server may leave some stats VHost-less, when switching from VHost-disabled to VHost-enabled mode, with this directive. The setting is global and the setting found last has the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFStatPath { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether the path part of URLs is to be stored and shown on the CAF status page. By default, the path portion is stripped. Keep in mind the relative path specifications as given in CAFUrlList directive, as well as the number of possible combinations of Url/VHost/Path, that can cause frequent overflows of the status table. When CAFStatPath is "Off", the path elements are stripped from all URLs provided in the CAFUrlList directive (and merging the identical names, if any result). This directive is global, and the setting found last having the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFOkDnsFallback { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether it is okay to fallback for consulting regular DNS on the unresolved names, which are not constrained with locality and/or affinities. Since shutdown of SERVNSD (which provided the fake .lb DNS from the load balancer), fallback to system DNS looks painfully slow (at it has now, in the absence of the DNS server, to reach the timeout), so the default for this option is "Off". The setting is global, and the value found last takes the actual effect.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFNoArgOnGet { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It can appear outside any paired section of the configuration, "On" sets to ignore argument assignment in GET requests that don't have explicit indication of the argument. POST requests are not affected. Default is "Off", VHost-specific.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFArgOnCgiOnly { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It controls whether argument is taken into account when an FCGI or CGI is being accessed. Default is "Off". The setting is per-VHost specific.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFCookies { Cookie | Cookie2 | Any }</td><td align="left" valign="top" rowspan="1" colspan="1">It instructs what cookies to search for: "Cookie" stands for RFC2109 cookies (aka Netscape cookies), this is the default. "Cookie2" stands for new RFC2965 cookies (new format cookies). "Any" allows searching for both types of cookies. This is a per-server option that is not shared across virtual host definitions, and allowed only outside any &lt;Directory&gt; or &lt;Location&gt;. Note that, according to the standard, cookie names are not case-sensitive.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFArgument argument</td><td align="left" valign="top" rowspan="1" colspan="1">It defines argument name to look for in the URLs.  There is no default. If set, the argument becomes default for any URL and also for proxies whose arguments are not explicitly set with CAFProxyArgument directives. The argument is special case sensitive: first, it is looked up "as-is" and, if that fails, in all uppercase then. This directive can appear outside any &lt;Directory&gt; or &lt;Location&gt; and applies to virtual hosts (if any) independently.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFHtmlAmp { On | Off }</td><td align="left" valign="top" rowspan="1" colspan="1">It can appear outside any paired section of configuration, set to On enables to recognize "&amp;amp;" for the ampersand character in request URLs (caution: "&amp;amp;" in URLs is not standard-conforming). Default is "Off", VHost-specific.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyCookie proxy cookie</td><td align="left" valign="top" rowspan="1" colspan="1">It establishes a correspondence between LB DNS named proxy and a cookie. For example, "CAFProxyCookie pubmed.lb MyPubMedCookie" defines that "MyPubMedCookie" should be searched for preferred host information when "pubmed.lb" is being considered as a target name for proxying the incoming request. This directive can appear anywhere in configuration, but is hierarchy complying.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyNoArgOnGet proxy { On | Off | Default }</td><td align="left" valign="top" rowspan="1" colspan="1">The related description can be seen at the CAFNoArgOnGet directive description above. The setting applies only to the specified proxy. "Default" (default) is to use the global setting.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyArgOnCgiOnly proxy { On | Off | Default }</td><td align="left" valign="top" rowspan="1" colspan="1">The related description can be seen at the CAFArgOnCgiOnly directive description above. The setting applies only to the specified proxy. "Default" (default) is to use the global setting.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyArgument proxy argument</td><td align="left" valign="top" rowspan="1" colspan="1">It establishes a correspondence between LB DNS named proxy and a query line argument. This directive overrides any default that might have been set with global "CAFArgument" directive. Please see the list of predefined proxies below. The argument is special case sensitive: first, it is looked up "as-is" and, if that fails, in all uppercase then. The first argument occurrence is taken into consideration.  It can appear anywhere in configuration, but is hierarchy complying.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyAltArgument proxy altargument</td><td align="left" valign="top" rowspan="1" colspan="1">It establishes a correspondence between LB DNS named proxy and an alternate query line argument. The alternate argument (if defined) is used to search (case-insensitively) query string for the argument value, but treating the value as if it has appeared to argument set forth by CAFProxyArgument or CAFArgument directives for the location in question. If no alternate argument value is found, the regular argument search is performed. Please see the list of predefined proxies below. Can appear anywhere in configuration, but is hierarchy complying, and should apply for existing proxies only. Altargument "-" deletes the alternate argument (if any). Note again that unlike regular proxy argument (set forth by either CAFArgument (globally) or CAFProxyArgument (per-proxy) directives) the alternate argument is entirely case-insensitive.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyDelimiter proxy delimiter</td><td align="left" valign="top" rowspan="1" colspan="1">It sets a one character delimiter that separates host[:port] field in the cookie, corresponding to the proxy, from some other following information, which is not pertinent to cookie affinity business. Default is '|'. No separation is performed on a cookie that does not have the delimiter  --  it is then thought as been found past the end-of-line. It can appear anywhere in configuration, but is hierarchy complying.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyPreference proxy preference</td><td align="left" valign="top" rowspan="1" colspan="1">It sets a preference (floating point number from the range [0..100]) that the proxy would have if a host matching the cookie is found. The preference value 0 selects the default value which is currently 95. It can appear anywhere in configuration, but is hierarchy complying.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">CAFProxyCryptKey proxy key</td><td align="left" valign="top" rowspan="1" colspan="1">It sets a crypt key that should be used to decode the cookie. Default is the key preset when a cookie correspondence is created [via either "CAFProxyCookie" or "CAFProxyArgument"]. To disable cookie decrypting (e.g. if the cookie comes in as a plain text) use "". Can appear anywhere in configuration, but is hierarchy complying.</td></tr></tbody></table></div><p>All hierarchy complying settings are inherited in directories that are deeper in the directory tree, unless overridden there. The new setting then takes effect for that and all descendant directories/locations.</p><p>There are 4 predefined proxies that may be used [or operated on] without prior declaration by either "CAFProxyCookie" or "CAFProxyArgument" directives:</p><div class="table" id="ch_app.T.nc_LB_nameCookieNamePreferenceD"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">LB name</td><td align="center" valign="top" rowspan="1" colspan="1">CookieName</td><td align="center" valign="top" rowspan="1" colspan="1">Preference</td><td align="center" valign="top" rowspan="1" colspan="1">Delimiter</td><td align="center" valign="top" rowspan="1" colspan="1">Crypted?</td><td align="center" valign="top" rowspan="1" colspan="1">Argument</td><td align="center" valign="top" rowspan="1" colspan="1">AltArg</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">tpubmed.lb</td><td align="left" valign="top" rowspan="1" colspan="1">LB-Hint-Pubmed</td><td align="center" valign="top" rowspan="1" colspan="1">95</td><td align="center" valign="top" rowspan="1" colspan="1">|</td><td align="center" valign="top" rowspan="1" colspan="1">yes</td><td align="center" valign="top" rowspan="1" colspan="1">db</td><td align="left" valign="top" rowspan="1" colspan="1">&lt;none&gt;</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">eutils.lb</td><td align="left" valign="top" rowspan="1" colspan="1">LB-Hint-Pubmed</td><td align="center" valign="top" rowspan="1" colspan="1">95</td><td align="center" valign="top" rowspan="1" colspan="1">|</td><td align="center" valign="top" rowspan="1" colspan="1">yes</td><td align="center" valign="top" rowspan="1" colspan="1">db</td><td align="left" valign="top" rowspan="1" colspan="1">DBAF</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">mapview.lb</td><td align="left" valign="top" rowspan="1" colspan="1">LB-Hint-MapView</td><td align="center" valign="top" rowspan="1" colspan="1">95</td><td align="center" valign="top" rowspan="1" colspan="1">|</td><td align="center" valign="top" rowspan="1" colspan="1">yes</td><td align="center" valign="top" rowspan="1" colspan="1">&lt;none&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">&lt;none&gt;</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">blastq.lb</td><td align="left" valign="top" rowspan="1" colspan="1">LB-Hint-Blast</td><td align="center" valign="top" rowspan="1" colspan="1">95</td><td align="center" valign="top" rowspan="1" colspan="1">|</td><td align="center" valign="top" rowspan="1" colspan="1">yes</td><td align="center" valign="top" rowspan="1" colspan="1">&lt;none&gt;</td><td align="left" valign="top" rowspan="1" colspan="1">&lt;none&gt;</td></tr></tbody></table></div><p><span class="nctnt highlight">NOTE</span>: The same cookie can be used to tie up an affinity for multiple LB proxies. On the other hand, LB proxy names are all unique throughout the configuration file.</p><p><span class="nctnt highlight">NOTE</span>: It is very important to keep in mind that arguments and alt-arguments are treated differently, case-wise. Alt-args are case insensitive, and are screened before the main argument (but appear as if the main argument has been found). On the other hand, main arguments are special case-sensitive, and are checked twice: "as is" first, then in all CAPs. So having both "DB" for alt-argument and "db" for the main, hides the main argument, and actually makes it case-insensitive. CAF will warn on some occurrences when it detects whether the argument overloading is about to happen (take a look at the logs).</p><p>The CAF module is also able to detect if a request comes from a local client. The <span class="nctnt ncbi-path">/etc/ncbi/local_ips</span> file describes the rules for making the decision.</p><p>The file is line-oriented, i.e. supposes to have one IP spec per one line. Comments are introduced by either "#" or "!", no continuation lines allowed, the empty lines are ignored.</p><p>An IP spec is a word (no embedded whitespace characters) and is either:</p><ul><li><p>a host name or a legitimate IP address</p></li><li><p>a network specification in the form "networkIP / networkMask"</p></li><li><p>an IP range (explained below).</p></li></ul><p>A networkIP / networkMask specification can contain an IP prefix for the network (with or without all trailing zeroes present), and the networkMask can be either in CIDR notation or in the form of a full IP address (all 4 octets) expressing contiguous high-bit ranges (all the records below are equivalent):</p><p><span class="nctnt ncbi-monospace">130.14.29.0/24</span><br /><span class="nctnt ncbi-monospace">130.14.29/24</span><br /><span class="nctnt ncbi-monospace">130.14.29/255.255.255.0</span><br /><span class="nctnt ncbi-monospace">130.14.29.0/255.255.255.0</span></p><p>An IP range is an incomplete IP address (that is, having less than 4 full octets) followed by exactly one dot and one integer range, e.g.:</p><p><span class="nctnt ncbi-monospace">130.14.26.0-63</span></p><p>denotes a host range from <span class="nctnt ncbi-monospace">130.14.26.0</span> thru <span class="nctnt ncbi-monospace">130.14.26.63</span> (including the ends),</p><p><span class="nctnt ncbi-monospace">130.14.8-9</span></p><p>denotes a host range from <span class="nctnt ncbi-monospace">130.14.8.0</span> thru <span class="nctnt ncbi-monospace">130.14.9.255</span> (including the ends).</p><p><span class="nctnt highlight">Note</span> that <span class="nctnt ncbi-monospace">127/8</span> gets automatically added, whether or not it is explicitly included into the configuration file. The file loader also warns if it encounters any specifications that overlap each other. Inexistent (or unreadable) file causes internal hardcoded defaults to be used - a warning is issued in this case.</p><p><span class="nctnt highlight">Note</span> that the IP table file is read once per Apache daemon's life cycle (and it is *not* reloaded upon graceful restarts). The complete stop / start sequence should be performed to force the IP table be reloaded.</p></div><div class="sec" id="ch_app._Configuration_Exampl_1"><h4><span class="title">Configuration Examples</span></h4><ul><li><p>To define that "WebEnv" cookie has an information about "pubmed.lb" preference in "/Entrez" and all the descendant directories one can use the following:</p></li></ul><pre><span class="nctnt-pre ncbi-code">&lt;Location /Entrez&gt;<br />    CAFProxyCookie  pubmed.lb  WebEnv<br />    CAFPreference   pubmed.lb  100<br />&lt;/Location&gt;</span></pre><p>The second directive in the above example sets the preference to 100% -- this is a preference, not a requirement, so meaning that using the host from the cookie is the most desirable, but not blindly instructing to go to in every case possible.</p><ul><li><p>To define new cookie for some new LB name the following fragment can be used:</p></li></ul><pre><span class="nctnt-pre ncbi-code">&lt;Directory /SomeDir&gt;<br />    CAFProxyCookie  myname.lb  My-Cookie<br />    CAFProxyCookie  other.lb   My-Cookie<br />&lt;/Directory&gt;<br />&lt;Directory /SomeDir/SubDir&gt;<br />    CAFProxyCookie  myname.lb  My-Secondary-Cookie<br />&lt;/Directory&gt;</span></pre><p>The effect of the above is that "My-Cookie" will be used in LB name searches of "myname.lb" in directory "/SomeDir", but in "/SomeDir/SubDir" and all directories of that branch, "My-Secondary-Cookie" will be used instead. If an URL referred to "/SomeDir/AnotherDir", then "My-Cookie" would still be used.</p><p><span class="nctnt highlight">Note</span> that at the same time "My-Cookie" is used under "/SomeDir" everywhere else if "other.lb" is being resolved there.</p><ul><li><p>The following fragment disables cookie for "tpubmed.lb" [note that no "CAFProxyCookie" is to precede this directive because "tpubmed.lb" is predefined]:</p></li></ul><pre><span class="nctnt-pre ncbi-code">CAFProxyPreference  tpubmed.lb  0</span></pre><ul><li><p>The following directive associates proxy "systems.lb" with argument "ticket":</p></li></ul><pre><span class="nctnt-pre ncbi-code">CAFProxyArgument  systems.lb  ticket</span></pre><p>The effect of the above is that if an incoming URL resolves to use "systems.lb", then "ticket", if found in the query string, would be considered for lookup of "systems.lb" with the load-balancing daemon.</p></div><div class="sec" id="ch_app.Arguments_Matching"><h4><span class="title">Arguments Matching</span></h4><p>Suppose that the DB=A is a query argument (explicit DB selection, including just "DB" (as a standalone argument, treated as missing value), "DB=" (missing value)). That will cause the following order of precedence in selecting the target host:</p><div class="table" id="ch_app.T.nc_MatchDescriptionDBABest__A__"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Match</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=A</td><td align="left" valign="top" rowspan="1" colspan="1">Best. <br />"A" may be "" to match the missing value</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=*</td><td align="left" valign="top" rowspan="1" colspan="1">Good. <br />"*" stands for "any other"</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB not defined</td><td align="left" valign="top" rowspan="1" colspan="1">Fair</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=-</td><td align="left" valign="top" rowspan="1" colspan="1">Poor. <br />"-" stands for "missing in the request"</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=B</td><td align="left" valign="top" rowspan="1" colspan="1">Mismatch. It is used for fallbacks only as the last resort</td></tr></tbody></table></div><p>No host with an explicit DB assignment (DB=B or DB=-) is being selected above if there is an exclamation point "!" [stands for "only"] in the assignment. DB=~A for the host causes the host to be skipped from selection as well. DBs are screened in the order of appearance, the first one is taken, so "DB=~A A" skips all requests having DB=A in their query strings.</p><p>Suppose that there is no DB selection in the request. Then the hosts are selected in the following order:</p><div class="table" id="ch_app.T.nc_MatchDescriptionDBBest___sta"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Match</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=-</td><td align="left" valign="top" rowspan="1" colspan="1">Best<br />"-" stands for "missing from the request"</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB not defined</td><td align="left" valign="top" rowspan="1" colspan="1">Good</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=*</td><td align="left" valign="top" rowspan="1" colspan="1">Fair.<br />"*" stands for "any other"</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">DB=B</td><td align="left" valign="top" rowspan="1" colspan="1">Poor</td></tr></tbody></table></div><p>No host with a non-empty DB assignment (DB=B or DB=*) is being selected in the above scenario if there is an exclamation point "!" [stands for "only"] in the assignment. DB=~- defined for the host causes the host not to be considered.</p><p>Only if there are no hosts in the best available category of hosts, the next category is used. That is, no "good" matches will ever be used if there are "best" matches available. Moreover, if all "best" matches have been used up but are known to exist, the search fails.</p><p>"~" may not be used along with "*": "~*" combination will be silently ignored entirety, and will not modify the other specified affinities. Note that "~" alone has a meaning of 'anything but empty argument value, ""'. Also note that formally, "~A" is an equivalent to "~A *" as well as "~-" is an equivalent to "*".</p><div class="sec" id="ch_app.Argument_Matching_Ex"><h5><span class="title">Argument Matching Examples</span></h5><p>Host affinity</p><p>  DB=A ~B</p><p>makes the host to serve requests having either DB=A or DB=&lt;other than B&gt; in their query strings. The host may be used as a failover for requests that have DB=C in them (or no DB) if there is no better candidate available. Adding "!" to the affinity line would cause the host not to be used for any requests, in which the DB argument is missing.</p><p>Host affinity</p><p>  DB=A -</p><p>makes the host to serve requests with either explicit DB=A in their query strings, or not having DB argument at all. Failovers from searches not matching the above may occur. Adding "!" to the line disables the failovers.</p><p>Host affinity</p><p>  DB=- *</p><p>makes the host to serve requests that don't have any DB argument in their query strings, or when their DB argument failed to literally match affinity lines of all other hosts. Adding "!" to the line doesn't change the behavior.</p></div></div><div class="sec" id="ch_app.Log_File"><h4><span class="title">Log File</span></h4><p>The CAF module uses the Apache web server log files to put CAF module’s messages into.</p></div><div class="sec" id="ch_app._Monitoring"><h4><span class="title">Monitoring</span></h4><p>The status of the CAF modules can be seen via a web interface using the following links:</p><p><a href="http://web1.be-md.ncbi.nlm.nih.gov/caf-status">http://web1.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://web2.be-md.ncbi.nlm.nih.gov/caf-status">http://web2.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://web3.be-md.ncbi.nlm.nih.gov/caf-status">http://web3.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://web4.be-md.ncbi.nlm.nih.gov/caf-status">http://web4.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://webdev1.be-md.ncbi.nlm.nih.gov/caf-status">http://webdev1.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://webdev2.be-md.ncbi.nlm.nih.gov/caf-status">http://webdev2.be-md.ncbi.nlm.nih.gov/caf-status</a></p><p><a href="http://web91.be-md.qa.ncbi.nlm.nih.gov/caf-status">http://web91.be-md.qa.ncbi.nlm.nih.gov/caf-status</a></p></div></div><div class="sec" id="ch_app.DISPD_Network_Dispat"><h3><span class="title">DISPD Network Dispatcher</span></h3><div class="sec" id="ch_app._Overview_3"><h4><span class="title">Overview</span></h4><p>The DISPD dispatcher is a CGI/1.0-compliant program (the actual file name is <span class="nctnt ncbi-path">dispd.cgi</span>). Its purpose is mapping a requested service name to an actual server location when the client has no direct access to the LBSMD daemon. This mapping is called dispatching. Optionally, the DISPD dispatcher can also pass data between the client, who requested the mapping, and the server, which implements the service, found as a result of dispatching. This combined mode is called a connection. The client may choose any of these modes if there are no special requirements on data transfer (e.g., firewall connection). In some cases, however, the requested connection mode implicitly limits the request to be a dispatching-only request, and the actual data flow between the client and the server occurs separately at a later stage.</p></div><div class="sec" id="ch_app.Protocol_Description"><h4><span class="title">Protocol Description</span></h4><p>The dispatching protocol is designed as an extension of HTTP/1.0 and is coded in the HTTP header parts of packets. The request (both dispatching and connection) is done by sending an HTTP packet to the DISPD dispatcher with a query line of the form: </p><pre>dispd.cgi?service=&lt;name&gt;     <br /></pre><p>which can be followed by parameters (if applicable) to be passed to the service. The <span class="nctnt ncbi-code">&lt;name&gt;</span> defines the name of the service to be used. The other parameters take the form of one or more of the following constructs: </p><pre>&amp;&lt;param&gt;[=&lt;value&gt;]     <br /></pre><p>where square brackets are used to denote an optional value part of the parameter.</p><p>In case of a connection request the request body can contain data to be passed to the first-found server. A connection to this server is automatically initiated by the DISPD dispatcher. On the contrary, in case of a dispatching-only request, the body is completely ignored, that is, the connection is dropped after the header has been read and then the reply is generated without consuming the body data. That process may confuse an unprepared client.</p><p>Mapping of a service name into a server address is done by the LBSMD daemon which is run on the same host where the DISPD dispatcher is run. The DISPD dispatcher never dispatches a non-local client to a server marked as local-only (by means of L=yes in the configuration of the LBSMD daemon). Otherwise, the result of dispatching is exactly what the client would get from the <a href="ch_conn.html#ch_conn.service_mapping_api">service mapping API</a> if run locally. Specifying capabilities explicitly the client can narrow the server search, for example, by choosing stateless servers only.</p><div class="sec" id="ch_app.Client_Request_to_DI"><h5><span class="title">Client Request to DISPD</span></h5><p>The following additional HTTP tags are recognized in the client request to the DISPD dispatcher.</p><div class="table" id="ch_app.T.nc_TagDescriptionAcceptedServer"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Tag</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Accepted-Server-Types: &lt;list&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The <span class="nctnt ncbi-code">&lt;list&gt;</span> can include one or more of the following keywords separated by spaces:<ul><li><p><span class="nctnt ncbi-type">NCBID</span></p></li><li><p><span class="nctnt ncbi-type">STANDALONE</span></p></li><li><p><span class="nctnt ncbi-type">HTTP</span></p></li><li><p><span class="nctnt ncbi-type">HTTP_GET</span></p></li><li><p><span class="nctnt ncbi-type">HTTP_POST</span></p></li><li><p><span class="nctnt ncbi-type">FIREWALL</span></p></li></ul><br />The keyword describes the server type which the client is capable to handle. The default is any (when the tag is not present in the HTTP header), and in case of a connection request, the dispatcher will accommodate an actual found server with the connection mode, which the client requested, by relaying data appropriately and in a way suitable for the server.<br /><span class="nctnt highlight">Note: </span><span class="nctnt ncbi-type">FIREWALL</span> indicates that the client chooses a firewall method of communication.<br /><span class="nctnt highlight">Note:</span> Some server types can be ignored if not compatible with the current client mode</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Client-Mode: &lt;client-mode&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The <span class="nctnt ncbi-code">&lt;client-mode&gt;</span> can be one of the following:<ul><li><p><span class="nctnt ncbi-type">STATELESS_ONLY</span> - specifies that the client is not capable of doing full-duplex data exchange with the server in a session mode (e.g., in a dedicated connection).</p></li><li><p><span class="nctnt ncbi-type">STATEFUL_CAPABLE</span> - should be used by the clients, which are capable of holding an opened connection to a server. This keyword serves as a hint to the dispatcher to try to open a direct TCP channel between the client and the server, thus reducing the network usage overhead.</p></li></ul><br />The default (when the tag is not present at all) is <span class="nctnt ncbi-type">STATELESS_ONLY</span> to support Web browsers.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Dispatch-Mode: &lt;dispatch-mode&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The <span class="nctnt ncbi-code">&lt;dispatch-mode&gt;</span> can be one of the following:<ul><li><p><span class="nctnt ncbi-type">INFORMATION_ONLY</span> - specifies that the request is a dispatching request, and no data and/or connection establishment with the server is required at this stage, i.e., the DISPD dispatcher returns only a list of available server specifications (if any) corresponding to the requested service and in accordance with client mode and server acceptance.</p></li><li><p><span class="nctnt ncbi-type">NO_INFORMATION</span> - is used to disable sending the above-mentioned dispatching information back to the client. This keyword is reserved solely for internal use by the DISPD dispatcher and should <b>not</b> be used by applications.</p></li><li><p><span class="nctnt ncbi-type">STATEFUL_INCLUSIVE</span> - informs the DISPD dispatcher that the current request is a connection request, and because it is going over HTTP it is treated as stateless, thus dispatching would supply stateless servers only. This keyword modifies the default behavior, and dispatching information sent back along with the server reply (resulting from data exchange) should include stateful servers as well, allowing the client to go to a dedicated connection later.</p></li><li><p><span class="nctnt ncbi-type">OK_DOWN</span> or <span class="nctnt ncbi-type">OK_SUPPRESSED</span> or <span class="nctnt ncbi-type">PROMISCUOUS</span> - defines a dispatch only request without actual data transfer for the client to obtain a list of servers which otherwise are not included such as, currently down servers (<span class="nctnt ncbi-type">OK_DOWN</span>), currently suppressed by having 100% penalty servers (<span class="nctnt ncbi-type">OK_SUPPRESSED</span>) or both (<span class="nctnt ncbi-type">PROMISCUOUS</span>)</p></li></ul><br />The default (in the absence of this tag) is a connection request, and because it is going over HTTP, it is automatically considered stateless. This is to support calls for NCBI services from Web browsers.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Skip-Info-&lt;n&gt;: &lt;server-info&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">&lt;n&gt;</span> is a number of <span class="nctnt ncbi-code">&lt;server-info&gt;</span> strings that can be passed to the DISPD dispatcher to ignore the servers from being potential mapping targets (in case if the client knows that the listed servers either do not work or are not appropriate). Skip-Info tags are enumerated by numerical consequent suffices (<span class="nctnt ncbi-code">&lt;n&gt;</span>), starting from 1. These tags are optional and should only be used if the client believes that the certain servers do not match the search criteria, or otherwise the client may end up with an unsuccessful mapping.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Client-Host: &lt;host&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag is used by the DISPD dispatcher internally to identify the <span class="nctnt ncbi-code">&lt;host&gt;</span>, where the request comes from, in case if relaying is involved. Although the DISPD dispatcher effectively disregards this tag if the request originates from outside NCBI (and thus it cannot be easily fooled by address spoofing), in-house applications <b>should not</b> use this tag when connecting to the DISPD dispatcher because the tag <b>is trusted and considered</b> within the NCBI Intranet.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Server-Count: {N|ALL}</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag defines how many server infos to include per response (default <span class="nctnt ncbi-code">N</span>=3, <span class="nctnt ncbi-code">ALL</span> causes everything to be returned at once).<br /><span class="nctnt ncbi-code">N</span> is an integer and <span class="nctnt ncbi-code">ALL</span> is a keyword.</td></tr></tbody></table></div></div><div class="sec" id="ch_app.DISPD_Client_Respons"><h5><span class="title">DISPD Client Response</span></h5><p>The DISPD dispatcher can produce the following HTTP tags in response to the client.</p><div class="table" id="ch_app.T.nc_TagDescriptionRelayPath_path"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Tag</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Relay-Path: &lt;path&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag shows how the information was passed along by the DISPD dispatcher and the NCBID utility. This is essential for debugging purposes</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Server-Info-&lt;n&gt;: &lt;server-info&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag(s) (enumerated increasingly by suffix <span class="nctnt ncbi-code">&lt;n&gt;</span>, starting from 1) give a list of servers, where the requested service is available. The list can have up to five entries. However, there is only one entry generated when the service was requested either in firewall mode or by a Web browser. For a non-local client, the returned server descriptors can include <span class="nctnt ncbi-type">FIREWALL</span> server specifications. Despite preserving information about host, port, type, and other (but not all) parameters of the original servers, <span class="nctnt ncbi-type">FIREWALL</span> descriptors are not specifications of real servers, but they are created on-the-fly by the DISPD dispatcher to indicate that the connection point of the server cannot be otherwise reached without the use of either firewalling or relaying.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Connection-Info: &lt;host&gt; &lt;port&gt; &lt;ticket&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag is generated in a response to a stateful-capable client and includes a host (in a dotted notation) and a port number (decimal value) of the connection point where the server is listening (if either the server has specifically started or the FWDaemon created that connection point because of the client's request). The ticket value (hexadecimal) represents the 4-byte ticket that must be passed to the server as binary data at the very beginning of the stream. If instead of a host, a port, and ticket information there is a keyword <span class="nctnt ncbi-type">TRY_STATELESS</span>, then for some reasons (see <span class="nctnt ncbi-code">Dispatcher-Failures</span> tag below) the request failed but may succeed if the client would switch into a stateless mode.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Dispatcher-Failures: &lt;failures&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag value lists all transient failures that the dispatcher might have experienced while processing the request. A fatal error (if any) always appears as the last failure in the list. In this case, the reply body would contain a copy of the message as well.<br /><span class="nctnt highlight">Note:</span> Fatal dispatching failure is also indicated by an unsuccessful HTTP completion code.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Used-Server-Info-n: &lt;server_info&gt;</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag informs the client end of server infos that having been unsuccessfully used during current connection request (so that the client will be able to skip over them if needs to).<br /><span class="nctnt ncbi-code">n</span> is an integral suffix, enumerating from 1. </td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1"><span class="nctnt ncbi-code">Dispatcher-Messages:</span></td><td align="left" valign="top" rowspan="1" colspan="1">The tag is used to issue a message into standard error log of a client. The message is intercepted and delivered from within Toolkit HTTP API.</td></tr></tbody></table></div></div><div class="sec" id="ch_app.Communication_Scheme"><h5><span class="title">Communication Schemes</span></h5><p>After making a dispatching request and using the dispatching information returned, the client can usually connect to the server on its own. Sometimes, however, the client has to connect to the DISPD dispatcher again to proceed with communication with the server. For the DISPD dispatcher this would then be a connection request which can go one of two similar ways, relaying and firewalling.</p><p>The figures (Figure7, Figure8) provided at the very beginning of the “Load Balancing” chapter can be used for better understanding of the communication schemes described below.</p><ul><li><p>In the relay mode, the DISPD dispatcher passes data from the client to the server and back, playing the role of a middleman. Data relaying occurs when, for instance, a Web browser client wants to communicate with a service governed by the DISPD dispatcher itself.</p></li><li><p>In the firewall mode, DISPD sends out only the information about where the client has to connect to communicate with the server. This connection point and a verifiable ticket are specified in the <span class="nctnt ncbi-code">Connection-Info</span> tag in the reply header. <span class="nctnt highlight">Note:</span> firewalling actually pertains only to the stateful-capable clients and servers. </p></li></ul><p>The firewall mode is selected by the presence of the <span class="nctnt ncbi-type">FIREWALL</span> keyword in the <span class="nctnt ncbi-code">Accepted-Server-Types</span> tag set by the client sitting behind a firewall and not being able to connect to an arbitrary port.</p><p>These are scenarios of data flow between the client and the server, depending on the “stateness” of the client:</p><p>A.  Stateless client</p><dl class="labeled-list"><dt>1</dt><dd><p class="no_top_margin">Client is <b>not using firewall</b> mode</p><dl class="labeled-list"><dt>I</dt><dd><p class="no_top_margin">The client has to connect to the server by its own, using dispatching information obtained earlier; or</p></dd><dt>II</dt><dd><p class="no_top_margin">The client connects to the DISPD dispatcher with a connection request (e.g., the case of Web browsers) and the DISPD dispatcher facilitates data relaying for the client to the server. </p></dd></dl></dd><dt>2</dt><dd><p class="no_top_margin">If the client chooses to use the firewall mode then the only way to communicate with the server is to connect to the DISPD dispatcher (making a connection request) and use the DISPD dispatcher as a relay.</p></dd></dl><p><span class="nctnt highlight">Note:</span> Even if the server is stand-alone (but lacking S=yes in the configuration file of the LBSMD daemon) then the DISPD dispatcher initiates a microsession to the server and wraps its output into an HTTP/1.0-compliant reply. Data from both HTTP and NCBID servers are simply relayed one-to-one.</p><p>B.  Stateful-capable client</p><dl class="labeled-list"><dt>1</dt><dd><p class="no_top_margin">A client which is <b>not using the firewall</b> mode has to connect directly to the server, using the dispatcher information obtained earlier (e.g., with the use of <span class="nctnt ncbi-type">INFORMATION_ONLY</span> in <span class="nctnt ncbi-code">Dispatch-Mode</span> tag) if local; for external clients the connection point is provided by the <span class="nctnt ncbi-code">Connection-Info</span> tag (port range 4444-4544).</p></dd><dt>2</dt><dd><p class="no_top_margin">If the firewall mode is selected, then the client has to expect <span class="nctnt ncbi-code">Connection-Info</span> to come back from the DISPD dispatcher pointing out where to connect to the server. If <span class="nctnt ncbi-type">TRY_STATELESS</span> comes out as a value of the former tag, then the client has to switch into a stateless mode (e.g., by setting <span class="nctnt ncbi-type">STATELESS_ONLY</span> in the <span class="nctnt ncbi-code">Client-Mode</span> tag) for the request to succeed.</p></dd></dl><p><span class="nctnt highlight">Note: </span><span class="nctnt ncbi-type">TRY_STATELESS</span> could be induced by many reasons, mainly because all servers for the service are stateless ones or because the FWDaemon is not available on the host, where the client's request was received.</p><p><span class="nctnt highlight">Note:</span> Outlined scenarios show that no prior dispatching information is required for a stateless client to make a connection request, because the DISPD dispatcher can always be used as a data relay (in this way, Web browsers can access NCBI services). But for a stateful-capable client to establish a dedicated connection an additional step of obtaining dispatching information must precede the actual connection.</p><p>To support requests from Web browsers, which are unaware of HTTP extensions comprising dispatching protocol the DISPD dispatcher considers an incoming request that does not contain input dispatching tags as a connection request from a stateless-only client.</p><p>The DISPD dispatcher uses simple heuristics in analyzing an HTTP header to determine whether the connection request comes from a Web browser or from an application (a service connector, for instance). In case of a Web browser the chosen data path could be more expensive but more robust including connection retries if required, whereas on the contrary with an application, the dispatcher could return an error, and the retry is delegated to the application.</p><p>The DISPD dispatcher always preserves original HTTP tags <span class="nctnt ncbi-code">User-Agent</span> and <span class="nctnt ncbi-code">Client-Platform</span> when doing both relaying and firewalling.</p></div></div></div><div class="sec" id="ch_app.NCBID_Server_Launche"><h3><span class="title">NCBID Server Launcher</span></h3><div class="sec" id="ch_app._Overview_4"><h4><span class="title">Overview</span></h4><p>The LBSMD daemon supports services of type NCBID which are really UNIX filter programs that read data from the stdin stream and write the output into the stdout stream without having a common protocol. Thus, HTTP/1.0 was chosen as a framed protocol for wrapping both requests and replies, and the NCBID utility CGI program was created to pass a request from the HTTP body to the server and to put the reply from the server into the HTTP body and send it back to the client. The NCBID utility also provides a dedicated connection between the server and the client, if the client supports the stateful way of communication. Former releases of the NCBID utility were implemented as a separate CGI program however the latest releases integrated the NCBID utility and the DISPD dispatcher into a single component (<span class="nctnt ncbi-path">ncbid.cgi</span> is a hard link to <span class="nctnt ncbi-path">dispd.cgi</span>).</p><p>The NCBID utility determines the requested service from the query string in the same way as the DISPD dispatcher does, i.e., by looking into the value of the CGI parameter service. An executable file which has to be run is then obtained by searching the configuration file (shared with the LBSMD daemon; the default name is <span class="nctnt ncbi-path">servrc.cfg</span>): the path to the executable along with optional command-line parameters is specified after the bar character ("|") in the line containing a service definition.</p><p>The NCBID utility can work in either of two connection modes, stateless and stateful, as determined by reading the following HTTP header tag: </p><p><span class="nctnt ncbi-monospace">Connection-Mode: &lt;mode&gt; </span></p><p>where <span class="nctnt ncbi-monospace">&lt;mode&gt;</span> is one of the following:</p><ul><li><p><span class="nctnt ncbi-type">STATEFUL</span></p></li><li><p><span class="nctnt ncbi-type">STATELESS</span></p></li></ul><p>The default value (when the tag is missing) is <span class="nctnt ncbi-type">STATELESS</span> to support calls from Web browsers.</p><p>When the DISPD dispatcher relays data to the NCBID utility this tag is set in accordance with the current client mode.</p><p>The <span class="nctnt ncbi-type">STATELESS</span> mode is almost identical to a call of a conventional CGI program with an exception that the HTTP header could hold tags pertaining to the dispatching protocol, and resulting from data relaying (if any) by the DISPD dispatcher.</p><p>In the <span class="nctnt ncbi-type">STATEFUL</span> mode, the NCBID utility starts the program in a more tricky way, which is closer to working in a firewall mode for the DISPD dispatcher, i.e. the NCBID utility loads the program with its stdin and stdout bound to a port, which is switched to listening. The program becomes a sort of an Internet daemon (the only exception is that only one incoming connection is allowed). Then the client is sent back an HTTP reply containing the <span class="nctnt ncbi-monospace">Connection-Info</span> tag. The client has to use port, host, and ticket from that tag to connect to the server by creating a dedicated TCP connection.</p><p><span class="nctnt highlight">Note</span>: the NCBID utility never generates <span class="nctnt ncbi-type">TRY_STATELESS</span> keyword.</p><p>For the sake of the backward compatibility the NCBID utility creates the following environment variables (in addition to CGI/1.0 environment variables created by the HTTP daemon when calling NCBID) before starting the service executables: </p><div class="table" id="ch_app.T.nc_NameDescriptionNI_CLIENT_IPA"><table><tbody><tr><td align="center" valign="top" rowspan="1" colspan="1">Name</td><td align="center" valign="top" rowspan="1" colspan="1">Description</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">NI_CLIENT_IPADDR</td><td align="left" valign="top" rowspan="1" colspan="1">The variable contains an IP address of the remote host.<br />It could also be an IP address of the firewall daemon if the NCBID utility was started as a result of firewalling.</td></tr><tr><td align="left" valign="top" rowspan="1" colspan="1">NI_CLIENT_PLATFORM</td><td align="left" valign="top" rowspan="1" colspan="1">The variable contains the client platform extracted from the HTTP tag <span class="nctnt ncbi-monospace">Client-Platform</span> provided by the client if any.</td></tr></tbody></table></div></div></div><div class="sec" id="ch_app.Firewall_Daemon_FWDa"><h3><span class="title">Firewall Daemon (FWDaemon)</span></h3><div class="sec" id="ch_app._Overview_5"><h4><span class="title">Overview</span></h4><p>The NCBI Firewall Daemon (FWDaemon) is essentially a network multiplexer listening at an advertised network address. </p><p>The FWDaemon works in a close cooperation with the DISPD dispatcher which informs FWDaemon on how to connect to the “real” NCBI server and then instructs the network client to connect to FWDaemon (instead of the “real” NCBI server). Thus, the FWDaemon serves as a middleman that just pumps the network traffic from the network client to the NCBI server and back.</p><p>The FWDaemon allows a network client to establish a persistent TCP/IP connection to any of publicly advertised NCBI services, provided that the client is allowed to make an outgoing network connection to any of the following FWDaemon addresses (on front-end NCBI machines): </p><pre>ports 5860..5870 at both 130.14.29.112 and 165.112.7.12 <br /></pre><p><span class="nctnt highlight">Note:</span> One FWDaemon can simultaneously serve many client/server pairs. </p><div class="sec" id="ch_app.FWDaemon_Behind_a__R"><h5><span class="title">FWDaemon Behind a "Regular" Firewall</span></h5><p>If a network client is behind a regular firewall, then a system administrator should open the above addresses (only!) for outgoing connections and set your client to "firewall" mode. Now the network client can use NCBI network services in a usual way (as if there were no firewall at all).</p></div><div class="sec" id="ch_app.FWDaemon_Behind_a__N"><h5><span class="title">FWDaemon Behind a "Non-Transparent" Firewall</span></h5><p><span class="nctnt highlight">Note:</span> If a firewall is "non-transparent" (this is an extremely rare case), then a system administrator must "map" the corresponding ports on your firewall server to the advertised FWDaemon addresses (shown above). In this case, you will have to specify the address of your firewall server in the client configuration.</p><p>The mapping on your non-transparent firewall server should be similar to the following:</p><pre><span class="nctnt-pre ncbi-code">CONN_PROXY_HOST:5860..5870 --&gt; 130.14.29.112:5860..5870</span> <br /></pre><p>Please note that there is a port range that might not be presently used by any clients and servers, but it is reserved for future extensions. Nevertheless, it is recommended that you have this range configured on firewalls to allow the applications to function seamlessly in the future.</p></div></div><div class="sec" id="ch_app._Monitoring_1"><h4><span class="title">Monitoring</span></h4><p>The FWDaemon could be monitored using the following web page:</p><p><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/NETWORK/fwd_check.cgi">http://www.ncbi.nlm.nih.gov/IEB/ToolBox/NETWORK/fwd_check.cgi</a></p><p>Having the page loaded into a browser the user will see the following.</p><p><span><img src="img/FWDaemonMonitor.gif" alt="Image FWDaemonMonitor.gif" /></span></p><p>Figure 15.  FWDaemon Checking Web Page</p><p>By clicking the “Check” button a page similar to the following will appear.</p><p><span><img src="img/FWDaemonCheckPage.gif" alt="Image FWDaemonCheckPage.gif" /></span></p><p>Figure 16.   FWDaemon Presence Check</p><p>The outside NCBI network users can check the connection to the NAT service following the below steps:</p><ul><li><p>Run the FWDaemon presence check as described above.</p></li><li><p>Take connection properties from any line where the status is “OK”. For example 130.14.29.112:5864</p></li><li><p>Establish a telnet session using those connection properties. The example of a connection session is given below (a case when a connection was successfully established).</p></li></ul><pre> &gt; telnet 130.14.29.112 5864<br />Trying 130.14.29.112... <br />Connected to 130.14.29.112. <br />Escape character is '^]'. <br />NCBI Firewall Daemon:  Invalid ticket.  Connection closed. <br />See http://www.ncbi.nlm.nih.gov/cpp/network/firewall.html. <br />Connection closed by foreign host.<br /></pre></div><div class="sec" id="ch_app._Log_Files_1"><h4><span class="title">Log Files</span></h4><p>The FWDaemon stores its log files at the following location:</p><p><span class="nctnt ncbi-path">/opt/machine/fwdaemon/log/fwdaemon</span></p><p>which is usually a link to <span class="nctnt ncbi-path">/var/log/fwdaemon</span>.</p><p>The file is formed locally on a host where FWDaemon is running.</p></div><div class="sec" id="ch_app.FWDaemon_and_NCBID_D"><h4><span class="title">FWDaemon and NCBID Server Data Exchange</span></h4><p>One of the key points in the communications between the NCBID server and the FWDaemon is that the DISPD dispatcher instructs the FWDaemon to expect a new client connection. This instruction is issued as a reaction on a remote client request. It is possible that the remote client requested a service but did not use it. To prevent resource leaking and facilitate the usage monitoring the FWDaemon keeps a track of those requested but not used connections in a special file. The NCBID dispatcher is able to read that file before requesting a new connection from the FWDaemon and if the client was previously marked as the one who left connections not used then the NCBID dispatcher refuses the connection request.</p><p>The data exchange is illustrated on the figure below.</p><p><span><img src="img/DISPDAndFWDaemon.gif" alt="Image DISPDAndFWDaemon.gif" /></span></p><p>Figure 17.   DISPD FWDaemon Data Exchange</p><p>The location of the <span class="nctnt ncbi-path">.dispd.msg</span> file is detected by the DISPD dispatcher as follows. The dispatcher determines the user name who owns the <span class="nctnt ncbi-path">dispd.cgi</span> executable. Then the dispatcher looks to the home directory for that user. The directory is used to look for the <span class="nctnt ncbi-path">.dispd.msg</span> file. The FWDaemon is run under the same user and the <span class="nctnt ncbi-path">.dispd.msg</span> file is saved by the daemon in its home directory.</p></div></div><div class="sec" id="ch_app.Launcherd_Utility"><h3><span class="title">Launcherd Utility</span></h3><p>The purpose of the launcherd utility is to replace the NCBID services on hosts where there is no Apache server installed and there is a need to have UNIX filter programs to be daemonized.</p><p>The launcherd utility is implemented as a command line utility which is controlled by command line arguments. The list of accepted arguments can be retrieved with the -h option:</p><p><span class="nctnt ncbi-code">service1:~&gt; /export/home/service/launcherd -h</span><br /><span class="nctnt ncbi-code">Usage:</span><br /><span class="nctnt ncbi-code">launcherd [-h] [-q] [-v] [-n] [-d] [-i] [-p #] [-l file] service command [parameters...]</span><br /><span class="nctnt ncbi-code">  -h   = Print usage information only; ignore anything else</span><br /><span class="nctnt ncbi-code">  -q   = Quiet start [and silent exit if already running]</span><br /><span class="nctnt ncbi-code">  -v   = Verbose logging [terse otherwise]</span><br /><span class="nctnt ncbi-code">  -n   = No statistics collection</span><br /><span class="nctnt ncbi-code">  -d   = Debug mode [do not go daemon, stay foreground]</span><br /><span class="nctnt ncbi-code">  -i   = Internal mode [bind to localhost only]</span><br /><span class="nctnt ncbi-code">  -p # = Port # to listen on for incoming connection requests</span><br /><span class="nctnt ncbi-code">  -l   = Set log file name [use `-' or `+' to run w/o logger]</span><br /><span class="nctnt ncbi-code">Note: Service must be of type STANDALONE to auto-get the port.</span><br /><span class="nctnt ncbi-code">Note: Logging to `/dev/null' is treated as logging to a file.</span><br /><span class="nctnt ncbi-code">Signals:  HUP, INT, QUIT, TERM to exit</span></p><p>The launcherd utility accepts the name of the service to be daemonized. Using the service name the utility checks the LBSMD daemon table and retrieves port on which the service requests should be accepted. As soon as an incoming request is accepted the launched forks and connects the socket with the standard streams of the service executable.</p><p>One of the launcherd utility command line arguments is a path to a log file where the protocol messages are stored.</p><p>The common practice for the launcherd utility is to be run by the standard UNIX cron daemon. Here is an example of a cron schedule which runs the launcherd utility every 3 minutes:</p><p><span class="nctnt ncbi-code"># DO NOT EDIT THIS FILE - edit the master and reinstall.</span><br /><span class="nctnt ncbi-code"># (/export/home/service/UPGRADE/crontabs/service1/crontab </span><br /><span class="nctnt ncbi-code"># installed on Thu Mar 20 20:48:02 2008) </span><br /><span class="nctnt ncbi-code"># (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $) </span><br /><span class="nctnt ncbi-code">MAILTO=ncbiduse@ncbi</span><br /><span class="nctnt ncbi-code">*/3 * * * * test -x /export/home/service/launcherd &amp;&amp; /export/home/service/launcherd -q -l /export/home/service/bounce.log -- Bounce  /export/home/service/bounce &gt;/dev/null MAILTO=grid-mon@ncbi,taxhelp@ncbi</span><br /><span class="nctnt ncbi-code">*/3 * * * * test -x /export/home/service/launcherd &amp;&amp; /export/home/service/launcherd -q -l /var/log/taxservice -- TaxService /export /home/service/taxservice/taxservice &gt;/dev/null</span><br /></p></div><div class="sec" id="ch_app.Monitoring_Tools"><h3><span class="title">Monitoring Tools</span></h3><p>There are various ways to monitor the services available at NCBI. These are generic third party tools and specific NCBI developed utilities. The specific utilities are described above in the sections related to a certain component.</p><p>The system load and statistics could be visualized by using ORCA graphs. It can be reached at:</p><p><a href="http://viz.ncbi.nlm.nih.gov/orca">http://viz.ncbi.nlm.nih.gov/orca/</a></p><p>The NCBI ORCA Pages shows all the available hosts.</p><p>Click on the certain server leads to another page with the related graphs.</p><p>One more web based tool to monitor servers / services statuses is Nagios. It can be reached at:</p><p><a href="http://nagios.ncbi.nlm.nih.gov/">http://nagios.ncbi.nlm.nih.gov</a></p></div><div class="sec" id="ch_app.Quality_Assurance_Do"><h3><span class="title">Quality Assurance Domain</span></h3><p>The quality assurance (QA) domain uses the same equipment and the same network as the production domain. Not all the services which are implemented in the production domain are implemented in the QA one. When a certain service is requested with the purpose of testing a service from QA should be called if it is implemented or a production one otherwise. The dispatching is implemented transparently. It is done by the CAF module running on production front ends. To implement that the CAFQAMap directive is put into the Apache web server configuration file as following:</p><p><span class="nctnt ncbi-monospace">CAFQAMap NCBIQA /opt/machine/httpd/public/conf/ncbiqa.mapping</span></p><p>The directive above defines the NCBIQA cookie which triggers names substitutions found in the <span class="nctnt ncbi-path">/opt/machine/httpd/public/conf/ncbiqa.mapping</span> file.</p><p>To set the cookie the user can visit the following link:</p><p><a href="http://qa.ncbi.nlm.nih.gov/portal/sysutils/qa_status.cgi">http://qa.ncbi.nlm.nih.gov/portal/sysutils/qa_status.cgi</a></p><p>A screen similar to the following will appear:</p><p><span><img src="img/QACookieManager.gif" alt="Image QACookieManager.gif" /></span></p><p>Figure 18.   QA Cookie Manager.</p><p>While connecting to a certain service the cookie is analyzed by the CAF module and if the QA cookie is detected then name mapping is triggered. The mapping is actually a process of replacing one name with another. The replacement rules are stored in the <span class="nctnt ncbi-path">/opt/machine/httpd/public/conf/ncbiqa.mapping</span> file. The file content could be similar to the following:</p><p><span class="nctnt ncbi-monospace">portal      portalqa</span></p><p><span class="nctnt ncbi-monospace">eutils      eutilsqa</span></p><p><span class="nctnt ncbi-monospace">tpubmed     tpubmedqa</span></p><p>which means to replace <span class="nctnt ncbi-monospace">portal</span> with <span class="nctnt ncbi-monospace">portalqa</span> etc.</p><p>So the further processing of the request is done using the substituted name. The process is illustrated on the figure below.</p><p><span><img src="img/QA.gif" alt="Image QA.gif" /></span></p><p>Figure 19.   NCBI QA</p></div></div><div class="sec" id="ch_app.applications1"><h2><span class="title">NCBI Genome Workbench</span></h2><p> The NCBI Genome Workbench is an integrated sequence visualization and analysis platform.  This application runs on Windows, Unix, and Macintosh OS X. </p><p>The following topics are discussed in this section:</p><ul><li><p><a href="ch_app.html#ch_app.gbench_dg">Design goals</a></p></li><li><p><a href="ch_app.html#ch_app.gbench_design">Design</a></p></li></ul><div class="sec" id="ch_app.gbench_dg"><h3><span class="title">Design Goals</span></h3><p> The primary goal of Genome Workbench is to provide a flexible platform for development of new analytic and visualization techniques. To this end, the application must facilitate easy modification and extension.  In addition, we place a large emphasis on cross-platform development, and Genome Workbench should function and appear identically on all supported platforms. </p></div><div class="sec" id="ch_app.gbench_design"><h3><span class="title">Design</span></h3><p> The basic design of Genome Workbench follows a modified Model-View-Controller (MVC) architecture.  The MVC paradigm provides a clean separation between the data being dealt with (the model), the user's perception of this data (provided in views), and the user's interaction with this data (implemented in controllers).  For Genome Workbench, as with many other implementations of the MVC architecture, the View and Controller are generally combined. </p><p> Central to the framework is the notion of the data being modeled.  The model here encompasses the NCBI data model, with particular emphasis on sequences and annotations.  The Genome Workbench framework provides a central repository for all managed data through the static class interface in <span class="nctnt ncbi-class">CDocManager</span>.  <span class="nctnt ncbi-class">CDocManager</span> owns the single instance of the C++ Object Manager that is maintained by the application.  <span class="nctnt ncbi-class">CDocManager</span> marshals individual <span class="nctnt ncbi-class">CDocument</span> classes to deal with data as the user requests. <span class="nctnt ncbi-class">CDocument</span>, at its core, wraps a <span class="nctnt ncbi-class">CScope</span> class and thus provides a hook to the object manager. </p><p> The View/Controller aspect of the architecture is implemented through the abstract class <span class="nctnt ncbi-class">CView</span>.  Each <span class="nctnt ncbi-class">CView</span> class is bound to a single document. Each <span class="nctnt ncbi-class">CView</span> class, in turn, represents a view of some portion of the data model or a derived object related to the document. This definition is intentionally vague; for example, when viewing a document that represents a sequence alignment, a sequence in that alignment may not be contained in the document itself but is distinctly related to the alignment and can be presented in the context of the document.  In general, the views that use the framework will define a top-level FLTK window; however, a view could be defined to be a CGI context such that its graphical component is a Web browser. </p><p> To permit maximal extensibility, the framework delegates much of the function of creating and presenting views and analyses to a series of plugins. In fact, most of the basic components of the application itself are implemented as plugins. The Genome Workbench framework defines three classes of plugins: data loaders, views, and algorithms. Technically, a plugin is simply a shared library defining a standard entry point. These libraries are loaded on demand; the entry point returns a list of plugin factories, which are responsible for creating the actual plugin instances. </p><p> Cross-platform graphical development presents many challenges to proper encapsulation.  To alleviate a lot of the difficulties seen with such development, we use a cross-platform GUI toolkit (FLTK) in combination with OpenGL for graphical development. </p></div></div><div class="sec" id="ch_app.ncbi_netcache_service"><h2><span class="title">NCBI NetCache Service</span></h2><ul><li><p><a href="ch_app.html#ch_app.what_is_netcache">What is NetCache?</a></p></li><li><p><a href="ch_app.html#ch_app.what_it_can_be_used">What it can be used for?</a></p></li><li><p><a href="ch_app.html#ch_app.getting_started">Getting started</a></p></li><li><p><a href="ch_app.html#ch_app.Available_samples">Available samples</a></p></li><li><p><a href="ch_app.html#ch_app.sample_configuration_file_netcac">Sample configuration file (netcached.ini)</a></p></li></ul><div class="sec" id="ch_app.what_is_netcache"><h3><span class="title">What is NetCache?</span></h3><p>The <span class="nctnt ncbi-app">NetCache</span> service is a component for temporary network storage. Using <span class="nctnt ncbi-app">NetCache</span> service, data BLOBs can be stored to and then retrieved from different hosts.</p><p>One important example where this functionality is badly needed is the CGI applications that require session info to be stored between calls. Such session information can be embedded into URLs or cookies, however it is generally not a good idea - for security reasons and also because the length of both URL and cookie is limited. Besides, cookies and URLs are not binary, so some additional data conversion would have to be done.</p><p>Thus it would be better to store this information on the server side. However, this information cannot be stored locally because the next request may hit a CGI running on another machine. One possible way to handle it is to create a file on a shared network drive. This approach has its own issues though:</p><ul><li><p>Adding new data BLOB</p></li><li><p>Removing data BLOB</p></li><li><p>Updating existing BLOB</p></li><li><p>Automatic removal of expired BLOBs</p></li><li><p>Automatic recovery after failures</p></li></ul><p>Among advantages of the <span class="nctnt ncbi-app">NetCache</span> are its high performance and virtually unlimited scalability. Any Linux, UNIX or Windows box can be a <span class="nctnt ncbi-app">NetCache</span> host.</p><p>The <a href="ch_grid.html">NCBI Grid</a> framework uses this service to pass data between its components.</p></div><div class="sec" id="ch_app.what_it_can_be_used"><h3><span class="title">What it can be used for?</span></h3><p>Programs can use <span class="nctnt ncbi-app">NetCache</span> for data exchange. For example,  an application puts some data into <span class="nctnt ncbi-app">NetCache</span> server and passes the data key to another application(s), which then can access (retrieve, update, remove) the data. Some typical cases of using <span class="nctnt ncbi-app">NetCache</span> are: </p><ul><li><p>Store session info</p></li><li><p>Graphics generated by CGIs</p></li><li><p>Caching results of computational algorithms </p></li><li><p>Cache results of expensive DBMS or search system queries </p></li><li><p>Data exchange between programs</p></li></ul><p>The diagram below illustrates how <span class="nctnt ncbi-app">NetCache</span> works.</p><p><span><img src="img/NetCache_diagramm.gif" alt="Image NetCache_diagramm.gif" /></span></p><ul><li><p>Client asks Load Balancer for service.</p></li><li><p>Load Balancer accepts name of the service and chooses the least loaded server (on this diagram Server 2) corresponding to this service.</p></li><li><p>Load Balancer returns the chosen server to the client.</p></li><li><p>Client connects to the <span class="nctnt ncbi-app">NetCache</span> server and sends the data to store.</p></li><li><p><span class="nctnt ncbi-app">NetCache</span> generates key which then can be used then for finding the BLOB.</p></li></ul></div><div class="sec" id="ch_app.getting_started"><h3><span class="title">Getting started</span></h3><p>If new application is being developed within an existing NCBI environment it is assumed that <span class="nctnt ncbi-app">NetCache</span> service is used together with NCBI Load Balancer. It is not recommended to use unbalanced <span class="nctnt ncbi-app">NetCache</span> service.  </p><p>In order to start new project using <span class="nctnt ncbi-app">NetCache</span> service it is necessary to obtain dedicated service name. For bulky applications the recourses of the server have to be adequate for the application’s needs.</p><p>The following simple example (Example 1) illustrates how to store and retrieve data using <span class="nctnt ncbi-app">NetCache</span>.</p><pre>auto_ptr&lt;CNetCacheClient&gt; nc_client; <br />... <br />//The NetCache service can be identified by its name: <br />nc_client.reset(new CNetCacheClient("nc_client_sample1", service_name)); <br /> ... <br />// Data to be saved on server <br />const char test_data[] = "A quick brown fox, jumps over lazy dog."; <br />... <br />// Store the data <br />// PutData method returns a unique key identifying  <br />// the blob created on the server  <br />string key = nc_client-&gt;PutData(test_data, strlen(test_data)+1); <br />... <br />// Retrieve the data by key <br />CNetCacheClient::SBlobData bdata;  <br />CNetCacheClient::EReadResult rres = nc_client-&gt;GetData(key, bdata); <br />... <br />//  <br />NcbiCout &lt;&lt; bdata.blob.get() &lt;&lt; NcbiEndl;<br /></pre></div><div class="sec" id="ch_app.Available_samples"><h3><span class="title">Available samples</span></h3><p>More up-to-date version of <span class="nctnt ncbi-app">NetCache</span> ini file can be found <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/app/netcache/netcached.ini">here</a>.</p><p>There are a few sample files with ready to use code:</p><p><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/sample/app/netcache/netcache_cgi_sample.cpp">src/sample/app/netcache/netcache_cgi_sample.cpp</a></p><p><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/sample/app/netcache/netcache_client_sample1.cpp">src/sample/app/netcache/netcache_client_sample1.cpp</a></p><p><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/sample/app/netcache/netcache_client_sample2.cpp">src/sample/app/netcache/netcache_client_sample2.cpp</a></p><p><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/sample/app/netcache/netcache_client_sample3.cpp">src/sample/app/netcache/netcache_client_sample3.cpp</a></p></div><div class="sec" id="ch_app.sample_configuration_file_netcac"><h3><span class="title">Sample configuration file (netcached.ini)</span></h3><pre>General purpose server parameters    <br />[server]    <br />; port number server responds on    <br />port=9000    <br />; maximum number of clients(threads) can be served simultaneously    <br />max_threads=25    <br />; initial number of threads created for incoming requests    <br />init_threads=5    <br />; Server side logging    <br />log=false    <br />; Size of thread local buffer (65536 should be fine)    <br />tls_size=65536    <br />; when true, if database cannot be open (corrupted) server     <br />; automatically drops the db directory (works only for BDB)    <br />; and creates the database from scratch    <br />; (the content is going to be lost)    <br />; Directory reinitialization can be forced by "netcached -reinit"    <br />drop_db=true    <br />; Network inactivity timeout in seconds    <br />network_timeout=20    <br />; BerkeleyDB related parameters    <br />[bdb]    <br />; directory to keep the database. It is important that this    <br />; directory resides on local drive (not NFS)    <br />;    <br />; WARNING: the database directory sometimes can be recursively deleted <br />;          (when netcached started with -reinit).     <br />;          DO NOT keep any of your files(besides the database) in it.<br />path=e:/netcached_data    <br />; cache name    <br />name=nccache    <br />; use syncronous or asyncromous writes (used with transactions)    <br />write_sync=false    <br />; when 'true' the database is transaction protected    <br />use_transactions=true    <br />; BLOB expiration timeout in seconds    <br />timeout=3600    <br />; subkey - mandatory parameter    <br />; onread - update BLOB time stamp on every read     <br />;          (otherwise only creation time will taken into account)    <br />; purge_on_startup - delete all deprecated BLOBs when starting netcached <br />;                     (may significantly slow down startup propcess) <br />; check_expiration - check if BLOB has expired (on read) and if it is <br />;                    return "not found". Otherwise BLOB lives until <br />;                    it is deleted by the internal garbage collector <br />timestamp=subkey onread    <br />#    purge_on_startup check_expiration    <br />; do not change this    <br />keep_versions=all    <br />; Run background cleaning thread    <br />; (Pretty much mandatory parameter, turn it off only if you want <br />;  to keep absolutely everything in the database)    <br />purge_thread=true    <br />; Delay (seconds) between purge(garbage collector) runs. <br />purge_thread_delay=30    <br />; maintanance thread sleeps for specified number of milliseconds after <br />; each batch. By changing this parameter you can adjust the purge <br />; thread priority    <br />purge_batch_sleep=100    <br />; maintanance thread processes database records by chunks of specified <br />; number. If you increase this number it also increases the performance<br />; of purge process (at the expense of the online connections)    <br />purge_batch_size=70    <br />; amount of memory allocated by BerkeleyDB for the database cache    <br />; Berkeley DB page cache) (More is better)    <br />mem_size=50M    <br />; Specifies how often cache should remove the Berkeley DB LOG files    <br />; Removal is triggered by the purge thread. Value of 2 means LOG is<br />; cleaned every second purge    <br />purge_clean_log=2    <br />; Call transaction checkpoint every "checkpoint_bytes" of stored data<br />checkpoint_bytes=10M    <br />; BLOBs &lt; 10M stored in database    <br />overflow_limit=10M    <br />; This parameter regulates BLOB expiration. If client constantly reads <br />; the BLOB and you do not want it to stuck in the database forever <br />; (timestamp=onread), set this parameter.    <br />; If timeout is 3600 and ttl_prolong is 2, maximum possible timeout for <br />; the BLOB becomes 3600 * 2 = 7200 seconds.    <br />ttl_prolong=3    <br />; <br /></pre></div></div></div></div><div class="col four_col last"><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>In this page</h3></div></div><div class="portlet_content"><ul><li><a href="#ch_app.datatool">DATATOOL: Code Generation and Data Serialization Utility</a></li><li><a href="#ch_app.Load_Balancing">Load Balancing</a></li><li><a href="#ch_app.applications1">NCBI Genome Workbench</a></li><li><a href="#ch_app.ncbi_netcache_service">NCBI NetCache Service</a></li></ul></div></div><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>Download</h3></div></div><div class="portlet_content"><ul><li><a href="pdf/ch_app.pdf">PDF version of this page</a></li></ul></div></div><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>Search</h3></div></div><div class="portlet_content"><form name="frmSymbolSearch" onsubmit="return SymbolSearch('toolkit')" action="/" id="frmSymbolSearch"><table><tbody><tr align="center" valign="middle"><td colspan="2" nowrap="nowrap"><input id="search_box" name="__symbol" style="vertical-align:                                          middle; line-height:normal " onkeypress="SymbolSearchKeyPress('toolkit',event)" type="text" />   
					<label for="search_box" class="offscreen_noflow">Search term</label><button type="submit" value="Search" style="vertical-align:                                          middle; line-height:normal;" onclick="javasrcipt:SymbolSearch('toolkit');">Search</button></td></tr><tr class="internal-only"><th style="text-align:left">Public</th><th style="text-align:left">Internal</th></tr><tr><td><input id="pToolkitAll" name="__symboloc" type="radio" checked="checked" /><label for="pToolkitAll" title="Search in the C/C++ source code and in this Book">All</label></td><td class="internal-only"><input id="iToolkitAll" name="__symboloc" type="radio" /><label for="iToolkitAll" title="Search in the C/C++ source code,  this Book, and Wiki">All</label></td></tr><tr><td><input id="pLXR" name="__symboloc" type="radio" /><label for="pLXR" title="Search the symbol in the source code using LINUX Cross-Reference browser">LXR</label></td><td class="internal-only"><input id="iLXR" name="__symboloc" type="radio" /><label for="iLXR" title="Search the symbol in the source code using LINUX Cross-Reference browser">LXR</label></td></tr><tr><td><input id="pLib" name="__symboloc" type="radio" /><label for="pLib" title="Locate the Toolkit library(es) where the symbol is defined">Library</label></td><td class="internal-only"><input id="iLib" name="__symboloc" type="radio" /><label for="iLib" title="Locate the Toolkit library(es) where the symbol is defined">Library</label></td></tr></tbody></table></form></div></div><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>Source Browsers</h3></div></div><div class="portlet_content"><ul><li class="external-only"><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident">LXR</a></li><li class="external-only"><a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident">Doxygen</a></li><li class="internal-only">LXR: <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident">public</a> / <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/lxr/ident">internal</a></li><li class="internal-only">Doxygen: <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/doxyhtml">public</a> / <a href="http://intranet.ncbi.nlm.nih.gov/ieb/ToolBox/CPP_DOC/doxyhtml">internal</a></li></ul></div></div><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>SVN Source Repository</h3></div></div><div class="portlet_content"><ul><li><a href="http://www.ncbi.nlm.nih.gov/bookshelf/br.fcgi?book=toolkit&amp;part=ch_getcode_svn#ch_getcode_svn.code_retrieval">Server</a></li><li><a href="https://svn.ncbi.nlm.nih.gov/viewvc/toolkit/trunk/c++">Web
                            (dev)</a></li><li><a href="https://svn.ncbi.nlm.nih.gov/viewvc/toolkit/trunk/internal/c++">Web
                            (extra)</a></li><li><a href="https://svn.ncbi.nlm.nih.gov/viewvc/toolkit/production/components">Web (prod)</a></li></ul></div></div><div class="portlet"><div class="portlet_head"><div class="portlet_title"><h3>Resources</h3></div></div><div class="portlet_content"><ul><li class="internal-only"><a href="http://intranet.ncbi.nlm.nih.gov/wiki-private/CxxToolkit">Wiki</a></li><li class="internal-only"><a href="http://jira/browse/CXX">JIRA</a></li><li class="internal-only"><a href="http://intranet/ieb/ToolBox/STAT/test_stat/test_stat_ext.cgi"><span title="View results of testsuite runs on the automatic C++ Toolkit builds">Testsuite</span></a></li><li><a href="release_notes.html">Release Notes</a></li><li><a href="ch_getcode_svn.html#ch_getcode_svn.ftp_download">Download</a></li><li><a href="pdf/TOC.pdf">PDF of the book</a></li><li><a href="ch_style.html">Coding Style</a></li><li><a href="ch_faq.html#ch_faq.mailing_lists">Mailing Lists</a></li><li><a href="mailto:CPP-CORE@NCBI.NLM.NIH.GOV"><span title="Contact C++ Toolkit group">Help and Support</span></a></li></ul></div></div></div></div></div></div></body></html>
