jQuery.widget("ui.ncbipopper",{options:{openMethod:"",openEvent:"mouseover",openAnimation:"slideDown",closeMethod:"",closeEvent:"mouseout",isEscapeKeyClose:true,isSourceElementCloseClick:false,isTriggerElementCloseClick:true,isTargetElementCloseClick:false,isDestElementCloseClick:false,isDocumentCloseClick:true,addCloseButton:false,closeAnimation:"slideUp",adjustFit:"autoAdjust",delayTimeout:300,sourcePosition:"",destPosition:"top left",sourceSelector:"",destSelector:"",targetPosition:"",triggerPosition:"bottom right",
sourceText:null,destText:null,multipleHandlesSelector:"",hasArrow:false,arrowDirection:"left",groupName:null,width:null,height:null,cssClass:null,excludeBasicCssStyles:false,ignoreSettingOutterWidth:false,loadingText:"loading...",showLoadingMessage:true,isDestTextCacheable:true},_create:function(){this._addTriggerHandlers();this._addTriggerAria();this._addResizeListener();this._addEscapeListener();this._addDocumentClickListener()},destroy:function(){},isPopperOpen:false,isPopperDisplayed:false,_isIE6:jQuery.browser.msie&&
parseInt(jQuery.browser.version,10)===6,_shim:false,_addTriggerHandlers:function(){var a=this.options.openMethod||this.options.openEvent,b=this.options.closeMethod||this.options.closeEvent,c=this;if(a===b&&b==="click"){var d=jQuery(this.element),f=this.options.multipleHandlesSelector;if(f)d=jQuery(f).add(d);d.click(function(e){c._toggleView();e.preventDefault()})}else{d={timeout:this.options.delayTimeout};d.over=a==="mouseover"?function(){c.open()}:function(){};if(b==="mouseout"){d.out=function(){c._isOverTrigger=
false;c._isOverPopper||c.close()};this.isChildHoverable=true;jQuery(this.element).mouseover(function(){c._isOverTrigger=true})}else{d.out=function(){};this.isChildHoverable=false}if(a==="mouseover"||b==="mouseout")jQuery(this.element).hoverIntent(d);a!=="mouseover"&&jQuery(this.element).bind(a,function(e){c.open();a==="click"&&e.preventDefault()});b!=="mouseout"&&jQuery(this.element).bind(b,function(e){c.close();b==="click"&&e.preventDefault()});if((this.options.isSourceElementCloseClick||this.options.isTriggerElementCloseClick)&&
b!=="click"&&a!=="click")jQuery(this.element).click(function(e){c.close(e);e.preventDefault()})}},_removeHandlers:function(){var a=this.options.openMethod||this.options.openEvent,b=this.options.closeMethod||this.options.closeEvent;jQuery(this.element).unbind(a).unbind(b)},_toggleView:function(){this.isPopperOpen?this.close():this.open()},open:function(){if(!this.isPopperOpen){this.element.trigger("ncbipopperopen");this.isPopperOpen=true;this._closeActivePopperGroup();this._setActivePopperGroup();
this._positionPopper();if(!this.hasCallback||this.isFunctionResultCached||this.hasCallback&&this.options.showLoadingMessage)this._displayPopper()}},close:function(){if(this.isPopperOpen){this.element.trigger("ncbipopperclose");this.isPopperOpen=false;this._hidePopper();this._setAriaState(false)}},_initDestElement:function(){if(this.content){this.options.isDestTextCacheable||this._reloadContent();return this.content}var a=null,b=this.element.attr("hash");if(b&&b.length>1&&b.charAt(0)==="#")a=b;a=this.options.destSelector||
this.options.sourceSelector||a;b=this.options.destText||this.options.sourceText;var c=null;if(a&&a.length>0)var d=jQuery(a);else if(b)d=this._createTextHolder(b);c=this._wrapContent(d);this._addCloseButton(c);this._addDestElementCloseClick(c);this.content=c;if(this._isIE6&&!this._shim)this._shim=this.content.createIE6LayerFix(true);this._addDestAria();return c},getDestElement:function(){return this.content||this._initDestElement()},_wrapContent:function(a){a.addClass("ui-ncbipopper-content");this.options.excludeBasicCssStyles||
a.addClass("ui-ncbipopper-basic");var b=a;b=this._wrapElement(a);this.options.hasArrow&&this._addArrows(b);this.isChildHoverable&&this._addPopperHover(b);return b},_wrapElement:function(a){var b=null;if(!a.parent().hasClass("ui-ncbipopper-wrapper")){var c="ui-ncbipopper-wrapper",d=this.options.cssClass;if(d)c+=" "+d;if(a.parent().css("overflow")==="hidden"){a.addClass("ui-ncbipopper-content-hook");d=a.clone();var f=a.attr("id");b=jQuery(document.body).children().last();d=d.insertAfter(b);if(a.hasClass("offscreen_noflow")){a.removeClass("offscreen_noflow");
a.width()}b=a.width();if(!this.options.width)this.options.width=b;a.remove();d.attr("id",f);a=d;c+=" ui-ncbipopper-hook"}c=jQuery("<div class='"+c+"'></div>");a.removeClass("offscreen_noflow");b=this.options.width||b||a.width();d=this.options.height||a.height();if(a[0].style.width.length===0||a[0].style.width==="auto"){if(!this.options.width)if(parseFloat(b).toString()===b.toString())b=parseFloat(b)+1;a.css("width",b)}this.options.height&&a.css("height",d);b=a.outerWidth();this.options.ignoreSettingOutterWidth||
c.width(b);c.css("display","none");a.wrap(c).css("display","block")}return a.parent()},_addArrows:function(a){if(jQuery(".ui-ncbipopper-arrow-image",a).length!==1){var b=this.options.arrowDirection,c="ui-ncbipopper-arrow-"+b,d=this.options.sourcePosition||this.options.destPosition;d=d.split(/\s/);if(b==="left"||b==="right"){c+=" "+c+"-"+d[0];a.width(a.width());a.width(a.outerWidth()+20);this.options._adjustOffsetX=0;this.options._adjustOffsetY=d[0]==="top"?-10:d[0]==="center"?0:10}else{c+=" "+c+"-"+
d[1];this.options._adjustOffsetX=d[1]==="left"?-10:d[1]==="center"?0:10;this.options._adjustOffsetY=0}c=jQuery("<div class='"+c+"'><div class='ui-ncbipopper-arrow-image'>&nbsp;</div></div>");a=a.children().eq(0).addClass("ui-ncbipopper-arrow-"+b+"-content");b==="left"||b==="top"?a.before(c):a.after(c)}},_addPopperHover:function(a){var b=this,c={timeout:this.options.delayTimeout,over:function(){},out:function(){b._overPopper(false)}};jQuery(a).hoverIntent(c);jQuery(a).mouseover(function(){b._overPopper(true)}).mouseout(function(d){b._outOfPopper(d,
a)})},_overPopper:function(a){if(a)this._pTimer=new Date;this._isOverPopper=a;!a&&!this._isOverTrigger&&this.close()},_outOfPopper:function(a,b){var c=jQuery(a.target||a.srcElement),d=b.position(),f=b.width()+d.left,e=b.height()+d.top;if(a.pageX||a.pageY){var g=a.pageX;a=a.pageY}else{var h=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;g=a.clientX+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0);a=a.clientY+h}d=f>g&&g>d.left&&
a>d.top&&e>a;c.parents(b).length>0&&d||this.options.delayTimeout>new Date-this._pTimer&&this._overPopper(false)},positionPopper:function(){this._positionPopper()},_positionPopper:function(){var a=this._initDestElement(),b=(this.options.sourcePosition||this.options.destPosition).split(/\s/),c=(this.options.targetPosition||this.options.triggerPosition).split(/\s/);b=b[1]+" "+b[0];var d=c[1]+" "+c[0],f=this.options.adjustFit;f=f==="autoAdjust"||f==="slide"?"fit":"none";a.css("display")==="none"&&a.css("visibility",
"hidden").css("display","block");var e=jQuery(this.element),g=e.height(),h=e.position().top,j=e.parent().height(),k=this.options._adjustOffsetX||0,i=this.options._adjustOffsetY||0;if(e.parent().css("overflow")==="hidden"&&h+g>j){e=j-h-g;if(c[0]==="center"||c[0]==="middle")i+=e/2;else if(c[0]==="bottom")i+=e}a.position({my:b,of:this.element,at:d,offset:k+" "+i,collision:f});if(this._shim){a=this.content.find(".ui-ncbipopper-content").position();c=parseInt(this.content.css("top"),10)+parseInt(a.top,
10);b=parseInt(this.content.css("left"),10)+parseInt(a.left,10);this._shim.css({top:c+"px",left:b+"px","z-index":this.content.css("z-index")-1}).width(this.content.width()-parseInt(a.left,10)).height(this.content.height()-parseInt(a.top,10))}},_displayPopper:function(){var a=this,b=this.getDestElement(),c=b.data("trigger");if(c&&c.get(0)!=this.element.get(0)&&c.ncbipopper("isOpen")){b.data("doNotClose",true);window.setTimeout(function(){b.data("doNotClose",false)},this.options.delayTimeout)}b.data("trigger",
this.element);c=this.options.openAnimation;if(c==="none"){b.css("visibility","visible");a.element.stop(true,true).trigger("ncbipopperopencomplete");a.isPopperDisplayed=true;this._shim&&this._shim.show()}else{b.stop(true,true);b.css("visibility","visible").css("display","none");b[c](290,function(){a.element.trigger("ncbipopperopencomplete");a.isPopperDisplayed=true;a._shim&&a._shim.show()})}this._setAriaState(true)},_hidePopper:function(){var a=this,b=this.getDestElement();if(b.data("doNotClose")){a.isPopperDisplayed=
false;b.data("doNotClose",false)}else{var c=this.options.closeAnimation;if(c==="none"){b.css("display","none");a.element.stop(true,true).trigger("ncbipopperclosecomplete");a.isPopperDisplayed=false}else{b.stop(true,true);b[c](150,function(){a.element.trigger("ncbipopperclosecomplete");a.isPopperDisplayed=false})}this._shim&&this._shim.hide()}},_closeActivePopperGroup:function(){var a=this.options.groupName;if(a){var b=jQuery.ui.ncbipopper.openGroups[a];if(b&&b!==this.element){jQuery(b).ncbipopper("close");
jQuery.ui.ncbipopper.openGroups[a]=null}}},_setActivePopperGroup:function(){var a=this.options.groupName;if(a)jQuery.ui.ncbipopper.openGroups[a]=this.element},_addEscapeListener:function(){if(this.options.isEscapeKeyClose){this._registerGlobalEscapeListener();var a=this;jQuery(document).bind("ncbipopperescapepressed",function(){a.close()})}},_registerGlobalEscapeListener:function(){if(!jQuery.ui.ncbipopper.isGlobalEscapeRegistered){jQuery.ui.ncbipopper.isGlobalEscapeRegistered=true;var a=document,
b="keypress";if(!jQuery.browser.msie&&!jQuery.browser.mozilla){a=window;b="keydown"}jQuery(a)[b](function(c){c.keyCode===27&&jQuery(document).trigger("ncbipopperescapepressed")})}},_addDocumentClickListener:function(){if(this.options.isDocumentCloseClick){this._registerGlobalClickListener();var a=this;jQuery(document).bind("ncbipopperdocumentclick",function(b,c){a._checkDocumentClick(b,c)})}},_registerGlobalClickListener:function(){if(!jQuery.ui.ncbipopper.isGlobalClickRegistered){jQuery.ui.ncbipopper.isGlobalClickRegistered=
true;jQuery(document).click(function(a){jQuery(document).trigger("ncbipopperdocumentclick",[a.srcElement||a.target])})}},_addResizeListener:function(){this._registerGlobalResizeListener();var a=this;jQuery(window).bind("ncbipopperdocumentresize",function(){a._pageResized()})},_registerGlobalResizeListener:function(){if(!jQuery.ui.ncbipopper.isGlobalResizeRegistered){jQuery.ui.ncbipopper.isGlobalResizeRegistered=true;jQuery(window).resize(function(){jQuery(window).trigger("ncbipopperdocumentresize")})}},
_pageResized:function(){this.isPopperOpen&&this._positionPopper()},_checkDocumentClick:function(a,b){if(b&&this.isPopperOpen){b=jQuery(b);if(!(this._isSameElementOrChild(jQuery(this.element),b)||this._isSameElementOrChild(this.getDestElement(),b))){if(a=this.options.multipleHandlesSelector){var c=false,d=this;jQuery(a).each(function(){if(d._isSameElementOrChild(jQuery(this),b))c=true});if(c)return}this.close()}}},_isSameElementOrChild:function(a,b){return a[0]==b[0]||jQuery(a).has(b).length===1},
_addCloseButton:function(a){if(this.options.addCloseButton){var b=jQuery(".ui-ncbipopper-close-button, .ncbipopper-close-button",a);if(b.length===0)b=jQuery("<button class='ui-ncbipopper-close-button ui-ncbipopper-close-button-generated'>x</button>").attr("generated","true").prependTo(a);if(b){var c=this;b.click(function(d){c.close();d.preventDefault()})}}},_addDestElementCloseClick:function(a){if(this.options.isTargetElementCloseClick||this.options.isDestElementCloseClick){var b=this;a.click(function(c){b.close();
c.preventDefault()})}},_createTextHolder:function(a){var b=jQuery("<div></div>"),c=this._getFunction(a);if(typeof c==="function")a=this._getText(c);b.css("display","none").attr("generated","true").html(a).appendTo(document.body);return b},_getFunction:function(a){var b=null;if(jQuery.ui.jig&&jQuery.ui.jig._getFncFromStr)b=jQuery.ui.jig._getFncFromStr(a);else if(typeof a==="function")b=a;return b},_getText:function(a){a||(a=this._getFunction(this.options.destText||this.options.sourceText));var b=this;
this.hasCallback=true;a=a.call(this.element[0],function(c){b._setHTML(c)})||this.options.loadingText;if(a!==this.options.loadingText)this.isFunctionResultCached=this.options.isDestTextCacheable;return a},_reloadContent:function(){var a=this._getText(),b=jQuery(".ui-ncbipopper-content",this.getDestElement());b&&b.html(a)},_setHTML:function(a){var b=jQuery(".ui-ncbipopper-content",this.getDestElement());if(b){b.html(a);this.isFunctionResultCached=this.options.isDestTextCacheable;!this.options.showLoadingMessage&&
!this.isPopperDisplayed&&this._displayPopper()}},_addTriggerAria:function(){this.element.attr("role","button").attr("aria-expanded",false)},_addDestAria:function(){this.getDestElement().attr("aria-live","assertive").attr("aria-hidden",true).addClass("ui-helper-reset")},_setAriaState:function(a){this.element.attr("aria-expanded",a);this.getDestElement().attr("aria-hidden",!a)},isOpen:function(){return this.isPopperOpen}});jQuery.ui.ncbipopper.openGroups={};
jQuery.ui.ncbipopper.isGlobalEscapeRegistered=false;jQuery.ui.ncbipopper.isGlobalClickRegistered=false;jQuery.ui.ncbipopper.isGlobalResizeRegistered=false;jQuery.ui.ncbipopper._selector=".jig-ncbipopper";jQuery.ui.ncbipopper.getSelector=function(){return this._selector};
