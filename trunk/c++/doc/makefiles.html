<!-- $Id$ -->
<!--#set var="TITLE" value="NCBI C++ Toolkit:  Working with Makefiles" -->
<!--#set var="HEADING" value="Working with Makefiles" -->
<!--#set var="DOCROOT" value="." -->
<!--#include virtual="./ssi/header.shtml" -->

<a name="ref_MakefilesTop"></a>

<ul>
<li> <b> <a href="#ref_MakefilesOverview">Overview</a> </b></li>
<li> <b> <a href="#ref_MakefilesHier">Makefile Hierarchy</a> </b></li>
<li> <b> <a href="#ref_MakefilesMeta">Meta-Makefiles</a> </b></li>
<li> <b> <a href="#ref_MakefilesProj">Project Makefiles </a> </b></li>
<li> <b> <a href="#ref_MakefilesTargets">Standard Build Targets</a> </b></li>
<li> <b> <a href="#ref_MakefilesMacros">Makefile Macros and <tt>Makefile.mk</tt></a> </b></li>
<li> <b> <a href="#ref_MakefilesEx">Example Makefiles</a> </b></li>
</ul>

<p>
<hr>

<a name="ref_MakefilesOverview"></a>
<h2>Overview &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        Building executables and libraries for a large, integrated set of software tools like
        the C++ Toolkit, and doing so consistently on different platforms and architectures,
        is a daunting task.  Therefore, the Toolkit developers have expended considerable
        effort to design a build system based upon the <tt>make</tt> utility as controlled by
        <i>makefiles</i>.   While it is of course possible to write one's own Toolkit <i>makefile</i> from scratch,
        it is seldom desirable.  To take advantage of Toolkit experience, wisdom and alchemy
        to help avoid often inscrutable compilation issues:
        <p>

        &nbsp;&nbsp;&nbsp;&nbsp;<b>we <i>strongly</i> advise users to work with the Toolkit's <tt>make</tt> system</b>!
        <p>

        <p>

        With minimal manual editing (and after invoking the
        <tt><a href="config.html">configure</a></tt> script in your build tree) the build system adapts to
        your environment, compiler options, defines all relevant <i>makefile</i> macros and targers, allows for
        recursive builds of the entire Toolkit and targetted builds of single modules,
        and handles many other details that can confound manual builds.
        Before describing the <tt>make</tt> system in detail, we list the major
        types of <i>makefiles</i> employed by the Toolkit.
        <p>

        <ul>
            <li> <b><i>meta-makefiles</i></b>
                <br> These files exist for each project and tie together project in the Toolkit
                hierarchy, defining those applications and libraries a project is responsible
                for (possibly recursively) building.
            <li> <b>Generic <i>makefile</i> Templates</b> (<tt>Makefile*.in</tt>)
                <br> The <tt>configure</tt> script processes these files from the <tt>src</tt>
                hierarchy to substitute for the special tags "@<i>some_name</i>@" and make
                other specializations required for a given project.  Note that <i>meta-makefiles</i>
                are typically derived from such templates.
            <li> <b>Customized <i>makefiles</i></b> (<tt>Makefile.*.[lib|app]</tt>)
                <br> For each library or application, this file gives specific targets, compiler
                flags, and other project-specific build instructions.  These files appear
                in the <tt>src</tt> hierarchy.
            <li> <b>Configured <i>makefiles</i></b> (<tt>Makefile</tt>)
                <br> A <i>makefile</i> generated by <tt>configure</tt> for each project
                and sub-project and placed in the appropriate location in the
                build tree ready for use will be called a 'configured <i>makefile</i>'.
                Note that <i>meta-makefiles</i> in the build tree may be considered 'configured'.
        </ul>


</dl>
<p>

<hr>

<a name="ref_MakefilesHier"></a>
<h2>Makefile Hierarchy &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        All Toolkit <i>makefiles</i> reside in either the <tt>src</tt> directory as templates
        or customized files, or in the appropriate configured form in each of your <tt><i>&lt;builddir&gt;</i></tt>
        hierarchies as illustrated below<br>
        <center><img SRC="programming_manual/make.gif" ></center>
        <p>

        In the figure, most of the files listed are templates from the <tt>src</tt> directory with
        each corresponding <i>configured makefile</i> at the top of the build tree.  Of these,
        <tt><i>&lt;builddir&gt;</i>/Makefile</tt> can be considered the master <i>makefile</i>
        in that it can recursively build the entire Toolkit.
        The role of each top-level <i>makefile</i> templates is summarized as follows:
<p>

        <ul>
            <li> <b><tt>Makefile.in</tt></b> -- makefile to perform a recursive build in all project subdirectories
            <li> <b><tt>Makefile.meta.in</tt></b> -- included by all makefiles that provide both local and recursive builds
            <li> <b><tt>Makefile.mk.in</tt></b> -- included by all makefiles; sets a lot of configuration variables
            <p>
            <li> <b><tt>Makefile.lib.in</tt></b> -- included by all makefiles that perform a "standard" library build, when building only static libraries.
            <li> <b><tt>Makefile.dll.in</tt></b> -- included by all makefiles that perform a "standard" library build, when building only shared libraries.
            <li> <b><tt>Makefile.both.in</tt></b> -- included by all makefiles that perform a "standard" library build, when building both static and shared libraries.
            <li> <b><tt>Makefile.lib.tmpl.in</tt></b> -- serves as a template for the project <i>customized makefiles</i>
              (<b><tt>Makefile.*.lib[.in]</tt></b>) that perform a "standard" library build
            <li> <b><tt>Makefile.app.in</tt></b> -- included by all makefiles that perform a "standard" application build
            <li> <b><tt>Makefile.lib.tmpl.in</tt></b> -- serves as a template for the project <i>customized makefiles</i>
              (<b><tt>Makefile.*.app[.in]</tt></b>) that perform a "standard" application build
            <li> <b><tt>Makefile.rules.in, Makefile.rules_with_autodep.in</tt></b> -- instructions for building object files; included by most other makefiles
        </ul>
        <p>

        The project-specific portion of the <i>makefile</i> hierarchy is represented in the figure by the
        <i>meta-makefile</i> template <tt>c++/src/myProj/Makefile.in</tt>, the <i>customized makefile</i>
        <tt>c++/src/myProj/Makefile.myProj.[app|lib]</tt>
        (not shown), and the <i>configured makefile</i> <tt>c++/myBuild/build/myProj/Makefile</tt>.
        In fact, every project and
        sub-project in the Toolkit has analogous files specialized to its project; in most
        circumstances, every new or user project should emulate this file structure to be
        compatible with the make system.

</dl>

<hr>

<a name="ref_MakefilesMeta"></a>
<h2>Meta-Makefiles &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>

A typical <i>meta-makefile</i> template(e.g. <i><b>Makefile.in</b></i> in your
<b><i>foo/c++/src/bar_proj/</i></b> dir) looks like this:
<pre>
    # Supply Makefile.bar_u1, Makefile.bar_u2 ...
    #
    USR_PROJ = bar_u1 bar_u2 ...

    # Supply Makefile.bar_l1.lib, Makefile.bar_l2.lib ...
    #
    LIB_PROJ = bar_l1 bar_l2 ...

    # Supply Makefile.bar_a1.app, Makefile.bar_a2.app ...
    #
    APP_PROJ = bar_a1 bar_l2 ...

    # Subprojects
    #
    SUB_PROJ = app sub_proj1 sub_proj2

    srcdir = @srcdir@
    include @builddir@/Makefile.meta
</pre>

This template separately specifies instructions for user, library and application
projects, along with a set of three sub-projects that can be made.
The mandatory final two lines <i>"srcdir = @srcdir@ ; include @builddir@/Makefile.meta"</i>
define the <a href="#ref_MakefilesTargets">standard build targets</a>.
<p>


<a NAME="ref_MakefileIn"></a>
<h4>Makefile.in meta files</h4>
The <i>Makefile.in</i> meta file in the project's source directory defines
a kind of road map that will be used by the <i>configure</i> script to
generate a makefile (<i>Makefile</i>) in the corresponding directory of
the <i>build</i> tree. <i>Makefile.in</i> does <i>not</i> participate in
the actual execution of <i>make</i>, but rather, defines what will happen
at that time by directing the <i>configure</i> script in the creation of
the <i>Makefile</i> that
<i>will</i> be executed (see also the
description of <i><a href="#ref_MakefilesTargets">Makefile
targets</a></i> below).
<p>

The <i>meta-makefile myProj/Makefile.in</i> should define at least one
of the following macros:
<p>

<ul>
<li>
<a NAME="musr"></a><b><i>USR_PROJ</i></b> (optional) - a list of names
for user-defined makefiles.</li>

<br>This macro is provided for the usage of ordinary stand-alone makefiles
which do not utilize the <i>make</i> commands contained in additional makefiles
in the top-level <i>build</i> directory. Each <i>p_i</i> listed in <i>USR_PROJ
= p_1 ... p_N</i> must have a corresponding
<i><a href="#usr_make">Makefile.p_i</a></i>
in the project's source directory. When <i>make</i> is executed, the <i>make</i>
directives contained in these files will be executed directly to build
the targets as specified.
<br>&nbsp;
<br>&nbsp;
<li>
<a NAME="mlib"></a><b><i>LIB_PROJ</i></b> (optional) - a list of names
for library makefiles.</li>

<br>For each library <i>l_i</i> listed in <i>LIB_PROJ = l_1 ... l_N</i>,
you must have created a corresponding project makefile named <i><a href="#lib_make">Makefile.l_i.lib</a></i>
in the project's source directory. When <i>make</i> is executed, these
library project makefiles will be used along with <i>Makefile.lib</i> and
<i>Makefile.lib.tmpl</i> (located in the top-level of the <i>build</i>
tree) to build the specified libraries.
<br>&nbsp;
<br>&nbsp;
<li>
<a name="masn"></a><b><i>ASN_PROJ</i></b> (optional) is like
<i>LIB_PROJ</i>, with one additional feature: Any projects listed
there will be interpreted as the names of ASN.1 module specifications
to be processed by <a href="tools/datatool/datatool.html">datatool</a>.
<br>&nbsp;
<br>&nbsp;

<li>
<a NAME="mapp"></a><b><i>APP_PROJ</i></b> (optional) - a list of names
for application makefiles.</li>

<br>Similarly, each application (<i>p1, p2, ..., pN</i>) listed under <i>APP_PROJ</i>
must have a corresponding project makefile named <i><a href="#app_make">Makefile.p*.app</a></i>
in the project's source directory. When <i>make</i> is executed, these
application project makefiles will be used along with <i>Makefile.app</i>
and <i>Makefile.app.tmpl</i> to build the specified executables.
<br>&nbsp;
<br>&nbsp;
<li>
<a NAME="msub"></a><b><i>SUB_PROJ</i></b> (optional) - a list of names
for subproject directories (used on recursive makes).</li>

<br>The <i>SUB_PROJ</i> macro is used to recursively define <i>make</i>
targets; items listed here define the subdirectories rooted in the project's
source directory where <i>make</i> should also be executed.</ul>
<p>

Some additional <i>meta-makefile</i> macros (listed in the table below)
exist to specify various directory paths that <tt>make</tt> needs to know.
The "@"-delimited tokens
are substituted during configuration based on your environment and any
command-line options passed to <tt>configure</tt>.
<p>

<br></br>
<a name="ref_TablePath"></a>
<table border=1 cellspacing=0>
<caption>Path Specification <i>Makefile</i> Macros</caption>
  <tr class="head">
	 <th>Macro</th>
	 <th>Source</th>
	 <th>Synopsis</th>
  </tr>

  <tr>
	 <td><b>top_srcdir</b></td>
	 <td><i>@top_srcdir@</i></td>
	 <td>Path to the whole NCBI C++ package</td>
  </tr>

  <tr>
	 <td><b>srcdir</b></td>
	 <td><i>@srcdir@</i></td>
	 <td>Directory in the <i>source tree</i> that corresponds to the
        directory (<i><b>./</b></i>) in the <i>build tree</i> where the
        build is currently going on
    </td>
  </tr>

  <tr>
	 <td><b>includedir</b></td>
	 <td><i>@includedir@</i></td>
	 <td>Top include directory in the <i>source tree</i></td>
  </tr>

  <tr>
	 <td><b>build_root</b></td>
	 <td><i>@build_root@</i></td>
	 <td>Path to the whole <i>build tree</i></td>
  </tr>

  <tr>
	 <td><b>builddir</b></td>
	 <td><i>@builddir@</i></td>
	 <td>Top build directory inside the <i>build tree</i></td>
  </tr>

  <tr>
	 <td><b>incdir</b></td>
	 <td><i>@incdir@</i></td>
	 <td>Top include directory inside the <i>build tree</i></td>
  </tr>

  <tr>
	 <td><b>libdir</b></td>
	 <td><i>@libdir@</i></td>
	 <td>Libraries built inside the <i>build tree</i></td>
  </tr>

  <tr>
	 <td><b>bindir</b></td>
	 <td><i>@bindir@</i></td>
	 <td>Executables built inside the <i>build tree</i></td>
  </tr>

  <tr>
	 <td><b>status_dir</b></td>
	 <td><i>@status_dir@</i></td>
	 <td>Configuration status files</i></td>
  </tr>
</table>


<p>
<br>
<a name="ref_Expendable"></a>
<h4>Expendable projects</h4>
By default, failure of any project will cause make to exit immediately.
Although this behavior can save a lot of time, it is not always
desirable.  One way to avoid it is to run <tt>make -k</tt> rather than
<tt>make</tt>, but then major problems affecting a large portion of
the build will still waste a lot of time.

<p>
Consequently, the toolkit's build system supports an alternative
approach: <a href="#ref_MakefilesMeta"><i>meta-makefiles</i></a> can define
<i>expendable</i> projects which should be built if possible but are
allowed to fail without interrupting the build.  The way to do this is
to list such projects in <b>EXPENDABLE_*_PROJ</b> rather than <b>*_PROJ</b>.


</dl>

<hr>

<a name="ref_MakefilesProj"></a>
<h2>Project Makefiles  &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
When beginning a new project, the <tt><a href="new_proj.html#ref_OutsideCreate">new_project.sh</a></tt> shell
        script will generate an initial <i>makefile</i> <tt>Makefile.<i>&lt;project_name&gt;</i>_app</tt>
        that you can modify as needed.  In addition, a working sample application can also be checked out to
        experiment with or as an alternate template.
        <p>

        The <tt><a href="new_proj.html#ref_OutsideImport">import_projects.sh</a></tt> script is
        useful for working on existing Toolkit projects without needing to build the whole Toolkit.
        In this case things are particularly straightforward as the project will be retrieved complete
        with its <i>makefile</i> already configured as <tt>Makefile.<i>&lt;project_name&gt;</i>_[app|lib]</tt>.
        (Note that there is an underscore in the name, not a period as in the similarly-named
        <i>customizable makefile</i> from which the configured file is derived.)
        <p>

        <dl>
            <dt><b>If you are working outside of the source tree:</b>
            <dd>
                In this scenario you are only linking to the Toolkit libraries and
                will not need to run the <tt>configure</tt> script, so a <tt>Makefile.in</tt>
                template <i>meta-makefile</i>is not required.<br>
                Some of the typical edits required for the <i>customized makefile</i> are shown
                in the <a href="programming_manual/outside_tree.html#makefiles">programming manual</a>.
                <p>

            <dt><b>If you are working within the source tree or subtree:</b>
            <dd>
                Project subdirectories that do not contain any <tt>*.in</tt> files are
                ignored by the <tt>configure</tt> script.  Therefore, you will now also need to
                create a <tt>meta-makefile</tt> for the newly created project before
                configuring your <i>build</i> directory to include the new project.<br>
                Several examples are detailed on the
                "<a href="new_proj.html#ref_MakeProjLib">Starting New Projects</a>" page.
        </dl>


<p>
<br>
<a name="ref_Packages"></a>
<h4>List of optional packages, features and projects</h4>
Here are the keywords you can list in REQUIRES in a customized
<a href="new_proj.html#ref_MakeProjApp">application</a> or
<a href="new_proj.html#ref_MakeProjLib">library</a> makefile, along with the corresponding
<a href="config.html#ref_ProhibitPackage">configure options</a>:

<p>

<table border=1 cellspacing=0>
 <tr class="head">
  <th>Keyword</th>
  <th align=left>Optional...</th>
  <th>Configure option(s)</th>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...package</th>
  <th></th>
 </tr>

 <tr>
  <td><b>Sybase</b></td>
  <td>Sybase libraries</td>
  <td><i>--without-sybase, --with-sybase-local(=DIR), --with-sybase-new</i></td>
 </tr>

 <tr>
  <td><b>FreeTDS</b></td>
  <td>FreeTDS libraries</td>
  <td><i>--without-ftds, --with-ftds=DIR</i></td>
 </tr>

 <tr>
  <td><b>Fast-CGI</b></td>
  <td>Fast-CGI library</td>
  <td><i>--without-fastcgi</i></td>
 </tr>

 <tr>
  <td><b>FLTK</b></td>
  <td>the Fast Light ToolKit</td>
  <td><i>--without-fltk, --with-fltk=DIR</i></td>
 </tr>

 <tr>
  <td><b>wxWindows</b></td>
  <td>wxWindows</td>
  <td><i>--without-wxwin, --with-wxwin=DIR</i></td>
 </tr>

 <tr>
  <td><b>C-Toolkit</b></td>
  <td>NCBI C Toolkit</td>
  <td><i>--without-ncbi-c</i></td>
 </tr>


 <tr>
  <td><b>SSSDB</b></td>
  <td>NCBI SSS DB library</td>
  <td><i>--without-sssdb, --without-sss</i></td>
 </tr>

 <tr>
  <td><b>SSSUTILS</b></td>
  <td>NCBI SSS UTILS library</td>
  <td><i>--without-sssutils, --without-sss</i></td>
 </tr>

 <tr>
  <td><b>GEO</b></td>
  <td>NCBI GEO libraries</td>
  <td><i>--without-geo</i></td>
 <tr>

 <tr>
  <td><b>SP</b></td>
  <td>SP libraries</td>
  <td><i>--without-sp</i></td>
 <tr>

 <tr>
  <td><b>PubMed</b></td>
  <td>NCBI PubMed libraries</td>
  <td><i>--without-pubmed</i></td>
 <tr>

 <tr>
  <td><b>ORBacus</b></td>
  <td>ORBacus CORBA</td>
  <td><i>--without-orbacus, --with-orbacus=DIR</i></td>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...feature</th>
  <th> </th>
 </tr>

 <tr>
  <td><b>MT</b></td>
  <td>multithreading is available</td>
  <td><i>--with-mt</i></td>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...project(s)</th>
  <th> </th>
 </tr>

 <tr>
  <td><b>serial</b></td>
  <td>ASN.1/XML serialization library and datatool</td>
  <td><i>--without-serial</i></td>
 </tr>

 <tr>
  <td><b>ctools</b></td>
  <td>projects based on the NCBI C toolkit</td>
  <td><i>--without-ctools</i></td>
 </tr>

 <tr>
  <td><b>gui</b></td>
  <td>projects that use the wxWindows GUI package</td>
  <td><i>--without-gui</i></td>
 </tr>

 <tr>
  <td><b>objects</b></td>
  <td>libraries to serialize ASN.1/XML objects</td>
  <td><i>--with-objects</i></td>
 </tr>

 <tr>
  <td><b>app</b></td>
  <td>standalone applications like ID1_FETCH</td>
  <td><i>--with-app</i></td>
 </tr>

 <tr>
  <td><b>internal</b></td>
  <td>all internal projects</td>
  <td><i>--with-internal</i></td>
 </tr>

 <tr>
  <td><b>local_lbsm</b></td>
  <td>IPC with locally running LBSMD</td>
  <td><i>--without-local-lbsm</i></td>
 </tr>
</table>


</dl>

<hr>

<a name="ref_MakefilesTargets"></a>
<h2>Standard Build Targets &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
<a name="ref_MakefilesMetaTargets"></a>
<h4><i>Meta-Makefile</i> Targets</h4>
        The mandatory lines from the <a href="#ref_MakefilesMeta"><i>meta-makefile</i> example above</a>,
<pre>
        srcdir = @srcdir@
        include @builddir@/Makefile.meta
</pre>
        provide the build rules for the following standard <i>meta-makefile</i> targets:
<ul>
  <li> <a href="#ref_MakeProjTarget"><b>all</b></a>:
    <ul>
		<li> run <i>"make  -f {Makefile.*} all"</i> for the makefiles
		  with the suffixes listed in macro <b>USR_PROJ</b>: <pre>
make -f Makefile.bar_u1 all
make -f Makefile.bar_u2 all
...... </pre>
		<li> build libraries using attributes defined in the
		  <i>customized makefiles</i> <b>Makefile.*.lib</b>
		  with the suffixes listed in macro <b>LIB_PROJ</b>
		<li> build application(s) using attributes defined in the
		  <i>customized makefiles</i> <b>Makefile.*.app</b> with the
		  suffixes listed in macro <b>APP_PROJ</b>
    </ul>
  <li> <a href="#ref_MakeProjTarget"><b>all_r</b></a> --
	 first make target <b>all</b>, then run <i>"make all_r"</i>
	 in all subdirectories enlisted in <i>$(SUB_PROJ)</i>: <pre>
cd bar_test       &&  make -f Makefile all_r
cd bar_sub_proj1  &&  make -f Makefile all_r
...... </pre>
  <li> <a href="#ref_MakeProjTarget"><b>clean, clean_r</b></a> --
	 run just the same makefiles but with targets <b>clean</b> and
	 <b>clean_r</b> (rather than <b>all</b> and <b>all_r</b>), respectively
  <li> <a href="#ref_MakeProjTarget"><b>purge, purge_r</b></a> --
	 .....with targets <b>purge</b> and <b>purge_r</b>, respectively
</ul>

<p>
<br>
<h4><i>Makefile</i> Targets</h4>
<a name="ref_MakeProjTarget"></a>
        The standard build targets for Toolkit <i>makefiles</i> are <b>all, clean</b> and <b>purge</b>.
        Recall that <a href="#ref_MakefilesTargets">recursive versions</a> of these
        targets exist for <i>meta-makefiles</i>.
<p>

<ul>
  <li> <b>all</b> -- compile the object modules specified in the
  <i>"$(OBJ)"</i> macro, and use them to build the library
  <i>"$(LIB)"</i> or the application <i>"$(APP)"</i>; then copy the
  resultant [<tt>lib|app</tt>] to the [<a href="#ref_TablePath"><tt>libdir|bindir</tt></a>] directory,
  respectively
  <li> <b>clean</b> -- remove all object modules and libs/apps
  that have been built by <b>all</b>
  <li> <b>purge</b> -- do <b>clean</b>, and then remove the copy
  of the [<tt>libs|apps</tt>] from the [<a href="#ref_TablePath"><tt>libdir|bindir</tt></a>] directory.
</ul>
<p>

The <i>customized makefiles</i> do not distinguish
between recursive (<b>all_r, clean_r, purge_r</b>) and
non-recursive (<b>all, clean, purge</b>) targets -- because the
recursion and multiple build is entirely up to the <a
href="#ref_MakefilesMeta"><i>meta-makefiles</i></a>.
<p>


</dl>

<hr>

<a name="ref_MakefilesMacros"></a>
<h2>Makefile Macros and <tt>Makefile.mk</tt>&nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
<a name="ref_MakeProjMk"></a>
        There is a wide assortment of configured tools, flags, third party packages and
        <a href="#ref_TablePath">paths (see above)</a>.  They can be specified for the
        whole build tree with the appropriate entry in <tt>Makefile.mk</tt>, which
        is silently included at the very beginning of the <i>customized makefiles</i>
        used to build <a href="new_proj.html#ref_MakeProjLib">libraries</a> and
        <a href="new_proj.html#ref_MakeProjApp">applications</a>.
        <p>

        Many <i>makefile</i> macros are
        supplied with defaults <tt>ORIG_*</tt> in <tt>Makefile.mk</tt>.  See the list of
        <a href="lxr/source/src/Makefile.mk.in#L86"><tt>ORIG_*</tt> macros</a>,
        and all others currently defined, in the
        <a href="lxr/source/src/Makefile.mk.in"></a> <tt>Makefile.mk.in</tt>
        template</a> for details.  One should not override these defaults
        in normal use, but add your own flags to them
        as needed in the corresponding working macro; <i>e.g.,</i> set
        <tt>CXX = $(ORIG_CXX) -DFOO_BAR</tt>.
        <p>

        <tt>Makefile.mk</tt> defines the following <i>makefile</i> macros obtained
        during the configuration process for <a href="#ref_TableFlags">flags</a>,
        <a href="#ref_MakeProjMk_FAST">system and third-party packages</a> and
        <a href="#ref_TableTools">development tools</a>:

<br></br>
<a name="ref_TableFlags"></a>
<table border=1 cellspacing=0>
<caption>Flags</caption>
  <tr class="head">
	 <th>Macro</th>
	 <th><a href="config.html#ref_TableToolsAndFlags">Source</a></th>
	 <th><a href="config.html#ref_StdBuildRules">Synopsis</a></th>
  </tr>

  <tr>
	 <td><b>CFLAGS</b></td>
	 <td><i>$CFLAGS</i></td>
	 <td>C compiler flags</td>
  </tr>

  <tr>
	 <td><b>FAST_CFLAGS</b></td>
	 <td><i>$FAST_CFLAGS</i></td>
	 <td><a href="#ref_MakeProjMk_FAST">(*)</a>
			 C compiler flags to generate faster code
    </td>
  </tr>

  <tr>
	 <td><b>CXXFLAGS</b></td>
	 <td><i>$CXXFLAGS</i></td>
	 <td>C++ compiler flags</td>
  </tr>

  <tr>
	 <td><b>FAST_CXXFLAGS</b></td>
	 <td><i>$FAST_CXXFLAGS</i></td>
	 <td><a href="#ref_MakeProjMk_FAST">(*)</a>
			 C++ compiler flags to generate faster code</td>
  </tr>

  <tr>
	 <td><b>cppFLAGS</b></td>
	 <td><i>$cppFLAGS</i></td>
	 <td>C/C++ preprocessor flags</td>
  </tr>

  <tr>
	 <td><b>DEPFLAGS</b></td>
	 <td><i>$DEPFLAGS</i></td>
	 <td>Flags for file dependency lists</td>
  </tr>

  <tr>
	 <td><b>LDFLAGS</b></td>
	 <td><i>$LDFLAGS</i></td>
	 <td>Linker flags</td>
  </tr>

  <tr>
	 <td><b>LIB_OR_DLL</b></td>
	 <td><i>@LIB_OR_DLL@</i></td>
	 <td>Specify whether to build a library as static or dynamic</td>
  </tr>

  <tr>
     <td><b>STATIC</b></td>
	 <td><i>@STATIC@</i></td>
	 <td>Library suffix to force static linkage (see
	 <a href="new_proj.html#ref_MakeProjApp">example</a>)</td>
  </tr>
</table>

<br></br>
<a name="ref_MakeProjMk_FAST"></a>
(*) The values of user-specified environment variables
    <i>$FAST_CFLAGS, $FAST_CXXFLAGS</i> will substitute the regular
    optimization flag <tt>-O</tt> (or <tt>-O2</tt>, etc.).
    For example, if in the environment:
    <i>$FAST_CXXFLAGS</i><tt>=-fast -speedy</tt> and
    <i>$CXXFLAGS</i>=<tt>-warn -O3 -std</tt>, then in makefile:
    <b>$(FAST_CXXFLAGS)</b><tt>=-warn -fast -speedy -std</tt>.


<br></br>
<a name="ref_TableThirdParty"></a>
<table border=1 cellspacing=0>
<caption>System and third-party packages</caption>
  <tr class="head">
	 <th>Macro</th>
	 <th><a href="config.html#ref_TableLocalization1">Source</a></th>
	 <th>Synopsis</th>
  </tr>

  <tr>
	 <td><b>LIBS</b></td>
	 <td><i>$LIBS</i></td>
	 <td>Default libraries to link with</td>
  </tr>

  <tr>
	 <td><b>PRE_LIBS</b></td>
	 <td><i>$PRE_LIBS</i></td>
	 <td>??? Default libraries to link with first</td>
  </tr>

  <tr>
	 <td><b>THREAD_LIBS</b></td>
	 <td><i>$THREAD_LIBS</i></td>
	 <td>Thread library <i>(system)</i></td>
  </tr>

  <tr>
	 <td><b>NETWORK_LIBS</b></td>
	 <td><i>$NETWORK_LIBS</i></td>
	 <td>Network library <i>(system)</i></td>
  </tr>

  <tr>
	 <td><b>MATH_LIBS</b></td>
	 <td><i>$MATH_LIBS</i></td>
	 <td>Math library <i>(system)</i></td>
  </tr>

  <tr>
	 <td><b>KSTAT_LIBS</b></td>
	 <td><i>$KSTAT_LIBS</i></td>
	 <td>KSTAT library <i>(system)</i></td>
  </tr>

  <tr>
	 <td><b>RPCSVC_LIBS</b></td>
	 <td><i>$RPCSVC_LIBS</i></td>
	 <td>RPCSVC library <i>(system)</i></td>
  </tr>

  <tr>
	 <td><b>SYBASE_INCLUDE</b></td>
	 <td><i>$SYBASE_INCLUDE</i></td>
	 <td>SYBASE headers</td>
  </tr>

  <tr>
	 <td><b>SYBASE_LIBS</b></td>
	 <td><i>$SYBASE_LIBS</i></td>
	 <td>SYBASE libraries</td>
  </tr>

  <tr>
	 <td><b>FASTCGI_INCLUDE</b></td>
	 <td><i>$FASTCGI_INCLUDE</i></td>
	 <td>Fast-CGI headers</td>
  </tr>

  <tr>
	 <td><b>FASTCGI_LIBS</b></td>
	 <td><i>$FASTCGI_LIBS</i></td>
	 <td>Fast-CGI libraries</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_INCLUDE</b></td>
	 <td><i>$NCBI_C_INCLUDE</i></td>
	 <td>NCBI C toolkit headers</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_LIBPATH</b></td>
	 <td><i>$NCBI_C_LIBPATH</i></td>
	 <td>Path to the NCBI C Toolkit libraries</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_ncbi</b></td>
	 <td><i>$NCBI_C_ncbi</i></td>
	 <td>NCBI C CoreLib</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_INCLUDE</b></td>
	 <td><i>$NCBI_SSS_INCLUDE</i></td>
	 <td>NCBI SSS headers</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_LIBPATH</b></td>
	 <td><i>$NCBI_SSS_LIBPATH</i></td>
	 <td>Path to NCBI SSS libraries</td>
  </tr>

  <tr>
	 <td><b>NCBI_PM_PATH</b></td>
	 <td><i>$NCBI_PM_PATH</i></td>
	 <td>Path to the PubMed package</td>
  </tr>

  <tr>
	 <td><b>ORBACUS_LIBPATH</b></td>
	 <td><i>$ORBACUS_LIBPATH</i></td>
	 <td>Path to the ORBacus CORBA libraries</td>
  </tr>

  <tr>
	 <td><b>ORBACUS_INCLUDE</b></td>
	 <td><i>$ORBACUS_LIBPATH</i></td>
	 <td>Path to the ORBacus CORBA headers</td>
  </tr>
</table>


<br></br>
<a name="ref_TableTools"></a>
<table border=1 cellspacing=0>
<caption>Compiler, Linker, and other development Tools</caption>
  <tr class="head">
	 <th>Macro</th>
	 <th><a href="config.html#ref_TableToolsAndFlags">Source</a></th>
	 <th><a href="config.html#ref_StdBuildRules">Synopsis</a></th>
  </tr>

  <tr>
	 <td><b>CC</b></td>
	 <td><i>$CC</i></td>
	 <td>C compiler</td>
  </tr>

  <tr>
	 <td><b>CXX</b></td>
	 <td><i>$CXX</i></td>
	 <td>C++ compiler</td>
  </tr>

  <tr>
	 <td><b>LINK</b></td>
	 <td><i>$CXX</i></td>
	 <td>Linker (C++-aware)</td>
  </tr>

  <tr>
	 <td><b>cpp</b></td>
	 <td><i>$cpp</i></td>
	 <td>C preprocessor</td>
  </tr>

  <tr>
	 <td><b>CXXcpp</b></td>
	 <td><i>$CXXcpp</i></td>
	 <td>C++ preprocessor</td>
  </tr>

  <tr>
	 <td><b>AR</b></td>
	 <td><i>$AR</i></td>
	 <td>Library archiver</td>
  </tr>

  <tr>
	 <td><b>STRIP</b></td>
	 <td><i>$STRIP</i></td>
	 <td>Tool to strip symbolic info from binaries</td>
  </tr>

  <tr>
	 <td><b>RM</b></td>
	 <td><i>rm -f</i></td>
	 <td>Remove file(s)</td>
  </tr>

  <tr>
	 <td><b>RMDIR</b></td>
	 <td><i>rm -rf</i></td>
	 <td>Remove file(s) and directory(ies) recursively</td>
  </tr>

  <tr>
	 <td><b>COPY</b></td>
	 <td><i>cp -p</i></td>
	 <td>Copy file (preserving the modification time)</td>
  </tr>

  <tr>
     <td><b>CC_FILTER</b></td>
	 <td><i>@CC_FILTER@</i></td>
	 <td>Filters for the C compiler</td>
  <tr>

  <tr>
     <td><b>CXX_FILTER</b></td>
	 <td><i>@CXX_FILTER@</i></td>
	 <td>Filters for the C++ compiler</td>
  <tr>

  <tr>
     <td><b>CHECK_ARG</b></td>
	 <td><i>@CHECK_ARG@</i></td>
	 <td></td>
  <tr>

  <tr>
     <td><b>LN_S</b></td>
	 <td><i>@LN_S@</i></td>
	 <td>Make a symbolic link if possible; otherwise, hard-link or copy</td>
  <tr>

  <tr>
	 <td><b>BINCOPY</b></td>
	 <td><i>@BINCOPY@</i></td>
	 <td>Copy a library or an executable -- but only if it was changed</td>
  </tr>
</table>

</dl>

<hr>

<a name="ref_MakefilesEx"></a>
<h2>Example Makefiles &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        Below are links to examples of typical <i>makefiles</i>, complete with descriptions
        of their content.
        <p>

        <ul>
            <li> Inside the Tree
                <ul>
                    <li> <a href="programming_manual/inside_tree.html#example">An example meta-makefile and its associated project makefiles</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#lib_make">Library project makefile: Makefile.myProj.lib</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#app_make">Application project makefile: Makefile.myProj.app</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#usr_make">Custom project makefile: Makefile.myProj</a> </li>
                </ul>
                <p>
                </li>
            <li> New Projects and Outside the Tree
                <ul>
                    <li> <a href="new_proj.html#ref_Outside">Use Shell Scripts to Create Makefiles</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjLib">Customized makefile to build a library</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjApp">Customized makefile to build an application</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjUsr">User-defined makefile to build... whatever</a>
                </ul>
                </li>
        </ul>

</dl>

<!--#include virtual="./ssi/navlinks.shtml" -->

<table border=0 width="607" cellspacing=0>
<script>
<!--
print_author('cpp-core', 'Denis Vakatov', '$Date$', 'ncbi.nlm.nih.gov');
print_author('cpp-core', 'Chris Lanczycki');
print_author('cpp-core', 'Eugene Vasilchenko');
print_author('cpp-core', 'Anton Lavrentiev');
print_author('cpp-core', 'Diane Zimmerman');
print_author('cpp-core', 'Lewis Geer');
// -->
</script>
</table>

<!--#include virtual="./ssi/footer.shtml" -->
