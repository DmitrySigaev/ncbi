<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.76 [en] (X11; U; SunOS 5.7 sun4u) [Netscape]">
   <title>NCBI C++ Toolkit -- F.A.Q.</title>
</head>
<body>

<h1>
NCBI C++ Toolkit -- F. A. Q.</h1>

<hr><!-- **************************************************************** -->
<ol>
<li>
<a href="#ref_CannotFindSymbol">Linker complains it <i>"cannot find symbol"</i>
in something like:
<i>SunWS_cache/CC_obj_b/bXmZkg3zX5VBJvYgjABX.o</i></a></li>

<li><a href="#ref_CannotFindSer">The linker complains about undefined symbols Nlm_MemGet, AsnIoNew, Nlm_MemFree, Nlm_MemCopy, and AsnIoClose in libxser.a"</a></li>

<li><a href="#ref_CannotFindObjectSymbol">How does one find the libraries to link when the linker complains of undefined symbols</a></li>

<li>
<a href="#ref_HowMakeDep">MAKE complains it does not know "<i>how to make
target: /home/qqq/c++/WorkShop6-Debug/lib/.seqset.dep</i>"</a></li>

<li>
<a href="#ref_LastResort">Still getting bizarre errors with unresolved
symbols, unfound libraries, etc., and nothing seems to help out much</a></li>

<li>
<a href="#ref_CannotFindGetTypeInfo">The GetTypeInfo() method is not declared or defined in any of the objects for which it is part of the interface.</a></li>

<li><a href="#ref_WhichIncludeFile">Which include file should be used in *.cpp files, <i>class</i>.hpp or <i>class_</i>.hpp?</a></li>

<li><a href="#ref_AddingASN">How to add new ASN.1 module from the C Toolkit to the C++ Toolkit?</a></li>

</ol>


<hr><!-- **************************************************************** -->
<h4>
<a NAME="ref_CannotFindSymbol"></a>Linker complains it <i>"cannot find
symbol"</i> in something like:
<i>SunWS_cache/CC_obj_b/bXmZkg3zX5VBJvYgjABX.o</i></h4>
Go to the relevant build dir, clean and rebuild everything using:
<pre>&nbsp;&nbsp; cd /home/qqq/c++/WorkShop6-Debug/build/FooBar
&nbsp;&nbsp; make purge_r all_r</pre><br>

<hr><h4><a NAME="ref_CannotFindSer">The linker complains about undefined symbols
Nlm_MemGet, AsnIoNew, Nlm_MemFree, Nlm_MemCopy, and  AsnIoClose in libxser.a.</h4>
The cause of this error is that the serialization library, by default, links in some code that references the 
C Toolkit library. You must link in the C Toolkit library by putting the following into your make file:<br>
<pre>
CPPFLAGS = $(ORIG_CPPFLAGS) \
  $(NCBI_C_INCLUDE) \

LIBS = \
  $(NCBI_C_LIBPATH) -lncbi
  $(ORIG_LIBS)
</pre>
If you are using the make file created by new_project.sh, then just uncomment the applicable lines.<br><br>

<hr><h4><a NAME="ref_CannotFindObjectSymbol"></a>How does one find the libraries to link when the linker complains of undefined symbols</h4>
For example, the linker may complain about the symbol <i>ncbi::objects::CSeq_id::GetTypeInfo(void)</i> being undefined. 
The cause of this problem is that the applicable objects library has not been linked into the application. You 
determine the applicable objects library as follows: <br><br>1) Look for the *.hpp file that declares the applicable class
(e.g., for CSeq_id this will be include/objects/seqloc/Seq_id.hpp). This can be done by going to the <a href="http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/ident?i=CSeq_id">source browser</a> and doing
an identifier search on the class name (e.g., CSeq_id) and looking in the <b>Defined as a class</b> section for the path name. <br><br>2) Note the name of the sub directory in which the *.hpp file is located (in this case the sub directory is seqloc). <br><br>3) The name of the library to link is determined from the sub directory name. In the make file add the library name to the LIB macro (e.g., LIB = <b>seqloc</b> xncbi) or add -l<b>subdir</b> (e.g.,
-lseqloc) to the command line of the link command. 
<br><br>The above describes how to find the libraries for classes in sub directories of the <b>object/</b> directory. A similar techniques works for other classes also. However, in a some cases, the library name is a variant on the sub directory name. These variants are summarized below.
<table>
<tr><th align=left>Directory<th align=left>Library
<tr><td>corelib/test<td>test_mt
<tr><td>corelib<td>xncbi
<tr><td>ctools/asn<td>xasn
<tr><td>cgi<td>xcgi or xfcgi
<tr><td>connect<td>xconnect
<tr><td>connect/test<td>xconntest
<tr><td>ctools<td>xctools
<tr><td>html<td>xhtml
<tr><td>objects/objmgr<td>xobjmgr
<tr><td>serial<td>xser
<tr><td>util<td>xutil
</table>
<br><br>Note: The C++ toolkit libraries have dependencies on each other. For example, symbols defined in seqfeat (libseqfeat.a) are referenced in library mmdb1 (libmmdb1.a). In this case you most link seqfeat after mmdb1.
 
<hr>
<h4>
<a NAME="ref_HowMakeDep"></a>MAKE complains it does not know "<i>how to
make target: /home/qqq/c++/WorkShop6-Debug/lib/.seqset.dep</i>"</h4>
This means that the "lib<b>seqset</b>.a" library is not built. To build
it:
<pre>&nbsp;&nbsp; cd /home/qqq/c++/WorkShop6-Debug/build/objects/<i>seqset</i>/
&nbsp;&nbsp; make</pre>

<hr>
<h4>
<a NAME="ref_LastResort"></a>Still getting bizarre errors with unresolved
symbols, unfound libraries, etc., and nothing seems to help out much</h4>
As the last resort, try to CVS update, reconfigure, clean and rebuild everything:
<pre>&nbsp;&nbsp; cd /home/qqq/c++/
&nbsp;&nbsp; cvs -q upd -d
&nbsp;&nbsp; compilers/WorkShop6.sh 32 ........
&nbsp;&nbsp; make purge_r
&nbsp;&nbsp; make all_r</pre>

<hr>
<h4>
<a NAME="ref_CannotFindGetTypeInfo"></a>The GetTypeInfo() method is not declared or defined in any of the objects for which it is part of the interface.</h4>The macro DECLARE_INTERNAL_TYPE_INFO() is used in the *.hpp files to declare the GetTypeInfo(). There are several macros that are used to implement GetTypeInfo() methods in *.cpp files. These macros are generally named and used as follows:<br>
<pre>
BEGIN_*_INFO(...)
{
  ADD_*(...)
  ...
}
</pre>
See <a href = "programming_manual/usrtypeinfo.html"><b>User-defined Type Information</b> in the <i>Programming Manual</i></a> for more information.

<hr>
<h4><a NAME="ref_WhichIncludeFile"></a>Which include file should be used in *.cpp files, <i>class</i>.hpp or <i>class_</i>.hpp?</h4>Include the <i>class</i>.hpp (file without underscore). Never instantiate or use a class of the form C*_Base directly. Instead use the C* form which inherits from the C*_Base class (e.g., don't use CSeq_id_Base directly -- use CSeq_id instead).
<hr><!-- **************************************************************** -->
<h4>
<a NAME="ref_AddingASN">How to add new ASN.1 module from the C Toolkit to the C++ Toolkit?</a></i></h4>

This is a step-by-step history of adding the <b>"cdd"</b> ASN.1 specification
originally located in the C Toolkit, <i>$CVSROOT/distrib/biostruc/cdd/cdd.asn</i>:

<ol>
		<li>
		  Create directories in your local C++ Toolkit tree.
		  For example, if your local C++ Toolkit tree is in <i>"~/c++"</i>:
		  <tt>
		  <ul>
			 <li> mkdir ~/c++/include/objects/cdd </li>
			 <li> mkdir ~/c++/src/objects/cdd </li>
		  </ul>
		  </tt>
		</li>

		<li>
		  Check-in the created dirs to CVS, and copy ASN.1 spec to the
        new C++ Toolkit CVS repository:
		  <tt>
		  <ul>
			 <li> cd ~/c++/include/objects ; cvs ci -m "" cdd </li>
			 <li> cd ~/c++/src/objects ; cvs ci -m "" cdd </li>
			 <li> cp -p $CVSROOT/distrib/biostruc/cdd/cdd.asn,v $CVSROOT/internal/c++/src/objects/cdd/cdd.asn,v </li>
			 <li> cd ~/c++/src/objects/cdd ; cvs update </li>
		  </ul>
		  </tt>
		</li>

		<li>
		  Add <i>"cdd.asn"</i> CVS location to the C/C++ ASN.1 sync. dir.-list.
		  <br> <b><i>c++/scripts/internal/c_toolkit/sync_asn.sh</i></b>:
		  <br>
		  <tt>
			 <i>SEARCH_DIRS='............. distrib/biostruc/cdd'</i>
		  </tt>
		  <br>
		</li>

		<li>
		  Add <i>"cdd"</i> to the list of modules used to generate
        serialization classes from ASN.1 specs in the C++ Toolkit.
		  <ul>
			 <li>
				[UNIX] <b><i>c++/src/objects/Makefile</i></b>:
				<br>
				<tt>
				  <i>MODULES = ............... cdd.asn</i>
				</tt>
			 </li>
			 <li>
				[NT] <b><i>c++/src/objects/nt_sources.sh</i></b>:
				<br>
				<tt>
				  <i>MODULES='............... cdd.asn'</i>
				</tt>
			 </li>
		  </ul>
		</li>

		<li>
		  Create so-called <i>module file</i> that specifies the location
		  of this ASN.1 spec, and locations of ASN.1 specs imported by
		  <i>"cdd.asn"</i>.
		  <br> <b><i>c++/src/objects/cdd/cdd.module</i></b>:
		  <tt>
			 <i>
				<br> MODULE_PATH = objects/cdd
				<br> MODULE_IMPORT = objects/general/general ..... objects/cn3d/cn3d
				</i>
		  </tt>
		</li>

		<li>
		  Create <i>meta-makefile</i> for the <b>"cdd"</b> project.
		  <br> <b><i>c++/src/objects/cdd/Makefile.in</i></b>:
		  <tt>
			 <i>
				<br> LIB_PROJ = cdd
				<br> srcdir = @srcdir@
				<br> include @builddir@/Makefile.meta
				</i>
		  </tt>
		</li>

		<li>
		  Add <b>"cdd"</b> project to the list of buildable projects.
		  <ul>
			 <li>
				[UNIX] <b><i>c++/src/objects/Makefile.in</i></b>:
				<tt>
				  <i>
					 <br> SUB_PROJ = ........ cdd
				  </i>
				</tt>
			 </li>
			 <li>
				[MSVC] <b><i>c++/compilers/msvc_prj/ncbi_cpp.dsw</i></b>:
				<br>
				Create library project <b>"objects_cdd"</b> containing
				source files <i>c++/src/objects/cdd/cdd__.cpp</i> and
				<i>c++/src/objects/cdd/cdd___.cpp</i> in the workspace
				<b>'objects_cdd'</b>.
				<br>
				The project file location should be:
				<b><i>c++/compilers/msvc_prj/objects/cdd/objects_cdd.dsp</i></b>
				<br>
				Then, add project <b>"objects_cdd"</b> as a dependency to the
            utility project <b>"all_objects_libs"</b>.
			 </li>
		  </ul>
		</li>

		<li>
		  Test it out -- try to build.
		</li>

		<li>
		  Now, commit the affected files back into CVS:
		  <i>
		  <ul>
			 <li>
				c++/scripts/internal/c_toolkit/<b>sync_asn.sh</b>
			 </li>
			 <li>
				c++/src/objects/<b>Makefile</b>
			 </li>
			 <li>
				c++/src/objects/<b>Makefile.in</b>
			 </li>
			 <li>
				c++/src/objects/<b>nt_sources.sh</b>
			 </li>
			 <li>
				c++/src/objects/cdd/<b>cdd.module</b>  <tt>[new file]</tt>
			 </li>
			 <li>
				c++/src/objects/cdd/<b>Makefile.in</b>  <tt>[new file]</tt>
			 </li>
			 <li>
				c++/compilers/msvc_prj/objects/<b>cdd/</b>  <tt>[new directory]</tt>
			 </li>
			 <li>
				c++/compilers/msvc_prj/objects/cdd/<b>objects_cdd.dsp</b>  <tt>[new file]</tt>
			 </li>
			 <li>
				c++/compilers/msvc_prj/<b>ncbi_cpp.dsw</b>
			 </li>
		  </ul>
		</i>
		</li>
</ol>


<!-- **************************************************************** -->
<br>
<p>
<hr>
<table BORDER=0 CELLSPACING=0 WIDTH="100%" >
<tr>
<td>
<address>
<a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address>
</td>

<td><!-- <td align=center><i>$Revision$</i></td> --></td>

<td ALIGN=RIGHT>($Date$)</td>
</tr>
</table>

</body>
</html>
