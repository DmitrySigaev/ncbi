<!-- $Id$ -->
<!--#set var="TITLE" value="NCBI C++ Toolkit:  Working with Makefiles" -->
<!--#set var="HEADING" value="Working with Makefiles" -->
<!--#set var="DOCROOT" value="." -->
<!--#include virtual="./ssi/header.shtml" -->

<a name="ref_MakefilesTop"></a>

<ul>
<li> <b> <a href="#ref_MakefilesOverview">Overview</a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesHier">Makefile Hierarchy</a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesMeta">Meta-Makefiles</a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesProj">Project Makefiles </a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesTargets">Standard Build Targets</a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesMacros">Makefile Macros and Makefile.mk</a> </b><!--NCBI_MARK--></li>
<li> <b> <a href="#ref_MakefilesEx">Example Makefiles</a> </b><!--NCBI_MARK--></li>
</ul>

<p>
<hr>

<a name="ref_MakefilesOverview"></a>
<h2>Overview &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        Building executables and libraries for a large, integrated set of software tools like
        the C++ Toolkit, and doing so consistently on different platforms and architectures,
        is a daunting task.  Therefore, the Toolkit developers have expended considerable
        effort to design a build system based upon the <span class="ncbi_util">make</span> utility as controlled by
        <span class="ncbi_term">makefiles</span>.   While it is of course possible to write one's own Toolkit <span class="ncbi_term">makefile</span> from scratch,
        it is seldom desirable.  To take advantage of Toolkit experience, wisdom and alchemy
        to help avoid often inscrutable compilation issues:
        <p>

        <blockquote>
            <em>we strongly advise users to work with the Toolkit's make system</em>
        </blockquote>
        <p>

        <p>

        With minimal manual editing (and after invoking the
        <a href="config.html"><span class="ncbi_script">configure</span></a> script in your build tree) the build system adapts to
        your environment, compiler options, defines all relevant <span class="ncbi_term">makefile</span> macros and targers, allows for
        recursive builds of the entire Toolkit and targetted builds of single modules,
        and handles many other details that can confound manual builds.
        Before describing the make system in detail, we list the major
        types of <span class="ncbi_term">makefiles</span> employed by the Toolkit.
        <p>

        <ul>
            <li> <b><span class="ncbi_term">meta-makefiles</span></b><!--NCBI_MARK-->
                <br> These files exist for each project and tie together project in the Toolkit
                hierarchy, defining those applications and libraries a project is responsible
                for (possibly recursively) building.
            <li> <b>Generic <span class="ncbi_term">makefile</span> Templates</b><!--NCBI_MARK--> (<span class="ncbi_file">Makefile*.in</span>)
                <br> The <span class="ncbi_script">configure</span> script processes these files from the <span class="ncbi_dir">src</span>
                hierarchy to substitute for the special tags <span class="ncbi_conf_var">"@some_name@"</span> and make
                other specializations required for a given project.  Note that <span class="ncbi_term">meta-makefiles</span>
                are typically derived from such templates.
            <li> <b>Customized <span class="ncbi_term">makefiles</span></b><!--NCBI_MARK--> (<span class="ncbi_file">Makefile.*.[lib|app]</span>)
                <br> For each library or application, this file gives specific targets, compiler
                flags, and other project-specific build instructions.  These files appear
                in the <span class="ncbi_dir">src</span> hierarchy.
            <li> <b>Configured <span class="ncbi_term">makefiles</span></b><!--NCBI_MARK--> (<span class="ncbi_file">Makefile</span>)
                <br> A <span class="ncbi_term">makefile</span> generated by <span class="ncbi_script">configure</span> for each project
                and sub-project and placed in the appropriate location in the
                build tree ready for use will be called a '<span class="ncbi_term">configured makefile</span>'.
                Note that <span class="ncbi_term">meta-makefiles</span> in the build tree may be considered 'configured'.
        </ul>


</dl>
<p>

<hr>

<a name="ref_MakefilesHier"></a>
<h2>Makefile Hierarchy &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        All Toolkit <span class="ncbi_term">makefiles</span> reside in either the <span class="ncbi_dir">src</span> directory as templates
        or customized files, or in the appropriate configured form in each of your <span class="ncbi_dir">&lt;builddir&gt;</span>
        hierarchies as illustrated below<br>
        <center><img SRC="programming_manual/make.gif" ></center>
        <p>

        In the figure, most of the files listed are templates from the <span class="ncbi_dir">src</span> directory with
        each corresponding <span class="ncbi_term">configured makefile</span> at the top of the build tree.  Of these,
        <span class="ncbi_file">&lt;builddir&gt;/Makefile</span> can be considered the master <span class="ncbi_term">makefile</span>
        in that it can recursively build the entire Toolkit.
        The role of each top-level <span class="ncbi_term">makefile</span> templates is summarized as follows:
<p>

        <ul>
            <li> <b><span class="ncbi_file">Makefile.in</span></b><!--NCBI_MARK--> -- makefile to perform a recursive build in all project subdirectories
            <li> <b><span class="ncbi_file">Makefile.meta.in</span></b><!--NCBI_MARK--> -- included by all makefiles that provide both local and recursive builds
            <li> <b><span class="ncbi_file">Makefile.mk.in</span></b><!--NCBI_MARK--> -- included by all makefiles; sets a lot of configuration variables
            <p>
            <li> <b><span class="ncbi_file">Makefile.lib.in</span></b><!--NCBI_MARK--> -- included by all makefiles that perform a "standard" library build, when building only static libraries.
            <li> <b><span class="ncbi_file">Makefile.dll.in</span></b><!--NCBI_MARK--> -- included by all makefiles that perform a "standard" library build, when building only shared libraries.
            <li> <b><span class="ncbi_file">Makefile.both.in</span></b><!--NCBI_MARK--> -- included by all makefiles that perform a "standard" library build, when building both static and shared libraries.
            <li> <b><span class="ncbi_file">Makefile.lib.tmpl.in</span></b><!--NCBI_MARK--> -- serves as a template for the project <span class="ncbi_term">customized makefiles</span>
              (<b><span class="ncbi_file">Makefile.*.lib[.in]</span></b><!--NCBI_MARK-->) that perform a "standard" library build
            <li> <b><span class="ncbi_file">Makefile.app.in</span></b><!--NCBI_MARK--> -- included by all makefiles that perform a "standard" application build
            <li> <b><span class="ncbi_file">Makefile.lib.tmpl.in</span></b><!--NCBI_MARK--> -- serves as a template for the project <span class="ncbi_term">customized makefiles</span>
              (<b><span class="ncbi_file">Makefile.*.app[.in]</span></b><!--NCBI_MARK-->) that perform a "standard" application build
            <li> <b><span class="ncbi_file">Makefile.rules.in, Makefile.rules_with_autodep.in</span></b><!--NCBI_MARK--> -- instructions for building object files; included by most other makefiles
        </ul>
        <p>

        The project-specific portion of the <span class="ncbi_term">makefile</span> hierarchy is represented in the figure by the
        <span class="ncbi_term">meta-makefile</span> template <span class="ncbi_file">c++/src/myProj/Makefile.in</span>, the <span class="ncbi_term">customized makefile</span>
        <span class="ncbi_file">c++/src/myProj/Makefile.myProj.[app|lib]</span>
        (not shown), and the <span class="ncbi_term">configured makefile</span> <span class="ncbi_file">c++/myBuild/build/myProj/Makefile</span>.
        In fact, every project and
        sub-project in the Toolkit has analogous files specialized to its project; in most
        circumstances, every new or user project should emulate this file structure to be
        compatible with the make system.

</dl>

<hr>

<a name="ref_MakefilesMeta"></a>
<h2>Meta-Makefiles &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>

A typical <span class="ncbi_term">meta-makefile</span> template(e.g. <span class="ncbi_file">Makefile.in</span> in your
<span class="ncbi_dir">foo/c++/src/bar_proj/</span> dir) looks like this:
<blockquote>
<pre class="ncbi_code">
# Supply Makefile.bar_u1, Makefile.bar_u2 ...
#
USR_PROJ = bar_u1 bar_u2 ...

# Supply Makefile.bar_l1.lib, Makefile.bar_l2.lib ...
#
LIB_PROJ = bar_l1 bar_l2 ...

# Supply Makefile.bar_a1.app, Makefile.bar_a2.app ...
#
APP_PROJ = bar_a1 bar_l2 ...

# Subprojects
#
SUB_PROJ = app sub_proj1 sub_proj2

srcdir = @srcdir@
include @builddir@/Makefile.meta
</pre>
</blockquote>

This template separately specifies instructions for user, library and application
projects, along with a set of three sub-projects that can be made.
The mandatory final two lines <span class="ncbi_code">"srcdir = @srcdir@ ; include @builddir@/Makefile.meta"</span>
define the <a href="#ref_MakefilesTargets">standard build targets</a>.
<p>


<a NAME="ref_MakefileIn"></a>
<h4>Makefile.in meta files</h4>
The <span class="ncbi_file">Makefile.in</span> meta file in the project's source directory defines
a kind of road map that will be used by the <span class="ncbi_script">configure</span> script to
generate a makefile (<span class="ncbi_file">Makefile</span>) in the corresponding directory of
the <span class="ncbi_term">build tree</span>. <span class="ncbi_file">Makefile.in</span> does <em>not</em> participate in
the actual execution of <span class="ncbi_util">make</span>, but rather, defines what will happen
at that time by directing the <span class="ncbi_script">configure</span> script in the creation of
the <span class="ncbi_file">Makefile</span> that will be executed (see also the
description of <a href="#ref_MakefilesTargets">Makefile
targets</a> below).
<p>

The meta-makefile <span class="ncbi_file">myProj/Makefile.in</span> should define at least one
of the following macros:
<p>

<ul>
<li>
<a NAME="musr"></a><span class="ncbi_make_var">USR_PROJ</span> (optional) - a list of names
for user-defined makefiles.</li>

<br>This macro is provided for the usage of ordinary stand-alone makefiles
which do not utilize the make commands contained in additional makefiles
in the top-level <span class="ncbi_dir">build</span> directory. Each <span class="ncbi_value">p_i</span> listed in <span class="ncbi_code">USR_PROJ
= p_1 ... p_N</span> must have a corresponding
<a href="#usr_make">Makefile.p_i</a>
in the project's source directory. When <span class="ncbi_util">make</span> is executed, the <span class="ncbi_util">make</span>
directives contained in these files will be executed directly to build
the targets as specified.
<br>&nbsp;
<br>&nbsp;
<li>
<a NAME="mlib"></a><span class="ncbi_make_var">LIB_PROJ</span> (optional) - a list of names
for library makefiles.</li>

<br>For each library <span class="ncbi_value">l_i</span> listed in <span class="ncbi_code">LIB_PROJ = l_1 ... l_N</span>,
you must have created a corresponding project makefile named <a href="#lib_make">Makefile.l_i.lib</a>
in the project's source directory. When <span class="ncbi_util">make</span> is executed, these
library project makefiles will be used along with <span class="ncbi_file">Makefile.lib</span> and
<span class="ncbi_file">Makefile.lib.tmpl</span> (located in the top-level of the <span class="ncbi_term">build tree</span>) to build the specified libraries.
<br>&nbsp;
<br>&nbsp;
<li>
<a name="masn"></a><span class="ncbi_make_var">ASN_PROJ</span> (optional) is like
<span class="ncbi_make_var">LIB_PROJ</span>, with one additional feature: Any projects listed
there will be interpreted as the names of ASN.1 module specifications
to be processed by <a href="tools/datatool/datatool.html">datatool</a>.
<br>&nbsp;
<br>&nbsp;

<li>
<a NAME="mapp"></a><span class="ncbi_make_var">APP_PROJ</span> (optional) - a list of names
for application makefiles.</li>

<br>Similarly, each application (<span class="ncbi_value">p1, p2, ..., pN</span>) listed under <span class="ncbi_make_var">APP_PROJ</span>
must have a corresponding project makefile named <a href="#app_make">Makefile.p*.app</a>
in the project's source directory. When <span class="ncbi_util">make</span> is executed, these
application project makefiles will be used along with <span class="ncbi_file">Makefile.app</span>
and <span class="ncbi_file">Makefile.app.tmpl</span> to build the specified executables.
<br>&nbsp;
<br>&nbsp;
<li>
<a NAME="msub"></a><span class="ncbi_make_var">SUB_PROJ</span> (optional) - a list of names
for subproject directories (used on recursive makes).</li>

<br>The <span class="ncbi_make_var">SUB_PROJ</span> macro is used to recursively define <span class="ncbi_util">make</span>
targets; items listed here define the subdirectories rooted in the project's
source directory where <span class="ncbi_util">make</span> should also be executed.</ul>
<p>

Some additional <span class="ncbi_term">meta-makefile</span> macros (listed in the table below)
exist to specify various directory paths that <span class="ncbi_util">make</span> needs to know.
The "@"-delimited tokens
are substituted during configuration based on your environment and any
command-line options passed to <span class="ncbi_script">configure</span>.
<p>

<br></br>
<a name="ref_TablePath"></a>
<table border=1 cellspacing=0>
<caption>Path Specification Makefile Macros</caption>
  <tr class="head">
     <th>Macro</th>
     <th>Source</th>
     <th>Synopsis</th>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">top_srcdir</span></td>
     <td><span class="ncbi_conf_var">@top_srcdir@</span></td>
     <td>Path to the whole NCBI C++ package</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">srcdir</span></td>
     <td><span class="ncbi_conf_var">@srcdir@</span></td>
     <td>Directory in the <span class="ncbi_term">source tree</span> that corresponds to the
        directory (<span class="ncbi_dir">./</span>) in the <span class="ncbi_term">build tree</term> where the
        build is currently going on
    </td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">includedir</span></td>
     <td><span class="ncbi_conf_var">@includedir@</span></td>
     <td>Top include directory in the <span class="ncbi_term">source tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">build_root</span></td>
     <td><span class="ncbi_conf_var">@build_root@</span></td>
     <td>Path to the whole <span class="ncbi_term">build tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">builddir</span></td>
     <td><span class="ncbi_conf_var">@builddir@</span></td>
     <td>Top build directory inside the <span class="ncbi_term">build tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">incdir</span></td>
     <td><span class="ncbi_conf_var">@incdir@</span></td>
     <td>Top include directory inside the <span class="ncbi_term">build tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">libdir</span></td>
     <td><span class="ncbi_conf_var">@libdir@</span></td>
     <td>Libraries built inside the <span class="ncbi_term">build tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">bindir</span></td>
     <td><span class="ncbi_conf_var">@bindir@</span></td>
     <td>Executables built inside the <span class="ncbi_term">build tree</span></td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">status_dir</span></td>
     <td><span class="ncbi_conf_var">@status_dir@</span></td>
     <td>Configuration status files</i></td>
  </tr>
</table>


<p>
<br>
<a name="ref_Expendable"></a>
<h4>Expendable projects</h4>
By default, failure of any project will cause make to exit immediately.
Although this behavior can save a lot of time, it is not always
desirable.  One way to avoid it is to run <span class="ncbi_cmd">make -k</span> rather than
<span class="ncbi_cmd">make</span>, but then major problems affecting a large portion of
the build will still waste a lot of time.

<p>
Consequently, the toolkit's build system supports an alternative
approach: <a href="#ref_MakefilesMeta"><span class="ncbi_term">meta-makefiles</span></a> can define
<span class="ncbi_term">expendable</span> projects which should be built if possible but are
allowed to fail without interrupting the build.  The way to do this is
to list such projects in <span class="ncbi_make_var">EXPENDABLE_*_PROJ</span> rather than <span class="ncbi_make_var">*_PROJ</span>.


</dl>

<hr>

<a name="ref_MakefilesProj"></a>
<h2>Project Makefiles  &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
When beginning a new project, the <a href="new_proj.html#ref_OutsideCreate" class="ncbi_script">new_project.sh</a> shell
        script will generate an initial <span class="ncbi_term">makefile</span> <span class="ncbi_file">Makefile.&lt;project_name&gt;_app</span>
        that you can modify as needed.  In addition, a working sample application can also be checked out to
        experiment with or as an alternate template.
        <p>

        The <a href="new_proj.html#ref_OutsideImport" class="ncbi_script">import_projects.sh</a> script is
        useful for working on existing Toolkit projects without needing to build the whole Toolkit.
        In this case things are particularly straightforward as the project will be retrieved complete
        with its <span class="ncbi_term">makefile</span> already configured as <span class="ncbi_file">Makefile.&lt;project_name&gt;_[app|lib]</span>.
        (Note that there is an underscore in the name, not a period as in the similarly-named
        <span class="ncbi_term">customizable makefile</span> from which the configured file is derived.)
        <p>

        <dl>
            <dt><b>If you are working outside of the source tree:</b><!--NCBI_MARK-->
            <dd>
                In this scenario you are only linking to the Toolkit libraries and
                will not need to run the <span class="ncbi_script">configure</span> script, so a <span class="ncbi_file">Makefile.in</span>
                template <span class="ncbi_term">meta-makefile</span> is not required.<br>
                Some of the typical edits required for the <span class="ncbi_term">customized makefile</span> are shown
                in the <a href="programming_manual/outside_tree.html#makefiles">programming manual</a>.
                <p>

            <dt><b>If you are working within the source tree or subtree:</b><!--NCBI_MARK-->
            <dd>
                Project subdirectories that do not contain any <span class="ncbi_file">*.in</span> files are
                ignored by the <span class="ncbi_script">configure</span> script.  Therefore, you will now also need to
                create a <span class="ncbi_term">meta-makefile</span> for the newly created project before
                configuring your <span class="ncbi_dir">build</span> directory to include the new project.<br>
                Several examples are detailed on the
                "<a href="new_proj.html#ref_MakeProjLib">Starting New Projects</a>" page.
        </dl>


<p>
<br>
<a name="ref_Packages"></a>
<h4>List of optional packages, features and projects</h4>
Here are the keywords you can list in REQUIRES in a customized
<a href="new_proj.html#ref_MakeProjApp">application</a> or
<a href="new_proj.html#ref_MakeProjLib">library</a> makefile, along with the corresponding
<a href="config.html#ref_ProhibitPackage">configure options</a>:

<p>

<table border=1 cellspacing=0>
 <tr class="head">
  <th>Keyword</th>
  <th align=left>Optional...</th>
  <th>Configure option(s)</th>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...package</th>
  <th></th>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">Sybase</span></td>
  <td>Sybase libraries</td>
  <td><span class="ncbi_conf_flag">--without-sybase, --with-sybase-local(=DIR), --with-sybase-new</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">FreeTDS</span></td>
  <td>FreeTDS libraries</td>
  <td><span class="ncbi_conf_flag">--without-ftds, --with-ftds=DIR</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">Fast-CGI</span></td>
  <td>Fast-CGI library</td>
  <td><span class="ncbi_conf_flag">--without-fastcgi</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">FLTK</span></td>
  <td>the Fast Light ToolKit</td>
  <td><span class="ncbi_conf_flag">--without-fltk, --with-fltk=DIR</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">wxWindows</span></td>
  <td>wxWindows</td>
  <td><span class="ncbi_conf_flag">--without-wxwin, --with-wxwin=DIR</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">C-Toolkit</span></td>
  <td>NCBI C Toolkit</td>
  <td><span class="ncbi_conf_flag">--without-ncbi-c</span></td>
 </tr>


 <tr>
  <td><span class="ncbi_keyword">SSSDB</span></td>
  <td>NCBI SSS DB library</td>
  <td><span class="ncbi_conf_flag">--without-sssdb, --without-sss</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">SSSUTILS</span></td>
  <td>NCBI SSS UTILS library</td>
  <td><span class="ncbi_conf_flag">--without-sssutils, --without-sss</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">GEO</span></td>
  <td>NCBI GEO libraries</td>
  <td><span class="ncbi_conf_flag">--without-geo</span></td>
 <tr>

 <tr>
  <td><span class="ncbi_keyword">SP</span></td>
  <td>SP libraries</td>
  <td><span class="ncbi_conf_flag">--without-sp</span></td>
 <tr>

 <tr>
  <td><span class="ncbi_keyword">PubMed</span></td>
  <td>NCBI PubMed libraries</td>
  <td><span class="ncbi_conf_flag">--without-pubmed</span></td>
 <tr>

 <tr>
  <td><span class="ncbi_keyword">ORBacus</span></td>
  <td>ORBacus CORBA</td>
  <td><span class="ncbi_conf_flag">--without-orbacus, --with-orbacus=DIR</span></td>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...feature</th>
  <th> </th>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">MT</span></td>
  <td>multithreading is available</td>
  <td><span class="ncbi_conf_flag">--with-mt</span></td>
 </tr>

 <tr class="shade">
  <th> </th>
  <th>...project(s)</th>
  <th> </th>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">serial</span></td>
  <td>ASN.1/XML serialization library and datatool</td>
  <td><span class="ncbi_conf_flag">--without-serial</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">ctools</span></td>
  <td>projects based on the NCBI C toolkit</td>
  <td><span class="ncbi_conf_flag">--without-ctools</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">gui</span></td>
  <td>projects that use the wxWindows GUI package</td>
  <td><span class="ncbi_conf_flag">--without-gui</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">objects</span></td>
  <td>libraries to serialize ASN.1/XML objects</td>
  <td><span class="ncbi_conf_flag">--with-objects</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">app</span></td>
  <td>standalone applications like ID1_FETCH</td>
  <td><span class="ncbi_conf_flag">--with-app</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">internal</span></td>
  <td>all internal projects</td>
  <td><span class="ncbi_conf_flag">--with-internal</span></td>
 </tr>

 <tr>
  <td><span class="ncbi_keyword">local_lbsm</span></td>
  <td>IPC with locally running LBSMD</td>
  <td><span class="ncbi_conf_flag">--without-local-lbsm</span></td>
 </tr>
</table>


</dl>

<hr>

<a name="ref_MakefilesTargets"></a>
<h2>Standard Build Targets &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
<a name="ref_MakefilesMetaTargets"></a>
<h4>Meta-Makefile Targets</h4>
        The mandatory lines from the <a href="#ref_MakefilesMeta"><span class="ncbi_term">meta-makefile</span> example above</a>,

<pre class="ncbi_code">
srcdir = @srcdir@
include @builddir@/Makefile.meta
</pre>
        provide the build rules for the following standard <span class="ncbi_term">meta-makefile</span> targets:
<ul>
  <li> <a href="#ref_MakeProjTarget"><span class="ncbi_make_flag">all</span></a>:
    <ul>
        <li> run <span class="ncbi_cmd">"make  -f {Makefile.*} all"</span> for the makefiles
          with the suffixes listed in macro <span class="ncbi_make_var">USR_PROJ</span>: 
<pre class="ncbi_code">
make -f Makefile.bar_u1 all
make -f Makefile.bar_u2 all
...... </pre>
        <li> build libraries using attributes defined in the
          <span class="ncbi_term">customized makefiles</span> <span class="ncbi_file">Makefile.*.lib</span>
          with the suffixes listed in macro <span class="ncbi_make_var">LIB_PROJ</span>
        <li> build application(s) using attributes defined in the
          <span class="ncbi_term">customized makefiles</span> <span class="ncbi_file">Makefile.*.app</span> with the
          suffixes listed in macro <span class="ncbi_make_var">APP_PROJ</span>
    </ul>
  <li> <a href="#ref_MakeProjTarget"><span class="ncbi_make_flag">all_r</span></a> --
     first make target <span class="ncbi_make_flag">all</span>, then run <span class="ncbi_cmd">"make all_r"</span>
     in all subdirectories enlisted in <span class="ncbi_make_var">$(SUB_PROJ)</span>: 
<pre class="ncbi_code">
cd bar_test       &&  make -f Makefile all_r
cd bar_sub_proj1  &&  make -f Makefile all_r
...... </pre>
  <li> <a href="#ref_MakeProjTarget"><span class="ncbi_make_flag">clean, clean_r</span></a> --
     run just the same makefiles but with targets <span class="ncbi_make_flag">clean</span> and
     <span class="ncbi_make_flag">clean_r</span> (rather than <span class="ncbi_make_flag">all</span> and <span class="ncbi_make_flag">all_r</span>), respectively
  <li> <a href="#ref_MakeProjTarget"><span class="ncbi_make_flag">purge, purge_r</span></a> --
     .....with targets <span class="ncbi_make_flag">purge</span> and <span class="ncbi_make_flag">purge_r</span>, respectively
</ul>

<p>
<br>
<h4>Makefile Targets</h4>
<a name="ref_MakeProjTarget"></a>
        The standard build targets for Toolkit <span class="ncbi_term">makefiles</span> are <span class="ncbi_make_flag">all, clean</span> and <span class="ncbi_make_flag">purge</span>.
        Recall that <a href="#ref_MakefilesTargets">recursive versions</a> of these
        targets exist for <span class="ncbi_term">meta-makefiles</span>.
<p>

<ul>
  <li> <span class="ncbi_make_flag">all</span> -- compile the object modules specified in the
  <span class="ncbi_make_var">"$(OBJ)"</span> macro, and use them to build the library
  <span class="ncbi_make_var">"$(LIB)"</span> or the application <span class="ncbi_make_var">"$(APP)"</span>; then copy the
  resultant [<span class="ncbi_file">lib|app</span>] to the [<a href="#ref_TablePath"><span class="ncbi_dir">libdir|bindir</span></a>] directory,
  respectively
  <li> <span class="ncbi_make_flag">clean</span> -- remove all object modules and libs/apps
  that have been built by <span class="ncbi_make_flag">all</span>
  <li> <span class="ncbi_make_flag">purge</span> -- do <span class="ncbi_make_flag">clean</span>, and then remove the copy
  of the [<span class="ncbi_file">libs|apps</span>] from the [<a href="#ref_TablePath"><span class="ncbi_dir">libdir|bindir</span></a>] directory.
</ul>
<p>

The <span class="ncbi_term">customized makefiles</span> do not distinguish
between recursive (<span class="ncbi_make_flag">all_r, clean_r, purge_r</span>) and
non-recursive (<span class="ncbi_make_flag">all, clean, purge</span>) targets -- because the
recursion and multiple build is entirely up to the <a
href="#ref_MakefilesMeta"><span class="ncbi_term">meta-makefiles</span></a>.
<p>


</dl>

<hr>

<a name="ref_MakefilesMacros"></a>
<h2>Makefile Macros and <span class="ncbi_file">Makefile.mk</span>&nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
<a name="ref_MakeProjMk"></a>
        There is a wide assortment of configured tools, flags, third party packages and
        <a href="#ref_TablePath">paths (see above)</a>.  They can be specified for the
        whole build tree with the appropriate entry in <span class="ncbi_file">Makefile.mk</span>, which
        is silently included at the very beginning of the <span class="ncbi_term">customized makefiles</span>
        used to build <a href="new_proj.html#ref_MakeProjLib">libraries</a> and
        <a href="new_proj.html#ref_MakeProjApp">applications</a>.
        <p>

        Many <span class="ncbi_term">makefile</span> macros are
        supplied with defaults <span class="ncbi_make_var">ORIG_*</span> in <span class="ncbi_file">Makefile.mk</span>.  See the list of
        <a href="lxr/source/src/Makefile.mk.in#L86"><span class="ncbi_make_var">ORIG_*</span> macros</a>,
        and all others currently defined, in the
        <a href="lxr/source/src/Makefile.mk.in"></a> <span class="ncbi_file">Makefile.mk.in</span>
        template</a> for details.  One should not override these defaults
        in normal use, but add your own flags to them
        as needed in the corresponding working macro; e.g., set
        <span class="ncbi_code">CXX = $(ORIG_CXX) -DFOO_BAR</span>.
        <p>

        <span class="ncbi_file">Makefile.mk</span> defines the following <span class="ncbi_term">makefile</span> macros obtained
        during the configuration process for <a href="#ref_TableFlags">flags</a>,
        <a href="#ref_MakeProjMk_FAST">system and third-party packages</a> and
        <a href="#ref_TableTools">development tools</a>:

<br></br>
<a name="ref_TableFlags"></a>
<table border=1 cellspacing=0>
<caption>Flags</caption>
  <tr class="head">
     <th>Macro</th>
     <th><a href="config.html#ref_TableToolsAndFlags">Source</a></th>
     <th><a href="config.html#ref_StdBuildRules">Synopsis</a></th>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CFLAGS</span></td>
     <td><span class="ncbi_make_var">$CFLAGS</span></td>
     <td>C compiler flags</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">FAST_CFLAGS</span></td>
     <td><span class="ncbi_make_var">$FAST_CFLAGS</span></td>
     <td><a href="#ref_MakeProjMk_FAST">(*)</a>
             C compiler flags to generate faster code
    </td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CXXFLAGS</span></td>
     <td><span class="ncbi_make_var">$CXXFLAGS</span></td>
     <td>C++ compiler flags</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">FAST_CXXFLAGS</span></td>
     <td><span class="ncbi_make_var">$FAST_CXXFLAGS</span></td>
     <td><a href="#ref_MakeProjMk_FAST">(*)</a>
             C++ compiler flags to generate faster code</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CPPFLAGS</span></td>
     <td><span class="ncbi_make_var">$CPPFLAGS</span></td>
     <td>C/C++ preprocessor flags</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">DEPFLAGS</span></td>
     <td><span class="ncbi_make_var">$DEPFLAGS</span></td>
     <td>Flags for file dependency lists</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">LDFLAGS</span></td>
     <td><span class="ncbi_make_var">$LDFLAGS</span></td>
     <td>Linker flags</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">LIB_OR_DLL</span></td>
     <td><span class="ncbi_conf_var">@LIB_OR_DLL@</span></td>
     <td>Specify whether to build a library as static or dynamic</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">STATIC</span></td>
     <td><span class="ncbi_conf_var">@STATIC@</span></td>
     <td>Library suffix to force static linkage (see
     <a href="new_proj.html#ref_MakeProjApp">example</a>)</td>
  </tr>
</table>

<br></br>
<a name="ref_MakeProjMk_FAST"></a>
(*) The values of user-specified environment variables
    <span class="ncbi_env">$FAST_CFLAGS, $FAST_CXXFLAGS</span> will substitute the regular
    optimization flag <span class="ncbi_make_flag">-O</span> (or <span class="ncbi_make_flag">-O2</span>, etc.).
    For example, if in the environment:
    <span class="ncbi_env">$FAST_CXXFLAGS</span>=<span class="ncbi_value">-fast -speedy</span> and
    <span class="ncbi_env">$CXXFLAGS</span>=<span class="ncbi_value">-warn -O3 -std</span>, then in makefile:
    <span class="ncbi_env">$(FAST_CXXFLAGS)</span>=<span class="ncbi_value">-warn -fast -speedy -std</span>.


<br></br>
<a name="ref_TableThirdParty"></a>
<table border=1 cellspacing=0>
<caption>System and third-party packages</caption>
  <tr class="head">
     <th>Macro</th>
     <th><a href="config.html#ref_TableLocalization1">Source</a></th>
     <th>Synopsis</th>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">LIBS</span></td>
     <td><span class="ncbi_env">$LIBS</span></td>
     <td>Default libraries to link with</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">PRE_LIBS</span></td>
     <td><span class="ncbi_env">$PRE_LIBS</span></td>
     <td>??? Default libraries to link with first</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">THREAD_LIBS</span></td>
     <td><span class="ncbi_env">$THREAD_LIBS</span></td>
     <td>Thread library (system)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NETWORK_LIBS</span></td>
     <td><span class="ncbi_env">$NETWORK_LIBS</span></td>
     <td>Network library (system)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">MATH_LIBS</span></td>
     <td><span class="ncbi_env">$MATH_LIBS</span></td>
     <td>Math library (system)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">KSTAT_LIBS</span></td>
     <td><span class="ncbi_env">$KSTAT_LIBS</span></td>
     <td>KSTAT library (system)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">RPCSVC_LIBS</span></td>
     <td><span class="ncbi_env">$RPCSVC_LIBS</span></td>
     <td>RPCSVC library (system)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">SYBASE_INCLUDE</span></td>
     <td><span class="ncbi_env">$SYBASE_INCLUDE</span></td>
     <td>SYBASE headers</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">SYBASE_LIBS</span></td>
     <td><span class="ncbi_env">$SYBASE_LIBS</span></td>
     <td>SYBASE libraries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">FASTCGI_INCLUDE</span></td>
     <td><span class="ncbi_env">$FASTCGI_INCLUDE</span></td>
     <td>Fast-CGI headers</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">FASTCGI_LIBS</span></td>
     <td><span class="ncbi_env">$FASTCGI_LIBS</span></td>
     <td>Fast-CGI libraries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_C_INCLUDE</span></td>
     <td><span class="ncbi_env">$NCBI_C_INCLUDE</span></td>
     <td>NCBI C toolkit headers</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_C_LIBPATH</span></td>
     <td><span class="ncbi_env">$NCBI_C_LIBPATH</span></td>
     <td>Path to the NCBI C Toolkit libraries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_C_ncbi</span></td>
     <td><span class="ncbi_env">$NCBI_C_ncbi</span></td>
     <td>NCBI C CoreLib</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_SSS_INCLUDE</span></td>
     <td><span class="ncbi_env">$NCBI_SSS_INCLUDE</span></td>
     <td>NCBI SSS headers</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_SSS_LIBPATH</span></td>
     <td><span class="ncbi_env">$NCBI_SSS_LIBPATH</span></td>
     <td>Path to NCBI SSS libraries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">NCBI_PM_PATH</span></td>
     <td><span class="ncbi_env">$NCBI_PM_PATH</span></td>
     <td>Path to the PubMed package</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">ORBACUS_LIBPATH</span></td>
     <td><span class="ncbi_env">$ORBACUS_LIBPATH</span></td>
     <td>Path to the ORBacus CORBA libraries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">ORBACUS_INCLUDE</span></td>
     <td><span class="ncbi_env">$ORBACUS_LIBPATH</span></td>
     <td>Path to the ORBacus CORBA headers</td>
  </tr>
</table>


<br></br>
<a name="ref_TableTools"></a>
<table border=1 cellspacing=0>
<caption>Compiler, Linker, and other development Tools</caption>
  <tr class="head">
     <th>Macro</th>
     <th><a href="config.html#ref_TableToolsAndFlags">Source</a></th>
     <th><a href="config.html#ref_StdBuildRules">Synopsis</a></th>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CC</span></td>
     <td><span class="ncbi_env">$CC</span></td>
     <td>C compiler</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CXX</span></td>
     <td><span class="ncbi_env">$CXX</span></td>
     <td>C++ compiler</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">LINK</span></td>
     <td><span class="ncbi_env">$CXX</span></td>
     <td>Linker (C++-aware)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CPP</span></td>
     <td><span class="ncbi_env">$CPP</span></td>
     <td>C preprocessor</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CXXCPP</span></td>
     <td><span class="ncbi_env">$CXXCPP</span></td>
     <td>C++ preprocessor</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">AR</span></td>
     <td><span class="ncbi_env">$AR</span></td>
     <td>Library archiver</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">STRIP</span></td>
     <td><span class="ncbi_env">$STRIP</span></td>
     <td>Tool to strip symbolic info from binaries</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">RM</span></td>
     <td><span class="ncbi_cmd">rm -f</span></td>
     <td>Remove file(s)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">RMDIR</span></td>
     <td><span class="ncbi_cmd">rm -rf</span></td>
     <td>Remove file(s) and directory(ies) recursively</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">COPY</span></td>
     <td><span class="ncbi_cmd">cp -p</span></td>
     <td>Copy file (preserving the modification time)</td>
  </tr>

  <tr>
     <td><span class="ncbi_make_var">CC_FILTER</span></td>
     <td><span class="ncbi_conf_var">@CC_FILTER@</span></td>
     <td>Filters for the C compiler</td>
  <tr>

  <tr>
     <td><span class="ncbi_make_var">CXX_FILTER</span></td>
     <td><span class="ncbi_conf_var">@CXX_FILTER@</span></td>
     <td>Filters for the C++ compiler</td>
  <tr>

  <tr>
     <td><span class="ncbi_make_var">CHECK_ARG</span></td>
     <td><span class="ncbi_conf_var">@CHECK_ARG@</span></td>
     <td></td>
  <tr>

  <tr>
     <td><span class="ncbi_make_var">LN_S</span></td>
     <td><span class="ncbi_conf_var">@LN_S@</span></td>
     <td>Make a symbolic link if possible; otherwise, hard-link or copy</td>
  <tr>

  <tr>
     <td><span class="ncbi_make_var">BINCOPY</span></td>
     <td><span class="ncbi_conf_var">@BINCOPY@</span></td>
     <td>Copy a library or an executable -- but only if it was changed</td>
  </tr>
</table>

</dl>

<hr>

<a name="ref_MakefilesEx"></a>
<h2>Example Makefiles &nbsp;<font size=-2><span class=nava>[<a href="#ref_MakefilesTop">Top</a>]</span></font></h2>
<dl>
    <dt>
    <dd>
        Below are links to examples of typical <span class="ncbi_term">makefiles</span>, complete with descriptions
        of their content.
        <p>

        <ul>
            <li> Inside the Tree
                <ul>
                    <li> <a href="programming_manual/inside_tree.html#example">An example meta-makefile and its associated project makefiles</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#lib_make">Library project makefile: Makefile.myProj.lib</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#app_make">Application project makefile: Makefile.myProj.app</a> </li>
                    <li> <a href="programming_manual/inside_tree.html#usr_make">Custom project makefile: Makefile.myProj</a> </li>
                </ul>
                <p>
                </li>
            <li> New Projects and Outside the Tree
                <ul>
                    <li> <a href="new_proj.html#ref_Outside">Use Shell Scripts to Create Makefiles</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjLib">Customized makefile to build a library</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjApp">Customized makefile to build an application</a> </li>
                    <li> <a href="new_proj.html#ref_MakeProjUsr">User-defined makefile to build... whatever</a>
                </ul>
                </li>
        </ul>

</dl>

<!--#include virtual="./ssi/navlinks.shtml" -->

<table border=0 width="607" cellspacing=0>
<script>
<!--
print_author('cpp-core', 'Denis Vakatov', '$Date$', 'ncbi.nlm.nih.gov');
print_author('cpp-core', 'Chris Lanczycki');
print_author('cpp-core', 'Eugene Vasilchenko');
print_author('cpp-core', 'Anton Lavrentiev');
print_author('cpp-core', 'Diane Zimmerman');
print_author('cpp-core', 'Lewis Geer');
// -->
</script>
</table>

<!--#include virtual="./ssi/footer.shtml" -->
