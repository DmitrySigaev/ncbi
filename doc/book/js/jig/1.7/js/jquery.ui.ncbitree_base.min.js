(function(c){c.widget("ui.ncbitree_base",{options:{expanded:"",speed:120,remember:false},_create:function(){this.list=this.element.eq(0);this.list[0].nodeName=="UL"&&this._treeify()},_treeify:function(){var a=this.list,e=this,f=this.options;a.attr({role:"tree"}).addClass("ui-widget");a.find("a:eq(0)").attr("tabindex","0");a.find("a:gt(0)").attr("tabindex","-1");a.find("ul").attr({role:"group"}).addClass("tree-group-collapsed");a.find("li").attr({role:"treeitem"});a.find("li:has(ul)").attr("aria-expanded",
"false").find(">a");a.find("li:has(ul)").find(">a").wrap('<span class="tree-parent"/>');a.bind("expand.treeEvents",function(b){e._expand(b.target);e._trigger("expand",b)}).bind("collapse.treeEvents",function(b){e._collapse(b.target);e._trigger("collapse",b)}).bind("toggle.treeEvents",function(b){e._toggle(b.target)}).bind("traverseDown.treeEvents",function(b){var d=a.find("span[tabindex=0]");d.length||(d=a.find("a[tabindex=0]"));d.length||(d=c(b.target));b=d.parent();if(b.is("[aria-expanded=true]"))d.next().find("a, span").eq(0).focus();
else b.next().length?b.next().find("a, span").eq(0).focus():b.parents("li").next().find("a, span").eq(0).focus()}).bind("traverseUp.treeEvents",function(b){var d=a.find("span[tabindex=0]");d.length||(d=a.find("a[tabindex=0]"));d.length||(d=c(b.target));b=d.parent();if(b.prev().length)b.prev().is("[aria-expanded=true]")?b.prev().find("li:visible:last a, li:visible:last span").eq(0).focus():b.prev().find("a, span").eq(0).focus();else b.parents("li:eq(0)").find("a, span").eq(0).focus()});a.bind("focus.treeEvents",
function(b){a.find("[tabindex=0]").attr("tabindex","-1").removeClass("ui-state-focus");c(b.target).attr("tabindex","0").addClass("ui-state-focus")}).bind("click.treeEvents",function(b){var d=c(b.target);if(d.is("span.tree-parent")){d.trigger("toggle");d.eq(0).focus();b.preventDefault()}}).bind("keydown.treeEvents",function(b){var d=a.find("span[tabindex=0], a[tabindex=0]");if(b.keyCode==37||b.keyCode==38||b.keyCode==39||b.keyCode==40){b.keyCode==37&&d.parent().is("[aria-expanded=true]")&&d.trigger("collapse");
b.keyCode==39&&d.parent().is("[aria-expanded=false]")&&d.trigger("expand");b.keyCode==38&&d.trigger("traverseUp");b.keyCode==40&&d.trigger("traverseDown");return false}else if((b.keyCode==13||b.keyCode==32)&&d.is("span.tree-parent")){d.trigger("toggle");return false}});var g=a.attr("id");if(g&&c.cookie("ncbitree")&&c.parseJSON(c.cookie("ncbitree"))[g]){f=c.parseJSON(c.cookie("ncbitree"))[g];e._load_state(f)}else a.find(f.expanded).find(">span").each(function(){e._expand(this)});a.find("li[role=treeitem] > a, li[role=treeitem] > span").addClass("ui-state-default").bind("mouseenter.treeEvents",
function(){c(this).addClass("ui-state-hover")}).bind("mouseleave.treeEvents",function(){c(this).removeClass("ui-state-hover")})},_expand:function(a){var e=this.options,f=this,g=this.list,b=a?c(a):g.find("a[tabindex=0]");b.addClass("ui-state-active").removeClass("ui-state-default");b.next().hide().removeClass("tree-group-collapsed").slideDown(e.speed,function(){c(this).removeAttr("style");b.parent().attr("aria-expanded","true").addClass("tree-expanded");e.remember&&f._save_state()})},_collapse:function(a){var e=
this.options,f=this,g=this.list,b=a?c(a):g.find("a[tabindex=0]");b.removeClass("ui-state-active").addClass("ui-state-default");b.next().slideUp(e.speed,function(){b.parent().attr("aria-expanded","false").removeClass("tree-expanded");c(this).addClass("tree-group-collapsed").removeAttr("style");e.remember&&f._save_state()})},_toggle:function(a){var e=this.list;a=a?c(a):e.find("a[tabindex=0]");a.parent().is("[aria-expanded=false]")?a.trigger("expand"):a.trigger("collapse")},expand:function(a,e){var f=
this.list;if(e){ancestor_spans=f.find(a).parentsUntil("[role=tree]").find(">span");ancestor_spans.each(function(){c(this).trigger("expand")})}f.find(a).find(">span").trigger("expand");this._trigger("expanded",null)},collapse:function(a){this.list.find(a).find(">span").trigger("collapse")},destroy:function(){c.Widget.prototype.destroy.apply(this,arguments);var a=this.list;a.removeAttr("role").removeClass("ui-widget");a.find("a").removeAttr("tabindex").removeClass("ui-state-focus ui-state-default ui-state-hover ui-state-active");
a.find("ul").removeAttr("role").removeClass("tree-group-collapsed");a.find("li").removeAttr("role").removeClass("tree-expanded");a.find("li:has(ul)").removeAttr("aria-expanded").find(">a").removeClass("tree-parent");a.find('span[class*="tree-parent"]>a').unwrap();a.find(this.options.expanded).removeAttr("aria-expanded");a.unbind(".treeEvents")},_load_state:function(a){var e=this,f=this.list;state=a.split("");f.find("li[aria-expanded]").each(function(g){state[g]==1?c(this).find(">span").each(function(){e._expand(this)}):
c(this).find(">span").each(function(){e._collapse(this)})})},_save_state:function(){var a=this.list,e=a.attr("id");if(e){state_data={};if(c.cookie("ncbitree"))state_data=c.parseJSON(c.cookie("ncbitree"));var f="";a.find("li[aria-expanded]").each(function(){f+=c(this).attr("aria-expanded")=="true"?"1":"0"});state_data[e]=f;data=JSON.stringify(state_data);c.cookie("ncbitree",data,{path:"/"})}}});c.ui.ncbitree_base.prototype.version="0.2"})(jQuery);
