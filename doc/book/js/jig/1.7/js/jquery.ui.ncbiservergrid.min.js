(function(){var e=jQuery.ui.ncbigrid.prototype.options;e.webservice=null;e.webserviceParams=null;e.isServersideLoad=false;e.isServersidePaging=false;e.isServersidePagingCached=false;e.isServersideSort=false;e.maxRowCount=null;e.columnNames=null;var h=jQuery.ui.ncbigrid.prototype._create,i=jQuery.ui.ncbigrid.prototype.sortDefaults,j=jQuery.ui.ncbigrid.prototype._killActiveSort,k=jQuery.ui.ncbigrid.prototype._sortData,l=jQuery.ui.ncbigrid.prototype.updateRows,m=jQuery.ui.ncbigrid.prototype.getRowCount,
n=jQuery.ui.ncbigrid.prototype.getMaxPage;jQuery.widget("ui.ncbiservergrid",jQuery.ui.ncbigrid,{_loadCreateCallback:false,_create:function(){if(this.options.isServersidePaging)this.options.isPageable=true;if(this.options.isServersideSort)this.options.isSortable=true;if(this.options.isServersideLoad&&!this.options.isServersidePaging){this._loadCreateCallback=true;this._fetchData()}else h.apply(this,arguments)},getMaxPage:function(){return this.options.isServersidePaging?Math.ceil(this.getRowCount()/
this.options.pageSize):n.apply(this,arguments)},getRowCount:function(){return this.options.isServersidePaging?this.options.maxRowCount||0:m.apply(this,arguments)},updateRows:function(){if(this.options.isServersidePaging||this.options.isServersideSort)this.updateRowsServer();else return l.apply(this,arguments)},updateRowsServer:function(){var a=null;if(this.options.isServersidePagingCached)a=this.isInCache();if(a)this._displayTheRows(a);else if(this._isInitialFetch&&!this.options.isServersideLoad){this.addToCache(this.element.find("tbody").html());
this._isInitialFetch=false}else this._fetchData()},_isInitialFetch:true,_fetchData:function(){var a=this;this.element.trigger("ncbigridshowloadingbar");this._activeRequest&&this._activeRequest.readyState<4&&this._activeRequest.abort();var b=this._handlewebserviceParams();if(this.options.isServersidePaging){b.parameters.page=this.getCurrentPage();b.parameters.pageSize=this.options.pageSize}if(this.options.isServersideSort&&this.options.sortColumn!==-1){var d=this.options.columnNames;b.parameters.sortCol=
d?d[this.options.sortColumn]:this.options.sortColumn+1;b.parameters.sortDir=this.options.sortColumnDir}this._activeRequest=jQuery.ajax({url:b.url,data:b.parameters,success:function(c,f,g){a._processData(c,f,g)},error:function(c,f,g){a._processError(c,f,g)}})},_handlewebserviceParams:function(){var a=this.options.webservice,b=this.options.webserviceParams||this.options.webServiceParams,d={};if(b)if(typeof b==="string"){var c=b.charAt(0)!=="?"||a.indexof("?")===-1?"?":"";a=a+c+b}else for(c in b)d[c]=
b[c];return{url:a,parameters:d}},_activeRequest:null,_processData:function(a,b){if(b==="success"){this._displayTheRows(a);this.addToCache(a)}this._loadCreateCallback&&h.apply(this)},_processError:function(a,b,d){if(typeof console!=="undefined"&&console.error){console.group&&console.group("Failed Request");console.error("The request failed to retrieve the rows");if(console.info){console.info(a);console.info(b);console.info(d)}console.group&&console.groupEnd("Failed Request")}},_displayTheRows:function(a){this.element.trigger("ncbigridresetscroll");
this.element.trigger("ncbigridhideloadingbar");this.element.find("tbody").html(a);this._notifyGridUpdated()},_cachedRows:{},getCacheKey:function(){var a=this.getCurrentPage().toString(),b=this.options.pageSize.toString(),d=this.options.sortColumn.toString(),c=this.options.sortColumnDir.toString();return a+"_"+b+"_"+d+"_"+c},addToCache:function(a){if(this.options.isServersidePagingCached)this._cachedRows[this.getCacheKey()]=a},isInCache:function(){return this._cachedRows[this.getCacheKey()]||null},
sortDefaults:function(){this.options.isServersideSort||i.apply(this,arguments)},_killActiveSort:function(){this.options.isServersideSort||j.apply(this,arguments)},_sortData:function(){this.options.isServersideSort?this.updateRows():k.apply(this,arguments)}})})();
