<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>cgi.cpp</title>
  </head>

  <body BGCOLOR="#FFFFFF">
  <pre><font color = "red">// File name: cgi.cpp
// Description: Demonstrate the basic CGI classes and functions
<font color = "green">
#include <a href="cgi_hpp.html">"cgi.hpp"</a>
#include &lt;cgi/cgictx.hpp>
#include &lt;corelib/ncbistd.hpp>
#include &lt;corelib/ncbireg.hpp>
#include &lt;memory>
<font color = "blue">
BEGIN_NCBI_SCOPE
</font></font>
/////////////////////////////////////////////////////////////////////////
// Implement the application's LoadResource() and ProcessRequest() methods
</font>
CNcbiResource* CHelloApp::LoadResource(void)
{ 
    auto_ptr&lt;CHelloResource> resource(new CHelloResource(GetConfig()));  
    resource->AddCommand(new CHelloBasicCommand(*resource));
    resource->AddCommand(new CHelloReplyCommand(*resource));
    return resource.release();
}

<font color = "red">// forward declarations </font>
void ShowCommands (const TCmdList& cmds, CCgiContext& ctx);
void ShowEntries (const TCgiEntries& entries);

int CHelloApp::ProcessRequest(CCgiContext& ctx)
{
    ShowCommands (GetResource().GetCmdList(), ctx);
    ShowEntries (const_cast&lt;TCgiEntries&>(ctx.GetRequest().GetEntries()));
    GetResource().HandleRequest(ctx);
    return 0;
}
<font color="red">
/////////////////////////////////////////////////////////////
// Define the resource's default command if none match query
</font>
CNcbiCommand* CHelloResource::GetDefaultCommand(void) const
{
    cerr << "    executing CHelloResource::GetDefaultCommand()" << endl;
    return new CHelloBasicCommand(const_cast&lt;CHelloResource&>(*this));
}

<font color="red">
///////////////////////////////////////////////////////////////
// Define the Execute() and Clone() methods for the commands </font>

void CHelloCommand::Execute(CCgiContext& ctx)
{
    cerr << "    executing CHelloCommand::Execute " << endl;
    const CNcbiRegistry& reg = ctx.GetConfig();
    ctx.GetResponse().WriteHeader();
}

CNcbiCommand* CHelloBasicCommand::Clone(void) const
{
    cerr << "    executing CHelloBasicCommand::Clone()" << endl;
    return new CHelloBasicCommand(GetHelloResource());
}

CNcbiCommand* CHelloReplyCommand::Clone(void) const
{
    cerr << "    executing CHelloReplyCommand::Clone" << endl;
    return new CHelloReplyCommand(GetHelloResource());
}

<font color = "red">// Show what commands have been installed </font>
void ShowCommands (const TCmdList& cmds, CCgiContext& ctx)
{
    cerr << "Commands defined for this application are: \n";
    for (TCmdList::const_iterator it = cmds.begin(); it != cmds.end(); it++) {
        cerr << (*it)->GetName();
        if ((*it)->IsRequested(ctx)) {
	    cerr << " (requested)" << endl;
	} else {
  	    cerr << " (not requested)" << endl;
	}
    }
}

<font color = "red">// Show the &lt;key=value> pairs in the request string </font>
void ShowEntries (const TCgiEntries& entries)
{
    cerr << "The entries in the request string were: \n";
    for (TCgiEntries::const_iterator it = entries.begin(); it != entries.end(); it++)
      {
	if (! (it->first.empty() && it->second.empty()))
	  cerr << it->first << "=" << it->second << endl;
      }
}
<font color="blue">
END_NCBI_SCOPE

USING_NCBI_SCOPE;
</font>
static CHelloApp theHelloApp;

int main(int argc, const char* argv[])
{
    SetDiagStream(&cerr);
    return theHelloApp.AppMain(argc, argv);
}

</pre>
</body>
</html>



