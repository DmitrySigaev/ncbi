<!--#set var="TITLE" value="The CNcbiRegistry Class" -->
<!--#set var="DOCROOT" value=".." -->
<!--#include virtual="../ssi/header.shtml" -->

<h1>
The CNcbiRegistry Class</h1>

<ul>
<li>
<a href="#intro">Introduction</a></li>

<li>
<a href="#syntax">Syntax of the configuration file</a></li>

<li>
<a href="#eflags">CNcbiRegistry::EFlags</a></li>

<li>
<a href="#methods">Additional Methods</a></li>
</ul>

<h3>
<a NAME="intro"></a>Introduction</h3>
<p>
The <a href="../docxx/CNcbiRegistry.html" class="ncbi_class">CNcbiRegistry</a> class
is used to access, modify and store runtime information read from a
configuration file.

<p>
If you are programming in the standard C++ Toolkit framework, using
<a href="applic.html#CNcbiApplication" class="ncbi_class">CNcbiApplication</a>
class, you should definitely read the rules on where the
application is looking for the configuration file, and how
you can access the loaded application-wide coniguration (registry)
from your code. This is described in the
<a href="applic.html#CNcbiRegistry">C++ Toolkit Library Reference / Core and Portability API / NCBI Application Environment and Command-Line Arguments</a>.


<h1>
<a NAME="syntax"></a></h1>

<h3>
Syntax of the configuration file</h3>
The configuration file is composed of <span class="ncbi_term">section</span> headers and "<span class="ncbi_value">name=value</span>"
strings, which occur within the named sections.  It is also possible
to include comments in the file,  which are indicated by a new line
with a leading semi-colon. Figure 1 shows an example configuration
file.

<blockquote>
<pre class="ncbi_code">
; MyProgram.ini

; parameters for section1
<span class="ncbi_reg">[section1]</span>
name1 = value1 and value1.2
n-2.3 = "  this value has two spaces at its very beginning and at the end  "
name3 = this is a multi\
line value</tt>
name4 = this is a single line ended by back slash\\
name5 = all backslashes and \
new lines must be \\escaped\\...

<span class="ncbi_reg">[ section2.9-bis ]</span>
This is a comment...
name2 = value2
</pre>
Figure1. An example configuration file
</blockquote>

All comments and empty lines are ignored by the registry file parser. 
Line continuations, as usual, are indicated with a backslash escape. More
generally,  backslashes are processed as:
<ul>
<li>
[backslash] + [backslash] -- converted into a single [backslash]</li>

<li>
[backslash] + [space(s)] + [EndOfLine] -- converted to an [EndOfLine]</li>

<li>
[backslash] + ["]  -- converted into a ["]</li>
</ul>
Character strings with embedded spaces do not need to be quoted, 
and an unescaped double quote at the very beginning or end of a value is
ignored. All other combinations with [backslash] and ["] are invalid.
<p>The following restrictions apply to the <span class="ncbi_term">section</span> and <span class="ncbi_term">name</span>
identifiers occurring in a registry file:
<ul>
<li>
the string must contain only:  [a-z], [A-Z], [0-9], [_.-] characters</li>

<li>
the interpretation of the string is <em>not</em> case-sensitive, e.g. <span class="ncbi_value">PATH
== path == PaTh</span></li>

<li>
all leading and trailing spaces will be truncated</li>
</ul>

<h3>
<a NAME="transience"></a></h3>

<h3>
<span class="ncbi_type">CNcbiRegistry::EFlags</span></h3>
In addition to the constructor, which initializes the registry in memory
and loads parameters from a file, the <span class="ncbi_class">CNcbiRegistry</span> class provides
methods for saving the registry (as a new configuration file), and
reading in additonal parameters from a secondary file(s).
Each "<span class="ncbi_value">name=value</span>"
pair stored in the registry has three attributes, specifying whether or
not that value is:
<ul>
<li>
<span class="ncbi_term">persistent</span>, meaning the value will be written to a file when
the registry is saved</li>

<li>
<span class="ncbi_term">overridable</span> meaning the value can be overridden by a new
value with the same name</li>

<li>
<span class="ncbi_term">truncatable</span> meaning that leading and trailing blanks can
be truncated from the value</li>
</ul>
By default, all of the configuration's parameters are <span class="ncbi_term">persistent, overridable</span>,
and <span class="ncbi_term">truncatable</span>.  The <span class="ncbi_type">EFlags</span> enumeration that quantifies
these attributes, and the related <span class="ncbi_keyword">typedef</span> <span class="ncbi_type">TFlags</span>, are defined
as:

<blockquote>
<pre class="ncbi_code">
enum EFlags {
    eTransient   = 0x1,
    ePersistent  = 0x100,
    eOverride    = 0x2,
    eNoOverride  = 0x200,
    eTruncate    = 0x4,
    eNoTruncate  = 0x400
};
typedef int TFlags;
</pre>
</blockquote>

<span class="ncbi_type">TFlags</span> is simply used to clarify that an <span class="ncbi_type">int</span> derived from
a combination (bit-wise <i>OR</i><!--NCBI_MARK-->) of <span class="ncbi_type">EFlags</span> is expected - not just
an arbitrary "regular" <span class="ncbi_type">int</span>.  Many of <span class="ncbi_class">CNcbiRegistry</span>'s
methods take an optional <span class="ncbi_type">TFlags</span> argument, which qualifies the selected
values with respect to these attributes.
<p>For example, the following code excerpt sets the value of registry entry
<span class="ncbi_reg_var">MyName</span>
in section <span class="ncbi_reg">MySection</span> to <span class="ncbi_value">"Eugene"</span>.  In particular, the
<span class="ncbi_type">TFlags</span> argument, derived from the bit-wise OR of
<span class="ncbi_var">eTruncate </span>and
<span class="ncbi_var">eNoOverride</span>, specifies that (1) all leading and trailing blanks
in the new value should be truncated, and (2) that the new value <em>cannot</em>
be applied to override a previous value if one exists:

<blockquote>
<pre class="ncbi_code">
CNcbiRegistry reg(.....);
...
reg.Set("MySection", "MyName", " Eugene   ",
        CNcbiRegistry::eNoOverride | CNcbiRegistry::eTruncate);
</pre>
</blockquote>

<p>The <span class="ncbi_class">CNcbiRegistry</span> class
constructor takes two arguments - an input stream to read the registry
from (usually a file), and an optional
<span class="ncbi_type">TFlags</span> argument, where the
latter can be used to specify that all of the values should be stored as
<span class="ncbi_term">transient</span>
rather than in the default mode, which is <span class="ncbi_term">persistent</span>:

<blockquote>
<pre class="ncbi_code">
CNcbiRegistry(CNcbiIstream&amp; is, TFlags flags = 0);
</pre>
</blockquote>

<p>Once the registry has been initialized by its constructor, it is also
possible to load additional parameters from other file(s) using the
<span class="ncbi_func">Read()</span> method:

<blockquote>
<pre class="ncbi_code">
void Read(CNcbiIstream&amp; is, TFlags flags = 0);
</pre>
</blockquote>

<p>Valid flags for the <span class="ncbi_func">Read() </span>method include 
<span class="ncbi_var">eTransient </span>and<span class="ncbi_var">eNoOverride</span>.
The default is for all  values to be read
in as <span class="ncbi_term">persistent</span>, with the capability of overriding any previously
loaded value associated with the same name.  Either or both of these
defaults can be modified by specifying <span class="ncbi_var">eTransient,
eNoOverride</span>, or (<span class="ncbi_var">eTransient | eNoOverride</span>) as the <span class="ncbi_var">flags</span>
argument in the above expression.
<p>The <span class="ncbi_func">Write() </span>method takes as its sole argument, a destination
stream to which only the <span class="ncbi_term">persistent</span> configuration parameters will
be written.
<p>Values can also be set directly inside your application, using:
<blockquote>
<pre class="ncbi_code">
bool Set(const string&amp; section, const string&amp; name, const string&amp; value, TFlags flags = 0);
</pre>
</blockquote>

<p>Here, valid flag values include <span class="ncbi_var">ePersistent,
eNoOverride</span>, <span class="ncbi_var">eTruncate, </span> or any logical combination of these. 
If <span class="ncbi_var">eNoOverride</span> is set and there is a previously defined value
for this parameter, then the value is not reset, and the method returns
<span class="ncbi_value">false</span>.
<p>The <span class="ncbi_func">Get()</span> method first searches the set
of <span class="ncbi_term">transient</span> parameters for a parameter named <span class="ncbi_var">name</span>, in section <span class="ncbi_var">section</span>,
and if this fails,  continues by searching the set of <span class="ncbi_term">persistent</span>
parameters. However, if the <span class="ncbi_var">ePersistent</span> flag is used, then only 
the set of <span class="ncbi_term">persistent</span> parameters will be searched. On success, <span class="ncbi_func">Get()</span> returns the stored value. On failure, the empty string is returned.

<blockquote>
<pre class="ncbi_code">
const string&amp; Get(const string&amp; section, const string&amp; name, TFlags flags = 0) const;
</pre>
</blockquote>


<a NAME="methods"></a>
<h3>Additonal methods</h3>

Four additional methods are defined in the interface.

<blockquote>
<pre class="ncbi_code">
bool Empty(void) const;
void Clear(void);
void EnumerateSections(list&lt;string>*sections) const;
void EnumerateEntries(const string&amp; section,  list&lt;string>* entries) const;
</pre>
</blockquote>

<p><span class="ncbi_func">Empty()</span> returns <span class="ncbi_value">true</span>
if the registry is empty. <span class="ncbi_func">Clear()</span> empties
out the registry, discarding all stored parameters. <span class="ncbi_func">EnumerateSections() </span>
writes all registry section names to sections.. <span class="ncbi_func">EnumerateEntries()</span>
writes the list of parameter names in section to entries.

<p><a href="argdescr.html"><i>previous</i>&nbsp;</a>&nbsp; <i><a href="../index.html">up</a></i><!--NCBI_MARK-->&nbsp;&nbsp;

<i><a href="diag.html">next</a></i><!--NCBI_MARK-->

<!--#include virtual="../ssi/navlinks.shtml" -->

<table BORDER=0 CELLSPACING=0 WIDTH="100%" >
<tr>
<td>
<address>
<a href="mailto:cpp-core@ncbi.nlm.nih.gov">Diane Zimmerman</a></address>
</td>

<td><!-- <td align=center><span class="ncbi_cvs_rev">$Revision$</span></td> --></td>

<td ALIGN=RIGHT><span class="ncbi_cvs_date">$Date$</span></td>
</tr>
</table>

<!--#include virtual="../ssi/footer.shtml" -->
