<!--#set var="TITLE" value=" Using the CArgDescriptions class " -->
<!--#set var="DOCROOT" value=".." -->
<!--#include virtual="../ssi/header.shtml" -->


<h2>Parsing, validating, and accessing command line arguments</h2>

<div>
<ul>
  <li><a href="#ref_Overview">Overview</a>
    <ul>
      <li>
<a href="#ref_Overview_WhatFor">What does this API allow you to do with the
command-line arguments</a>
      </li>
      <li>
<a href="#ref_Overview_Classes">The relationships between the <span class="ncbi_class">CArgDescriptions</span>,
<span class="ncbi_class">CArgs</span>, and <span class="ncbi_class">CArgValue</span> classes</a>
      </li>
      <li>
<a href="#ref_Overview_Structure">The generic structure of the command
line and the available argument types</a>
      </li>
    </ul>
  </li>
  <li>
<a href="#ref_CArgDescriptions">The <span class="ncbi_class">CArgDescriptions</span> class: specifying
argument attributes and constraints</a>

  <ul>
    <li>
<a href="#ref_CArgDescriptions_Attr">Argument attributes (name, synopsis,
comment, value type, default value)</a>
    </li>
    <li>
<a href="#ref_CArgDescriptions_Types">Argument <span class="ncbi_var">types</span></a>
      <ul>
        <li>position-independent arguments (tagged)
          <ul>
            <li>
mandatory keys: <span class="ncbi_app_a">-&lt;key> &lt;value></span>
            </li>
            <li>
optional keys: [<span class="ncbi_app_a">-&lt;key>&lt;value>]</span>
            </li>
            <li>
flags: <span class="ncbi_app_a">-&lt;flag></span>
            </li>
          </ul>
        </li>
        <li>positional arguments (no preceding tags)
          <ul>
            <li>
plain (named): <span class="ncbi_app_a">&lt;value></span>
            </li>
            <li>
extra (unnamed): <span class="ncbi_app_a">.....</span>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
<a href="#ref_CArgDescriptions_StdValueTypes">Standard types: type restrictions
imposed on the input arguments</a>
    </li>
    <li>
<a href="#ref_CArgDescriptions_UserValueTypes"><span class="ncbi_class">CArgAllow</span> class:
user-defined restrictions on the range of allowed values</a>
    </li>
    <li>
<a href="#ref_CArgDescriptions_App">
Using <span class="ncbi_class">CArgDescriptions</span> in application</a>
    </li>
    <li>
<a href="#ref_CArgDescriptions_Usage">Generating a USAGE message</a>
    </li>
  </ul>
  </li>
  <li>
<a href="#ref_CArgs">The <span class="ncbi_class">CArgs</span> class: A container class for <span class="ncbi_class">CArgValue</span>
objects</a>
  </li>
  <li>
<a href="#ref_CArgValue">The <span class="ncbi_class">CArgValue</span> class: The internal representation
of argument values</a>
  </li>
  <li>
<a href="#ref_CodeExamples">Code examples</a>
  </li>
</ul>
</div>


<p>&nbsp;</p>

<a NAME="ref_Overview"></a>
<h3>Overview</h3>

<br>

<a NAME="ref_Overview_WhatFor"></a>
<h4>What does this API allow you to do with
the command-line arguments</h4>
<p>
This set of classes implements automated&nbsp; command line parsing. Specifically,
it allows the developer to:
<ul>
  <li>
specify attributes of expected arguments, such as name, synopsis,
comment, data type, etc.,
  </li>
  <li>
validate values of the arguments passed to the program against these specifications,</li>
  <li>
validate the number of positional arguments in the command line,
  </li>
  <li>
generate a <a href="#ref_CArgDescriptions_Usage">USAGE</a> message
based on the argument descriptions (<span class="ncbi_note">NOTE:</span> <span class="ncbi_app_a">-h</span> flag to print the <a href="#ref_CArgDescriptions_Usage" class="ncbi_term">USAGE</a>
is defined by default),
  </li>
  <li>
access the input argument values specifically type-cast according to their
description.
  </li>
</ul>

Normally, <span class="ncbi_class">CArgDescriptions</span> object is required and 
<a href="#ref_CArgDescriptions_App">should be created</a>
in application's <span class="ncbi_func">Init()</span> function before any other initialization.
Otherwise <span class="ncbi_class">CNcbiApplication</span> creates a default one,
which allows any program which utilizes NCBI C++ toolkit to provide
some <span class="ncbi_term">standard</span> command line options, namely:
<ul>
  <li>
to obtain a general description of the program as well as description
of all available command line parameters (<span class="ncbi_script_a">-h</span> flag),
  </li>
  <li>
to redirect the program's
<a href="diag.html">diagnostic messages</a>
into a specified file (<span class="ncbi_script_a">-logfile</span> key),
  </li>
  <li>
to read the program's
<a href="registry.html">configuration data</a>
from a specified file (<span class="ncbi_script_a">-conffile</span> key).
  </li>
</ul>
<table border=1 cellpadding=5>
<tr>
  <th>Flag</th><th>Description</th><th>Example</th>
</tr>
<tr>
  <td>-h</td>
  <td>Print description of the application's command line parameters.</td>
  <td>theapp -h</td>
</tr>
<tr>
  <td>-logfile</td>
  <td>Redirect program's log into the specified file</td>
  <td>theapp -logfile theapp_log</td>
</tr>
<tr>
  <td>-conffile</td>
  <td>Read the program's configuration data from the specified file</td>
  <td>theapp -conffile theapp_cfg</td>
</tr>
</table>
</p>
<p>
To avoid creation of a default <span class="ncbi_class">CArgDescriptions</span> object (sometimes it
is inappropriate), one should call <span class="ncbi_func">CNcbiApplication::DisableArgDescriptions()</span>
function from an application object constructor.
<br />
Also, it is possible to use
<span class="ncbi_func">CNcbiApplication::HideStdArgs(THideStdArgs hide_mask)</span> method
to hide description of the standard arguments (<span class="ncbi_script_a">-h, -logfile, -conffile</span>)
in the <a href="#ref_CArgDescriptions_Usage">USAGE</a> message.
Please note, this only hides the description of these flags - it is still
possible to use them.
</p>

<br>

<a NAME="ref_Overview_Classes"></a>
<h4>
The relationships between the <span class="ncbi_class">CArgDescriptions</span>,
<span class="ncbi_class">CArgs</span>, and <span class="ncbi_class">CArgValue</span> classes</h4>

<p>
The <a href="#ref_CArgDescriptions" class="ncbi_class">CArgDescriptions</a> class provides
an interface to describe the data type and attributes of command-line
arguments, via a set of <span class="ncbi_class">AddXxx()</span> methods. Additional constraints
on the argument values can be imposed using the <span class="ncbi_class">SetConstraint()</span>
method.
The <span class="ncbi_class">CreateArgs() </span>method is passed the values of all
command line arguments at runtime. It verifies their overall syntactic
structure and matches their values against the stored descriptions. If
the arguments are parsed successfully, a new <a href="#ref_CArgs" class="ncbi_class">CArgs</a>
object is returned by <span class="ncbi_class">CreateArgs()</span>.
</p>
<p>
The resulting
<a href="#ref_CArgs" class="ncbi_class">CArgs</a> object will contain
verified and ready-to-use argument values which are stored as <a href="#ref_CArgValue" class="ncbi_class">CArgValue</a>'s.
The value of a particular argument can be accessed using the argument's
name (as specified in the <a href="#ref_CArgDescriptions" class="ncbi_class">CArgDescriptions</a>
object), and the returned <a href="#ref_CArgValue" class="ncbi_class">CArgValue</a>
object can then be safely type-cast to a correct C++ type
(<span class="ncbi_type">int</span>, <span class="ncbi_type">string</span>, <span class="ncbi_type">stream</span>, etc.).
These class relations and methods can be summarized schematically
as:
<center><img SRC="flow.gif" height=288 width=612></center>
The last statement in this example implicitly references a <a href="#ref_CArgValue" class="ncbi_class">CArgValue</a>
object, in the value returned when the <span class="ncbi_ccode">[ ] </span>operator is applied to
<span class="ncbi_var">myArgs</span>.
The method <span class="ncbi_func">CArgValue::AsDouble() </span>is then applied to this object
to retrieve a<span class="ncbi_type"> double</span>.
</p>


<br>

<a NAME="ref_Overview_Structure"></a>
<h4>The generic structure of the command
line, and available argument types</h4>

<p>
This API can describe and work with&nbsp; command line arguments that fit
the following profile:
</p>
<p>
// <font color="#FF0000">progname</font>
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{<font color="#FF0000">arg_key</font><font color="#000000">,</font><font color="#FF0000">&nbsp;
arg_key_opt</font><font color="#000000">,&nbsp; </font><font color="#FF0000">arg_key_dflt</font><font color="#000000">,</font><font color="#FF0000">&nbsp;
arg_flag</font>}&nbsp;&nbsp; [<font color="#FF0000">--</font>]
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{<font color="#FF0000">arg_pos</font>}&nbsp; {<font color="#FF0000">arg_pos_opt</font><font color="#000000">,</font><font color="#FF0000">&nbsp;
arg_pos_dflt</font>}
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{<font color="#FF0000">arg_extra</font>}&nbsp; {<font color="#FF0000">arg_extra_opt</font>}
<br>//
<br>// where:
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_key</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:=&nbsp; -&lt;key> &lt;value>&nbsp;&nbsp;&nbsp; -- (mandatory)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_key_opt</font>&nbsp;&nbsp;&nbsp;&nbsp;
:= [-&lt;key> &lt;value>]&nbsp;&nbsp; -- (optional, without default value)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_key_dflt</font>&nbsp;&nbsp;&nbsp;&nbsp;
:= [-&lt;key> &lt;value>]&nbsp;&nbsp; -- (optional, with default value)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_flag</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= -&lt;flag>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-- (always optional)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">--&nbsp;&nbsp;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= optional delimiter to indicate the beginning of pos. args
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_pos</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= &lt;value>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-- (mandatory)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_pos_opt&nbsp;</font>&nbsp;&nbsp;
:= [&lt;value>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --
(optional, without default value)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_pos_dflt</font>&nbsp;&nbsp;&nbsp;
:= [&lt;value>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --
(optional, with default value)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_extra</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= &lt;value>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-- (dep. on the constraint policy)
<br>//&nbsp;&nbsp;&nbsp; <font color="#FF0000">arg_extra_opt</font>&nbsp;
:= [&lt;value>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --
(dep. on the constraint policy)
<br>//
<br>// and:
<br>//&nbsp;&nbsp;&nbsp; &lt;key> must be followed by &lt;value>
<br>//&nbsp;&nbsp;&nbsp; &lt;flag> and &lt;key> are case-sensitive, and
they can contain
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
only alphanumeric characters
<br>//&nbsp;&nbsp;&nbsp; &lt;value> is an arbitrary string (additional
constraints can
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
be applied in the argument description, see "EType")
<br>//
<br>// {<font color="#FF0000">arg_pos***</font>} and {<font color="#FF0000">arg_extra***</font>}
-- position-dependent arguments, with
<br>// no tag preceding them.
<br>// {<font color="#FF0000">arg_pos***</font>} -- have individual names
and descriptions (see methods
<br>// AddPositional***).
<br>// {<font color="#FF0000">arg_extra***</font>} have one description
for all (see method AddExtra).
<br>// User can apply <a href="#ref_CArgDescriptions_Number">constraints</a>
on the number of mandatory and optional
<br>// {<font color="#FF0000">arg_extra***</font>} arguments.
</p>
<p>
Examples:
<pre class="ncbi_cmd">
    MyProgram1 -reverse -depth 5 -name Lisa -log foo.log 1.c 2.c 3.c
    MyProgram2 -i foo.txt -o foo.html -color red
    MyProgram3 -a -quiet -pattern 'Error:' bar.txt
</pre>
</p>



<p>&nbsp;</p>



<a NAME="ref_CArgDescriptions"></a>
<h3>The <a href="../docxx/CArgDescriptions.html" class="ncbi_class">CArgDescriptions</a>
class</h3>

<br>
<h4><a NAME="ref_CArgDescriptions_Attr"></a>Argument description attributes</h4>

<p>
Methods <span class="ncbi_func">AddXxx() </span>are used to describe the following argument attributes:
<dl>
  <dt><i><font color="#0000B4">name</font></i><!--NCBI_MARK--></dt>
  <dd>
The string that will be used to identify the variable, as in: <span class="ncbi_var">CArgs[name].
</span>For all tagged variables in a command line, name is also the key (or flag)
to be used there, as in: "<span class="ncbi_app_a">-name value</span>" (or "<span class="ncbi_app_a">-name"</span>).
  </dd>

  <dt>
<i><font color="#0000B4">synopsis&nbsp;&nbsp;&nbsp; </font></i><!--NCBI_MARK--><font color="#000000">(for
</font><span class="ncbi_type">key_***</span> arguments only)
  </dt>
  <dd>
The automatically generated <i><a href="#ref_CArgDescriptions_Usage">USAGE</a></i><!--NCBI_MARK-->
message includes argument description in the format:
<br /><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-name [synopsis] &lt;type, constraint&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment</i>
  </dd>

  <dt><i><font color="#0000B4">comment</font></i><!--NCBI_MARK--></dt>
  <dd>
To be displayed in the <i><a href="#ref_CArgDescriptions_Usage">USAGE</a></i><!--NCBI_MARK-->
message, as described above.
  </dd>

  <dt><i><font color="#0000B4">value ttype</font></i><!--NCBI_MARK--></dt>
  <dd>
One of the scalar values defined in the <a href="#ref_EType" class="ncbi_arg_a">EType</a> 
enumeration, which defines the type of the argument.
  </dd>

  <dt>
<i><font color="#0000B4">default&nbsp;&nbsp;&nbsp;&nbsp; </font></i><!--NCBI_MARK--><font color="#000000">(for</font> <span class="ncbi_type">key_dflt</span> and
<span class="ncbi_type">pos_dflt</span> arguments only)
  </dt>
  <dd>
A default value to be used if the argument is not included in the command
line - only available for optional program arguments.
  </dd>

  <dt><i><font color="#0000B4">flags</font></i><!--NCBI_MARK--></dt>
  <dd>
The <span class="ncbi_term">flags</span> argument, which occurs optionally in all but the <span class="ncbi_func">AddFlag()</span>
method, has meaning only when <a href="#ref_EType">EType</a> is <span class="ncbi_var">eInputFile</span> or <span class="ncbi_var">eOutputFile</span>, and restricts the mode in which
the file should be opened.
  </dd>
</dl>
</p>



<br>
<a NAME="ref_CArgDescriptions_Types"></a>
<h4>Argument types</h4>
<p>
The <span class="ncbi_class">CArgDescriptions</span> class allows to define command-line arguments
that fit one of the following pattern types:
<dl>
<dt>
  <b>Mandatory named arguments:</b> <span class="ncbi_app_a">-&lt;key> &lt;value></span>
  (example: <span class="ncbi_app_a">-age 31</span>)
</dt>
<dd>
  Position-independent arguments that <em>must</em> be present in the command line.
  <br>
  <a href="../lxr/ident?i=AddKey" class="ncbi_func">AddKey(key, synopsis, comment, value_type,
flags)</a>
   <p>
</dd>

<dt>
  <b>Optional named arguments:</b> <span class="ncbi_app_a">[-&lt;key> &lt;value>]</span>
  (example: <span class="ncbi_app_a">-name Lisa</span>)
</dt>
<dd>
  Position-independent arguments that are <b>optional</b><!--NCBI_MARK-->.
  <br>
  <a href="../lxr/ident?i=AddKey" class="ncbi_func">AddOptionalKey(key, synopsis, comment,
value_type, flags)</a>
  <br>
  A default value can be specified in the argument's description to cover
  those cases where the argument does not occur in the command line.
  <br>
  <a href="../lxr/ident?i=AddKey" class="ncbi_func">AddDefaultKey(key, synopsis, comment,
value_type, default_value, flags)</a>
  <p>
</dd>

<dt>
  <b>Optional named flags:</b> <span class="ncbi_app_a">[-&lt;flag>]</span>
  (example: <span class="ncbi_arg_a"> -reverse</span>)
</dt>
<dd>
  Position-independent boolean (without value) arguments. These arguments
  are <em>always</em> optional.
  <br>
  <a href="../lxr/ident?i=AddFlag" class="ncbi_func">AddFlag(flag, comment, set_value)</a>
  <p>
</dd>

<dt>
  <b>Mandatory named positional arguments:</b> <span class="ncbi_app_a">&lt;value></span>
  (example: <span class="ncbi_app_a">12 Feb</span>)
</dt>
<dd>
  These are position-<span class="ncbi_term">dependent</span> arguments (of any type), which are
  read using a <span class="ncbi_app_a">value</span> only. They do however, have names stored with
  their descriptions, which they are associated with in an order-dependent
  fashion. Specifically, the order in which untagged argument descriptions
  are added to the <span class="ncbi_class">CArgDescriptions</span> object using <span class="ncbi_func">AddPositional()</span>
  defines the order in which these arguments should appear in the command line.
  <br>
  <a href="../lxr/ident?i=AddPlain" class="ncbi_func">AddPositional(key, comment, value_type,
flags)</a>
  <p>
</dd>

<dt>
  <b>Optional named positional arguments:</b> <span class="ncbi_app_a">[value]</span>
  (example: <span class="ncbi_app_a">foo.txt&nbsp; bar</span>)
</dt>
<dd>
  Position-<span class="ncbi_term">dependent</span> arguments that are <span class="ncbi_term">optional</span>. They always go after the <span class="ncbi_term">mandatory</span> positional arguments. The order in which untagged argument descriptions are added to the <span class="ncbi_class">CArgDescriptions</span> object using <span class="ncbi_func">Add[Optional|Default]Positional()</span> defines the order in which these arguments should appear in the command line.
  <br>
  <a href="../lxr/ident?i=AddPlain" class="ncbi_func">AddOptionalPositional(key, comment,
value_type, flags)</a>
  <br>
  <a href="../lxr/ident?i=AddPlain" class="ncbi_func">AddDefaultPositional(key, comment,
value_type, default_value, flags)</a>
  <p>
</dd>

<dt>
   <b>Unnamed positional arguments</b> (all of the same type: <span class="ncbi_app_a">&lt;value1&gt;
| [valueN]</span>
   (example: <span class="ncbi_app_a">foo.c bar.c xxx.c</span>)
</dt>
<dd>
  These are also position-<span class="ncbi_term">dependent</span> arguments that are read using
  a <span class="ncbi_app_a">value</span> only. They are expected to appear at the very end of 
  the command line, after all named arguments. Unlike the previous argument type however,
  these arguments do not have individual named descriptions, but share a
  single "unnamed" description. You can specify how many mandatory and how
  many optional arguments to expect using <span class="ncbi_var">n_mandatory</span> and
  <span class="ncbi_var">n_optional</span> parameters:
  <br>
  <a href="../lxr/ident?i=AddExtra">AddExtra(n_mandatory, n_optional, comment, type, flags)</a>
  </dd>
</dl>
</p>

<p>
Any of the registered descriptions can be tested for existence and/or deleted
using:
<pre class="ncbi_code">
    bool Exist(const string&amp; name) const;
    void Delete(const string&amp; name);
</pre>
These methods can also be applied to the unnamed positional arguments
(as a <span class="ncbi_app_a">group</span>), using: <span class="ncbi_ccode">Exist(kEmptyStr)</span> and <span class="ncbi_ccode">Delete(kEmptyStr).</span>
</p>

<br>
<a NAME="ref_CArgDescriptions_StdValueTypes"></a>
<h4>Standard types: type restrictions imposed on the input argument values</h4>
<p>
Although each argument's input value is initially loaded as a simple character
string, the argument's specified type entails a restricted set of
possible values. For example, if the type is <span class="ncbi_var">eInteger</span>, then any
integer value is acceptable, but floating point and non-numerical values
are not. The <a href="../lxr/ident?i=CArgDescriptions">EType</a>
enumeration quantifies the allowed types and is defined as:
<a NAME="ref_EType"></a>
<blockquote>
<pre class="ncbi_code">
enum EType {
    eString = 0,  // an arbitrary string
    eBoolean,     // {'true', 't', 'false', 'f'}, case-insensitive
    eInteger,     // convertible to an integer number (long)
    eDouble,      // convertible to a floating point number (double)
    eInputFile,   // name of file (must exist and be readable)
    eOutputFile   // name of file (must be writeable)
</pre>
</blockquote>
</p>


<br>
<a NAME="ref_CArgDescriptions_UserValueTypes"></a>
<h4><span class="ncbi_class">CArgAllow</span> class:
user-defined restrictions on the range of allowed values</h4>

<p>
Further restrictions on the allowed values can be specified using the <span class="ncbi_func">CArgDescriptions::SetConstraint()</span> method with the
<a href="../docxx/CArgAllow.html" class="ncbi_class">CArgAllow</a> class.
For example:
<pre class="ncbi_code">
    auto_ptr&lt;CArgDescriptions&gt; args(new CArgDescriptions);
    // add descriptions for "firstint" and "nextint" using AddXxx( ...)
    ...
    CArgAllow* constraint = new CArgAllow_Integers(5,10);
    args-&gt;SetConstraint("firstInt", constraint);
    args-&gt;SetConstraint("nextInt", constraint);
</pre>
This specifies that the arguments named <span class="ncbi_app_a">"firstInt"</span>
and <span class="ncbi_app_a">"nextInt"</span> must both be in the range [5, 10]
The <a href="../docxx/CArgAllow_Integers.html" class="ncbi_class">CArgAllow_Integers</a>
class is derived from the <em>abstract</em> <span class="ncbi_class">CArgAllow</span> class. 
The constructor takes the two integer arguments as lower and upper bounds for allowed values.
Similarly, the <a href="../docxx/CArgAllow_Doubles.html"class="ncbi_class">CArgAllow_Doubles</a>
class can be used to specify a range of allowed floating point values.
For both classes, the order of the numeric arguments does not matter, as
the constructors will use min/max comparisons to generate a valid range.
</p>

<p>
A third class derived from the <span class="ncbi_class">CArgAllow</span> class is the
<a href="../docxx/CArgAllow_Strings.html" class="ncbi_class">CArgAllow_Strings</a>
class. In this case, the set of allowed values can not be specified
by a <span class="ncbi_class">range</span>, but the following construct can be used to enumerate
all eligible string values:
<pre class="ncbi_code">
    CArgAllow* constraint = (new CArgAllow_Strings())-&gt;
                             Allow("this)->Allow("that")-&gt;Allow("etc");
    args.SetConstraint("someString", constraint);
</pre>
Here, the constructor takes no arguments, and the <span class="ncbi_func">Allow() </span>method
returns <span class="ncbi_var">this</span>. Thus, a list of allowed strings can be specified by
daisy-chaining a set of calls to <span class="ncbi_func">Allow()</span>. A bit unusual yet terser
notation can also be used by engaging the comma operator, as in:
<pre class="ncbi_code">
    args.SetConstraint("someString",
                       &amp;(*new CArgAllow_Strings, "this", "that", "etc"));
</pre>
Other two pre-defined constraint classes are
<a href="../docxx/CArgAllow_Symbols.html" class="ncbi_code">CArgAllow_Symbols</a>
and <a href="../docxx/CArgAllow_String.html" class="ncbi_code">CArgAllow_String</a>.
<br />
If the value provided on the command line is not in the allowed set
of values specified for that argument, then an exception will be thrown.&nbsp;
This exception can be caught and handled in the usual manner, as&nbsp;
described in the discussion of <a href="#ref_CArgDescriptions_Usage">Generating
a <span class="ncbi_term">USAGE </span>message.</a>
</p>

<br>
<a NAME="ref_CArgDescriptions_App"></a>
<h4>Using <span class="ncbi_class">CArgDescriptions</span> in application</h4>
<p>
Description of program arguments should be provided in application's
<span class="ncbi_func">Init()</span> function before any other initialization. A good idea
is also to specify the program's description here:
<pre class="ncbi_code">
    auto_ptr&lt;CArgDescriptions&gt; arg_desc(new CArgDescriptions);
    arg_desc->SetUsageContext(GetArguments().GetProgramBasename(),
                              "program's description here");
    // Define arguments, if any
    ... 
    SetupArgDescriptions(arg_desc.release());
</pre>
The <span class="ncbi_func">SetUsageContext()</span> method is used to define the name of the
program and its description, which is to be displayed in the <span class="ncbi_term">USAGE</span>
message.
<br />
As long as applications's initialization is completed and there is still no
argument description, <span class="ncbi_class">CNcbiApplication</span> class provides a "default" one.
This behavior can be overridden by calling <span class="ncbi_func">DisableArgDescriptions()</span>
method of <span class="ncbi_dir">CNcbiAppliation</span>.
</p>


<br>
<a NAME="ref_CArgDescriptions_Usage"></a>
<h4>Generating a <span class="ncbi_term">USAGE</span> message</h4>
<p>
One of the functions of <span class="ncbi_class">CArgDescriptions</span> object is to generate
a <span class="ncbi_term">USAGE</span> message automatically (this gives yet another reason
to define one). Once such object is <a href="#ref_CArgDescriptions_App">defined</a>,
there is nothing else to worry about - <span class="ncbi_class">CNcbiApplication</span> will do the job
for you: <span class="ncbi_func">SetupArgDescriptions()</span> method includes parsing the command line
and matching arguments against their descriptions. Should an error occurs, -
e.g. a mandatory argument is missing,  - the program prints a message
explaining what was wrong and terminates. The output in this case might look like this:
<pre class="ncbi_output">
USAGE
  myApp -h -k MandatoryKey [optarg]

DESCRIPTION
   myApp test program

REQUIRED ARGUMENTS
 -k &lt;String&gt;
   This is a mandatory alpha-num key argument

OPTIONAL ARGUMENTS
 -h
   Print this USAGE message;  ignore other arguments
 optarg &lt;File_Out&gt;
   This is an optional named positional argument without default value
========================================================================
"E:\cxx\src\corelib\ncbiapp.cpp", line 437: Error:
NCBI C++ Exception:
    "E:\cxx\src\corelib\ncbiargs.cpp", line 621: Error: (CArgException::eNoArg) Argument "k". Required argument missing:  `String'
    "E:\cxx\src\corelib\ncbiapp.cpp", line 383: Error: (CArgException::eNoArg) Application's initialization failed
</pre>
The message shows a description of the program, and a summary of each argument.
In this example, the input file argument's description was defined as:
<pre class="ncbi_code">
    arg_desc-&gt;AddKey( "k", "MandatoryKey",
             "This is a mandatory alpha-num key argument",
             CArgDescriptions::eString);
</pre>
The information generated for each argument is displayed in the format:
<blockquote>
<i>me [synopsis]  &lt;type [, constraint] &gt;<br />
comment<br />
[default = .....]</i><!--NCBI_MARK-->
</blockquote>
</p>


<p>&nbsp;</p>


<a NAME="ref_CArgs"></a>
<h3>The <a href="../docxx/CArgs.html">CArgs</a> class: A container class
for <a href="#ref_CArgValue">CArgValue</a> objects</h3>

<p>
The <span class="ncbi_class">CArgs</span> class provides a data structure where the arguments' values
can be stored, and includes access routines in its public interface:
<blockquote>
<pre class="ncbi_code">
class CArgs
{
public:
    bool Exist(string&amp; name) const;
                   // true if name has a description
    const CArgValue&amp; operator [](string&amp; name);
                   // retrieve value by argument name
    unsigned GetNExtra(void) const;
                   // number of passed unnamed(extra) arguments
    const CArgValue&amp; operator [](unsigned idx);
                   // retrieve value by unnamed arg's index
    void Print(string&amp; str) const;
                   // print all arguments to "str"
};
</pre>
</blockquote>

As a result of executing <span class="ncbi_func">CArgDescriptions::CreateArgs()</span>, the command
line's arguments are validated against the registered descriptions, and
a <span class="ncbi_class">CArgs</span> object is created.&nbsp; Each argument value is internally
represented as a <a href="#ref_CArgValue" class="ncbi_class">CArgValue</a> object,
and is added to a container managed by the <span class="ncbi_class">CArgs</span> object.
All <span class="ncbi_term">named</span> arguments can be accessed using the <span class="ncbi_ccode">[ ]</span> operator, as in: <span class="ncbi_ccode">myCArgs["f"]</span>,
where <span class="ncbi_value">"f"</span> is the name registered for that argument. There are two ways
to access the <em>N</em>-th <span class="ncbi_term">unnamed</span> positional argument: <span class="ncbi_ccode">myCArgs["#N"]</span> and <span class="ncbi_ccode">myCArgs[N]</span>,
where 1 &lt;= <em>N</em> &lt;= GetNExtra().
</p>


<p>&nbsp;</p>

<a NAME="ref_CArgValue"></a>
<h3><a href="../docxx/CArgValue.html" class="ncbi_class">CArgValue </a> class:
the internal representation of argument values</h3>

<p>
The internal representation of an argument value - as it is stored and
retrieved from its <a href="#ref_CArgs" class="ncbi_class">CArgs</a> container - is
an instance of a
<span class="ncbi_class">CArgValue</span>. The primary purpose of this class is
to provide type-validated loading through a set of <span class="ncbi_func">AsXxx()</span> methods:

<blockquote>
<pre class="ncbi_code">
class CArgValue : public CObject
{
public:
    // Check if the argument holds a value.
     // Argument does not hold value if it was described as optional argument
     // without default value, and if it was not passed a value in the command
     // line. On attempt to retrieve the value from such "no-value" argument,
     // exception will be thrown.
     virtual bool HasValue(void) const = 0;
     operator bool (void) const { return  HasValue(); }
     bool operator!(void) const { return !HasValue(); }

     // Get the argument's string value.
     // (If it is a value of flag argument, then return one of "true", "false".)
     virtual const string&amp; AsString(void) const = 0;

     // These functions throw an exception if you requested the wrong
     // value type (e.g. if called "AsInteger()" for a "boolean" arg).
     virtual long   AsInteger(void) const = 0;
     virtual double AsDouble (void) const = 0;
     virtual bool   AsBoolean(void) const = 0;

     virtual CNcbiIstream&amp; AsInputFile (void) const = 0;
     virtual CNcbiOstream&amp; AsOutputFile(void) const = 0;
     virtual void          CloseFile(void) const = 0; // safe close&amp;destroy
};
</pre></blockquote>

Each of these <span class="ncbi_func">AsXxx()</span> methods will access the string storing the
requested variable's value, and attempt to convert that string to the specified
type, using for example, functions such as <span class="ncbi_func">atoi() </span>or<span class="ncbi_func"> atof()</span>.
Thus, the following construct can be used to obtain the value of a floating
point argument named "f":
<pre class="ncbi_code">
   float f = args["f"].AsDouble();
</pre>
An exception will be thrown with an appropriate error message, if:
<ul>
  <li>the conversion fails, or</li>
  <li>
"f" was described as an optional key or positional argument without default
value (i.e. using <span class="ncbi_func">AddOptional***()</span> method), and it was not defined
in the command line. NOTE: you can check for this case using <span class="ncbi_func">CArgValue::HasValue()</span>
method.
  </li>
</ul>
</p>


<p>&nbsp;</p>

<a NAME="ref_CodeExamples"></a>
<h3>Code examples</h3>
<p>
A simple application program,
<a href="../lxr/source/src/corelib/test/test_ncbiargs_sample.cpp" class="ncbi_file">test_ncbiargs_sample.cpp</a>
demonstrates the usage of these classes for argument processing. See also
<a href="../lxr/source/src/corelib/test/test_ncbiargs.cpp" class="ncbi_file">test_ncbiargs.cpp</a>
(especially <span class="ncbi_func">main()</span>, <span class="ncbi_func">s_InitTest0() </span>and<span class="ncbi_func"> s_RunTest0()</span> there),
and <a href="../lxr/source/src/objects/asn2asn/asn2asn.cpp" class="ncbi_file">asn2asn.cpp</a></i>
for more examples.
</p>

<p>&nbsp;</p>
<i><a href="applic.html">previous&nbsp;</a></i><!--NCBI_MARK-->&nbsp;&nbsp;&nbsp; <i><a href="../index.html">up</a><a href="registry.html">next&nbsp;</a></i><!--NCBI_MARK-->


<!--#include virtual="../ssi/navlinks.shtml" -->

<table BORDER=0 CELLSPACING=0 WIDTH="100%" >
<tr>
<td>
<address>
<a href="mailto:cpp-core@ncbi.nlm.nih.gov">Diane Zimmerman</a></address>
</td>

<td><!-- <td align=center><span class="ncbi_cvs_rev">$Revision$</span></td> --></td>

<td ALIGN=RIGHT><span class="ncbi_cvs_date">$Date$</span></td>
</tr>

<tr>
<td>
<address>
<a href="mailto:cpp-core@ncbi.nlm.nih.gov">Denis Vakatov</a></address>
</td>
</tr>
</table>

<!--#include virtual="../ssi/footer.shtml" -->
