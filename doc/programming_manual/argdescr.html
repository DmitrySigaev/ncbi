<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (X11; U; SunOS 5.7 sun4u) [Netscape]">
   <title> Using the CArgDescriptions class </title>
</head>
<body bgcolor="#FFFFFF">

<h1>
Parsing, validating, and accessing command line arguments</h1>

<ul>
<li>
<a href="#ref_Overview">Overview</a></li>

<ul>
<li>
<a href="#ref_Overview_WhatFor">What this API allows you to do with the
command-line arguments</a></li>

<li>
<a href="#ref_Overview_Classes">The relationships between the <i>CArgDescriprions</i>,
<i>CArgs</i>,
and <i>CArgValue</i> classes</a></li>

<li>
<a href="#ref_Overview_Structure">The generic structure of the command
line and the available argument types</a></li>
</ul>

<li>
<a href="#ref_CArgDescriptions">The <i>CArgDescriptions</i> class: specifying
argument attributes and constraints</a></li>

<ul>
<li>
<a href="#ref_CArgDescriptions_Attr">Argument attributes (name, synopsys,
comment, value type, default value)</a></li>

<li>
<a href="#ref_CArgDescriptions_Types">Argument <i>types</i></a></li>

<ul>
<li>
position-independent arguments (tagged)</li>

<ul>
<li>
mandatory keys:&nbsp; <font color="#008080">-&lt;key> &lt;value></font></li>

<li>
optional keys:&nbsp; <font color="#660000">[</font><font color="#008080">-&lt;key>
&lt;value>]</font></li>

<li>
flags: <font color="#008080">-&lt;flag></font></li>
</ul>

<li>
positional arguments (no preceding tags)</li>

<ul>
<li>
plain (named):&nbsp; <font color="#008080">&lt;value></font></li>

<li>
extra: <font color="#008080">&lt;value> .....</font></li>
</ul>
</ul>

<li>
<a href="#ref_CArgDescriptions_StdValueTypes">Standard types: type restrictions
imposed on the input arguments</a></li>

<li>
<a href="#ref_CArgDescriptions_UserValueTypes"><i>CArgAllow</i> class:
user-defined restrictions on the range of allowed values</a></li>

<li>
<a href="#ref_CArgDescriptions_Number">Constraining the number of positional
arguments</a></li>
</ul>

<li>
<a href="#ref_CArgs">The <i>CArgs</i> class: A container class for <i>CArgValue</i>
objects</a></li>

<li>
<a href="#ref_CArgValue">The <i>CArgValue</i> class: The internal representation
of argument values</a></li>

<li>
<a href="#ref_CodeExamples">Code examples</a></li>
</ul>
<a NAME="ref_Overview"></a>
<h3>
Overview</h3>

<h4>
<a NAME="ref_Overview_WhatFor"></a>What this API allows you to do with
the command-line arguments</h4>
This set of classes implements automated&nbsp; command line parsing. Specifically,
it allows the developer to:
<ul>
<li>
specify attributes for the expected arguments, such as name, synopsis,
comment, data type, etc.</li>

<li>
validate the values of arguments passed to the program against these descriptions</li>

<li>
validate the number of positional arguments occurring in the command line</li>

<li>
generate a <i><a href="#ref_CArgDescriptions_Usage">USAGE</a></i> message
based on the argument descriptions</li>

<li>
access the input argument values specifically type-cast according to their
description</li>
</ul>

<h4>
<a NAME="ref_Overview_Classes"></a>The relationships between the <i>CArgDescriptions</i>,
<i>CArgs</i>,
and <i>CArgValue</i> classes</h4>
The <i><a href="#ref_CArgDescriptions">CArgDescriptions</a></i> class provides
an interface to describe the data type and attributes of&nbsp; command-line
arguments, via a set of <i>AddXxx()</i> methods.&nbsp; Additional constraints
on the number of arguments and their acceptable ranges of values can be
imposed using the <i>SetConstraint()</i> methods.&nbsp; The <i>CreateArgs()
</i>method
is passed the values of all command line arguments at runtime. It verifies
their overall syntactic structure and matches their values against the
stored descriptions. If the arguments are parsed successfully,&nbsp; a
new <i><a href="#ref_CArgs">CArgs</a></i> object is returned by <i>CreateArgs()</i>.
<p>The resulting
<i><a href="#ref_CArgs">CArgs</a></i> object will contain
verified and ready-to-use argument values which are stored as <i><a href="#ref_CArgValue">CArgValue</a></i>'s.
The value of&nbsp; a particular argument can be accessed using the argument's
name (as it was specified in&nbsp; the <i><a href="#ref_CArgDescriptions">CArgDescriptions</a></i>
object),&nbsp; and the returned&nbsp; <i><a href="#ref_CArgValue">CArgValue</a></i>
object can then be safely type-cast to the right C++ type (<i>int</i>,
<i>string</i>,
<i>stream</i>,
etc.). These class relations and methods can be summarized
<font color="#003300">schematically</font>
as:
<center><img SRC="flow.gif" height=288 width=612></center>
The last statement in this example implicitly references a <i><a href="#ref_CArgValue">CArgValue</a></i>
object, in the value returned when the <i>[ ] </i>operator is applied to
<i>myArgs</i>.&nbsp;
The method <i>CArgValue::AsDouble() </i>is then applied to this object
to retrieve a<i> double.</i>
<h4>
<a NAME="ref_Overview_Structure"></a>The generic structure of the command
line, and available argument types</h4>
This API can describe and work with&nbsp; command line arguments that fit
the following profile:
<p>//&nbsp;&nbsp;&nbsp; progname&nbsp; {<font color="#008080">arg_key,
arg_key_opt, arg_flag</font>}&nbsp; {<font color="#008080">arg_plain</font>}&nbsp;
{<font color="#008080">arg_extra</font>}
<br>//
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008080">arg_key</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:=&nbsp; -&lt;key> &lt;value>&nbsp;&nbsp;&nbsp;&nbsp; -- (mandatory)
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008080">arg_key_opt&nbsp;</font>&nbsp;
:= [-&lt;key> &lt;value>]&nbsp;&nbsp;&nbsp; -- (optional)
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008080">arg_flag&nbsp;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= -&lt;flag>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-- (always optional)
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008080">arg_plain</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= &lt;value> | [value]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- (depends on the
<a href="#ref_CArgDescriptions_Number">constraint
policy</a>)
<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008080">arg_extra</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
:= &lt;value> | [value]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- (depends on the
<a href="#ref_CArgDescriptions_Number">constraint
policy</a>)
<br>//
<br>//&nbsp;&nbsp;&nbsp; &lt;key> must be followed by &lt;value>
<br>//&nbsp;&nbsp;&nbsp; &lt;flag> and &lt;key> are case-sensitive, and
can contain only alphanumeric (or underscore) characters
<br>//&nbsp;&nbsp;&nbsp; &lt;value> is an arbitrary string (additional
restrictions can be imposed upon the argument value)
<br>//
<br>// {<font color="#008080">arg_plain</font>} and {<font color="#008080">arg_extra</font>}
are position dependent arguments, with no tag preceding them.
<br>// {<font color="#008080">arg_plain</font>} have individual names and
descriptions.
<br>// {<font color="#008080">arg_extra</font>} have only one description
for all of them.
<br>// User can apply <a href="#ref_CArgDescriptions_Number">constraints</a>
on the <i>number</i> of position arguments.
<p><font color="#000099">Examples:</font>
<br><font color="#000099">&nbsp;&nbsp;&nbsp; MyProgram1 -reverse -depth
5 -name Lisa -log foo.log 1.c 2.c 3.c</font>
<br><font color="#000099">&nbsp;&nbsp;&nbsp; MyProgram2 -i foo.txt -o foo.html
-color red</font>
<br><font color="#000099">&nbsp;&nbsp;&nbsp; MyProgram3&nbsp; -a -quiet
-pattern 'Error:'&nbsp; bar.txt</font>
<p><a NAME="ref_CArgDescriptions"></a>
<h3>
The <i><a href="../docxx/CArgDescriptions.html">CArgDescriptions</a></i>
class</h3>

<h4>
<a NAME="ref_CArgDescriptions_Attr"></a>Argument description attributes</h4>
Methods <i>AddXxx() </i>are used to describe the following argument attributes:
<dl>
<dt>
<i><font color="#0000B4">name</font></i></dt>

<dd>
The string that will be used to identify the variable, as in: <i>CArgs[name].
</i>For
all tagged variables on the command line, name is also the key (or flag)
to be used there, as in: "<i>-name value</i>" (or "<i>-name"</i>).</dd>

<dt>
<i><font color="#0000B4">synopsis</font></i></dt>

<dd>
The automatically generated <i><a href="#ref_CArgDescriptions_Usage">USAGE</a></i>
messages include a description for each argument, with the format:</dd>

<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i>-name
[synopsis] type [mandatory | optional]</i>
<dt>
<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
comment</i></dt>

<dt>
<i><font color="#0000B4">comment</font></i></dt>

<dd>
Displayed in the <i><a href="#ref_CArgDescriptions_Usage">USAGE</a></i>
message, as described above.</dd>

<dt>
<i><font color="#0000B4">value<b> </b>type</font></i></dt>

<dd>
One of the scalar values defined in the <i><a href="#ref_EType">EType</a></i>&nbsp;
enumeration, defining the type category of the argument.</dd>

<dt>
<i><font color="#0000B4">flags</font></i></dt>

<dd>
The <i>flags </i>argument, which occurs optionally in all but the <i>AddFlag()</i>
method, has meaning only when <i><a href="#ref_EType">EType</a> </i>is<i>
eInputFile</i> or
<i>eOutputFile</i>, and constrains the mode in which
the file should be opened.</dd>

<dt>
<i><font color="#0000B4">default</font></i></dt>

<dd>
A default value to be used if the argument is not included on the command
line - only available for optional program arguments.</dd>

<dd>
</dd>
</dl>

<h4>
<a NAME="ref_CArgDescriptions_Types"></a>Argument <i>types</i></h4>
The <i>CArgDescriptions</i> class allows you to define command-line arguments
that fit one of the following 5 pattern types:
<dl>
<dt>
<font color="#000080">Mandatory named arguments:&nbsp; <i>-&lt;key> &lt;value>
</i></font><i><font color="#FF0000">(example:&nbsp;
-age 31)</font></i></dt>

<dd>
Position-independent arguments that <b>must</b> be present in the command
line.</dd>

<dd>
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=AddKey">AddKey(key,
synopsis, comment, value_type, flags)</a></i></dd>

<br>&nbsp;
<dt>
<font color="#000080">Optional named arguments:&nbsp; <i>[-&lt;key> &lt;value>]
</i></font><i><font color="#FF0000">(example:&nbsp;
-name Lisa)</font></i></dt>

<dd>
Position-independent arguments that are <b>optional</b>. A default value
can be specified in the argument's description to cover those cases where
the argument does not occur in the command line.</dd>

<dd>
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=AddKey">AddOptionalKey(key,
synopsis, comment, value_type, flags, default_value)</a></i></dd>

<br>&nbsp;
<dt>
<font color="#000080">Optional named flags:&nbsp; <i>[-&lt;flag>] </i></font><i><font color="#FF0000">(example:&nbsp;
-reverse)</font></i></dt>

<dd>
Position-independent boolean (without value) arguments. These arguments
are <i>always</i> optional.</dd>

<dd>
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=AddFlag">AddFlag(flag,
comment)</a></i></dd>

<br>&nbsp;
<dt>
<font color="#000080">Named positional arguments:&nbsp; <i>&lt;value> |
[&lt;value>]
</i></font><i><font color="#FF0000">(example:&nbsp; 12 Feb)</font></i></dt>

<dd>
These are position-<i>dependent</i> arguments (of any type), which are
input using a <i>value</i> only. They do however, have names stored with
their descriptions, which they are associated with in an order-dependent
fashion. Specifically, the order in which untagged argument descriptions
are added to the <i>CArgDescriptions</i> object (using <i>AddPlain()</i>)
defines the order in which these arguments should appear on the command
line. Using a <i><a href="#ref_CArgDescriptions_Number">constraint policy</a></i>,
it is possible to specify how many of these arguments <b>must</b> be present
in the command line.</dd>

<dd>
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=AddPlain">AddPlain(key,
comment, value_type, flags, default_value)</a></i></dd>

<br>&nbsp;
<dt>
<font color="#000080">Unnamed positional arguments (all of the same type:
<i>&lt;value1>
| [valueN]</i>&nbsp; </font><i><font color="#FF0000">(example:&nbsp; foo.c
bar.c xxx.c)</font></i></dt>

<dd>
These are also position-<i>dependent</i> arguments that are input using
a <i>value</i> only. Again, the same <i><a href="#ref_CArgDescriptions_Number">constraint
policy</a></i> determines how many of these arguments are required. Unlike
the previous argument type however, these arguments do not have individual
named descriptions, but share a single "unnamed" description.</dd>

<dd>
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=AddExtra">AddExtra(comment,
type, flags)</a></i></dd>
</dl>
Any of the registered descriptions can be tested for existance and/or deleted
using:
<p><font color="#008080">&nbsp;&nbsp; bool Exist(const string&amp; name)
const;</font>
<br><font color="#008080"><b>&nbsp;&nbsp; </b>void Delete(const string&amp;
name);</font>
<p>These methods can also be applied to the unnamed postional arguments
(as a <i>group</i>),&nbsp; using: <i>Exist(NcbiEmptyString) </i>and<i>
Delete(NcbiEmptyString).</i>
<h4>
<a NAME="ref_CArgDescriptions_StdValueTypes"></a>Standard types: type restrictions
imposed on the input argument <i>values</i></h4>
Although each argument's input value is initially loaded as a simple character
string, the argument's specified <i>type</i> entails a restricted set of
possible values. For example, if the type is <i>eInteger</i>, then any
integer value is acceptable, but floating point and non-numerical values
are not. The <i>EType</i> enumeration quantifies the allowed types and
is defined as:
<br><a NAME="ref_EType"></a>
<br>&nbsp;<font color="#008080">&nbsp; enum <a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=CArgDescriptions">EType</a>
{</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eString
= 0,&nbsp;&nbsp;&nbsp; // an arbitrary string</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eAlnum,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// [a-zA-Z0-9_]</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eBoolean,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// {'true', 't', 'false', 'f'},&nbsp; case-insensitive</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eInteger,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// convertable to an integer number (long)</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eDouble,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// convertable to a floating point number (double)</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eInputFile,&nbsp;&nbsp;&nbsp;
// name of file (must exist and be readable)</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eOutputFile&nbsp;
// name of file (must be writeable)</font>
<br><font color="#008080">&nbsp;&nbsp; };</font>
<h4>
<a NAME="ref_CArgDescriptions_UserValueTypes"></a><i>CArgAllow</i> class:
user-defined restrictions on the range of allowed values</h4>
Further restrictions on the allowed values can be specified using the <i>CArgDescriptions::SetConstraint()
</i>method
with the <i><a href="../docxx/CArgAllow.html">CArgAllow</a></i> class.
For example:
<blockquote><font color="#008080">CArgDescriptions args;</font><font color="#008080"></font>
<p><font color="#008080">// add descriptions for "firstint" and "nextint"
using AddXxx( ...)</font><font color="#008080"></font>
<p><font color="#008080">CArgAllow* constraint = new CArgAllow_Integers(5,
10);</font>
<br><font color="#008080">args.SetConstraint("firstInt", constraint);</font>
<br><font color="#008080">args.SetConstraint("nextInt", constraint);</font></blockquote>
<font color="#000000">This specifies that the arguments named "<i>firstInt</i>"
and "<i>nextInt</i>" must both be in the range [5, 10].&nbsp; </font>The
<i><a href="../docxx/CArgAllow_Integers.html">CArgAllow_Integers</a></i>
class is derived from the <b>abstract</b> <i>CArgAllow</i> class. The constructor
takes the two integer arguments as lower and upper bounds for allowed values.
Similarly, the <i><a href="../docxx/CArgAllow_Doubles.html">CArgAllow_Doubles</a></i>
class can be used to specify a range of allowed floating point values.&nbsp;
For both classes, the order of the numeric arguments does not matter, as
the constructors will use <i>min/max </i>comparisions to generate a valid
range.
<p>A third class derived from the <i>CArgAllow</i> class is the <i><a href="../docxx/CArgAllow_Strings.html">CArgAllow_Strings</a></i>
class.&nbsp; In this case, the set of allowed values can not be specified
by a <i>range,</i> but the following construct can be used to enumerate
all eligible string values:
<blockquote><font color="#008080">CArgAllow* constraint = (new CArgAllow_Strings())-></font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Allow("this)->Allow("that")->Allow("etc");</font>
<br><font color="#008080">args.SetConstraint("someString", constraint);</font></blockquote>
Here, the constructor takes no arguments, and the <i>Allow() </i>method
returns <i>this</i>. Thus, a list of allowed strings can be specified by
daisy-chaining a set of calls to <i>Allow</i>(). A bit unusual yet terser
notation can also be used by engaging the comma operator, as in:
<blockquote><font color="#008080">args.SetConstraint("someString",</font>
<br><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&amp;(*new CArgAllow_Strings, "this", "that", "etc"));</font></blockquote>
If the value provided on the command line is not in the allowed set of
values specified for that argument, then an exception will be thrown.&nbsp;
This exception can be caught and handled in the usual manner, as&nbsp;
described in the discussion of <a href="#ref_CArgDescriptions_Usage">Generating
a <i>USAGE </i>message.</a>
<h4>
<a NAME="ref_CArgDescriptions_Number"></a>Constraining the number of positional
arguments</h4>
Positional argument values on the command line have no preceding tag, and
are associated with their argument descriptions according to the order
in which they occur, and the order in which these descriptions were registered.
Thus, if your program contained the following lines:
<p><font color="#008080">&nbsp;&nbsp; descriptions.AddPlain("n", "between
1 and 10", eInteger);</font>
<br><font color="#008080">&nbsp;&nbsp; descriptions.AddPlain("f", "between
0 and 1", eDouble);</font>
<p>then calling the program as: <i>myprog 1 0</i>, would bind the positional
parameters as <i>n = 1</i> and <i>f = 0.0</i>.
<p>By default, the total expected number of positional arguments is equal
to the number of <i>named</i> positional descriptions that were registered
using <i>AddPlain()</i>. It is possible to modify this default behavior
however, by using the <i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/ident?i=SetConstraint">SetConstraint()</a></i>
method. This method uses its two arguments, an <i>EConstraint policy</i>,
and an <i>unsigned int</i> value (<i>N</i>), to constrain the <i>total</i>
number of (named <i>and</i> unnamed) positional arguments, <i>M</i>, as
follows:
<br>&nbsp;
<center><table BORDER=2 NOSAVE >
<tr NOSAVE>
<th NOSAVE>
<center>policy</center>
</th>

<th>constraint</th>
</tr>

<tr>
<td><i>eAny&nbsp;</i></td>

<td>none&nbsp;</td>
</tr>

<tr>
<td><i>eLessOrEqual&nbsp;</i></td>

<td><i>M &lt;= N</i></td>
</tr>

<tr>
<td><i>eEqual&nbsp;</i></td>

<td><i>M == N</i></td>
</tr>

<tr>
<td><i>eMoreOrEqual&nbsp;</i></td>

<td><i>M => N</i></td>
</tr>
</table></center>

<p>A single shared description is registered for all additional
<i>unnamed</i>
positional arguments,&nbsp; via the <i>AddExtra()</i> method. By default,
<i>unnamed</i>
positional arguments are always optional, unless a constraint policy has
been explicitly set which requires them. We consider next how the number
of named and unnamed positional arguments must together satisfy the constraints.
<p>The <i>unnamed</i> positional arguments must always follow the named
positional arguments. The first <i>N</i> positional arguments will be associated
with the first <i>N</i> named descriptions that were registered using <i>AddPlain()</i>.
If this method was invoked<i> K</i> times, where <i>N &lt; K</i>, then
an exception will be thrown if there are only <i>N</i> arguments.&nbsp;
A second type of error might occur yet go undetected, when <i>unnamed</i>
positional arguments can appear. In this case, it is possible to erroneously
satisfy the required number of <i>named</i> positional arguments by incorrectly
associating the trailing <i>unnamed</i> positional arguments with the remaining
named descriptions.
<p>More generally, the default behavior is equivalent to what would result
from having called <i>SetConstraint(eEqual, n)</i>, where <i>n</i> is the
number of <i>named </i>positional arguments only. Thus, to allow <i>unnamed</i>
positional arguments on the command line as well, the <i>SetConstraint()</i>
method should be invoked with
<i>eMoreOrEqual</i> and/or a larger value
of <i>N</i>.
<h4>
<a NAME="ref_CArgDescriptions_Usage"></a>Generating a <i>USAGE</i> message</h4>
There are many points where an exception may arise, due to either an argument
type mismatch or missing arguments. <i>CArgDescriptions::CreateArgs()&nbsp;</i>
checks the command line arguments against the descriptions which have been
registered. The first step of this process involves a <i>pre-check</i>
that tests to see if the constraint policy is satisfiable. If so, then
the individual argument values are loaded and matched against their descriptions.&nbsp;
A <i>post-check</i> is then performed, to ensure that all of the mandatory
arguments are present and that the positional arguments satisfy the constraint
policy.
<p>Exceptions which are thrown during argument processing can be presented
to the user, but by themselves do not provide much information. Catching
the exception and displaying it <i>along</i> with a <i>USAGE</i> message
provides a sounder interface to the application, and can be done as follows:
<pre><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ...executed inside CNcbiApplication::Run()

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CArgDescriptions argDescr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CArgs args;</font></pre>

<pre><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; args = argDescr.CreateArgs( GetArguments() );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (exception&amp; e) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cerr &lt;&lt; e.what() &lt;&lt; endl;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; argDescr.SetUsageContext(GetArguments().GetProgramName(),&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "(program description)");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string a;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cerr &lt;&lt; argDesc.PrintUsage(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></pre>

<pre><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // success... okay to use "args" now</font></pre>
The <i>CreateArgs()</i> method actually serves two purposes: (1) it verifies
that all of the mandatory arguments are present, and that the number of
positional arguments is valid, and (2) it creates an instance of the <i><a href="#ref_CArgs">CArgs</a></i>
class, described below.
<p>The <i>SetUsageContext()</i> method is used to define the name of the
program and its description, as it will be displayed by the <i>USAGE</i>
message. <i>PrintUsage(some_string)</i> writes its message to <i>some_string,
</i>and returns that <i>string</i>, so that it can be used with an output
operator. The output generated when an exception occurs might look something
like:
<pre><font color="#000080">Must specify mandatory argument:&nbsp; "-i &lt;MyInputFile>"&nbsp;
SYNOPSIS
&nbsp;&nbsp; myApplic -text -i MyInputFile [-l MyLogFile]&nbsp;

DESCRIPTION&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; (program description)

OPERANDS&nbsp;&nbsp;&nbsp;
&nbsp;-text&nbsp;&nbsp;&nbsp; Flag
&nbsp;&nbsp; Use text input format
&nbsp;-i MyInputFile&nbsp;&nbsp;&nbsp; InpFile, mandatory
&nbsp;&nbsp; Input data file
&nbsp;[-l MyLogFile]&nbsp;&nbsp;&nbsp; OutFile, optional
&nbsp;&nbsp; Log errors to &lt;logfile></font></pre>
The printed <i>USAGE</i> message shows a synopsis of the program and its
arguments, a description of the program, and a summary of each argument,
as obtained from its description. In this example, the input file argument's
description was registered as:
<pre><font color="#008080">argDesc.AddKey("i", "MyInputFile", "Input data file", CArgDescriptions::eInputFile, 0);</font></pre>
The information generated for each argument is displayed in the format:
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i>-name
[synopsis] type [, mandatory | optional]</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
comment</i>
<p><a NAME="ref_CArgs"></a>
<h3>
The <i><a href="../docxx/CArgs.html">CArgs</a></i> class: A container class
for <i><a href="#ref_CArgValue">CArgValue</a></i> objects</h3>
The <i>CArgs</i> class provides a data structure where the arguments' values
can be stored, and includes access routines in its public interface:
<pre><font color="#008080">class CArgs
{
public:

&nbsp;&nbsp;&nbsp; bool Exist(string&amp; name) const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // true if name has a description
&nbsp;&nbsp;&nbsp; bool IsProvided(string&amp; name) const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // true if argument was also present

&nbsp;&nbsp;&nbsp; const CArgValue&amp; operator [](string&amp; name);&nbsp; // retrieve value by argument name

&nbsp;&nbsp;&nbsp; unsigned GetNExtra(void) const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // number of extra arguments
&nbsp;&nbsp;&nbsp; const CArgValue&amp; operator [](unsigned idx);&nbsp; // retrieve value by unnamed arg's index

&nbsp;&nbsp;&nbsp; void Print(string&amp; str) const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // print all agruments to "str"
};</font></pre>
As a result of executing <i>CArgDescriptions::CreateArgs()</i>, the command
line's arguments are validated against the registered descriptions, and
a <i>CArgs</i> object is created.&nbsp; Each argument value is internally
represented as a <i><a href="#ref_CArgValue">CArgValue</a></i> object,
and is added to a container managed by the <i>CArgs</i> object.&nbsp; All
<i>named</i>
arguments can be accessed&nbsp; using the [] operator, as in: <i>myCArgs["f"]</i>,
where "f" is the name registered for that argument. There are two ways
to access the <i>Nth</i> <i>unnamed</i> positional argument: <i>myCArgs["#N"]
</i>and
<i>myCArgs[N],&nbsp; </i>where<i> 1 &lt;= N &lt;= GetNExtra().</i>
<p><a NAME="ref_CArgValue"></a>
<h3>
<i><a href="../docxx/CArgValue.html">CArgValue </a></i>class:&nbsp; the
internal representation of argument values</h3>
The internal representation of an argument value - as it is stored and
retrieved from its <i><a href="#ref_CArgs">CArgs</a></i> container - is
an instance of a
<i>CArgValue</i>. The primary purpose of this class is
to provide type-validated loading through a set of <i>AsXxx()</i> methods:
<pre><font color="#008080">class CArgValue : public CObject
{
public:
&nbsp;&nbsp;&nbsp; // These functions throw an exception on the wrong value type
&nbsp;&nbsp;&nbsp; string&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AsString&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (void) const;
&nbsp;&nbsp;&nbsp; long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AsInteger&nbsp;&nbsp;&nbsp;&nbsp; (void) const;
&nbsp;&nbsp;&nbsp; double&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AsDouble&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (void) const;
&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AsBoolean&nbsp;&nbsp;&nbsp;&nbsp; (void) const;
&nbsp;&nbsp;&nbsp; CNcbiIstream&amp;&nbsp; AsInputFile&nbsp; (EFlags) const;
&nbsp;&nbsp;&nbsp; CNcbiOstream&amp;&nbsp; AsOutputFile (EFlags) const;
};</font></pre>
Each of these <i>AsXxx()</i> methods will access the string storing the
requested variable's value, and attempt to convert that string to the specified
type, using for example, functions such as <i>atoi() </i>or<i> atof()</i>.&nbsp;
Thus, the following construct can be used to obtain the value of a floating
point argument named "f":
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; float f = args["f"].AsDouble();</pre>
The last two methods assume the string is a filename, and attempt to open
a file of that name, using <i>EFlags</i> to determine the mode it is to
be opened with. The <i>EFlags</i> enumeration is defined in the <i>CArgValue</i>
class as:
<p><tt><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp; enum EFlags {</font></tt>
<br><tt><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
fUnchanged = 0x1, // do not change open mode</font></tt>
<br><tt><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
fToText&nbsp;&nbsp;&nbsp; = 0x2, // change file open mode to text</font></tt>
<br><tt><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
fToBinary&nbsp; = 0x4&nbsp; // change file open mode to binary</font></tt>
<br><tt><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp; };</font></tt>
<p>If the conversion fails, an exception will be thrown with an appropriate
error message.
<h1>
<a NAME="ref_CodeExamples"></a></h1>

<h3>
Code examples</h3>
A simple application program, <i><a href="applic_cpp.html">applic.cpp</a></i>
demonstrates the usage of these classes for argument processing. See also
<i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/source/src/corelib/test/test_ncbiargs.cpp">test_ncbiargs.cpp</a></i>,
and <i><a href="http://ray.nlm.nih.gov:6224/intranet/ieb/CPP/lxr/http/source/src/objects/asn2asn/asn2asn.cpp">asn2asn.cpp</a></i>
for more examples.
<p><i><a href="applic.html">previous&nbsp;</a></i>&nbsp;&nbsp;&nbsp; <i><a href="../index.html">up</a></i>&nbsp;&nbsp;

<i><a href="registry.html">next&nbsp;</a></i>
<hr>
<table BORDER=0 CELLSPACING=0 WIDTH="100%" >
<tr>
<td>
<address>
<a href="mailto:zimmerma@ncbi.nlm.nih.gov">Diane Zimmerman</a></address>
</td>

<td><!-- <td align=center><i>$Revision$</i></td> --></td>

<td ALIGN=RIGHT><i>$Date$</i></td>
</tr>

<tr>
<td>
<address>
<a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address>
</td>
</tr>
</table>

</body>
</html>
