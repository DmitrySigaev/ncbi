<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
  <title> asn2asn.cpp </title>
</head>
<body BGCOLOR="#FFFFFF">

<pre><font color = "red">
// File Description: Reads a Bioseq-set or seq-entry and translates
//		     binary/text to text/binary
<font color = "green">
#include <a href="asn2asn_hpp.html"> "asn2asn.hpp"</a>
#include &lt;corelib/ncbiutil.hpp>
#include &lt;corelib/ncbienv.hpp>
#include &lt;objects/seqset/Seq_entry.hpp>
#include &lt;objects/seqset/Bioseq_set.hpp>
#include &lt;serial/objistrasn.hpp>
#include &lt;serial/objistrasnb.hpp>
#include &lt;serial/objostrasn.hpp>
#include &lt;serial/objostrasnb.hpp>
#include &lt;serial/choiceptr.hpp>
#include &lt;serial/serial.hpp>

<font color = "blue">BEGIN_NCBI_SCOPE

using namespace objects; <font color = "black">

static
void PrintUsage(void)
{
    NcbiCout <<
      "Arguments:\n" <<
      "  -i  Filename for asn.1 input\n" <<
      "  -e  Input is a Seq-entry\n" <<
      "  -b  Input asnfile in binary mode\n" <<
      "  -S  Skip value in file without reading it in memory (no write after)\n" <<
      "  -o  Filename for asn.1 output\n" <<
      "  -s  Output asnfile in binary mode\n" <<
      "  -l  Log errors to file named\n";
    exit(1);
}

static
void InvalidArgument(const string& arg)
{
    ERR_POST(Error << "Invalid argument: " << arg);
    PrintUsage();
}

static
const string& StringArgument(const CNcbiArguments& args, size_t index)
{
    if ( index >= args.Size() || args[index].empty() )
      InvalidArgument("Argument required");
    return args[index];
}

<font color = "red">
/*****************************************************************************
*
*   Main program loop to read, process, write SeqEntrys
*
*****************************************************************************/
<font color = "black">
int CAsn2Asn::Run(void)
{
    string inFile;
    bool skip = false; 
    bool inSeqEntry = false;
    bool inBinary = false;
    string outFile;
    bool outBinary = false;
    string logFile;
 

<font color = "red">    // initialize the diagnostic stream <font color = "black">
  
    CNcbiOfstream diag("errs.asn2asn");
    SetDiagStream(&diag);

<font color = "red">    // process the input arguments <font color = "black">

    if ( GetArguments().Size() == 1 )
    PrintUsage();
    
    {
        for ( size_t i = 1; i < GetArguments().Size(); ++i ) {
            const string& arg = GetArguments()[i];
            if ( arg[0] == '-' ) {
                switch ( arg[1] ) {

      	       case 'i':
                    inFile = StringArgument(GetArguments(), ++i);
                    break;

                case 'e':
                    inSeqEntry = true;
                    break;

                case 'b':
                    inBinary = true;
                    break;

                case 'o':
                    outFile = StringArgument(GetArguments(), ++i);
                    break;

                case 's':
                    outBinary = true;
                    break;

                case 'S':
                    skip = true;
                    break;

                case 'l':
                    logFile = StringArgument(GetArguments(), ++i);
                    break;

                default:
                    InvalidArgument(arg);
                    break;
                }
            }
            else {
            	InvalidArgument(arg);
            	break;
            }
        }
    }

<font color = "red">    // initialize the ASN input stream <font color = "black">

    auto_ptr&lt;CNcbiIstream> inFStream;
    CNcbiIstream* inStream;
    if ( inFile.empty() || inFile == "stdin" ) {
        inStream = &NcbiCin;
    }
    else {
        if ( inBinary )
            inFStream.reset(inStream = 
                new CNcbiIfstream(inFile.c_str(), IOS_BASE::in | IOS_BASE::binary));
        else
            inFStream.reset(inStream = new CNcbiIfstream(inFile.c_str()));

        if ( !*inStream ) 
          ERR_POST(Fatal << "Cannot open file: " << inFile);
    }

<font color = "red">    // Associate an ASN input object with the input <font color = "black">

    auto_ptr&lt;CObjectIStream> inObject;
    if ( inBinary )
      inObject.reset(new CObjectIStreamAsnBinary(*inStream));
    else
      inObject.reset(new CObjectIStreamAsn(*inStream));
  
<font color = "red">    // initialize the ASN output stream <font color = "black">

    auto_ptr&lt;CNcbiOstream> outFStream;
    CNcbiOstream* outStream;
    if ( outFile.empty() ) {
        outStream = 0;
    }
    else if ( outFile == "stdout" || outFile == "-" ) {
        outStream = &NcbiCout;
    }
    else {
        if ( outBinary )
            outFStream.reset(outStream =
                new CNcbiOfstream(outFile.c_str(), IOS_BASE::out | IOS_BASE::binary));
        else
            outFStream.reset(outStream = new CNcbiOfstream(outFile.c_str()));

       if ( !*outStream )
           ERR_POST(Fatal << "Cannot open file: " << outFile);
    }

<font color = "red">    // Associate an ASN output object with the output <font color = "black">

    auto_ptr&lt;CObjectOStream> outObject;
    if ( outStream ) {
        if ( outBinary )
            outObject.reset(new CObjectOStreamAsnBinary(*outStream));
        else
            outObject.reset(new CObjectOStreamAsn(*outStream));
    }  
  
    if ( inSeqEntry ) {	  <font color = "red">  //  read one Seq-entry <font color = "black">

        CSeq_entry entry;
        *inObject >> entry;
        if ( outObject.get() )
        *outObject << entry;
    }

    else {                <font color = "red">  // read Seq-entry's from a Bioseq-set  <font color = "black">

        CBioseq_set entries;
        *inObject >> entries;
        if ( outObject.get() )
        *outObject << entries;
    }

    inObject.reset(0);
    outObject.reset(0);
    return 0;
}
<font color = "blue">END_NCBI_SCOPE

USING_NCBI_SCOPE; 
<font color = "black">
int main(int argc, char** argv)
{
    return CAsn2Asn().AppMain(argc, argv);
}
