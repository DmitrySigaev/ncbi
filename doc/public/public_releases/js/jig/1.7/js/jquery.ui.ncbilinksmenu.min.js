(function(){var m=jQuery.ui.ncbipopper.prototype._create,n=jQuery.ui.ncbipopper.prototype.open,o=jQuery.ui.ncbipopper.prototype.close;jQuery.widget("ui.ncbilinksmenu",jQuery.ui.ncbipopper,{_create:function(){this._checkHrefForWebService();this._setPopperOptions();m.apply(this,arguments);this._handleLinksMenu()},_checkHrefForWebService:function(){if(!this.options.webservice&&!this.options.destSelector&&!this.options.localJSON)this.options.webservice=this.element.attr("href")},_setPopperOptions:function(){var a=
this.options;a.openEvent="click";a.closeEvent="xmouseout";if(a.loadingMessage)a.showLoadingMessage=true;if(!a.width)a.width="200px";a.cssClass="ui-ncbilinksmenu";a.ignoreSettingOutterWidth=true;a.excludeBasicCssStyles=true;if(this.options.webservice||this.options.localJSON)this.options.destText="<ul class='linksmenu-ul'><li class='ui-ncbilinksmenu-loadingMessage'><span>"+this.options.loadingText+"</span></li></ul>"},_handleLinksMenu:function(){this.getDestElement().find("li").attr("role","presentation");
var a=this;this.getDestElement().find("a").attr({role:"menuitem",tabindex:"-1"}).click(function(b){a._pingDetails(b,this,"linksmenuclick");a.close()})},_setTriggerId:function(){var a=this.element.attr("id");a&&this.getDestElement().data("triggerId","#"+a).attr("data-jigtriggerid","#"+a)},_pingDetails:function(a,b,e){typeof ncbi!=="undefined"&&ncbi.sg&&ncbi.sg.ping&&ncbi.sg.ping(b,a.originalEvent,e,{})},close:function(){this._destroyKeyListeners();o.apply(this,arguments)},open:function(){this._setUpKeyListeners();
this._setTriggerId();n.apply(this,arguments);if(!this._contentFetched||!this.options.isDestTextCacheable){var a=this.options.webservice,b=this.options.localJSON;if(a)if(b=this._getCachedItem())this._handleResponse(b.data,b.contentType,true);else{var e=this;if(this.options.isJSONP){b=a.indexOf("?")>0?"&":"?";a+=b+"callback=?";jQuery.getJSON(a,{},function(i){e._loadContentJSON(i)})}else jQuery.ajax({url:a,success:function(i,l,c){e._handleResponse(i,c.getResponseHeader("content-type"))},error:function(){e.getDestElement().find("ul.linksmenu-ul").replaceWith("<ul class='linksmenu-ul'><li class='ui-ncbilinksmenu-errorMessage'><span>Error Loading Data</span></li></ul>");
window.setTimeout(function(){e.close()},4E3)}})}else b&&this._loadContentJSON(b)}},_handleResponse:function(a,b,e){e||(this._cachedCalls[this.options.webservice]={data:a,contentType:b});b=="application/json"?this._loadContentJSON(a):this._loadContent(a)},_cachedResponses:{},_loadContentJSON:function(a){function b(c,j){var f=c.text,g=c.href||"#",d=c.target||"",h=c.click||"",k=c.rel||"";if(d)d=' target="'+d+'"';if(k)k=' rel="'+k+'"';c=jQuery("<li></li>");f=jQuery("<a href='"+g+"'"+d+k+">"+f+"</a>");
if(h)try{var p=new Function(" return "+h+"()");f.click(function(q){p.call(this,q,i)})}catch(r){typeof console!=="undefined"&&console.error&&console.error(r)}c.append(f);j.append(c)}function e(c,j){for(var f=0;f<c.length;f++){var g=c[f],d=g.heading;if(d){var h=jQuery("<li></li>").attr("role","heading");d=jQuery("<span>"+d+"</span>");h.append(d);if(g=g.links){d=jQuery("<ul></ul>");e(g,d);h.append(d)}j.append(h)}else b(g,j)}}var i=this,l=jQuery("<ul></ul>").addClass("linksmenu-ul").attr("role","menu");
(a=a.links)&&e(a,l);this._contentFetched=true;this.getDestElement().find("ul.linksmenu-ul").replaceWith(l);this._handleLinksMenu();this.element.trigger("ncbilinksmenujsonmenuloaded")},_loadContent:function(a){var b=a;if(a.match(/(<html)/i)){a=jQuery("<div></div>").html(a).find(".linksmenu-ul");if(a.length>1)a=a.filter(this.options.webserviceMenuSelector);b=a.clone();if(!b){console.error("no element found");b="<ul class='linksmenu-ul'><li class='ui-ncbilinksmenu-errorMessage'><span>Error Loading Data</span></li></ul>"}}this._contentFetched=
true;this.getDestElement().find("ul.linksmenu-ul").replaceWith(b).addClass("linksmenu-ul");this._handleLinksMenu()},_setUpKeyListeners:function(){if(!this._popupkeylistener){var a=this;this.selectedOption=-1;this._popupkeylistener=function(b){a._moveMenuOption(b.keyCode)&&b.preventDefault()};jQuery(window).keypress(this._popupkeylistener)}},_destroyKeyListeners:function(){if(this._popupkeylistener){jQuery(window).unbind("keypress",this._popupkeylistener);this.selectedOption=null}},_keys:{up:38,down:40,
enter:13},_moveMenuOption:function(a){var b=this._keys;switch(a){case b.up:this._moveSelection(-1);cancelAction=true;break;case b.down:this._moveSelection(1);cancelAction=true;break;case b.enter:cancelAction=false;break;default:cancelAction=false}return cancelAction},_moveSelection:function(a){if(this.selectedOption===undefined||this.selectedOption===null)this.selectedOption=-1;this.selectedOption+=a;a=this.getDestElement().find("a");var b=a.length;if(this.selectedOption<0)this.selectedOption=b-1;
else if(this.selectedOption>=b)this.selectedOption=0;a.eq(this.selectedOption).focus()},_cachedCalls:{},_getCachedItem:function(){if(!this.options.isDestTextCacheable)return null;return this._cachedCalls[this.options.webservice]}})})();
