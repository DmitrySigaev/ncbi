(function(e){e.widget("ui.ncbitoggler",{styles:{ariaWrapper:"ui-ncbitoggler-live",groupMasterReplaceNode:"span.ui-ncbitoggler-group-replace-txt",groupMasterStateClose:"ui-ncbitoggler-group-master-to-close",groupMasterStateOpen:"ui-ncbitoggler-group-master-to-open",master:"ui-ncbitoggler",masterOpen:"ui-ncbitoggler-open",slave:"ui-ncbitoggler-slave",slaveOpen:"ui-ncbitoggler-slave-open",icon:"ui-icon-triangle-1-e",iconOpen:"ui-icon-triangle-1-s",iconPlusMinusBig:"ui-icon-plus-minus-big",iconPlusMinusBigOpen:"ui-icon-plus-minus-big-open"},
_create:function(){this._setOption("disabled",false);this.appendTextNode=this.initSlavesClass=this.iconSpan=this.startOpen=this.rememberCookie=this.remember=this.cookieName=this.addedHref=null;var a=this.element,b=a[0],c=this.styles,d=this,f=this.options.isIcon;a.addClass("ui-widget ui-ncbitoggler");f||a.addClass("ui-ncbitoggler-no-icon");var g=a.attr("href");!g?(this.addedHref=true):(this.addedHref=false);this._validate(g);a.children("span.ui-ncbitoggler-master-text").length===0&&a.contents().filter(function(){return this.nodeType===
3}).each(function(){var h=e(this);jQuery.trim(this.nodeValue).length>0&&h.wrap('<span class="ui-ncbitoggler-master-text"></span>')});if(this.options.openedAppendText!==""||this.options.closedAppendText!==""){this.appendTextNode=a.children("span.ui-ncbitoggler-appended-text");if(this.appendTextNode.length===0)throw new Error('ncbitoggler: when setting openAppendText or closedAppendText options, must have an existing <span class="ui-ncbitoggler-appended-text"> node as first child of master');}if(this.remember=
this.options.remember||false){g=this.element.attr("id");if(!g){window.console&&console.error&&console.error("ncbitoggler: master node "+b+" must have a unique id attribute when remembering state");return}this.cookieName=this.options.cookieNamePrefix+g;this.rememberCookie=e.cookie(this.cookieName)}if(this.startOpen=this.rememberCookie?this.rememberCookie==="open"?true:false:a.hasClass("jig-ncbitoggler-open")||a.hasClass(c.masterOpen)||this.options.initOpen?true:false){a.removeClass(this.styles.master);
a.addClass(c.masterOpen)}else{a.removeClass(this.styles.masterOpen);a.addClass(c.master)}f&&this._initMasterIcon();this.slaves=this._getSlaves();this.slaves.addClass("ui-widget ui-ncbitoggler").removeClass("ui-ncbitoggler-disabled ui-state-disabled");if(this.startOpen){this.slaves.removeClass(c.slave);this.slaves.addClass(c.slaveOpen);this.initSlavesClass=c.slaveOpen}else{this.slaves.removeClass(c.slaveOpen);this.slaves.addClass(c.slave);this.initSlavesClass=c.slave}this._initAria();this._doGrouping();
a.click(function(h){d.toggle(h,d)})},_getGroupMaster:function(){for(var a=this.styles,b=this.element[0].className.split(/\s+/),c=0;c<b.length;c++){var d=b[c].match(/ui-ncbitoggler-group-(.+)$/);if(d){d=d[1];var f=e("a.ui-ncbitoggler-group-open-"+d+", a.ui-ncbitoggler-group-close-"+d,this.options.contextNode);if(f.length===1){f.hasClass("ui-ncbitoggler-group-open-"+d)&&f.addClass(a.groupMasterStateOpen);f.hasClass("ui-ncbitoggler-group-close-"+d)&&f.addClass(a.groupMasterStateClose);return f}}}},_doGrouping:function(){var a=
this._getGroupMaster();if(a){var b=this,c=this.styles,d=a.data("togglers");this.element.id||e.ui.jig._generateId(this.widgetName);if(!this.element[0].id)this.element[0].id=e.ui.jig._generateId(this.widgetName);if(typeof d==="undefined"){a.data("togglers",[]);a.data("togglers").push(this.element)}else d.push(this.element);var f=a.find(c.groupMasterReplaceNode);a.click(function(g){g.preventDefault();g=a.data("togglers");g=g[g.length-1][0];if(a.hasClass(c.groupMasterStateOpen)){b.open();f.length>0&&
f.text(b.options.groupMasterCloseReplaceText);b.element[0]===g&&a.removeClass(c.groupMasterStateOpen).addClass(c.groupMasterStateClose)}else{b.close();f.length>0&&f.text(b.options.groupMasterOpenReplaceText);b.element[0]===g&&a.removeClass(c.groupMasterStateClose).addClass(c.groupMasterStateOpen)}})}},_initAria:function(){var a=this.startOpen;this.element.attr({role:"button","aria-expanded":a});this.slaves.attr({"aria-hidden":a?false:true});this.options.liveRegions&&this.slaves.each(function(){e(this).wrap('<div class="ui-helper-reset" aria-live="assertive">')})},
_validate:function(a){var b=this.element,c=["a","button"],d=b[0].tagName.toLowerCase();if(e.inArray(d,c)===-1)throw new Error("ncbitoggler: master node must be one of the following elements: "+c.toString());a||b.attr("href","#")},_initMasterIcon:function(){var a=this.element,b=this.styles;if(this.options.indicator=="plus-minus-big"){this.iconOpenClass=b.iconPlusMinusBigOpen;this.iconCloseClass=b.iconPlusMinusBig}else{this.iconOpenClass=b.iconOpen;this.iconCloseClass=b.icon}this.iconSpan=a.find("span.ui-icon");
if(this.iconSpan.length===0){this.iconSpan=e('<span class="ui-icon"></span>');this.startOpen?this.iconSpan.addClass(this.iconOpenClass):this.iconSpan.addClass(this.iconCloseClass);a.append(this.iconSpan)}else if(this.startOpen){this.iconSpan.removeClass(this.iconCloseClass);this.iconSpan.addClass(this.iconOpenClass)}},getSlaves:function(){return this._slaves},_getSlaves:function(){var a=this.element,b=a.attr("toggles");if(b){this.isSibling=false;a=b.split(/ +/);b="";for(var c=0;c<a.length;c++)b+=
c!==a.length-1?"#"+a[c]+",":"#"+a[c];a=e(b)}else if(a.parent(":header").length>0){a.parent(":header").parent().css("zoom","1");this.isSibling=true;a=a.parent(":header").css("zoom","1").next()}else{this.isSibling=true;a=a.next()}return this._slaves=a},_openSlaves:function(){var a=this.slaves,b=this.styles;a.removeClass(b.slave).addClass(b.slaveOpen).attr("aria-hidden","false");b=this.options.openedAppendText;b!==""&&this.appendTextNode.html(b);a.css("display","")},_closeSlaves:function(){var a=this.slaves,
b=this.styles;a.removeClass(b.slaveOpen).addClass(b.slave).attr("aria-hidden","true");b=this.options.closedAppendText;b!==""&&this.appendTextNode.html(b);a.css("display","")},_fixHasLayout:function(a){window.setTimeout(function(){a.slaves.addClass("foo").removeClass("foo")},1)},open:function(a){var b=this.element,c=this,d=this.styles;if(b.hasClass(d.master)){b.removeClass(d.master).addClass(d.masterOpen).attr("aria-expanded","true");this.options.isIcon&&this.iconSpan.removeClass(this.iconCloseClass).addClass(this.iconOpenClass);
this.remember&&e.cookie(this.cookieName,"open");if(this.options.animation==="slide")this.slaves.slideToggle(this.options.speed,function(){c._openSlaves();e.browser.msie&&c._fixHasLayout(c);b.trigger("ncbitoggleropen");a&&a()});else{this._openSlaves();e.browser.msie&&c._fixHasLayout(c);b.trigger("ncbitoggleropen");a&&a()}}return b},close:function(a){var b=this.element,c=this,d=this.styles;if(b.hasClass(d.masterOpen)){b.removeClass(d.masterOpen).addClass(d.master).attr("aria-expanded","false");this.options.isIcon&&
this.iconSpan.removeClass(this.iconOpenClass).addClass(this.iconCloseClass);this.remember&&e.cookie(this.cookieName,"closed");if(this.options.animation==="slide")this.slaves.slideToggle(this.options.speed,function(){c._closeSlaves();b.trigger("ncbitogglerclosed").trigger("ncbitogglerclose");a&&a()});else{this._closeSlaves();b.trigger("ncbitogglerclosed");a&&a()}}return b},toggle:function(a,b,c){var d=arguments.length;if(d===0||d===1){b=this;if(d===1)c=arguments[0]}else a.preventDefault();this.element.hasClass(this.styles.master)?
b.open(c):b.close(c)},_removeHandlers:function(){this.element.unbind("click");this.element.click(function(a){a.preventDefault()})},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);var a=this.element,b=this.styles;a.removeClass(b.master+" "+b.masterOpen+" ui-state-disabled ui-widget ui-ncbitoggler-disabled").removeAttr("role").removeAttr("aria-expanded");this.slaves.removeClass("ui-ncbitoggler-slave ui-ncbitoggler-slave-open ui-state-disabled ui-widget ui-ncbitoggler-disabled");
if(this.options.isIcon){b=a.find("span.ui-icon")[0];a[0].removeChild(b)}this.addedHref&&a.removeAttr("href");this._removeHandlers();return this},disable:function(){e.Widget.prototype.disable.apply(this,arguments);this._removeHandlers();this.slaves.addClass("ui-ncbitoggler-disabled ui-state-disabled");return this},enable:function(){e.Widget.prototype.enable.apply(this,arguments);this.slaves.removeClass("ui-ncbitoggler-disabled ui-state-disabled");var a=this;this.element.click(function(b){a.toggle(b,
a)});return this}});e.ui.ncbitoggler.prototype.options={animation:"slide",closedAppendText:"",cookieNamePrefix:"jig-tog-rem-",indicator:"small-arrow",initOpen:false,isIcon:true,liveRegions:true,openedAppendText:"",remember:false,speed:50}})(jQuery);
