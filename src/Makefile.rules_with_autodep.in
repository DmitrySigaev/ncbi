#################################
# $Id$
# Author:  Denis Vakatov (vakatov@ncbi.nlm.nih.gov)
#################################
#
#  C/C++ compilation rules;  plus
#  auto-dependencies build rules for GNU make
#################################


###  C/C++ compilation
include $(builddir)/Makefile.rules


### Dependencies (GNU make only)
DEPFLAGS_ALL = $(DEPFLAGS) $(LOCAL_CPPFLAGS) $(CPPFLAGS)
%.d: ./%.cpp
	$(CXX_WRAPPER) $(CXX) $(DEPFLAGS_ALL) $< $(DEPFLAGS_POST) \
	  | sed 's%$*@obj_ext@ *:%$*@obj_ext@ $@ :%g' > $@.tmp
	test -s $@.tmp  &&  mv -f $@.tmp $@
%.d: $(srcdir)/%.cpp
	$(CXX_WRAPPER) $(CXX) $(DEPFLAGS_ALL) $< $(DEPFLAGS_POST) \
	  | sed 's%$*@obj_ext@ *:%$*@obj_ext@ $@ :%g' > $@.tmp
	test -s $@.tmp  &&  mv -f $@.tmp $@
%.d: ./%.c
	$(CC_WRAPPER) $(CC)  $(DEPFLAGS_ALL) $< $(DEPFLAGS_POST) \
	  | sed 's%$*@obj_ext@ *:%$*@obj_ext@ $@ :%g' > $@.tmp
	test -s $@.tmp  &&  mv -f $@.tmp $@
%.d: $(srcdir)/%.c
	$(CC_WRAPPER) $(CC)  $(DEPFLAGS_ALL) $< $(DEPFLAGS_POST) \
	  | sed 's%$*@obj_ext@ *:%$*@obj_ext@ $@ :%g' > $@.tmp
	test -s $@.tmp  &&  mv -f $@.tmp $@


ifeq ($(MAKECMDGOALS),clean)
DONT_INCLUDE = 1
endif
ifeq ($(MAKECMDGOALS),purge)
DONT_INCLUDE = 1
endif
ifeq ($(MAKECMDGOALS),requirements)
DONT_INCLUDE = 1
endif

ifndef DONT_INCLUDE
include $(SOURCES:=.d)
endif
