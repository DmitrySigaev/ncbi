-- $Id: omssa.asn,v 1.28 2005/09/21 18:05:59 lewisg Exp $
--**********************************************************************
--
--  OMSSA (Open Mass Spectrometry Search Algorithm) data definitions
--  Lewis Geer, 2003
--
--  make using something like
--  "datatool -m omssa.asn -oc ObjOmssa -oA -od omssa.def"
--
--  note that this file requires omssa.def
--
--**********************************************************************

OMSSA DEFINITIONS ::=
BEGIN


-- Generic holder for experimental info

NameValue ::= SEQUENCE {
	name VisibleString,
        value VisibleString
        }

-- Holds a single spectrum

MSSpectrum ::= SEQUENCE {
	number INTEGER, -- unique number of spectrum
	charge SEQUENCE OF INTEGER,  -- may be more than one if unknown
	precursormz INTEGER,  -- scaled precursor m/z, scale is in MSSearchSettings
	mz SEQUENCE OF INTEGER,  -- scaled product m/z
	abundance SEQUENCE OF INTEGER,  -- scaled product abundance
	iscale REAL,                 -- abundance scale, float to integer
	ids SEQUENCE OF VisibleString OPTIONAL,  -- ids/filenames
        namevalue SEQUENCE OF NameValue OPTIONAL -- extra info: retention times, etc.
	}


-- Holds a set of spectra

MSSpectrumset ::= SEQUENCE OF MSSpectrum


-- enumerate enzymes

MSEnzymes ::= INTEGER {
	trypsin (0),
	argc (1),
        cnbr (2),
	chymotrypsin (3),
	formicacid (4),
	lysc (5),
	lysc-p (6),
	pepsin-a (7),
	tryp-cnbr (8),
	tryp-chymo (9),
	trypsin-p (10),
	whole-protein (11),
	aspn (12),
	gluc (13),
	aspngluc (14),
	top-down (15),
	semi-tryptic (16),
	no-enzyme (17),
	chymotrypsin-p (18),
        max(19),
	none (255)
	}


-- enumerate modifications

MSMod ::= INTEGER {
    methylk (0),          -- methylation of K
    oxym (1),             -- oxidation of methionine
    carboxymethylc (2),   -- carboxymethyl cysteine
    carbamidomethylc(3),  -- carbamidomethyl cysteine
    deamidationkq (4),    -- deamidation of K and Q
    propionamidec (5),    -- propionamide cysteine
    phosphorylations (6), -- phosphorylation of S
    phosphorylationt (7), -- phosphorylation of T
    phosphorylationy (8), -- phosphorylation of Y    
    ntermmcleave (9),     -- N terminal methionine cleavage
    ntermacetyl (10),     -- N terminal protein acetyl
    ntermmethyl (11),     -- N terminal protein methyl
    ntermtrimethyl (12),  -- N terminal protein trimethyl
    methythiold (13),     -- beta methythiolation of D
    methylq (14),         -- methylation of Q
    trimethylk (15),      -- trimethylation of K
    methyld (16),         -- methylation of D
    methyle (17),         -- methylation of E
    ctermpepmethyl (18),     -- C terminal methylation
    trideuteromethyld (19), -- trideuteromethylation of D
    trideuteromethyle (20), -- trideuteromethylation of E
    ctermpeptrideuteromethyl (21),  -- C terminal trideuteromethylation
    nformylmet (22),
    twoamino3oxobutanoicacid (23),
    acetylk (24),
    ctermamide (25),
    bmethylthiold (26),
    carbamidomethylk (27),
    carbamidometylh (28),
    carbamidomethyld (29),
    carbamidomethyle (30),
    carbamylk (31),
    ntermcarbamyl (32),
    citrullinationr (33),
    cysteicacidc (34),
    diiodinationy (35),
    dimethylk (36),
    dimethylr (37),
    ntermpepdimethyl (38),
    dihydroxyf (39),
    thioacetylk (40),
    ntermpeptioacetyl (41),
    farnesylationc (42),
    formylk (43),
    ntermpepformyl (44),
    formylkynureninw (45),
    phef (46),
    gammacarboxyld (47),
    gammacarboxyle (48),
    geranylgeranylc (49),
    ntermpepglucuronylg (50),
    glutathionec (51),
    glyglyk (52),
    guanidinationk (53),
    his2asnh (54),
    his2asph (55),
    ctermpephsem (56),
    ctermpephselactm (57),
    hydroxykynureninw (58),
    hydroxylationd (59),
    hydroxylationk (60),
    hydroxylationn (61),
    hydroxylationp (62),
    hydroxylationf (63),
    hydroxylationy (64),
    iodinationy (65),
    kynureninw (66),
    lipoylk (67),
    ctermpepmeester (68),
    meesterd (69),
    meestere (70),
    meesters (71),
    meestery (72),
    methylc (73),
    methylh (74),
    methyln (75),
    ntermpepmethyl (76),
    methylr (77),
    ntermpepmyristoyeylationg (78),
    ntermpepmyristoyl4hg (79),
    ntermpepmyristoylationg (80),
    myristoylationk (81),
    ntermformyl (82),
    nemc (83),
    nipcam (84),
    nitrow (85),
    nitroy (86),
    ctermpepo18 (87),
    ctermpepdio18 (88),
    oxyh (89),
    oxyw (90),
    ppantetheines (91),
    palmitoylationc (92),
    palmitoylationk (93),
    palmitoylations (94),
    palmitoylationt (95),
    phospholosss (96),
    phospholosst (97),
    phospholossy (98),
    phosphoneutrallossc (99),
    phosphoneutrallossd (100),
    phosphoneutrallossh (101),
    propionylk (102),
    ntermpeppropionyl (103),
    propionylheavyk (104),
    ntermpeppropionylheavy (105),
    pyridylk (106),
    ntermpeppyridyl (107),
    ntermpeppyrocmc (108),
    ntermpeppyroe (109),
    ntermpeppyroq (110),
    pyroglutamicp (111),
    spyridylethylc (112),
    semetm (113),
    sulfationy (114),
    suphonem (115),
    triiodinationy (116),
    trimethylationr (117),
    ntermpeptripalmitatec (118),
    usermod1 (119),  -- start of user defined mods
    usermod2 (120),
    usermod3 (121),
    usermod4 (122),
    usermod5 (123),
    usermod6 (124),
    usermod7 (125),
    usermod8 (126),
    usermod9 (127),
    usermod10 (128), -- end of user defined mods
    icatlight (129),
    icatheavy (130),
    camthiopropanoylk (131),
    phosphoneutrallosss (132),
    phosphoneutrallosst (133),
    max (134), -- maximum number of mods
    none(10000)
    }

-- enumerate modification types

MSModType ::= INTEGER {
    modaa (0),   -- at particular amino acids
    modn (1),    -- at the N terminus of a protein
    modnaa (2),  -- at the N terminus of a protein at particular amino acids
    modc (3),    -- at the C terminus of a protein
    modcaa (4),  -- at the C terminus of a protein at particular amino acids
    modnp (5),   -- at the N terminus of a peptide
    modnpaa (6), -- at the N terminus of a peptide at particular amino acids
    modcp (7),   -- at the C terminus of a peptide
    modcpaa (8), -- at the C terminus of a peptide at particular amino acids
    modmax (9)   -- the max number of modification types
    }


-- mass container

MSMassSet ::= SEQUENCE {
    monomass REAL,
    averagemass REAL,
    n15mass REAL
    }

-- Modification Definition

MSModSpec ::= SEQUENCE {
    mod MSMod,  -- what is the mod
    type MSModType,  -- modification type
    name VisibleString,  -- friendly name of mod
    monomass REAL,       -- monoisotopic mass
    averagemass REAL,    -- average mass
    n15mass REAL,        -- monoisotopic n15 mass
    residues SEQUENCE OF VisibleString OPTIONAL,  -- residues to apply mod to
    neutralloss MSMassSet OPTIONAL  -- loss after precursor mass determination
    }
    
-- Holds a set of modifications

MSModSpecSet ::= SEQUENCE OF MSModSpec

-- How is charge to be handled?  Some input files are not clear
-- on this.  For example, a dta file only specifies one charge, 
-- even though the charge is not really known.

MSCalcPlusOne ::= INTEGER {
	dontcalc (0),  -- don't guess charge one
	calc (1)       -- guess charge one
	}

-- user instructions on whether to believe charges in input file
	
MSCalcCharge ::= INTEGER {
	calculate (0),  -- guess the charge(s) from the data
	usefile (1),    -- use what the input file says
	userange (2)    -- use the charge range specified
	}

-- How to handle precursor charge

MSChargeHandle ::= SEQUENCE {
        calcplusone MSCalcPlusOne DEFAULT 1,  -- do we guess charge one?
	calccharge MSCalcCharge DEFAULT 2,    -- how do we handle other charges?
	mincharge INTEGER DEFAULT 2,          -- if userange, what is the min?
	maxcharge INTEGER DEFAULT 3,          -- if userange, what is the max?
	considermult INTEGER DEFAULT 3,        -- at which precursor charge to consider +2 ions?
        plusone REAL   -- what % of peaks below precursor needed to call as +1
	}
	

-- what type of atomic mass to use

MSSearchType ::= INTEGER {
	monoisotopic(0),
	average(1),
	monon15(2),
	max(3)
	}
	
-- what is the charge dependence of the mass tolerance?

MSZdependence ::= INTEGER {
	independent(0),  -- mass tol. invariant with charge
        linearwithz(1),  -- mass tol. scales with charge
	max(2)
        }
	
-- Search settings

MSSearchSettings ::= SEQUENCE {
	precursorsearchtype MSSearchType,  -- average or monoisotopic?
	productsearchtype MSSearchType,  -- average or monoisotopic?
	ionstosearch SEQUENCE OF MSIonType,  -- which ions to search?
	peptol REAL,  -- peptide mass tolerance
	msmstol REAL, -- msms mass tolerance
	zdep MSZdependence,  -- what is the charge dependence of the mass tolerance?
        cutoff REAL,  -- evalue cutoff
          -- next 3 fields define intensity fraction below
          -- which peaks will be discard
        cutlo REAL, -- the start of the cutoff, fraction of most intense peak
        cuthi REAL, -- the end of the cutoff
        cutinc REAL, -- the increment of the cutoff
        singlewin INTEGER,  -- the size of the single charge filtering window
        doublewin INTEGER,  -- the size of the double charge filtering window
	singlenum INTEGER,  -- the number of peaks allowed in the single window
        doublenum INTEGER,  -- the number of peaks allowed in the double window
	fixed SEQUENCE OF MSMod,     -- fixed PTM's
	variable SEQUENCE OF MSMod,  -- variable PTM's
	enzyme MSEnzymes,      -- digestion enzyme
	missedcleave INTEGER,  -- number of missed cleaves allowed
	hitlistlen INTEGER DEFAULT 25,  -- the number of hits kept in memory
	                                -- for a spectrum
	db VisibleString,  -- sequence set to search, e.g. "nr"
        tophitnum INTEGER, -- number of m/z to consider in first pass
        minhit INTEGER DEFAULT 2, -- minimum number of m/z values for a valid hit
        minspectra INTEGER DEFAULT 4, -- minimum number of m/z for a valid spectra
        scale INTEGER DEFAULT 100,  -- scale for m/z float to integer
        maxmods INTEGER DEFAULT 64,  -- maximum number of mass ladders per
                                     -- database peptide
	taxids SEQUENCE OF INTEGER OPTIONAL,  -- taxa to limit search
	chargehandling MSChargeHandle OPTIONAL,  -- how to deal with charges
	usermods MSModSpecSet OPTIONAL,  -- user defined modifications
	pseudocount INTEGER DEFAULT 1, -- min number of counts per precursor bin
	searchb1 INTEGER DEFAULT 0,    -- should b1 product be in search (1=no, 0=yes)
	searchctermproduct INTEGER DEFAULT 0, -- should c terminus ion be searched (1=no, 0=yes)
	maxproductions INTEGER DEFAULT 0,     -- max number of ions in each series (0=all)
	minnoenzyme INTEGER DEFAULT 4         -- min number of AA in peptide for noenzyme search
}


-- The search request that is given to the OMSSA algorithm

MSRequest ::= SEQUENCE {
	spectra MSSpectrumset,      -- the set of spectra
        settings MSSearchSettings,  -- the search settings
	rid VisibleString OPTIONAL  -- request id
	}


-- enumeration of ion types

MSIonType ::= INTEGER {
	a (0),
	b (1),
        c (2),
	x (3),
	y (4),
	z (5),
	max (6)
	}
	

-- defines a particular ion

MSMZHit ::= SEQUENCE {
	ion MSIonType,  -- ion type, e.g. b
	charge INTEGER, -- ion charge
	number INTEGER, -- the sequential number of the ion
	mz INTEGER  -- scaled m/z value in Da
}


-- contains information about sequences with identical peptide
-- sequences

MSPepHit ::= SEQUENCE {
	start INTEGER,       -- start position (inclusive) in sequence
	stop INTEGER,        -- stop position (inclusive) in sequence
	gi INTEGER OPTIONAL, -- genbank identifier
	accession VisibleString OPTIONAL,  -- sequence accession
	defline VisibleString OPTIONAL,    -- sequence description
	protlength INTEGER OPTIONAL        -- length of protein
}	

-- modifications to a hit peptide

MSModHit ::= SEQUENCE {
	site INTEGER,  -- the position in the peptide
	modtype MSMod  -- the type of modification
	}


-- hits to a given spectrum

MSHits ::= SEQUENCE {
	evalue REAL,     -- E-value (expect value)
	pvalue REAL,     -- P-value (probability value)
	charge INTEGER,  -- the charge state used in search.  -1 == not +1
	pephits SEQUENCE OF MSPepHit, -- peptides that match this hit
	mzhits SEQUENCE OF MSMZHit OPTIONAL,  -- ions hit
	pepstring VisibleString OPTIONAL,  -- the peptide sequence
        mass INTEGER OPTIONAL,  -- scaled experimental mass of peptide in Da
	mods SEQUENCE OF MSModHit OPTIONAL,  -- modifications to sequence
	pepstart VisibleString OPTIONAL,  -- AA before the peptide
        pepstop VisibleString OPTIONAL,   -- AA after the peptide
        protlength INTEGER OPTIONAL,      -- length of protein hit (depricated)
	theomass INTEGER OPTIONAL,        -- scaled theoretical mass of peptide hit
	oid INTEGER OPTIONAL              -- blast library oid    
	}


-- error return for a particular spectrum's hitset

MSHitError ::= INTEGER {
	none (0),
	generalerr (1),
	unable2read (2),  -- can't read the spectrum
	notenuffpeaks (3) -- not enough peaks to search
	}


-- contains a set of hits to a single spectrum

MSHitSet ::= SEQUENCE {
        number INTEGER, -- unique number of spectrum
        error MSHitError OPTIONAL,               -- error, if any
        hits SEQUENCE OF MSHits OPTIONAL,        -- set of hit to spectrum
        ids SEQUENCE OF VisibleString OPTIONAL,  -- filenames or other ids of spectra searched
        namevalue SEQUENCE OF NameValue OPTIONAL -- extra info: retention times, etc.
	}


-- error return for the entire response

MSResponseError ::= INTEGER {
	none (0),
	generalerr (1),
	noblastdb (2),   -- unable to open blast library
	noinput (3)      -- input missing
	}


-- search results

MSResponse ::= SEQUENCE {
	hitsets SEQUENCE OF MSHitSet,  -- hits grouped by spectrum
        scale INTEGER DEFAULT 100,  -- scale to change m/z float to integer
	rid VisibleString OPTIONAL,  -- request id
	error MSResponseError OPTIONAL,  -- error response
        version VisibleString OPTIONAL,  -- version of OMSSA
	email VisibleString OPTIONAL,  -- email address for notification
        dbversion INTEGER OPTIONAL    -- version of db searched (usually size)
	}	
	
-- holds both search requests and responses

MSSearch ::= SEQUENCE {
	request SEQUENCE OF MSRequest OPTIONAL,
	response SEQUENCE OF MSResponse OPTIONAL
	}

END
