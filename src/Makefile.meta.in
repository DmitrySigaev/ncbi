#################################
# $Id$
# Author:  Denis Vakatov (vakatov@ncbi.nlm.nih.gov)
#################################
# Meta-makefile(to be configured into "Makefile")
# This can be used to build/install/clean [PROJECT] makefiles
# in current directory and in the below [SUBPROJ] directories.
#
# PROJECT = Makefile.p1 Makefile.p2
# SUBPROJ = app sub_proj1 sub_proj2
# include @builddir@/Makefile.meta
#################################


### Make sure we are using a right command shell

@make_shell@


### One-level build -- [PROJECT] makefiles

PROJ_BRA = \
if test ! -z "$(PROJECT)" ; then \
   x_project="$(PROJECT)" ; \
   for i in $$x_project ; do \
		$(MAKE) -f $$i $(MFLAGS)
PROJ_KET = ; \
   done ; \
fi

all:
	@$(PROJ_BRA) all   $(PROJ_KET)
clean:
	@$(PROJ_BRA) clean $(PROJ_KET)
purge:
	@$(PROJ_BRA) purge $(PROJ_KET)


### Recursive build -- in the [SUBPROJ] directories

SUB_BRA = \
if test ! -z "$(SUBPROJ)" ; then \
	x_subproj="$(SUBPROJ)" ; \
	for i in $$x_subproj ; do \
		( if test -d $$i ; then \
          cd $$i  &&  $(MAKE) $(MFLAGS)

SUB_KET = ; else \
          echo "Warning:  non-existent sub-project \"$$i\"" ; \
        fi ) ; \
	done ; \
fi

all_r: all
	@$(SUB_BRA) all_r   $(SUB_KET)
clean_r: clean
	@$(SUB_BRA) clean_r $(SUB_KET)
purge_r: purge 
	@$(SUB_BRA) purge_r $(SUB_KET)
