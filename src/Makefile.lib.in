#################################
# $Id$
# Author:  Denis Vakatov (vakatov@ncbi.nlm.nih.gov)
#################################
# This can be used to build/install/clean
#  1) a single(sic!) library [LIBOBJ, LIB],  and/or
#  2) set of separate standalone object files [OBJ]
#
# srcdir = @srcdir@
# include @builddir@/Makefile.mk
#
# LIBOBJ  = p1_lib1 p1_lib2 
# LIB     = p1
# OBJ     = p1_obj1
# SUBPROJ = app sub_proj1 sub_proj2
# .....
# CXXFLAGS = -g $(ORIG_CXXFLAGS) -D_DEBUG -DXYZ_P1_PROJECT
# .....
# include @builddir@/Makefile.lib
#################################


### Add prefixes and extentions
XLIBOBJ = $(LIBOBJ:=@obj_ext@)
XOBJ    = $(OBJ:=@obj_ext@)
XLIB    = $(LIB:%=@lib_pre@%@lib_ext@)


### C/C++ source file compilation rules

%@obj_ext@: $(srcdir)/%.cpp
	$(CXX) @f_compile@ $(CXXFLAGS) $(CPPFLAGS) $< @f_outobj@$@
%@obj_ext@: $(srcdir)/%.c
	$(CC)  @f_compile@ $(CFLAGS)   $(CPPFLAGS) $< @f_outobj@$@


### The library build rule

$(XLIB): $(XLIBOBJ)
	$(AR) @f_outlib@$(XLIB) $(XLIBOBJ)
	-$(RANLIB) $(XLIB)


### Standard targets

all: $(XLIB) $(XOBJ)
	@$(COPY_IF) $(libdir) $(XLIB) $(XOBJ)

clean:
	-$(RMDIR) SunWS_cache
	-$(RM) .make.state
	-$(RM) $(XLIBOBJ)
	-$(RM) $(XLIB)
	-$(RM) $(XOBJ)
	-$(RM) *~

purge: clean
	-cd $(libdir)  &&  $(RM) $(XLIB) $(XOBJ)
