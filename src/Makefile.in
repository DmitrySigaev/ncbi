# $Id$

# Master (top-level) makefile for all NCBI C++ projects
##################################################################

include ./Makefile.mk


#################################
#  Standard meta-makefile
#################################


MANDATORY_PROJ  = corelib util connect cgi html hello

OPTIONAL_PROJ   = @serial@ @dbapi@ @objects@ @ctools@ @app@ @algo@ \
   @internal@
X_OPTIONAL_PROJ =  serial dbapi objects ctools app algo \
   internal
CHECK_SUB_PROJ = @check@
EXPENDABLE_SUB_PROJ = @gui@

SUB_PROJ = $(MANDATORY_PROJ) $(OPTIONAL_PROJ) $(CHECK_SUB_PROJ)
include ./Makefile.meta



#################################
#  Special rules
#################################


#
# Prepare for install:   get rid of everything not needed for the install
# and move aside internal libraries we plan to stop installing altogether
#

apps_to_drop = $(top_srcdir)/scripts/internal/projects/apps_to_drop
libs_to_drop = $(top_srcdir)/scripts/internal/projects/libs_to_drop
dbindir = $(bindir)/.DEATH-ROW
dlibdir = $(libdir)/.DEATH-ROW
strip_for_install:
	test "$(COMPILER)-$(DEBUG_SFX)" = "workshop-Debug" || \
	  rm -rf $(MANDATORY_PROJ) $(X_OPTIONAL_PROJ) check $(POTENTIAL_SUB_PROJ) Makefile
	@test \! -f "$(apps_to_drop)" || \
	  while read app; do \
	    test -f "$(bindir)/$$app" && mkdir -p $(dbindir) && \
	      echo mv .../bin/$$app .../bin/.DEATH-ROW && \
	      mv $(bindir)/$$app $(dbindir); \
	  done < "$(apps_to_drop)"
	@test \! -f "$(libs_to_drop)" || \
	  while read lib; do \
	    test -f "$(status_dir)/.$$lib.dep" && mkdir -p $(dlibdir) && \
	      echo mv .../lib/lib$$lib.\* .../lib/.DEATH-ROW && \
	      mv $(libdir)/lib$$lib.* $(dlibdir); \
	    test -f "$(status_dir)/.$$lib-static.dep" && \
	      mv $(libdir)/lib$$lib-static.* $(dlibdir); \
	  done < "$(libs_to_drop)"
